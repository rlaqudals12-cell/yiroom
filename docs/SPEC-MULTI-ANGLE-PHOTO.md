# SPEC: ë‹¤ê°ë„ ì´¬ì˜ ì‹œìŠ¤í…œ

> í”¼ë¶€/í¼ìŠ¤ë„ì»¬ëŸ¬ ë¶„ì„ ì •í™•ë„ í–¥ìƒì„ ìœ„í•œ ë‹¤ê°ë„ ì´¬ì˜ ë° ì´ë¯¸ì§€ ê²€ì¦ ì‹œìŠ¤í…œ

**Version**: 1.0
**Date**: 2026-01-08
**Status**: Draft
**Author**: Claude Code

---

## ëª©ì 

ì „ë¬¸ í”¼ë¶€ ë¶„ì„ê¸°ì²˜ëŸ¼ ë‹¤ê°ë„ ì´¬ì˜ì„ ì§€ì›í•˜ì—¬ AI ë¶„ì„ ì •í™•ë„ë¥¼ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

### ê¸°ëŒ€ íš¨ê³¼

| ì´¬ì˜ ë°©ì‹          | ì‹ ë¢°ë„ | ë¶„ì„ í’ˆì§ˆ   |
| ------------------ | ------ | ----------- |
| ì •ë©´ë§Œ             | 75%    | ê¸°ë³¸ ë¶„ì„   |
| ì •ë©´ + ì¢Œì¸¡        | 85%    | í–¥ìƒëœ ë¶„ì„ |
| ì •ë©´ + ì¢Œì¸¡ + ìš°ì¸¡ | 95%    | ì •ë°€ ë¶„ì„   |

---

## ì ìš© ë²”ìœ„

| ëª¨ë“ˆ              | ì ìš© ì—¬ë¶€ | ë¹„ê³                            |
| ----------------- | --------- | ------------------------------ |
| S-1 (í”¼ë¶€ ë¶„ì„)   | **1ìˆœìœ„** | í”¼ë¶€ ìƒíƒœëŠ” ì¢Œìš° ë¹„ëŒ€ì¹­ì´ ë§ìŒ |
| PC-1 (í¼ìŠ¤ë„ì»¬ëŸ¬) | 2ìˆœìœ„     | 1íšŒì„± ë¶„ì„, ì •ë©´ë§Œìœ¼ë¡œë„ ì¶©ë¶„  |
| C-1 (ì²´í˜• ë¶„ì„)   | ì œì™¸      | ì „ì‹  ì´¬ì˜ìœ¼ë¡œ ë³„ë„ í”Œë¡œìš°      |

---

## ê¸°ëŠ¥ ëª…ì„¸

### 1. ì¹´ë©”ë¼ ì´¬ì˜ ê°€ì´ë“œ

#### 1.1 ê°€ì´ë“œ ì˜¤ë²„ë ˆì´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚      â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®          â”‚
â”‚      â”‚               â”‚          â”‚
â”‚      â”‚   ğŸ‘¤ ì •ë©´     â”‚          â”‚  â† ì–¼êµ´ ì‹¤ë£¨ì—£ SVG
â”‚      â”‚   ê°€ì´ë“œ      â”‚          â”‚
â”‚      â”‚               â”‚          â”‚
â”‚      â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯          â”‚
â”‚                                 â”‚
â”‚  "ì–¼êµ´ì„ ê°€ì´ë“œì— ë§ì¶°ì£¼ì„¸ìš”"    â”‚
â”‚                                 â”‚
â”‚         [ ğŸ“· ì´¬ì˜ ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.2 ê°ë„ë³„ ê°€ì´ë“œ

| ê°ë„        | ì‹¤ë£¨ì—£    | ì•ˆë‚´ ë¬¸êµ¬                    |
| ----------- | --------- | ---------------------------- |
| ì •ë©´ (í•„ìˆ˜) | ì •ë©´ ì–¼êµ´ | "ì •ë©´ì„ ë°”ë¼ë´ì£¼ì„¸ìš”"        |
| ì¢Œì¸¡ (ì„ íƒ) | 45Â° ì¢Œì¸¡  | "ì™¼ìª½ìœ¼ë¡œ ì‚´ì§ ëŒë ¤ì£¼ì„¸ìš”"   |
| ìš°ì¸¡ (ì„ íƒ) | 45Â° ìš°ì¸¡  | "ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì‚´ì§ ëŒë ¤ì£¼ì„¸ìš”" |

#### 1.3 UX í”Œë¡œìš°

```
[ì •ë©´ ì´¬ì˜] â† í•„ìˆ˜
    â†“
"ì •í™•ë„ë¥¼ ë†’ì´ë ¤ë©´ ì¢Œ/ìš° ì‚¬ì§„ë„ ì¶”ê°€í•´ì£¼ì„¸ìš”"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  â”‚
â”‚  [ì¢Œì¸¡ ì¶”ê°€]     [ìš°ì¸¡ ì¶”ê°€]     â”‚
â”‚                                  â”‚
â”‚         [ê±´ë„ˆë›°ê¸° â†’]             â”‚
â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[ë¶„ì„ ì‹œì‘]
```

---

### 2. ê°¤ëŸ¬ë¦¬ ì—…ë¡œë“œ ê²€ì¦

#### 2.1 ê²€ì¦ íë¦„

```
[ì‚¬ì§„ ì„ íƒ] â†’ [AI ê²€ì¦] â†’ ì í•©/ë¶€ì í•© íŒë‹¨
                  â†“
            ì í•©: ë‹¤ìŒ ë‹¨ê³„
            ë¶€ì í•©: ì¬ì—…ë¡œë“œ ìš”ì²­
```

#### 2.2 ê²€ì¦ ê¸°ì¤€

| í•­ëª©      | ê¸°ì¤€           | ë¶€ì í•© ì‹œ ë©”ì‹œì§€                    |
| --------- | -------------- | ----------------------------------- |
| ì–¼êµ´ ê°ì§€ | ì–¼êµ´ 1ê°œ ê°ì§€  | "ì–¼êµ´ì´ ëª…í™•í•˜ê²Œ ë³´ì´ì§€ ì•Šì•„ìš”"     |
| ê°ë„ ì¼ì¹˜ | ìš”ì²­ ê°ë„ Â±15Â° | "ì •ë©´ ì‚¬ì§„ì´ í•„ìš”í•´ìš”"              |
| ì¡°ëª… í’ˆì§ˆ | ì ì • ë°ê¸°      | "ì¡°ëª…ì´ ë„ˆë¬´ ì–´ë‘¡ê±°ë‚˜ ë°ì•„ìš”"       |
| ë©”ì´í¬ì—…  | ì§„í•œ í™”ì¥ ê°ì§€ | "ë§¨ ì–¼êµ´ ì‚¬ì§„ì´ ë” ì •í™•í•´ìš”" (ê²½ê³ ) |

#### 2.3 ê²€ì¦ API

```typescript
// POST /api/validate/face-image
interface ValidateFaceImageRequest {
  imageBase64: string;
  expectedAngle: 'front' | 'left' | 'right';
}

interface ValidateFaceImageResponse {
  suitable: boolean;
  reason?: string; // ë¶€ì í•© ì‚¬ìœ 
  detectedAngle?: 'front' | 'left' | 'right' | 'unknown';
  quality: {
    lighting: 'good' | 'dark' | 'bright' | 'uneven';
    makeupDetected: boolean;
    faceDetected: boolean;
    blur: boolean;
  };
}
```

---

### 3. AI í”„ë¡¬í”„íŠ¸ (ì´ë¯¸ì§€ ê²€ì¦ìš©)

```typescript
const validateFaceImagePrompt = `
ë‹¹ì‹ ì€ ì–¼êµ´ ì´ë¯¸ì§€ í’ˆì§ˆ ê²€ì¦ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

ğŸ“‹ ê²€ì¦ ìˆœì„œ:
1. ì–¼êµ´ì´ ì´ë¯¸ì§€ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
2. ì–¼êµ´ì˜ ê°ë„ë¥¼ íŒë‹¨í•˜ì„¸ìš” (ì •ë©´/ì¢Œì¸¡/ìš°ì¸¡).
3. ì¡°ëª… ìƒíƒœë¥¼ í‰ê°€í•˜ì„¸ìš”.
4. ë©”ì´í¬ì—… ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”.
5. íë¦¼/ì €í•´ìƒë„ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”.

âš ï¸ íŒë‹¨ ê¸°ì¤€:
- ì •ë©´: ì½”ê°€ ì–¼êµ´ ì¤‘ì•™, ì–‘ìª½ ëˆˆì´ ëŒ€ì¹­
- ì¢Œì¸¡: ì™¼ìª½ ì–¼êµ´ì´ ë” ë§ì´ ë³´ì„, ì˜¤ë¥¸ìª½ ê·€ ì•ˆ ë³´ì„
- ìš°ì¸¡: ì˜¤ë¥¸ìª½ ì–¼êµ´ì´ ë” ë§ì´ ë³´ì„, ì™¼ìª½ ê·€ ì•ˆ ë³´ì„

ğŸ“Š ìš”ì²­ëœ ê°ë„: ${expectedAngle}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´ì£¼ì„¸ìš”:
{
  "suitable": [true/false - ìš”ì²­ ê°ë„ì™€ ì¼ì¹˜í•˜ë©´ true],
  "reason": "[ë¶€ì í•© ì‹œ í•œêµ­ì–´ ì‚¬ìœ ]",
  "detectedAngle": "[front|left|right|unknown]",
  "quality": {
    "lighting": "[good|dark|bright|uneven]",
    "makeupDetected": [true/false],
    "faceDetected": [true/false],
    "blur": [true/false]
  }
}
`;
```

---

### 4. ë‹¤ê°ë„ ë¶„ì„ í”„ë¡¬í”„íŠ¸ (S-1 í”¼ë¶€)

```typescript
const multiAngleSkinAnalysisPrompt = `
ë‹¹ì‹ ì€ ì „ë¬¸ í”¼ë¶€ê³¼í•™ ê¸°ë°˜ AI ë¶„ì„ê°€ì…ë‹ˆë‹¤.

ğŸ“· ì œê³µëœ ì´ë¯¸ì§€:
- ì •ë©´ ì´ë¯¸ì§€: ${hasfront ? 'ìˆìŒ' : 'ì—†ìŒ'}
- ì¢Œì¸¡ ì´ë¯¸ì§€: ${hasLeft ? 'ìˆìŒ' : 'ì—†ìŒ'}
- ìš°ì¸¡ ì´ë¯¸ì§€: ${hasRight ? 'ìˆìŒ' : 'ì—†ìŒ'}

ğŸ“‹ ë¶„ì„ ìˆœì„œ:
1. ê° ì´ë¯¸ì§€ì˜ ì¡°ëª… ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.
2. ì •ë©´ ì´ë¯¸ì§€ë¡œ ì „ì²´ì ì¸ í”¼ë¶€ ìƒíƒœë¥¼ í‰ê°€í•˜ì„¸ìš”.
3. ì¢Œì¸¡/ìš°ì¸¡ ì´ë¯¸ì§€ê°€ ìˆë‹¤ë©´ ì¢Œìš° ë¹„ëŒ€ì¹­ ìƒíƒœë¥¼ ë¹„êµí•˜ì„¸ìš”.
4. ëª¨ë“  ì´ë¯¸ì§€ë¥¼ ì¢…í•©í•˜ì—¬ ìµœì¢… ì ìˆ˜ë¥¼ ì‚°ì¶œí•˜ì„¸ìš”.

âš ï¸ ë‹¤ê°ë„ ë¶„ì„ ì‹œ ì£¼ì˜:
- ì¢Œìš° í”¼ë¶€ ìƒíƒœê°€ ë‹¤ë¥´ë©´ ë” ë‚˜ìœ ìª½ ê¸°ì¤€ìœ¼ë¡œ ì ìˆ˜ ì‚°ì¶œ
- ì¡°ëª…ì´ ë‹¤ë¥¸ ì´ë¯¸ì§€ëŠ” ì‹ ë¢°ë„ ë‚®ì¶¤
- ì •ë©´ë§Œ ìˆì„ ê²½ìš° analysisReliability: "medium"
- 3ì¥ ëª¨ë‘ ìˆì„ ê²½ìš° analysisReliability: "high"

ğŸ“Š í”¼ë¶€ ë¶„ì„ ê¸°ì¤€:
[ê¸°ì¡´ S-1 í”„ë¡¬í”„íŠ¸ì˜ ë¶„ì„ ê¸°ì¤€ í¬í•¨]

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´ì£¼ì„¸ìš”:
{
  "imagesAnalyzed": {
    "front": [true/false],
    "left": [true/false],
    "right": [true/false]
  },
  "asymmetryDetected": [true/false],
  "asymmetryDetails": "[ì¢Œìš° ë¹„ëŒ€ì¹­ ìƒì„¸ - ìˆì„ ê²½ìš°]",
  // ... ê¸°ì¡´ S-1 ê²°ê³¼ í•„ë“œë“¤
  "analysisReliability": "[high|medium|low]"
}
`;
```

---

## ë°ì´í„°ë² ì´ìŠ¤

### ìŠ¤í‚¤ë§ˆ ë³€ê²½

```sql
-- skin_analyses í…Œì´ë¸”ì— ë‹¤ê°ë„ ì´ë¯¸ì§€ ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE skin_analyses
  ADD COLUMN IF NOT EXISTS front_image_url TEXT,
  ADD COLUMN IF NOT EXISTS left_image_url TEXT,
  ADD COLUMN IF NOT EXISTS right_image_url TEXT,
  ADD COLUMN IF NOT EXISTS images_count INT DEFAULT 1;

-- ê¸°ì¡´ image_urlì„ front_image_urlë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
UPDATE skin_analyses
SET front_image_url = image_url
WHERE front_image_url IS NULL AND image_url IS NOT NULL;
```

---

## ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
components/analysis/
â”œâ”€â”€ camera/
â”‚   â”œâ”€â”€ FaceGuideOverlay.tsx      # ì–¼êµ´ ê°€ì´ë“œ ì˜¤ë²„ë ˆì´
â”‚   â”œâ”€â”€ AngleSelector.tsx         # ê°ë„ ì„ íƒ UI
â”‚   â””â”€â”€ MultiAngleCapture.tsx     # ë‹¤ê°ë„ ì´¬ì˜ í”Œë¡œìš°
â”œâ”€â”€ validation/
â”‚   â””â”€â”€ ImageValidator.tsx        # ì´ë¯¸ì§€ ê²€ì¦ ê²°ê³¼ í‘œì‹œ
â””â”€â”€ skin/
    â””â”€â”€ MultiAngleSkinCapture.tsx # S-1ìš© í†µí•© ì»´í¬ë„ŒíŠ¸
```

---

## API ì—”ë“œí¬ì¸íŠ¸

| ë©”ì„œë“œ | ê²½ë¡œ                       | ì„¤ëª…                    |
| ------ | -------------------------- | ----------------------- |
| POST   | `/api/validate/face-image` | ì–¼êµ´ ì´ë¯¸ì§€ ê²€ì¦        |
| POST   | `/api/analyze/skin`        | í”¼ë¶€ ë¶„ì„ (ë‹¤ê°ë„ ì§€ì›) |

### ìš”ì²­ í˜•ì‹ ë³€ê²½

```typescript
// ê¸°ì¡´
interface SkinAnalysisRequest {
  imageBase64: string;
}

// ë³€ê²½
interface SkinAnalysisRequest {
  frontImageBase64: string; // í•„ìˆ˜
  leftImageBase64?: string; // ì„ íƒ
  rightImageBase64?: string; // ì„ íƒ
}
```

---

## ë¹„ìš© ë¶„ì„

### Gemini API í† í°

| í•­ëª©      | 1ì¥  | 3ì¥    | ì¦ê°€ìœ¨   |
| --------- | ---- | ------ | -------- |
| ì…ë ¥ í† í° | ~300 | ~800   | +167%    |
| ì¶œë ¥ í† í° | ~500 | ~500   | 0%       |
| **ì´í•©**  | ~800 | ~1,300 | **+63%** |

### ê²€ì¦ API ì¶”ê°€ ë¹„ìš©

- ì´ë¯¸ì§€ë‹¹ ê²€ì¦: ~200 í† í°
- 3ì¥ ê²€ì¦ ì‹œ: ~600 í† í° ì¶”ê°€
- **ì´ 3ì¥ ë¶„ì„ ë¹„ìš©**: ~1,900 í† í° (ê¸°ì¡´ ëŒ€ë¹„ 2.4ë°°)

> Gemini 3 Flash ê°€ê²©ì´ ì €ë ´í•˜ë¯€ë¡œ ìˆ˜ìš© ê°€ëŠ¥í•œ ìˆ˜ì¤€

---

## êµ¬í˜„ ìˆœì„œ

### Phase 1: ì´ë¯¸ì§€ ê²€ì¦ API

1. `/api/validate/face-image` ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
2. ê²€ì¦ í”„ë¡¬í”„íŠ¸ ì‘ì„± ë° í…ŒìŠ¤íŠ¸
3. Mock fallback êµ¬í˜„

### Phase 2: ì¹´ë©”ë¼ ê°€ì´ë“œ ì»´í¬ë„ŒíŠ¸

1. `FaceGuideOverlay` ì»´í¬ë„ŒíŠ¸ (SVG ê°€ì´ë“œ)
2. `AngleSelector` ì»´í¬ë„ŒíŠ¸ (ì¢Œ/ìš° ì„ íƒ)
3. `MultiAngleCapture` í†µí•© í”Œë¡œìš°

### Phase 3: S-1 í†µí•©

1. `skin_analyses` í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜
2. S-1 API ë‹¤ê°ë„ ì§€ì› ì¶”ê°€
3. S-1 í”„ë¡¬í”„íŠ¸ ì—…ë°ì´íŠ¸
4. ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸

### Phase 4: ê°¤ëŸ¬ë¦¬ ì—…ë¡œë“œ ê²€ì¦

1. ì—…ë¡œë“œ ì‹œ ìë™ ê²€ì¦ ì—°ë™
2. ë¶€ì í•© ì‹œ ì¬ì—…ë¡œë“œ UI

---

## í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

### ê²€ì¦ API

- [ ] ì •ë©´ ì‚¬ì§„ â†’ ì •ë©´ ìš”ì²­ ì‹œ suitable: true
- [ ] ì¢Œì¸¡ ì‚¬ì§„ â†’ ì •ë©´ ìš”ì²­ ì‹œ suitable: false
- [ ] ì–¼êµ´ ì—†ëŠ” ì‚¬ì§„ â†’ faceDetected: false
- [ ] ì–´ë‘ìš´ ì‚¬ì§„ â†’ lighting: "dark"

### ë‹¤ê°ë„ ë¶„ì„

- [ ] ì •ë©´ë§Œ ë¶„ì„ â†’ analysisReliability: "medium"
- [ ] 3ì¥ ë¶„ì„ â†’ analysisReliability: "high"
- [ ] ì¢Œìš° ë¹„ëŒ€ì¹­ ê°ì§€ â†’ asymmetryDetected: true

---

## ì°¸ê³ 

- [prompt-engineering.md](../.claude/rules/prompt-engineering.md) - í”„ë¡¬í”„íŠ¸ ì‘ì„± ê·œì¹™
- [ai-integration.md](../.claude/rules/ai-integration.md) - AI í†µí•© íŒ¨í„´
- [SDD-VISUAL-ANALYSIS-ENGINE.md](./SDD-VISUAL-ANALYSIS-ENGINE.md) - ë¹„ì£¼ì–¼ ë¶„ì„ ì—”ì§„

---

**Approved by**: (ìŠ¹ì¸ ëŒ€ê¸°)
**Implementation Start**: (ëŒ€ê¸° ì¤‘)
