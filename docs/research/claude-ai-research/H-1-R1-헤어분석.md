# H-1-R1: 헤어 분석 리서치 (Hair Analysis Research)

> **Version**: 2.0
> **Created**: 2026-01-23
> **Updated**: 2026-01-23
> **Status**: Complete
> **Author**: Claude Code

---

## 1. 핵심 요약

AI 기반 헤어 분석 시스템 구축을 위한 종합 기술 리서치. 헤어 타입 분류(Andre Walker 4-Type System), 두피 건강 지표(sebumeter 원리 기반), Lab 색공간 헤어컬러 분석, **7가지 얼굴형별** 헤어스타일 추천 알고리즘을 다룬다. **한국인 모발의 특수성**(평균 굵기 80-100μm, 직모 우세, 동양인 멜라닌 특성)을 반영한 분류 기준과 TypeScript 구현 방향을 제시한다.

### 1.1 관련 문서

| 문서 유형 | 경로 | 설명 |
|----------|------|------|
| **원리** | `docs/principles/hair-makeup-analysis.md` | 헤어/메이크업 분석 원리 |
| **스펙** | `docs/specs/SDD-HAIR-ANALYSIS.md` | H-1 헤어 분석 스펙 |
| **색채학** | `docs/principles/color-science.md` | Lab 색공간, 웜톤/쿨톤 이론 |
| **얼굴 랜드마크** | `docs/research/claude-ai-research/CIE-2-R1-얼굴랜드마크.md` | MediaPipe 얼굴 감지 |

### 1.2 학술적 근거 출처

- Andre Walker Hair Typing System (1990s) - 모발 타입 분류 체계
- International Colour Chart System (ICC) - 헤어 레벨 시스템
- L'Oréal Professional Hair Color Level System
- Farkas, L.G. (1994). "Anthropometry of the Head and Face" - 얼굴 측정학
- 대한피부과학회 (2020). "한국인 두피 및 모발 특성 연구"
- 대한성형외과학회 (2019). "한국인 안면 비율 연구"
- CIE 1976 L*a*b* 색공간 표준

---

## 2. 헤어 타입 분류 상세

### 2.1 Andre Walker Hair Typing System (1-4 타입)

Andre Walker(오프라 윈프리의 스타일리스트)가 개발한 모발 분류 체계로, 전 세계적으로 가장 널리 사용된다.

#### 2.1.1 메인 타입 분류

| 타입 | 명칭 | 특징 | 모낭 형태 | 한국인 비율 |
|------|------|------|----------|------------|
| **Type 1** | Straight (직모) | S-패턴 없음, 가장 강한 윤기 | 원형 | ~85% |
| **Type 2** | Wavy (웨이브) | S-패턴, 두피~끝 방향 웨이브 | 타원형 | ~12% |
| **Type 3** | Curly (곱슬) | 명확한 컬 패턴, 스프링 형태 | 납작한 타원형 | ~2.5% |
| **Type 4** | Coily (코일리) | Z-패턴, 가장 취약 | 비대칭/리본형 | ~0.5% |

#### 2.1.2 세부 타입 분류 (A/B/C)

```
Type 1 (Straight):
├── 1A: 완전 직모, 볼륨 어려움, 가장 얇음
├── 1B: 직모이나 약간의 바디감, 보통 굵기
└── 1C: 굵은 직모, 약간의 웨이브 가능성

Type 2 (Wavy):
├── 2A: 느슨한 S-패턴, 얼굴 근처 직모에 가까움
├── 2B: 뚜렷한 S-패턴, 중간부터 웨이브
└── 2C: 강한 웨이브, 곱슬에 가까움, 프리즈 발생

Type 3 (Curly):
├── 3A: 느슨한 컬, 직경 ~인치, 잘 정의된 S/Z 패턴
├── 3B: 타이트한 컬, 직경 마커펜 정도, 스프링 같음
└── 3C: 매우 타이트한 컬, 직경 연필 정도, 볼륨 극대

Type 4 (Coily):
├── 4A: 타이트한 코일, S-패턴 존재, 탄력 있음
├── 4B: Z-패턴, 직각 굽힘, 가장 수축률 높음
└── 4C: 정의된 패턴 없음, 극도로 취약, 최대 수축
```

#### 2.1.3 타입별 특성 상세

| 세부 타입 | 수축률 | 습도 민감도 | 손상 취약도 | 추천 케어 |
|----------|--------|------------|------------|----------|
| 1A | 0% | 낮음 | 낮음 | 볼륨 샴푸 |
| 1B | 0% | 낮음 | 낮음 | 일반 케어 |
| 1C | 0-5% | 중간 | 낮음 | 컬 크림 |
| 2A | 5-10% | 중간 | 낮음 | 가벼운 무스 |
| 2B | 10-20% | 높음 | 중간 | 안티프리즈 |
| 2C | 20-30% | 매우 높음 | 중간 | 딥 컨디셔닝 |
| 3A | 30-40% | 높음 | 높음 | 리브인 컨디셔너 |
| 3B | 40-50% | 높음 | 높음 | 오일 시링 |
| 3C | 50-60% | 매우 높음 | 매우 높음 | LOC 메서드 |
| 4A | 60-70% | 매우 높음 | 극도로 높음 | LCO 메서드 |
| 4B | 70-80% | 극도로 높음 | 극도로 높음 | 프로텍티브 스타일 |
| 4C | 75%+ | 극도로 높음 | 극도로 높음 | 수분 시링 |

### 2.2 모발 굵기 (Hair Diameter/Thickness)

#### 2.2.1 측정 기준

모발 굵기는 **단일 모발의 직경**으로 측정하며, 현미경 또는 마이크로미터로 정밀 측정한다.

| 분류 | 직경 범위 | 특징 | 스타일링 특성 |
|------|----------|------|--------------|
| **Fine (가는 모발)** | 50-70μm | 부드러움, 볼륨 부족 | 쉽게 납작해짐, 열 손상 취약 |
| **Medium (보통 모발)** | 70-90μm | 균형 잡힌 특성 | 다양한 스타일 가능 |
| **Coarse/Thick (굵은 모발)** | 90-120μm | 강함, 윤기 좋음 | 스타일링 유지력 좋음, 드라이 시간 김 |

#### 2.2.2 인종별 평균 모발 굵기

| 인종/민족 | 평균 직경 | 범위 | 특이사항 |
|----------|----------|------|---------|
| **한국인** | 80-100μm | 60-120μm | 직경 크나 밀도 낮음 |
| **동아시아인 전체** | 80-120μm | 60-130μm | 가장 굵은 편 |
| **백인** | 50-90μm | 40-100μm | 중간 |
| **아프리카계** | 60-90μm | 50-100μm | 타원형 단면, 컬 형성 |

#### 2.2.3 굵기 판정 알고리즘 (이미지 기반 추정)

```python
def estimate_hair_thickness(hair_strand_pixels: List[int], image_resolution_dpi: float) -> str:
    """
    이미지에서 모발 가닥 두께 추정

    Args:
        hair_strand_pixels: 모발 가닥의 픽셀 너비들
        image_resolution_dpi: 이미지 해상도

    Returns:
        'fine' | 'medium' | 'thick'
    """
    # 픽셀을 마이크로미터로 변환
    # 1 inch = 25400 μm
    pixel_to_um = 25400 / image_resolution_dpi

    diameters_um = [px * pixel_to_um for px in hair_strand_pixels]
    avg_diameter = sum(diameters_um) / len(diameters_um)

    # AI 기반 이미지 분석에서는 상대적 비교 사용
    # (절대 측정은 현미경 필요)
    if avg_diameter < 70:
        return 'fine'
    elif avg_diameter < 90:
        return 'medium'
    else:
        return 'thick'
```

### 2.3 모발 밀도 (Hair Density)

#### 2.3.1 밀도 분류

모발 밀도는 **두피 단위 면적당 모발 수**로 측정한다.

| 분류 | 밀도 (개/cm²) | 총 모발 수 추정 | 시각적 특징 |
|------|--------------|---------------|------------|
| **Low (저밀도)** | < 100 | < 80,000개 | 두피 쉽게 보임 |
| **Medium (중밀도)** | 100-150 | 80,000-120,000개 | 두피 일부 보임 |
| **High (고밀도)** | > 150 | > 120,000개 | 두피 거의 안 보임 |

#### 2.3.2 인종별 평균 밀도

| 인종/민족 | 평균 밀도 (개/cm²) | 총 모발 수 | 특이사항 |
|----------|------------------|-----------|---------|
| **한국인** | 100-130 | ~100,000개 | 굵기 대비 밀도 낮음 |
| **백인 (금발)** | 140-150 | ~140,000개 | 가장 높은 밀도 |
| **백인 (갈색)** | 110-120 | ~110,000개 | 중간 |
| **백인 (흑발)** | 100-110 | ~100,000개 | 비교적 낮음 |
| **아프리카계** | 60-90 | ~60,000-90,000개 | 낮은 밀도, 굵은 모발 |

#### 2.3.3 밀도 AI 판정 기준

```typescript
interface DensityEstimation {
  scalpVisibility: number;    // 두피 가시성 (0-100, 높을수록 두피 잘 보임)
  strandCount: number;        // 샘플 영역 내 모발 가닥 수
  coverage: number;           // 커버리지 비율 (0-100)
}

function estimateDensity(estimation: DensityEstimation): 'low' | 'medium' | 'high' {
  // 두피 가시성 기반 (주요 지표)
  if (estimation.scalpVisibility > 60) return 'low';
  if (estimation.scalpVisibility > 30) return 'medium';

  // 커버리지 보조 지표
  if (estimation.coverage < 50) return 'low';
  if (estimation.coverage < 75) return 'medium';

  return 'high';
}
```

### 2.4 모발 다공성 (Porosity)

모발의 수분/제품 흡수 능력을 결정하는 큐티클층 상태.

#### 2.4.1 다공성 분류

| 분류 | 큐티클 상태 | 수분 흡수 | 수분 유지 | 특징 |
|------|-----------|----------|----------|------|
| **Low (저다공성)** | 단단히 닫힘 | 느림 | 좋음 | 제품 축적, 열 필요 |
| **Medium (중다공성)** | 적절히 열림 | 적당 | 적당 | 이상적 상태 |
| **High (고다공성)** | 손상/열림 | 빠름 | 나쁨 | 빠른 건조, 프리즈 |

#### 2.4.2 Float Test 원리

```
저다공성: 물에 뜸 (4시간+ 후 가라앉음)
중다공성: 서서히 가라앉음 (2-4분)
고다공성: 즉시 가라앉음 (<2분)
```

---

## 3. 두피 건강 지표

### 3.1 유분도 측정 (Sebumeter 원리)

#### 3.1.1 Sebumeter 작동 원리

Sebumeter는 **광학 밀도 변화**를 이용하여 피지량을 측정한다.

```
측정 원리:
1. 특수 테이프를 두피에 접촉 (30초)
2. 피지가 테이프에 흡수
3. 테이프의 투명도 변화 측정 (광학 센서)
4. 투명도 변화 → 피지량 (μg/cm²) 환산

측정 단위: μg/cm² (마이크로그램/제곱센티미터)
```

#### 3.1.2 두피 유분 기준값

| 분류 | Sebum 레벨 (μg/cm²) | 시각적 특징 | 세정 빈도 권장 |
|------|---------------------|------------|--------------|
| **건성 (Dry)** | < 100 | 당김, 각질 | 2-3일/회 |
| **정상 (Normal)** | 100-220 | 균형, 윤기 적절 | 1-2일/회 |
| **지성 (Oily)** | > 220 | 번들거림, 기름짐 | 매일 |
| **극지성** | > 300 | 심한 유분 | 매일 2회 가능 |

#### 3.1.3 AI 이미지 기반 유분 추정

```typescript
interface ScalpOilAnalysis {
  shininess: number;         // 광택/반사도 (0-100)
  textureUniformity: number; // 텍스처 균일도 (0-100)
  colorVariation: number;    // 색상 변이 (0-100)
  visibleOilPatches: number; // 유분 패치 비율 (0-100)
}

function estimateOilLevel(analysis: ScalpOilAnalysis): number {
  // 가중 평균 점수 계산
  const weights = {
    shininess: 0.40,
    textureUniformity: 0.20,
    colorVariation: 0.15,
    visibleOilPatches: 0.25,
  };

  const score =
    analysis.shininess * weights.shininess +
    (100 - analysis.textureUniformity) * weights.textureUniformity +
    analysis.colorVariation * weights.colorVariation +
    analysis.visibleOilPatches * weights.visibleOilPatches;

  return Math.round(score);
}

function classifyScalpOilType(oilScore: number): 'dry' | 'normal' | 'oily' {
  if (oilScore < 30) return 'dry';
  if (oilScore < 65) return 'normal';
  return 'oily';
}
```

### 3.2 각질/비듬 감지 알고리즘

#### 3.2.1 비듬 유형 분류

| 유형 | 원인 | 시각적 특징 | 크기 |
|------|------|-----------|------|
| **건성 비듬** | 두피 건조 | 작고 흰 가루 | < 1mm |
| **지성 비듬** | 말라세지아 균 | 크고 노란빛, 기름진 | 2-5mm |
| **지루성 피부염** | 염증 | 붉은 두피, 두꺼운 각질 | 5mm+ |
| **건선** | 자가면역 | 은백색 각질, 경계 명확 | 가변적 |

#### 3.2.2 비듬 감지 알고리즘

```python
import cv2
import numpy as np

def detect_dandruff(scalp_image: np.ndarray) -> dict:
    """
    두피 이미지에서 비듬/각질 감지

    Returns:
        severity: 0-100 (심각도)
        type: 'none' | 'dry' | 'oily' | 'seborrheic'
        affected_area: 영향 받은 면적 비율
    """
    # 1. 전처리: 색상 공간 변환
    lab = cv2.cvtColor(scalp_image, cv2.COLOR_BGR2LAB)
    l_channel = lab[:, :, 0]

    # 2. 고대비 영역 (밝은 각질) 감지
    # 적응형 임계값 적용
    thresh = cv2.adaptiveThreshold(
        l_channel, 255,
        cv2.ADAPTIVE_THRESH_GAUSSIAN_C,
        cv2.THRESH_BINARY,
        11, -30  # 밝은 영역만 추출
    )

    # 3. 노이즈 제거
    kernel = np.ones((3, 3), np.uint8)
    cleaned = cv2.morphologyEx(thresh, cv2.MORPH_OPEN, kernel)

    # 4. 연결 컴포넌트 분석
    num_labels, labels, stats, centroids = cv2.connectedComponentsWithStats(cleaned)

    # 5. 각질 조각 크기 분석
    flake_sizes = []
    for i in range(1, num_labels):
        area = stats[i, cv2.CC_STAT_AREA]
        if 10 < area < 5000:  # 노이즈/큰 영역 제외
            flake_sizes.append(area)

    # 6. 심각도 및 유형 결정
    total_area = scalp_image.shape[0] * scalp_image.shape[1]
    affected_ratio = sum(flake_sizes) / total_area * 100

    avg_flake_size = np.mean(flake_sizes) if flake_sizes else 0

    # 유형 결정 (평균 크기 기반)
    if affected_ratio < 1:
        dandruff_type = 'none'
    elif avg_flake_size < 50:  # 작은 조각
        dandruff_type = 'dry'
    elif avg_flake_size < 200:  # 중간 조각
        dandruff_type = 'oily'
    else:  # 큰 조각
        dandruff_type = 'seborrheic'

    return {
        'severity': min(100, int(affected_ratio * 10)),
        'type': dandruff_type,
        'affected_area': round(affected_ratio, 2),
        'flake_count': len(flake_sizes),
    }
```

### 3.3 두피 홍조/민감도 분석

#### 3.3.1 홍조 레벨 분류

| 레벨 | a* 값 (Lab) | 시각적 특징 | 의미 |
|------|------------|-----------|------|
| **정상** | 5-15 | 건강한 핑크 | 양호 |
| **경미한 홍조** | 15-25 | 약간 붉음 | 민감 가능성 |
| **중등도 홍조** | 25-35 | 뚜렷한 붉음 | 민감성 두피 |
| **심한 홍조** | > 35 | 염증 의심 | 전문 상담 권장 |

#### 3.3.2 홍조 분석 알고리즘

```typescript
interface LabColor {
  L: number;  // 0-100 (밝기)
  a: number;  // -128 to 127 (빨강-초록)
  b: number;  // -128 to 127 (노랑-파랑)
}

function analyzeScalpRedness(scalpLabColors: LabColor[]): {
  rednessLevel: 'normal' | 'mild' | 'moderate' | 'severe';
  rednessScore: number;
  sensitivityRisk: 'low' | 'medium' | 'high';
} {
  // 평균 a* 값 계산 (붉은기 지표)
  const avgA = scalpLabColors.reduce((sum, c) => sum + c.a, 0) / scalpLabColors.length;

  // 변동성 (염증 패턴 감지)
  const stdA = Math.sqrt(
    scalpLabColors.reduce((sum, c) => sum + Math.pow(c.a - avgA, 2), 0) / scalpLabColors.length
  );

  // 홍조 레벨 결정
  let rednessLevel: 'normal' | 'mild' | 'moderate' | 'severe';
  if (avgA < 15) rednessLevel = 'normal';
  else if (avgA < 25) rednessLevel = 'mild';
  else if (avgA < 35) rednessLevel = 'moderate';
  else rednessLevel = 'severe';

  // 점수 (0-100)
  const rednessScore = Math.min(100, Math.max(0, (avgA - 5) * 3));

  // 민감도 위험도 (홍조 + 변동성 고려)
  const sensitivityRisk =
    avgA > 25 || stdA > 10 ? 'high' :
    avgA > 15 || stdA > 5 ? 'medium' : 'low';

  return { rednessLevel, rednessScore, sensitivityRisk };
}
```

### 3.4 두피 타입 종합 분류

```typescript
type ScalpType = 'dry' | 'normal' | 'oily' | 'sensitive' | 'combination';

interface ScalpAnalysisResult {
  oilLevel: number;           // 0-100
  hydration: number;          // 0-100
  rednessScore: number;       // 0-100
  dandruffSeverity: number;   // 0-100
  sensitivityIndicators: string[];
}

function classifyScalpType(analysis: ScalpAnalysisResult): ScalpType {
  const { oilLevel, hydration, rednessScore, sensitivityIndicators } = analysis;

  // 1. 민감성 우선 체크 (염증, 알러지 징후)
  if (
    rednessScore > 50 ||
    sensitivityIndicators.length > 2 ||
    sensitivityIndicators.includes('inflammation')
  ) {
    return 'sensitive';
  }

  // 2. 복합성 체크 (T존/측면 차이)
  // (이미지 영역별 분석 필요 - 별도 함수)

  // 3. 단순 분류
  if (oilLevel > 65) return 'oily';
  if (oilLevel < 35 || hydration < 40) return 'dry';

  return 'normal';
}
```

---

## 4. 헤어 컬러 분석

### 4.1 Lab 색공간 기반 헤어 레벨 측정

#### 4.1.1 Hair Level System (1-10)

미용업계에서 사용하는 표준 헤어 레벨 시스템.

| 레벨 | 명칭 | Lab L* 범위 | 멜라닌 함량 | 설명 |
|------|------|------------|------------|------|
| 1 | Black | 10-18 | 최대 | 자연 흑발 |
| 2 | Darkest Brown | 18-22 | 매우 높음 | 가장 어두운 갈색 |
| 3 | Dark Brown | 22-28 | 높음 | 어두운 갈색 |
| 4 | Medium Brown | 28-35 | 중상 | 중간 갈색 |
| 5 | Light Brown | 35-42 | 중간 | 밝은 갈색 |
| 6 | Dark Blonde | 42-50 | 중하 | 어두운 금발 |
| 7 | Medium Blonde | 50-58 | 낮음 | 중간 금발 |
| 8 | Light Blonde | 58-68 | 매우 낮음 | 밝은 금발 |
| 9 | Very Light Blonde | 68-78 | 극소 | 매우 밝은 금발 |
| 10 | Lightest Blonde | 78-90 | 최소 | 가장 밝은 금발/백금 |

#### 4.1.2 한국인 자연 헤어 레벨 분포

```
한국인 자연 헤어 레벨 분포 (미염색):
- Level 1-2: 70% (자연 흑발)
- Level 3: 20% (매우 어두운 갈색)
- Level 4: 8% (어두운 갈색)
- Level 5+: 2% (자연 밝은 색, 드묾)

염색 후 선호 레벨:
- Level 4-5: 35% (자연스러운 갈색)
- Level 6-7: 40% (밝은 갈색/어두운 금발)
- Level 8+: 15% (밝은 금발 계열)
- 레벨 3 이하: 10% (다시 어둡게)
```

### 4.2 헤어컬러 언더톤 감지 (웜/쿨/뉴트럴)

#### 4.2.1 언더톤 결정 기준

| 언더톤 | Lab a* | Lab b* | 특징 컬러 |
|--------|--------|--------|----------|
| **Warm (웜)** | > 5 | > 10 | 골드, 카라멜, 카퍼, 오번 |
| **Cool (쿨)** | < 5 | < 10 | 애쉬, 플래티넘, 바이올렛 |
| **Neutral (뉴트럴)** | 3-8 | 5-15 | 밸런스드 브라운 |

#### 4.2.2 언더톤 분석 알고리즘

```typescript
type HairUndertone = 'warm' | 'cool' | 'neutral';

function analyzeHairUndertone(hairLabColors: LabColor[]): {
  undertone: HairUndertone;
  warmthScore: number;  // -100 (쿨) to 100 (웜)
  confidence: number;
} {
  // 대표 색상 계산 (이상치 제거 후 평균)
  const filtered = removeOutliers(hairLabColors);
  const avgA = mean(filtered.map(c => c.a));
  const avgB = mean(filtered.map(c => c.b));

  // Warmth Score 계산
  // a*: 빨강(+) vs 초록(-) → 빨강 = 따뜻함
  // b*: 노랑(+) vs 파랑(-) → 노랑 = 따뜻함
  const warmthScore = (avgA * 2 + avgB) / 3;

  // 언더톤 결정
  let undertone: HairUndertone;
  if (warmthScore > 15) undertone = 'warm';
  else if (warmthScore < 5) undertone = 'cool';
  else undertone = 'neutral';

  // 신뢰도 (분산 기반)
  const variance = standardDeviation(filtered.map(c => c.a * 2 + c.b));
  const confidence = Math.max(0, 100 - variance * 2);

  return {
    undertone,
    warmthScore: Math.round(warmthScore * 5),  // -100 to 100 스케일
    confidence: Math.round(confidence),
  };
}

function removeOutliers(colors: LabColor[], threshold = 2): LabColor[] {
  const avgL = mean(colors.map(c => c.L));
  const stdL = standardDeviation(colors.map(c => c.L));

  return colors.filter(c =>
    Math.abs(c.L - avgL) < stdL * threshold
  );
}
```

### 4.3 헤어 염색 컬러 카테고리 (8개)

```typescript
type HairColorCategory =
  | 'black'         // 블랙 (레벨 1-2)
  | 'dark-brown'    // 다크 브라운 (레벨 2-3)
  | 'medium-brown'  // 미디엄 브라운 (레벨 4-5)
  | 'light-brown'   // 라이트 브라운 (레벨 5-6)
  | 'blonde'        // 블론드 (레벨 7+)
  | 'red'           // 레드/카퍼/오번
  | 'ash'           // 애쉬 계열 (쿨톤 브라운~금발)
  | 'dyed-vivid';   // 비비드 컬러 (핑크, 블루, 퍼플 등)

const HAIR_COLOR_RANGES: Record<HairColorCategory, {
  L: [number, number];
  a: [number, number];
  b: [number, number];
}> = {
  'black': { L: [10, 22], a: [-3, 5], b: [-3, 8] },
  'dark-brown': { L: [20, 32], a: [3, 12], b: [5, 18] },
  'medium-brown': { L: [30, 45], a: [5, 15], b: [10, 28] },
  'light-brown': { L: [42, 58], a: [8, 18], b: [15, 35] },
  'blonde': { L: [55, 85], a: [3, 15], b: [18, 45] },
  'red': { L: [25, 55], a: [18, 40], b: [15, 40] },
  'ash': { L: [25, 70], a: [-5, 5], b: [-8, 8] },
  'dyed-vivid': { L: [20, 75], a: [-40, 55], b: [-45, 55] },
};

function classifyHairColor(labColor: LabColor): HairColorCategory {
  const { L, a, b } = labColor;

  // 1. 비비드 컬러 체크 (범위 밖 a* 또는 b*)
  if (Math.abs(a) > 35 || Math.abs(b) > 40) {
    return 'dyed-vivid';
  }

  // 2. 애쉬 체크 (낮은 a*, b*)
  if (a < 5 && b < 8 && L > 25 && L < 70) {
    return 'ash';
  }

  // 3. 레드 체크 (높은 a*)
  if (a > 18 && L > 25 && L < 55) {
    return 'red';
  }

  // 4. 명도 기반 분류
  if (L < 22) return 'black';
  if (L < 32) return 'dark-brown';
  if (L < 45) return 'medium-brown';
  if (L < 58) return 'light-brown';
  return 'blonde';
}
```

### 4.4 퍼스널컬러 시즌별 추천 헤어컬러

| 시즌 | 권장 레벨 | 권장 언더톤 | 추천 컬러명 | 피해야 할 컬러 |
|------|----------|-----------|-----------|--------------|
| **봄 (Spring)** | 5-7 | 웜, 밝음 | 카라멜, 허니 브라운, 골드 하이라이트 | 애쉬, 블루블랙, 버건디 |
| **여름 (Summer)** | 4-6 | 쿨, 부드러움 | 애쉬 브라운, 로즈 브라운, 밀크티 | 오렌지, 골드, 카퍼 |
| **가을 (Autumn)** | 3-5 | 웜, 깊음 | 초콜릿, 오번, 카퍼, 마호가니 | 플래티넘, 애쉬, 블루블랙 |
| **겨울 (Winter)** | 1-3, 8+ | 쿨, 선명 | 블랙, 에스프레소, 플래티넘, 버건디 | 황금빛, 카라멜, 브릭 |

```typescript
interface HairColorRecommendation {
  colorName: string;
  colorNameKr: string;
  level: number;
  undertone: HairUndertone;
  labTarget: LabColor;
  matchScore: number;
  seasonCompatibility: Season[];
}

function recommendHairColorsBySeason(
  season: Season,
  currentHairLab: LabColor
): HairColorRecommendation[] {
  const recommendations: Record<Season, HairColorRecommendation[]> = {
    spring: [
      {
        colorName: 'Honey Brown',
        colorNameKr: '허니 브라운',
        level: 6,
        undertone: 'warm',
        labTarget: { L: 48, a: 12, b: 28 },
        matchScore: 95,
        seasonCompatibility: ['spring'],
      },
      {
        colorName: 'Caramel Blonde',
        colorNameKr: '카라멜 블론드',
        level: 7,
        undertone: 'warm',
        labTarget: { L: 55, a: 10, b: 32 },
        matchScore: 90,
        seasonCompatibility: ['spring', 'autumn'],
      },
      {
        colorName: 'Golden Brown',
        colorNameKr: '골든 브라운',
        level: 5,
        undertone: 'warm',
        labTarget: { L: 42, a: 14, b: 25 },
        matchScore: 88,
        seasonCompatibility: ['spring'],
      },
    ],
    summer: [
      {
        colorName: 'Ash Brown',
        colorNameKr: '애쉬 브라운',
        level: 5,
        undertone: 'cool',
        labTarget: { L: 40, a: 2, b: 5 },
        matchScore: 95,
        seasonCompatibility: ['summer'],
      },
      {
        colorName: 'Rose Brown',
        colorNameKr: '로즈 브라운',
        level: 5,
        undertone: 'cool',
        labTarget: { L: 42, a: 8, b: 3 },
        matchScore: 92,
        seasonCompatibility: ['summer', 'winter'],
      },
      {
        colorName: 'Milk Tea',
        colorNameKr: '밀크티',
        level: 6,
        undertone: 'neutral',
        labTarget: { L: 50, a: 5, b: 12 },
        matchScore: 88,
        seasonCompatibility: ['summer'],
      },
    ],
    autumn: [
      {
        colorName: 'Chocolate Brown',
        colorNameKr: '초콜릿 브라운',
        level: 4,
        undertone: 'warm',
        labTarget: { L: 32, a: 10, b: 18 },
        matchScore: 95,
        seasonCompatibility: ['autumn'],
      },
      {
        colorName: 'Auburn',
        colorNameKr: '오번',
        level: 4,
        undertone: 'warm',
        labTarget: { L: 35, a: 22, b: 24 },
        matchScore: 92,
        seasonCompatibility: ['autumn'],
      },
      {
        colorName: 'Copper Brown',
        colorNameKr: '카퍼 브라운',
        level: 5,
        undertone: 'warm',
        labTarget: { L: 40, a: 25, b: 28 },
        matchScore: 90,
        seasonCompatibility: ['autumn', 'spring'],
      },
    ],
    winter: [
      {
        colorName: 'Blue Black',
        colorNameKr: '블루 블랙',
        level: 1,
        undertone: 'cool',
        labTarget: { L: 15, a: 0, b: -3 },
        matchScore: 95,
        seasonCompatibility: ['winter'],
      },
      {
        colorName: 'Cool Espresso',
        colorNameKr: '쿨 에스프레소',
        level: 2,
        undertone: 'cool',
        labTarget: { L: 22, a: 3, b: 5 },
        matchScore: 93,
        seasonCompatibility: ['winter'],
      },
      {
        colorName: 'Burgundy',
        colorNameKr: '버건디',
        level: 3,
        undertone: 'cool',
        labTarget: { L: 28, a: 18, b: -2 },
        matchScore: 88,
        seasonCompatibility: ['winter', 'summer'],
      },
    ],
  };

  return recommendations[season]
    .map(rec => ({
      ...rec,
      matchScore: adjustMatchScore(rec, currentHairLab),
    }))
    .sort((a, b) => b.matchScore - a.matchScore);
}

function adjustMatchScore(
  recommendation: HairColorRecommendation,
  currentHairLab: LabColor
): number {
  // 현재 헤어컬러와 타겟 컬러 간 Delta E 계산
  const deltaE = calculateCIEDE2000(currentHairLab, recommendation.labTarget);

  // 변화량에 따른 조정
  // 너무 비슷하면 변화 의미 없음, 너무 다르면 손상 위험
  let adjustment = 0;
  if (deltaE < 5) adjustment = -15;      // 거의 동일
  else if (deltaE < 15) adjustment = 5;  // 적절한 변화
  else if (deltaE < 30) adjustment = 0;  // 중간 변화
  else if (deltaE < 50) adjustment = -10; // 큰 변화
  else adjustment = -20;                  // 극단적 변화

  return Math.max(0, Math.min(100, recommendation.matchScore + adjustment));
}
```

---

## 5. 얼굴형별 헤어스타일 추천

### 5.1 7가지 얼굴형 분류 알고리즘

#### 5.1.1 측정 포인트

```
얼굴 측정 5대 포인트:
1. 얼굴 길이 (Face Length): 헤어라인 중앙 ~ 턱 끝
2. 이마 너비 (Forehead Width): 이마 가장 넓은 부분
3. 광대 너비 (Cheekbone Width): 광대 가장 넓은 부분
4. 턱선 너비 (Jawline Width): 턱선 가장 넓은 부분
5. 턱 길이 (Chin Length): 입술 하단 ~ 턱 끝
```

#### 5.1.2 얼굴형 판정 알고리즘

```typescript
interface FaceMeasurements {
  faceLength: number;
  foreheadWidth: number;
  cheekboneWidth: number;
  jawlineWidth: number;
  chinLength: number;
  jawAngle?: number;  // 턱선 각도 (도)
}

type FaceShape = 'oval' | 'round' | 'oblong' | 'square' | 'heart' | 'diamond' | 'triangle';

function classifyFaceShape(measurements: FaceMeasurements): {
  faceShape: FaceShape;
  confidence: number;
  ratios: Record<string, number>;
} {
  const {
    faceLength,
    foreheadWidth,
    cheekboneWidth,
    jawlineWidth,
    chinLength,
    jawAngle = 120,
  } = measurements;

  // 주요 비율 계산
  const faceRatio = faceLength / cheekboneWidth;  // 세로:가로
  const foreheadToJaw = foreheadWidth / jawlineWidth;
  const cheekToForehead = cheekboneWidth / foreheadWidth;
  const cheekToJaw = cheekboneWidth / jawlineWidth;
  const chinRatio = chinLength / faceLength;

  const ratios = {
    faceRatio: Number(faceRatio.toFixed(2)),
    foreheadToJaw: Number(foreheadToJaw.toFixed(2)),
    cheekToForehead: Number(cheekToForehead.toFixed(2)),
    cheekToJaw: Number(cheekToJaw.toFixed(2)),
    chinRatio: Number(chinRatio.toFixed(2)),
  };

  // 점수 기반 분류
  const scores: Record<FaceShape, number> = {
    oval: 0,
    round: 0,
    oblong: 0,
    square: 0,
    heart: 0,
    diamond: 0,
    triangle: 0,
  };

  // Oval (계란형): 이상적 비율 1:1.5, 부드러운 곡선
  if (faceRatio >= 1.4 && faceRatio <= 1.6) scores.oval += 30;
  if (foreheadToJaw >= 0.95 && foreheadToJaw <= 1.1) scores.oval += 20;
  if (cheekToForehead >= 1.0 && cheekToForehead <= 1.15) scores.oval += 20;
  if (chinRatio >= 0.18 && chinRatio <= 0.25) scores.oval += 15;

  // Round (둥근형): 가로세로 비슷, 넓은 볼
  if (faceRatio < 1.3) scores.round += 35;
  if (cheekboneWidth >= foreheadWidth && cheekboneWidth >= jawlineWidth) scores.round += 20;
  if (chinRatio < 0.18) scores.round += 15;

  // Oblong (긴형): 세로가 가로보다 훨씬 김
  if (faceRatio > 1.65) scores.oblong += 40;
  if (Math.abs(foreheadWidth - cheekboneWidth) < cheekboneWidth * 0.1) scores.oblong += 15;
  if (Math.abs(cheekboneWidth - jawlineWidth) < cheekboneWidth * 0.1) scores.oblong += 15;

  // Square (사각형): 각진 턱선, 넓은 이마
  if (jawAngle > 140) scores.square += 35;
  if (foreheadToJaw >= 0.9 && foreheadToJaw <= 1.1) scores.square += 20;
  if (faceRatio >= 1.1 && faceRatio <= 1.4) scores.square += 15;

  // Heart (하트형): 넓은 이마, 좁은 턱
  if (foreheadToJaw > 1.2) scores.heart += 35;
  if (cheekToJaw > 1.2) scores.heart += 20;
  if (chinRatio < 0.2) scores.heart += 15;

  // Diamond (다이아몬드): 좁은 이마/턱, 넓은 광대
  if (cheekToForehead > 1.1 && cheekToJaw > 1.15) scores.diamond += 35;
  if (foreheadWidth < cheekboneWidth && jawlineWidth < cheekboneWidth) scores.diamond += 25;

  // Triangle (역삼각형/삼각형): 좁은 이마, 넓은 턱선
  if (foreheadToJaw < 0.85) scores.triangle += 35;  // 이마가 턱보다 좁음
  if (jawlineWidth > foreheadWidth && jawlineWidth >= cheekboneWidth) scores.triangle += 25;
  if (faceRatio >= 1.2 && faceRatio <= 1.5) scores.triangle += 15;

  // 최고 점수 얼굴형 선택
  const entries = Object.entries(scores) as [FaceShape, number][];
  entries.sort((a, b) => b[1] - a[1]);

  const faceShape = entries[0][0];
  const maxScore = entries[0][1];
  const confidence = Math.min(100, Math.round(maxScore * 1.2));

  return { faceShape, confidence, ratios };
}
```

### 5.2 얼굴형별 권장/피해야 할 스타일 매핑

#### 5.2.1 스타일 추천 매트릭스

| 얼굴형 | 권장 스타일 | 피해야 할 스타일 | 스타일링 원칙 |
|--------|------------|----------------|--------------|
| **Oval** | 대부분 가능, 숏컷, 롱헤어, 앞머리 자유 | 특별히 없음 | 이상적 비율 유지 |
| **Round** | 레이어드 롱, 하이 볼륨, 사이드 파팅, 긴 앞머리 | 짧은 단발, 전체 컬, 가르마 없는 앞머리 | 세로 라인 강조 |
| **Oblong** | 사이드 볼륨, 앞머리, 턱선 레이어, 웨이브 | 긴 일자컷, 높은 업스타일, 볼륨 없는 롱헤어 | 가로 볼륨 추가 |
| **Square** | 소프트 웨이브, 레이어드, 사이드 앞머리, 턱선 아래 길이 | 일자 앞머리, 원렝스 단발, 뒤로 넘긴 스타일 | 각진 부분 부드럽게 |
| **Heart** | 턱선 볼륨, 사이드 파팅, 턱선 길이 보브, 레이어 | 이마 강조 풀백, 짧은 레이어, 정수리 볼륨 | 하부 볼륨으로 균형 |
| **Diamond** | 사이드 앞머리, 턱선/이마 커버, 친 레이어 | 정수리만 볼륨, 타이트 업스타일, 이마/턱 노출 | 상하부 균형 |
| **Triangle** | 이마 볼륨, 정수리 레이어, 풀뱅/사이드뱅 | 턱선 강조 스타일, 하부 볼륨, 턱선 길이 단발 | 상부 볼륨으로 균형 |

#### 5.2.2 스타일 추천 타입 정의

```typescript
interface HairStyleRecommendation {
  styleId: string;
  styleName: string;
  styleNameKr: string;
  description: string;
  length: 'short' | 'medium' | 'long';
  volumePosition: 'top' | 'sides' | 'bottom' | 'all';
  bangsType: 'none' | 'full' | 'side' | 'curtain' | 'wispy';
  suitableFaceShapes: FaceShape[];
  unsuitableFaceShapes: FaceShape[];
  matchScore: number;
  matchReason: string;
  imageUrl?: string;
  suitableHairTypes: HairType[];
}

const HAIR_STYLE_DATABASE: HairStyleRecommendation[] = [
  // Layered Styles
  {
    styleId: 'layered-long',
    styleName: 'Long Layered',
    styleNameKr: '롱 레이어드',
    description: '긴 머리에 층을 넣어 자연스러운 볼륨과 움직임 연출',
    length: 'long',
    volumePosition: 'all',
    bangsType: 'curtain',
    suitableFaceShapes: ['round', 'square', 'oval'],
    unsuitableFaceShapes: ['oblong'],
    matchScore: 90,
    matchReason: '세로 라인 강조로 얼굴이 길어 보이는 효과',
    suitableHairTypes: ['straight', 'wavy'],
  },
  {
    styleId: 'layered-bob',
    styleName: 'Layered Bob',
    styleNameKr: '레이어드 보브',
    description: '턱선 길이의 보브에 층을 넣어 가볍고 세련된 느낌',
    length: 'medium',
    volumePosition: 'sides',
    bangsType: 'side',
    suitableFaceShapes: ['oval', 'heart', 'oblong'],
    unsuitableFaceShapes: ['round'],
    matchScore: 88,
    matchReason: '턱선 아래 볼륨으로 얼굴 비율 균형',
    suitableHairTypes: ['straight', 'wavy', 'curly'],
  },

  // Bob Styles
  {
    styleId: 'chin-length-bob',
    styleName: 'Chin Length Bob',
    styleNameKr: '턱선 보브',
    description: '턱선에 맞춘 깔끔한 보브 스타일',
    length: 'medium',
    volumePosition: 'bottom',
    bangsType: 'none',
    suitableFaceShapes: ['heart', 'diamond', 'oval'],
    unsuitableFaceShapes: ['round', 'square'],
    matchScore: 85,
    matchReason: '하부 볼륨으로 좁은 턱선 보완',
    suitableHairTypes: ['straight', 'wavy'],
  },

  // Bangs Styles
  {
    styleId: 'curtain-bangs',
    styleName: 'Curtain Bangs',
    styleNameKr: '커튼 앞머리',
    description: '가르마를 중심으로 양쪽으로 흐르는 자연스러운 앞머리',
    length: 'medium',
    volumePosition: 'top',
    bangsType: 'curtain',
    suitableFaceShapes: ['oblong', 'square', 'diamond'],
    unsuitableFaceShapes: ['heart'],
    matchScore: 87,
    matchReason: '이마 부분 커버로 얼굴 길이 조절',
    suitableHairTypes: ['straight', 'wavy'],
  },
  {
    styleId: 'side-swept-bangs',
    styleName: 'Side-Swept Bangs',
    styleNameKr: '사이드 앞머리',
    description: '한쪽으로 쓸어 넘긴 대각선 앞머리',
    length: 'short',
    volumePosition: 'top',
    bangsType: 'side',
    suitableFaceShapes: ['square', 'diamond', 'heart'],
    unsuitableFaceShapes: [],
    matchScore: 86,
    matchReason: '대각선 라인으로 각진 부분 완화',
    suitableHairTypes: ['straight', 'wavy'],
  },

  // Wave/Curl Styles
  {
    styleId: 'soft-waves',
    styleName: 'Soft Waves',
    styleNameKr: '소프트 웨이브',
    description: '자연스럽게 흐르는 부드러운 웨이브',
    length: 'long',
    volumePosition: 'sides',
    bangsType: 'none',
    suitableFaceShapes: ['square', 'oblong', 'oval'],
    unsuitableFaceShapes: [],
    matchScore: 89,
    matchReason: '곡선 라인으로 각진 인상 완화',
    suitableHairTypes: ['straight', 'wavy'],
  },

  // Short Styles
  {
    styleId: 'textured-pixie',
    styleName: 'Textured Pixie',
    styleNameKr: '텍스처드 픽시',
    description: '질감을 살린 짧은 픽시 스타일',
    length: 'short',
    volumePosition: 'top',
    bangsType: 'wispy',
    suitableFaceShapes: ['oval', 'heart'],
    unsuitableFaceShapes: ['round', 'square'],
    matchScore: 82,
    matchReason: '상부 볼륨으로 세련된 인상',
    suitableHairTypes: ['straight', 'wavy', 'curly'],
  },
  {
    styleId: 'side-volume-shag',
    styleName: 'Side Volume Shag',
    styleNameKr: '사이드 볼륨 샤기',
    description: '옆으로 퍼지는 볼륨감 있는 샤기 스타일',
    length: 'medium',
    volumePosition: 'sides',
    bangsType: 'curtain',
    suitableFaceShapes: ['oblong', 'oval'],
    unsuitableFaceShapes: ['round'],
    matchScore: 84,
    matchReason: '가로 볼륨으로 긴 얼굴 균형',
    suitableHairTypes: ['wavy', 'curly'],
  },

  // Triangle Face Styles
  {
    styleId: 'top-volume-layer',
    styleName: 'Top Volume Layer',
    styleNameKr: '탑 볼륨 레이어',
    description: '정수리와 이마 부분에 볼륨을 주는 레이어드 스타일',
    length: 'medium',
    volumePosition: 'top',
    bangsType: 'full',
    suitableFaceShapes: ['triangle', 'diamond'],
    unsuitableFaceShapes: ['heart', 'oval'],
    matchScore: 88,
    matchReason: '상부 볼륨으로 좁은 이마와 넓은 턱선 균형',
    suitableHairTypes: ['straight', 'wavy'],
  },
  {
    styleId: 'full-bangs-long',
    styleName: 'Full Bangs Long',
    styleNameKr: '풀뱅 롱헤어',
    description: '이마를 완전히 덮는 앞머리와 긴 머리의 조합',
    length: 'long',
    volumePosition: 'top',
    bangsType: 'full',
    suitableFaceShapes: ['triangle', 'oblong'],
    unsuitableFaceShapes: ['round'],
    matchScore: 86,
    matchReason: '풀뱅으로 좁은 이마 커버, 상부 볼륨 강조',
    suitableHairTypes: ['straight', 'wavy'],
  },
];

function recommendHairStyles(
  faceShape: FaceShape,
  hairType?: HairType,
  preferredLength?: 'short' | 'medium' | 'long'
): HairStyleRecommendation[] {
  return HAIR_STYLE_DATABASE
    .filter(style => style.suitableFaceShapes.includes(faceShape))
    .filter(style => !hairType || style.suitableHairTypes.includes(hairType))
    .filter(style => !preferredLength || style.length === preferredLength)
    .map(style => ({
      ...style,
      matchScore: calculateStyleMatchScore(style, faceShape, hairType),
    }))
    .sort((a, b) => b.matchScore - a.matchScore)
    .slice(0, 5);
}

function calculateStyleMatchScore(
  style: HairStyleRecommendation,
  faceShape: FaceShape,
  hairType?: HairType
): number {
  let score = style.matchScore;

  // 얼굴형에 가장 적합한 스타일인 경우 보너스
  if (style.suitableFaceShapes[0] === faceShape) score += 5;

  // 헤어 타입 호환성
  if (hairType && style.suitableHairTypes[0] === hairType) score += 3;

  // 피해야 할 얼굴형인 경우 페널티
  if (style.unsuitableFaceShapes.includes(faceShape)) score -= 30;

  return Math.max(0, Math.min(100, score));
}
```

### 5.3 황금비율 적용

```typescript
const GOLDEN_RATIO = 1.618;

interface FaceProportions {
  // 수직 비율 (3등분)
  hairlineToEyebrows: number;    // 이마
  eyebrowsToNoseBase: number;    // 중안부
  noseBaseToChint: number;       // 하안부

  // 수평 비율
  faceWidthToLength: number;     // 가로:세로
  eyeDistanceToFaceWidth: number; // 눈 사이 거리 비율
}

function analyzeGoldenRatioDeviation(proportions: FaceProportions): {
  overallBalance: number;  // 0-100
  deviations: Record<string, number>;
  suggestions: string[];
} {
  const idealProportions = {
    hairlineToEyebrows: 0.33,
    eyebrowsToNoseBase: 0.33,
    noseBaseToChint: 0.33,
    faceWidthToLength: 1 / GOLDEN_RATIO,  // ~0.618
    eyeDistanceToFaceWidth: 0.2,
  };

  const deviations: Record<string, number> = {};
  let totalDeviation = 0;

  for (const [key, ideal] of Object.entries(idealProportions)) {
    const actual = proportions[key as keyof FaceProportions];
    const deviation = Math.abs(actual - ideal) / ideal * 100;
    deviations[key] = Number(deviation.toFixed(1));
    totalDeviation += deviation;
  }

  const overallBalance = Math.max(0, 100 - totalDeviation / 5);

  // 헤어스타일 제안 생성
  const suggestions: string[] = [];

  if (proportions.hairlineToEyebrows > 0.38) {
    suggestions.push('앞머리로 이마 비율 조절 추천');
  }
  if (proportions.noseBaseToChint > 0.38) {
    suggestions.push('턱선 길이의 스타일로 하안부 균형');
  }
  if (proportions.faceWidthToLength > 0.7) {
    suggestions.push('세로 볼륨 스타일로 얼굴 길어 보이게');
  }
  if (proportions.faceWidthToLength < 0.55) {
    suggestions.push('가로 볼륨 스타일로 얼굴 넓어 보이게');
  }

  return {
    overallBalance: Number(overallBalance.toFixed(1)),
    deviations,
    suggestions,
  };
}
```

---

## 6. 한국인 헤어 특성 데이터

### 6.1 한국인 평균 모발 물리적 특성

| 특성 | 한국인 평균 | 서양인 평균 | 차이점 |
|------|------------|------------|--------|
| **모발 직경** | 80-100μm | 50-90μm | 10-20% 굵음 |
| **모발 밀도** | 100-130개/cm² | 120-150개/cm² | 15-20% 낮음 |
| **총 모발 수** | ~100,000개 | ~100,000-140,000개 | 비슷~적음 |
| **모발 단면** | 원형 | 타원형~원형 | 더 균일 |
| **성장 속도** | 1.0-1.2cm/월 | 1.0-1.5cm/월 | 비슷~느림 |
| **수명 주기** | 4-6년 | 3-7년 | 비슷 |
| **자연 헤어 타입** | 85% 직모 | 45% 직모 | 직모 우세 |
| **멜라닌 타입** | 유멜라닌 우세 | 페오멜라닌 다양 | 검은색 우세 |

### 6.2 한국인 두피 특성

| 특성 | 한국인 평균 | 특이사항 |
|------|------------|---------|
| **피지 분비량** | 180-220 μg/cm² | 온대 기후 적응, 계절 변동 큼 |
| **두피 pH** | 4.5-5.5 | 정상 범위 |
| **경피 수분 손실** | 중간 | 습도 민감 |
| **두피 타입 분포** | 복합성 40%, 지성 30%, 건성 20%, 민감성 10% | 복합성 우세 |

### 6.3 한국인 모발 관리 고려사항

```typescript
const KOREAN_HAIR_CONSIDERATIONS = {
  // 모발 특성
  hairCharacteristics: {
    thickness: 'medium-to-thick',
    density: 'medium',
    naturalColor: 'black-to-dark-brown',
    predominantType: 'straight',
    porosity: 'low-to-medium',
  },

  // 일반적인 고민
  commonConcerns: [
    { concern: 'oily-scalp', prevalence: 0.35 },
    { concern: 'hairloss', prevalence: 0.25 },
    { concern: 'frizz', prevalence: 0.20 },  // 습한 여름
    { concern: 'damage', prevalence: 0.30 }, // 염색/펌 비율 높음
    { concern: 'lack-volume', prevalence: 0.25 },
  ],

  // 계절별 케어 포인트
  seasonalCare: {
    spring: ['미세먼지 차단', '두피 클렌징 강화'],
    summer: ['유분 조절', '자외선 차단', '수분 유지'],
    autumn: ['탈모 예방', '영양 공급'],
    winter: ['정전기 방지', '보습 강화'],
  },

  // 추천 케어 성분
  recommendedIngredients: {
    scalp: ['티트리', '페퍼민트', '나이아신아마이드', '징크피리치온'],
    hair: ['케라틴', '실크 아미노산', '아르간 오일', '판테놀'],
    hairLoss: ['비오틴', '카페인', '미녹시딜(의약품)', '쏘팔메토'],
  },
};
```

### 6.4 아시아인 vs 서구인 모발 비교

| 특성 | 아시아인 | 백인 | 아프리카계 |
|------|---------|------|-----------|
| **단면 형태** | 원형 | 타원형 | 납작/리본형 |
| **컬 패턴** | 직모 우세 | 다양 | 컬/코일 우세 |
| **큐티클층** | 10-12층 | 6-8층 | 6-8층 |
| **피질 밀도** | 높음 | 중간 | 낮음 |
| **인장 강도** | 가장 강함 | 중간 | 가장 약함 |
| **탄성** | 낮음 | 중간 | 높음 |
| **광택** | 높음 | 중간 | 낮음 |
| **화학 처리 저항성** | 높음 | 중간 | 낮음 |
| **열 손상 민감도** | 낮음 | 중간 | 높음 |

---

## 7. TypeScript 구현 방향

### 7.1 타입 정의

```typescript
// types/hair-analysis.ts

// 헤어 타입 (Andre Walker System)
export type HairTypeMain = 1 | 2 | 3 | 4;
export type HairTypeSub = 'A' | 'B' | 'C';
export type HairType = `${HairTypeMain}${HairTypeSub}`;
export type HairTypeSimple = 'straight' | 'wavy' | 'curly' | 'coily';

// 모발 굵기
export type HairThickness = 'fine' | 'medium' | 'thick';

// 모발 밀도
export type HairDensity = 'low' | 'medium' | 'high';

// 모발 다공성
export type HairPorosity = 'low' | 'medium' | 'high';

// 두피 타입
export type ScalpType = 'dry' | 'normal' | 'oily' | 'sensitive' | 'combination';

// 헤어컬러 카테고리
export type HairColorCategory =
  | 'black'
  | 'dark-brown'
  | 'medium-brown'
  | 'light-brown'
  | 'blonde'
  | 'red'
  | 'ash'
  | 'dyed-vivid';

// 헤어컬러 언더톤
export type HairUndertone = 'warm' | 'cool' | 'neutral';

// 얼굴형
export type FaceShape = 'oval' | 'round' | 'oblong' | 'square' | 'heart' | 'diamond' | 'triangle';

// 헤어 고민
export type HairConcern =
  | 'hairloss'
  | 'dandruff'
  | 'frizz'
  | 'damage'
  | 'oily-scalp'
  | 'dry-scalp'
  | 'split-ends'
  | 'lack-volume'
  | 'gray-hair'
  | 'color-fading';

// Lab 색상
export interface LabColor {
  L: number;  // 0-100
  a: number;  // -128 to 127
  b: number;  // -128 to 127
}

// 헤어컬러 분석 결과
export interface HairColorAnalysis {
  dominant: LabColor;
  secondary: LabColor | null;
  category: HairColorCategory;
  level: number;        // 1-10
  undertone: HairUndertone;
  warmthScore: number;  // -100 to 100
  hex: string;
}

// 두피 분석 결과
export interface ScalpAnalysis {
  type: ScalpType;
  oilLevel: number;       // 0-100
  hydration: number;      // 0-100
  rednessScore: number;   // 0-100
  sensitivityRisk: 'low' | 'medium' | 'high';
  dandruff: {
    severity: number;     // 0-100
    type: 'none' | 'dry' | 'oily' | 'seborrheic';
  };
}

// 모발 건강 메트릭
export interface HairHealthMetrics {
  hydration: number;     // 0-100
  damage: number;        // 0-100 (높을수록 건강)
  elasticity: number;    // 0-100
  shine: number;         // 0-100
  density: number;       // 0-100
  overallScore: number;  // 0-100
}

// 얼굴형 분석 결과
export interface FaceShapeAnalysis {
  faceShape: FaceShape;
  confidence: number;
  ratios: {
    faceRatio: number;       // 세로/가로
    foreheadToJaw: number;
    cheekToForehead: number;
    cheekToJaw: number;
    chinRatio: number;
  };
  goldenRatioDeviation: number;
}

// 헤어스타일 추천
export interface HairStyleRecommendation {
  styleId: string;
  styleName: string;
  styleNameKr: string;
  description: string;
  length: 'short' | 'medium' | 'long';
  volumePosition: 'top' | 'sides' | 'bottom' | 'all';
  bangsType: 'none' | 'full' | 'side' | 'curtain' | 'wispy';
  matchScore: number;
  matchReason: string;
  imageUrl?: string;
}

// 헤어컬러 추천
export interface HairColorRecommendation {
  colorName: string;
  colorNameKr: string;
  level: number;
  undertone: HairUndertone;
  labTarget: LabColor;
  hex: string;
  matchScore: number;
  matchReason: string;
  seasonCompatibility: Season[];
  damageLevel: 'low' | 'medium' | 'high';
}

// 전체 분석 결과
export interface HairAnalysisResult {
  // 기본 정보
  hairType: HairTypeSimple;
  hairTypeDetailed?: HairType;
  hairThickness: HairThickness;
  hairDensity: HairDensity;
  hairPorosity?: HairPorosity;

  // 색상 분석
  hairColor: HairColorAnalysis;

  // 두피 분석
  scalp: ScalpAnalysis;

  // 건강 지표
  health: HairHealthMetrics;

  // 얼굴형 분석
  faceShape: FaceShapeAnalysis;

  // 감지된 고민
  concerns: HairConcern[];

  // 추천
  recommendedStyles: HairStyleRecommendation[];
  recommendedColors: HairColorRecommendation[];
  recommendedIngredients: string[];
  careTips: string[];

  // 인사이트
  insight: string;

  // 메타데이터
  analyzedAt: Date;
  analysisReliability: 'high' | 'medium' | 'low';
  usedMock: boolean;
}
```

### 7.2 분류 알고리즘 의사코드

```typescript
// lib/analysis/hair/classifiers.ts

/**
 * 헤어 타입 분류 (이미지 기반)
 */
function classifyHairType(
  imageFeatures: {
    curlPattern: number;      // 0: 직모, 1: 강한 컬
    waveFrequency: number;    // 웨이브 빈도
    zigzagPattern: boolean;   // Z 패턴 존재
  }
): HairTypeSimple {
  const { curlPattern, waveFrequency, zigzagPattern } = imageFeatures;

  // Z 패턴 = 코일리
  if (zigzagPattern) return 'coily';

  // 컬 패턴 강도 기반 분류
  if (curlPattern > 0.7) return 'curly';
  if (curlPattern > 0.3 || waveFrequency > 0.4) return 'wavy';
  return 'straight';
}

/**
 * 헤어 레벨 계산 (Lab L* 기반)
 */
function calculateHairLevel(labL: number): number {
  // Lab L* to Hair Level 매핑
  const levels = [
    { max: 18, level: 1 },
    { max: 22, level: 2 },
    { max: 28, level: 3 },
    { max: 35, level: 4 },
    { max: 42, level: 5 },
    { max: 50, level: 6 },
    { max: 58, level: 7 },
    { max: 68, level: 8 },
    { max: 78, level: 9 },
    { max: 100, level: 10 },
  ];

  for (const { max, level } of levels) {
    if (labL <= max) return level;
  }
  return 10;
}

/**
 * 전체 분석 점수 계산
 */
function calculateOverallScore(metrics: HairHealthMetrics): number {
  const weights = {
    hydration: 0.20,
    damage: 0.25,
    elasticity: 0.15,
    shine: 0.15,
    density: 0.25,
  };

  return Math.round(
    metrics.hydration * weights.hydration +
    metrics.damage * weights.damage +
    metrics.elasticity * weights.elasticity +
    metrics.shine * weights.shine +
    metrics.density * weights.density
  );
}
```

### 7.3 Mock 데이터 구조

```typescript
// lib/mock/hair-analysis.ts

export function generateMockHairAnalysisResult(): HairAnalysisResult {
  const faceShapes: FaceShape[] = ['oval', 'round', 'oblong', 'square', 'heart', 'diamond', 'triangle'];
  const hairTypes: HairTypeSimple[] = ['straight', 'wavy', 'curly', 'coily'];
  const thicknesses: HairThickness[] = ['fine', 'medium', 'thick'];
  const scalpTypes: ScalpType[] = ['dry', 'normal', 'oily', 'sensitive'];

  const randomFaceShape = faceShapes[Math.floor(Math.random() * faceShapes.length)];
  const randomHairType = hairTypes[Math.floor(Math.random() * hairTypes.length)];
  const randomThickness = thicknesses[Math.floor(Math.random() * thicknesses.length)];
  const randomScalpType = scalpTypes[Math.floor(Math.random() * scalpTypes.length)];

  const generateScore = (min: number, max: number) =>
    Math.floor(Math.random() * (max - min + 1)) + min;

  const health: HairHealthMetrics = {
    hydration: generateScore(35, 85),
    damage: generateScore(40, 90),
    elasticity: generateScore(45, 85),
    shine: generateScore(35, 80),
    density: generateScore(40, 85),
    overallScore: 0,
  };
  health.overallScore = calculateOverallScore(health);

  return {
    hairType: randomHairType,
    hairThickness: randomThickness,
    hairDensity: 'medium',

    hairColor: {
      dominant: { L: 22, a: 3, b: 5 },
      secondary: null,
      category: 'black',
      level: 2,
      undertone: 'neutral',
      warmthScore: 10,
      hex: '#1a1a1a',
    },

    scalp: {
      type: randomScalpType,
      oilLevel: generateScore(30, 70),
      hydration: generateScore(40, 75),
      rednessScore: generateScore(10, 40),
      sensitivityRisk: 'low',
      dandruff: { severity: generateScore(0, 20), type: 'none' },
    },

    health,

    faceShape: {
      faceShape: randomFaceShape,
      confidence: generateScore(75, 95),
      ratios: {
        faceRatio: 1.45 + Math.random() * 0.2,
        foreheadToJaw: 1.0 + Math.random() * 0.2,
        cheekToForehead: 1.0 + Math.random() * 0.15,
        cheekToJaw: 1.05 + Math.random() * 0.15,
        chinRatio: 0.2 + Math.random() * 0.08,
      },
      goldenRatioDeviation: generateScore(5, 25),
    },

    concerns: ['frizz', 'split-ends'],

    recommendedStyles: recommendHairStyles(randomFaceShape, randomHairType),
    recommendedColors: [],  // PC-1 연동 필요
    recommendedIngredients: ['케라틴', '아르간 오일', '판테놀', '비오틴'],
    careTips: [
      '미지근한 물로 샴푸하세요',
      '드라이기는 20cm 이상 거리에서 사용하세요',
      '주 1-2회 딥 트리트먼트를 해주세요',
      '자외선 노출 시 모발 보호 제품을 사용하세요',
    ],

    insight: `${getFaceShapeLabel(randomFaceShape)} 얼굴형에 ${getHairTypeLabel(randomHairType)} 타입이시네요. 얼굴형의 균형을 살려주는 스타일을 추천드립니다.`,

    analyzedAt: new Date(),
    analysisReliability: 'medium',
    usedMock: true,
  };
}

function getFaceShapeLabel(shape: FaceShape): string {
  const labels: Record<FaceShape, string> = {
    oval: '계란형',
    round: '둥근형',
    oblong: '긴형',
    square: '사각형',
    heart: '하트형',
    diamond: '다이아몬드형',
    triangle: '역삼각형',
  };
  return labels[shape];
}

function getHairTypeLabel(type: HairTypeSimple): string {
  const labels: Record<HairTypeSimple, string> = {
    straight: '직모',
    wavy: '웨이브',
    curly: '곱슬',
    coily: '강한 곱슬',
  };
  return labels[type];
}
```

---

## 8. 구현 시 필수 사항

### 8.1 P7 워크플로우 체크리스트

```markdown
## H-1 헤어 분석 P7 워크플로우

### 1. 리서치 (본 문서)
- [x] Andre Walker Hair Typing System
- [x] 두피 건강 지표 (Sebumeter 원리)
- [x] Lab 색공간 헤어컬러 분류
- [x] 얼굴형 분류 알고리즘
- [x] 한국인 모발 특성 데이터

### 2. 원리 문서화
- [ ] docs/principles/hair-science.md 작성 (필요 시)
- [x] docs/principles/hair-makeup-analysis.md 존재

### 3. ADR 작성
- [ ] ADR-052: Hair Analysis Architecture

### 4. 스펙 작성
- [x] SDD-HAIR-ANALYSIS.md (v2.0 업데이트됨)

### 5. 구현
- [ ] lib/analysis/hair/
  - [ ] index.ts (Barrel export)
  - [ ] types.ts (타입 정의)
  - [ ] face-shape.ts (얼굴형 분류)
  - [ ] hair-color.ts (헤어컬러 분석)
  - [ ] hair-type.ts (헤어 타입 분류)
  - [ ] scalp-type.ts (두피 타입 분류)
  - [ ] style-recommend.ts (스타일 추천)
  - [ ] color-recommend.ts (컬러 추천)
- [ ] app/api/analyze/hair/route.ts (API)
- [ ] lib/mock/hair-analysis.ts (Mock)
- [ ] tests/ (테스트)
```

### 8.2 AI 분석 정확도 검증 항목

| 항목 | 목표 정확도 | 검증 방법 |
|------|-----------|----------|
| 얼굴형 분류 | > 85% | 전문가 라벨링 비교 |
| 헤어 타입 분류 | > 90% | 4-Type 기준 |
| 헤어컬러 레벨 | ±1 레벨 이내 | 전문 미용사 평가 |
| 두피 타입 분류 | > 80% | 4종 기준 |
| 스타일 추천 적합도 | > 75% | 사용자 만족도 |

### 8.3 테스트 데이터 수집

- [ ] 얼굴형별 샘플 이미지 (7종 x 50장 = 350장)
- [ ] 헤어 타입별 샘플 이미지 (4종 x 50장 = 200장)
- [ ] 헤어 레벨별 샘플 이미지 (10 레벨 x 20장 = 200장)
- [ ] 다양한 조명 조건 이미지 (100장)
- [ ] 한국인 특화 테스트셋 (500장)

---

## 9. 참고 자료

### 9.1 학술 자료

1. **모발 과학**
   - Walker, A. (2007). *Andre Talks Hair!*. Andre Walker Hair
   - J. Gray. (2001). *The World of Hair: A Scientific Companion*. Macmillan
   - 대한피부과학회지 - 한국인 모발 특성 연구

2. **두피 측정**
   - Courage + Khazaka. *Sebumeter SM 815 Manual*
   - International Journal of Cosmetic Science - Scalp Health Studies

3. **색채학**
   - CIE. *Colorimetry - Part 4: CIE 1976 L*a*b* Colour Space*
   - Hair Color Level System (ICID Standards)

4. **얼굴형 분류**
   - Face Shape Classification Using Facial Features (IEEE, 2020)
   - Golden Ratio in Human Face (Journal of Craniofacial Surgery)

### 9.2 관련 원리 문서

- [hair-makeup-analysis.md](../../principles/hair-makeup-analysis.md) - 헤어/메이크업 분석 원리
- [color-science.md](../../principles/color-science.md) - Lab 색공간, 웜톤/쿨톤 이론

### 9.3 관련 SDD

- [SDD-HAIR-ANALYSIS.md](../../specs/SDD-HAIR-ANALYSIS.md) - H-1 모듈 스펙
- [SDD-CIE-2-FACE-DETECTION.md](../../specs/SDD-CIE-2-FACE-DETECTION.md) - 얼굴 랜드마크

### 9.4 관련 리서치 문서

- [CIE-2-R1-얼굴랜드마크.md](./CIE-2-R1-얼굴랜드마크.md) - MediaPipe 얼굴 랜드마크
- [CIE-3-R1-Lab색공간피부톤.md](./CIE-3-R1-Lab색공간피부톤.md) - Lab 색공간 분석

---

**Version**: 2.0 | **Created**: 2026-01-23 | **Updated**: 2026-01-23
**Author**: Claude Code
**Module**: H-1 (헤어 분석)
**P7 Stage**: 리서치 완료
**Dependencies**: CIE-2 (얼굴 감지), PC-1 (퍼스널컬러)
**Downstream**: N-1 (영양분석 - 크로스 모듈 알림)
**Changes v2.0**: 7가지 얼굴형 (triangle 추가), 스타일 추천 매트릭스 확장
