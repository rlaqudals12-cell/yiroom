# 체형 분석 고도화 기술 리서치 보고서

## 핵심 요약

MediaPipe Pose의 **33개 랜드마크** 중 체형 분석에 핵심적인 랜드마크는 어깨(11, 12), 엉덩이(23, 24), 무릎(25, 26), 발목(27, 28)이며, 이를 통해 어깨-엉덩이 비율(SHR), 상하체 비율, 관절 각도를 실시간으로 측정할 수 있다. 학술적으로 검증된 체형 비율 측정 공식으로는 **WHR(허리/엉덩이) < 0.85(여성), < 0.90(남성)**, **WHtR(허리/신장) < 0.5**가 건강 기준으로 사용되며, 자세 평가는 **CVA(두개척추각) > 53°**, **Cobb angle < 10°**가 정상 범위다. 한국인 20대 남성 평균 키 **174.4cm**, 여성 **161.1cm**로 Size Korea 8차 조사 기준이며, 서양인 대비 **다리 비율이 짧고 몸통이 긴** 특성이 있어 체형 분류 시 한국인 기준 정규화가 필수적이다.

---

## 1. MediaPipe Pose 랜드마크 매핑 및 체형 측정

### 33개 랜드마크 인덱스 테이블

MediaPipe Pose는 신체 전체를 커버하는 33개 랜드마크를 제공하며, 체형 분석에는 상체와 하체 랜드마크가 핵심적으로 활용된다. 각 랜드마크는 정규화된 x, y 좌표(0.0~1.0)와 깊이(z), 가시성(visibility), 존재 확신도(presence)를 제공한다.

| 인덱스 | 영문명 | 한글명 | 체형 분석 용도 |
|--------|--------|--------|---------------|
| 0 | nose | 코 | 기준점, 머리 위치 |
| 7-8 | left/right ear | 귀 | CVA(거북목) 측정 |
| **11** | **left shoulder** | **왼쪽 어깨** | ⭐ 어깨 너비, 자세 대칭성 |
| **12** | **right shoulder** | **오른쪽 어깨** | ⭐ 어깨 너비, 자세 대칭성 |
| 13-14 | left/right elbow | 팔꿈치 | 팔 관절 각도 |
| 15-16 | left/right wrist | 손목 | 팔 길이 측정 |
| **23** | **left hip** | **왼쪽 엉덩이** | ⭐ 엉덩이/허리 측정, 골반 기울기 |
| **24** | **right hip** | **오른쪽 엉덩이** | ⭐ 엉덩이/허리 측정, 골반 기울기 |
| **25** | **left knee** | **왼쪽 무릎** | ⭐ 다리 길이, 무릎 각도 |
| **26** | **right knee** | **오른쪽 무릎** | ⭐ 다리 길이, 무릎 각도 |
| **27** | **left ankle** | **왼쪽 발목** | ⭐ 다리 길이, 전체 높이 |
| **28** | **right ankle** | **오른쪽 발목** | ⭐ 다리 길이, 전체 높이 |
| 29-32 | heel/foot index | 발뒤꿈치/발가락 | 발 위치, 자세 안정성 |

### 체형 측정별 랜드마크 조합

| 측정 항목 | 사용 랜드마크 | 인덱스 | 계산 방법 |
|----------|--------------|--------|----------|
| 어깨 너비 | left_shoulder → right_shoulder | 11, 12 | 유클리드 거리 |
| 엉덩이 너비 | left_hip → right_hip | 23, 24 | 유클리드 거리 |
| 허리 너비 (추정) | shoulder-hip 중간점 보간 | 11,12,23,24 | 엉덩이 너비 × 0.8 보정 |
| 상체 길이 | shoulder 중점 → hip 중점 | (11+12)/2 → (23+24)/2 | 중점 간 거리 |
| 하체 길이 | hip → knee → ankle | 23→25→27 또는 24→26→28 | 누적 거리 |
| 전체 높이 | nose → ankle | 0 → 27/28 | 코-발목 거리 + 머리 보정 |

**허리 측정 대안**: MediaPipe에는 직접적인 허리 랜드마크가 없으므로, 어깨-엉덩이 중간점(약 60% 지점)을 허리로 추정하고 엉덩이 너비의 **0.8배**를 허리 너비로 보정 적용한다.

---

## 2. 학술적 체형 비율 측정 공식

체형 분석의 학술적 기반이 되는 세 가지 핵심 비율은 WHR, WHtR, SHR이며, 각각 건강 지표와 체형 분류에 활용된다.

### WHR (Waist-to-Hip Ratio) - 허리/엉덩이 비율

**공식**: `WHR = 허리 둘레 / 엉덩이 둘레`

WHO에서 정의한 건강 위험 기준은 남성 **≥ 0.90**, 여성 **≥ 0.85**이며, 1.0을 초과할 경우 심혈관 질환과 제2형 당뇨병 위험이 현저히 증가한다. BMI보다 75세 이상 노인의 사망률 예측에 더 효과적이며, 복부 비만과 내장 지방을 직접적으로 반영한다.

### WHtR (Waist-to-Height Ratio) - 허리/신장 비율

**공식**: `WHtR = 허리 둘레 / 신장`

NICE 가이드라인(2022/2025)에 따른 분류:
- **< 0.4**: 저체중 가능성
- **0.4 ~ 0.49**: 정상 (건강)
- **0.5 ~ 0.59**: 주의 필요
- **≥ 0.6**: 조치 필요

핵심 메시지는 **"허리 둘레를 신장의 절반 미만으로 유지하라"**이며, 성별, 연령, 민족에 관계없이 동일한 기준값을 적용할 수 있어 글로벌 앱에 적합하다.

### SHR (Shoulder-to-Hip Ratio) - 어깨/엉덩이 비율

**공식**: `SHR = 어깨 너비 / 엉덩이 너비`

남성의 이상적인 어깨/허리 비율(Adonis Index)은 황금비인 **1.618**이며, 1.55~1.65 범위가 매력적인 체형으로 인식된다. 체형 분류에서 SHR > 1.1은 역삼각형, SHR < 0.9는 배형으로 분류한다.

### 신장 기반 정규화 방법

픽셀에서 실제 치수로 변환 시 참조 객체(알려진 길이) 사용이 권장되며, 카메라 왜곡 보정을 위해 방사 왜곡(k₁, k₂, k₃)과 접선 왜곡(p₁, p₂) 계수를 적용해야 한다. 2D 이미지 기반 측정의 MAE는 최적 조건에서 신장 **0.9cm**, 허리 둘레 **16.5mm** 수준이나, 비제어 환경에서는 **6-7cm**, **35-40mm**로 증가한다.

---

## 3. 관절 각도 및 자세 평가 메트릭

### 주요 관절 정상 ROM (Range of Motion)

| 관절 | 동작 | 정상 범위 |
|------|------|----------|
| 무릎 | 굴곡/신전 | 0° ~ 140° |
| 어깨 | 굴곡 | 0° ~ 180° |
| 어깨 | 외전 | 0° ~ 150° |
| 고관절 | 굴곡 | 0° ~ 125° |
| 발목 | 배측굴곡 | 0° ~ 20° |

### 척추 곡률 정상 범위

| 척추 부위 | 곡률 유형 | 정상 범위 | 비정상 기준 |
|-----------|----------|----------|------------|
| 경추 (C2-C7) | 전만 | 20° ~ 40° | < 10° (일자목) |
| 흉추 (T2-T12) | 후만 | 20° ~ 40° | > 40° (굽은 등) |
| 요추 | 전만 | 40° ~ 60° | 범위 이탈 |
| 골반 | 전방 기울기 | 남성 4°~10°, 여성 7°~15° | > 15° (전방경사) |

### 주요 자세 문제 평가 기준

| 문제명 | 측정 방법 | 정상 | 경미 | 심각 |
|--------|----------|------|------|------|
| **거북목 (Forward Head Posture)** | CVA (귀-C7-수평선 각도) | > 53° | 45°~53° | < 45° |
| **측만증 (Scoliosis)** | Cobb Angle (X-ray) | < 10° | 10°~25° | > 40° |
| **전방경사 (Anterior Pelvic Tilt)** | ASIS-PSIS 각도 | 4°~15° | 15°~20° | > 20° |
| **굽은 등 (Hyperkyphosis)** | T2-T12 Cobb Angle | 20°~40° | 40°~55° | > 55° |

### 3D 관절 각도 계산 공식

벡터 내적을 이용한 각도 계산: 점 A, B, C에서 B를 꼭지점으로 하는 각도 θ는 다음과 같이 계산한다.

```
θ = arccos( (BA · BC) / (|BA| × |BC|) )
BA · BC = (Ax-Bx)(Cx-Bx) + (Ay-By)(Cy-By) + (Az-Bz)(Cz-Bz)
```

---

## 4. 체형 분류 시스템 비교 및 추천 로직

### 분류 시스템 비교

| 시스템 | 분류 기준 | 유형 수 | 모바일 앱 적합성 |
|--------|----------|--------|-----------------|
| **과일형 (Fruit Shape)** | 어깨-허리-엉덩이 측정값 비율 | 5~7개 | ⭐ **높음** - 측정 기반 자동화 가능 |
| Kibbe Body Type | Yin/Yang 균형, 뼈대, 얼굴 특징 | 13개 | 낮음 - 주관적 평가 필요 |
| Somatotype | Heath-Carter 10개 측정값 | 3개+혼합 | 중간 - 전문 장비 필요 |

**모바일 앱 추천**: **과일형(Fruit Body Shape)** - 4개 측정값(가슴, 허리, 상부 엉덩이, 엉덩이)으로 자동 분류 가능하며, 학술적으로 검증된 알고리즘(International Journal of Clothing Science and Technology)이 존재한다.

### 과일형 분류 규칙 (여성)

- **모래시계**: (bust - hips) ≤ 1" AND (bust - waist) ≥ 9" OR (hips - waist) ≥ 10"
- **배형**: (hips - bust) ≥ 3.6" AND (hips - waist) < 9"
- **역삼각형**: (bust - hips) ≥ 3.6" AND (bust - waist) < 9"
- **직사각형**: 모든 측정치 ±5% 이내, 허리 > 가슴의 75%
- **사과형**: 허리 ≥ 가슴 또는 엉덩이, WHR > 0.85

### 체형별 운동/스타일링 추천 요약

| 체형 | 권장 운동 | 권장 스타일 |
|------|---------|------------|
| **사과형** | HIIT, 코어 운동, 하체 근력 | V넥, 하이웨이스트, A라인 스커트 |
| **배형** | 상체 근력 (푸시업, 숄더프레스) | 러플 상의, 다크 컬러 하의, A라인 |
| **모래시계** | HIIT, 인도어 사이클링 | 바디콘, 랩 드레스, 벨트 활용 |
| **직사각형** | 웨이트 (스쿼트+덤벨) | 펠플럼, 벨트 드레스, 레이어링 |
| **역삼각형** | 하체 집중 운동 | V넥, 와이드 레그 팬츠, 밝은 색 하의 |

---

## 5. 한국인 체형 표준 데이터

### Size Korea 8차 조사 (2020-2023) 개요

Size Korea는 산업통상자원부 국가기술표준원에서 운영하며, 8차 조사에서 **365개 측정 항목**, 누적 **103,803명** 직접측정 데이터를 보유하고 있다. 공식 웹사이트(sizekorea.kr)에서 회원가입 후 무료로 데이터에 접근할 수 있다.

### 한국인 남성 체형 표준 데이터

| 측정항목 | 20대 | 30대 | 40대 | 50대 |
|---------|------|------|------|------|
| 키 (cm) | **174.4** | 174.9 | 172.5 | 170.5 |
| 몸무게 (kg) | 73.5 | 78.2 | 76.8 | 74.5 |
| 어깨너비 (mm) | 400-402 | 400-405 | 395-400 | 390-395 |
| 가슴둘레 (cm) | 93.0 | 96.5 | 96.0 | 94.5 |
| 허리둘레 (cm) | 78.4 | 84.5 | 87.0 | 88.0 |
| 엉덩이둘레 (cm) | 94.3 | 97.0 | 97.5 | 96.0 |
| WHR | **0.83** | 0.87 | 0.89 | 0.92 |

### 한국인 여성 체형 표준 데이터

| 측정항목 | 20대 | 30대 | 40대 | 50대 |
|---------|------|------|------|------|
| 키 (cm) | **161.1** | 162.0 | 160.4 | 157.5 |
| 몸무게 (kg) | 56.5 | 58.0 | 59.5 | 60.0 |
| 어깨너비 (mm) | 355-360 | 360-365 | 360-365 | 355-360 |
| 가슴둘레 (cm) | 82.0 | 84.5 | 87.0 | 88.5 |
| 허리둘레 (cm) | 68.0 | 72.0 | 76.0 | 79.0 |
| 엉덩이둘레 (cm) | 91.0 | 93.5 | 94.5 | 95.0 |
| WHR | **0.75** | 0.77 | 0.80 | 0.83 |

### 서양인 대비 한국인 체형 특성

| 항목 | 한국인 특성 | 서양인 특성 |
|------|-----------|------------|
| 신장 대비 다리 비율 | **상대적으로 짧음** (0.45-0.46) | 상대적으로 긺 |
| 신장 대비 몸통 비율 | **상대적으로 긺** | 상대적으로 짧음 |
| 허리-엉덩이 비율 (여성) | **더 작음** (직선적 실루엣) | 더 큼 (곡선적) |
| 평균 BMI | **23-24** | 26-30 |
| 체형 변이 | **더 균일함** | 더 다양함 |

핵심 고려사항: 같은 키 기준 한국인이 서양인보다 다리가 유의미하게 짧고 몸통이 길다. 체형 분류 시 서양 기준을 그대로 적용하면 오분류가 발생할 수 있으므로 **한국인 기준값으로 정규화**가 필수적이다.

---

## 6. TypeScript 구현 코드

### 6.1 랜드마크 타입 및 유틸리티

```typescript
// MediaPipe Pose 랜드마크 인덱스 열거형
export enum PoseLandmarkIndex {
  NOSE = 0,
  LEFT_EYE_INNER = 1, LEFT_EYE = 2, LEFT_EYE_OUTER = 3,
  RIGHT_EYE_INNER = 4, RIGHT_EYE = 5, RIGHT_EYE_OUTER = 6,
  LEFT_EAR = 7, RIGHT_EAR = 8,
  MOUTH_LEFT = 9, MOUTH_RIGHT = 10,
  LEFT_SHOULDER = 11, RIGHT_SHOULDER = 12,
  LEFT_ELBOW = 13, RIGHT_ELBOW = 14,
  LEFT_WRIST = 15, RIGHT_WRIST = 16,
  LEFT_PINKY = 17, RIGHT_PINKY = 18,
  LEFT_INDEX = 19, RIGHT_INDEX = 20,
  LEFT_THUMB = 21, RIGHT_THUMB = 22,
  LEFT_HIP = 23, RIGHT_HIP = 24,
  LEFT_KNEE = 25, RIGHT_KNEE = 26,
  LEFT_ANKLE = 27, RIGHT_ANKLE = 28,
  LEFT_HEEL = 29, RIGHT_HEEL = 30,
  LEFT_FOOT_INDEX = 31, RIGHT_FOOT_INDEX = 32,
}

// 랜드마크 인터페이스
export interface Landmark {
  x: number;           // 0.0 ~ 1.0 정규화
  y: number;           // 0.0 ~ 1.0 정규화
  z: number;           // 깊이 (엉덩이 중점 기준)
  visibility?: number; // 가시성 (0.0 ~ 1.0)
  presence?: number;   // 존재 확신도 (0.0 ~ 1.0)
}

// 유틸리티 함수
export function calculateDistance(p1: Landmark, p2: Landmark): number {
  return Math.sqrt(
    Math.pow(p2.x - p1.x, 2) + 
    Math.pow(p2.y - p1.y, 2) + 
    Math.pow(p2.z - p1.z, 2)
  );
}

export function calculateDistance2D(p1: Landmark, p2: Landmark): number {
  return Math.sqrt(
    Math.pow(p2.x - p1.x, 2) + 
    Math.pow(p2.y - p1.y, 2)
  );
}

export function getMidpoint(p1: Landmark, p2: Landmark): Landmark {
  return {
    x: (p1.x + p2.x) / 2,
    y: (p1.y + p2.y) / 2,
    z: (p1.z + p2.z) / 2,
    visibility: Math.min(p1.visibility ?? 1, p2.visibility ?? 1),
    presence: Math.min(p1.presence ?? 1, p2.presence ?? 1),
  };
}

// 신뢰도 검증
export function isLandmarkReliable(
  landmark: Landmark, 
  threshold = 0.5
): boolean {
  return (landmark.visibility ?? 0) > threshold && 
         (landmark.presence ?? 0) > threshold;
}
```

### 6.2 체형 비율 계산

```typescript
export interface BodyMeasurements {
  shoulderWidth: number;
  hipWidth: number;
  estimatedWaistWidth: number;
  upperBodyLength: number;
  lowerBodyLength: number;
}

export interface BodyRatios {
  shoulderHipRatio: number;    // SHR
  upperLowerRatio: number;     // 상하체 비율
  estimatedWHR: number;        // 추정 허리-엉덩이 비율
}

export function measureBodyFromLandmarks(
  landmarks: Landmark[]
): BodyMeasurements {
  const leftShoulder = landmarks[PoseLandmarkIndex.LEFT_SHOULDER];
  const rightShoulder = landmarks[PoseLandmarkIndex.RIGHT_SHOULDER];
  const leftHip = landmarks[PoseLandmarkIndex.LEFT_HIP];
  const rightHip = landmarks[PoseLandmarkIndex.RIGHT_HIP];
  const leftKnee = landmarks[PoseLandmarkIndex.LEFT_KNEE];
  const leftAnkle = landmarks[PoseLandmarkIndex.LEFT_ANKLE];

  const shoulderWidth = calculateDistance2D(leftShoulder, rightShoulder);
  const hipWidth = calculateDistance2D(leftHip, rightHip);
  
  // 허리 추정 (엉덩이의 80%)
  const estimatedWaistWidth = hipWidth * 0.8;
  
  // 상체 길이
  const shoulderMid = getMidpoint(leftShoulder, rightShoulder);
  const hipMid = getMidpoint(leftHip, rightHip);
  const upperBodyLength = calculateDistance2D(shoulderMid, hipMid);
  
  // 하체 길이
  const upperLeg = calculateDistance2D(leftHip, leftKnee);
  const lowerLeg = calculateDistance2D(leftKnee, leftAnkle);
  const lowerBodyLength = upperLeg + lowerLeg;

  return {
    shoulderWidth,
    hipWidth,
    estimatedWaistWidth,
    upperBodyLength,
    lowerBodyLength,
  };
}

export function calculateBodyRatios(
  measurements: BodyMeasurements
): BodyRatios {
  return {
    shoulderHipRatio: measurements.shoulderWidth / measurements.hipWidth,
    upperLowerRatio: measurements.upperBodyLength / measurements.lowerBodyLength,
    estimatedWHR: measurements.estimatedWaistWidth / measurements.hipWidth,
  };
}
```

### 6.3 체형 분류 알고리즘

```typescript
export type BodyShapeType = 
  | 'hourglass' | 'pear' | 'apple' 
  | 'rectangle' | 'invertedTriangle';

export interface BodyShapeResult {
  type: BodyShapeType;
  confidence: number;
  koreanName: string;
}

// 여성 체형 분류 (측정값 단위: 인치)
export function classifyFemaleBodyShape(
  bust: number,
  waist: number,
  highHip: number,
  hips: number
): BodyShapeResult {
  const bustHipDiff = bust - hips;
  const hipsBustDiff = hips - bust;
  const bustWaistDiff = bust - waist;
  const hipsWaistDiff = hips - waist;
  const highHipWaistRatio = highHip / waist;

  // 모래시계형
  if (bustHipDiff <= 1 && hipsBustDiff < 3.6 && 
      (bustWaistDiff >= 9 || hipsWaistDiff >= 10)) {
    return { type: 'hourglass', confidence: 0.9, koreanName: '모래시계형' };
  }

  // 배형 (삼각형)
  if (hipsBustDiff >= 3.6 && hipsWaistDiff < 9) {
    return { type: 'pear', confidence: 0.85, koreanName: '배형' };
  }

  // 역삼각형
  if (bustHipDiff >= 3.6 && bustWaistDiff < 9) {
    return { type: 'invertedTriangle', confidence: 0.85, koreanName: '역삼각형' };
  }

  // 사과형
  if (waist >= bust || waist >= hips) {
    return { type: 'apple', confidence: 0.8, koreanName: '사과형' };
  }

  // 직사각형 (기본)
  return { type: 'rectangle', confidence: 0.7, koreanName: '직사각형' };
}

// 남성 체형 분류
export type MaleBodyShape = 
  | 'rectangle' | 'triangle' | 'invertedTriangle' 
  | 'oval' | 'trapezoid';

export function classifyMaleBodyShape(
  shoulders: number,
  waist: number,
  hips: number
): MaleBodyShape {
  const shoulderHipRatio = shoulders / hips;
  const shoulderWaistRatio = shoulders / waist;

  if (waist >= shoulders && waist >= hips) return 'oval';
  if (hips > shoulders) return 'triangle';
  if (shoulderHipRatio > 1.2 && shoulderWaistRatio > 1.15) return 'invertedTriangle';
  if (shoulderHipRatio > 1.05 && shoulderWaistRatio > 1.2) return 'trapezoid';
  return 'rectangle';
}
```

### 6.4 관절 각도 계산

```typescript
interface Point3D {
  x: number;
  y: number;
  z: number;
}

// 3개 점으로 각도 계산 (B가 꼭지점)
export function calculateAngle3D(
  a: Point3D, 
  b: Point3D, 
  c: Point3D
): number {
  const ba = { x: a.x - b.x, y: a.y - b.y, z: a.z - b.z };
  const bc = { x: c.x - b.x, y: c.y - b.y, z: c.z - b.z };
  
  const dotProduct = ba.x * bc.x + ba.y * bc.y + ba.z * bc.z;
  const magnitudeBA = Math.sqrt(ba.x ** 2 + ba.y ** 2 + ba.z ** 2);
  const magnitudeBC = Math.sqrt(bc.x ** 2 + bc.y ** 2 + bc.z ** 2);
  
  const cosAngle = dotProduct / (magnitudeBA * magnitudeBC);
  const angleRad = Math.acos(Math.max(-1, Math.min(1, cosAngle)));
  
  return angleRad * (180 / Math.PI);
}

// 무릎 각도 (Hip-Knee-Ankle)
export function calculateKneeAngle(landmarks: Landmark[]): number {
  const hip = landmarks[PoseLandmarkIndex.LEFT_HIP];
  const knee = landmarks[PoseLandmarkIndex.LEFT_KNEE];
  const ankle = landmarks[PoseLandmarkIndex.LEFT_ANKLE];
  return calculateAngle3D(hip, knee, ankle);
}

// 어깨 굴곡 각도
export function calculateShoulderFlexion(landmarks: Landmark[]): number {
  const hip = landmarks[PoseLandmarkIndex.LEFT_HIP];
  const shoulder = landmarks[PoseLandmarkIndex.LEFT_SHOULDER];
  const elbow = landmarks[PoseLandmarkIndex.LEFT_ELBOW];
  return 180 - calculateAngle3D(hip, shoulder, elbow);
}
```

### 6.5 자세 점수화 알고리즘

```typescript
interface PostureMetrics {
  cva: number;              // 두개척추각 (거북목)
  thoracicKyphosis: number; // 흉추 후만각
  pelvicTilt: number;       // 골반 기울기
  spineSymmetry: number;    // 척추 대칭성 (0-1)
}

interface PostureNorms {
  min: number;
  max: number;
  optimal: number;
}

const POSTURE_NORMS: Record<string, PostureNorms> = {
  cva: { min: 48, max: 65, optimal: 55 },
  thoracicKyphosis: { min: 20, max: 40, optimal: 30 },
  pelvicTilt: { min: 4, max: 15, optimal: 10 },
};

const WEIGHTS = {
  cva: 0.30,
  thoracicKyphosis: 0.25,
  pelvicTilt: 0.25,
  spineSymmetry: 0.20,
};

function calculateMetricScore(value: number, norms: PostureNorms): number {
  const { min, max, optimal } = norms;
  const deviation = Math.abs(value - optimal);
  const maxDeviation = Math.max(optimal - min, max - optimal);
  
  if (value >= min && value <= max) {
    return 100 - (deviation / maxDeviation) * 30;
  }
  
  const outsideDeviation = value < min ? min - value : value - max;
  const penaltyFactor = Math.min(outsideDeviation / maxDeviation, 1);
  return Math.max(0, 70 - penaltyFactor * 70);
}

export function calculatePostureScore(metrics: PostureMetrics): {
  totalScore: number;
  grade: string;
  issues: string[];
} {
  const issues: string[] = [];
  
  const cvaScore = calculateMetricScore(metrics.cva, POSTURE_NORMS.cva);
  if (metrics.cva < 48) issues.push('거북목(Forward Head Posture) 의심');
  
  const kyphosisScore = calculateMetricScore(
    metrics.thoracicKyphosis, 
    POSTURE_NORMS.thoracicKyphosis
  );
  if (metrics.thoracicKyphosis > 40) issues.push('굽은 등(Hyperkyphosis) 의심');
  
  const pelvicScore = calculateMetricScore(
    metrics.pelvicTilt, 
    POSTURE_NORMS.pelvicTilt
  );
  if (metrics.pelvicTilt > 15) issues.push('전방경사(Anterior Pelvic Tilt) 의심');
  
  const symmetryScore = metrics.spineSymmetry * 100;
  if (metrics.spineSymmetry < 0.9) issues.push('척추 비대칭 의심');
  
  const totalScore = Math.round(
    cvaScore * WEIGHTS.cva +
    kyphosisScore * WEIGHTS.thoracicKyphosis +
    pelvicScore * WEIGHTS.pelvicTilt +
    symmetryScore * WEIGHTS.spineSymmetry
  );
  
  let grade: string;
  if (totalScore >= 90) grade = 'A (우수)';
  else if (totalScore >= 80) grade = 'B (양호)';
  else if (totalScore >= 70) grade = 'C (보통)';
  else if (totalScore >= 60) grade = 'D (주의)';
  else grade = 'F (위험)';
  
  return { totalScore, grade, issues };
}
```

### 6.6 한국인 기준 정규화

```typescript
// 한국인 표준 데이터 (Size Korea 8차 조사)
const KOREAN_STANDARDS = {
  male: {
    '20s': { height: 174.4, shoulderWidth: 401, waist: 78.4, hip: 94.3, whr: 0.83 },
    '30s': { height: 174.9, shoulderWidth: 402, waist: 84.5, hip: 97.0, whr: 0.87 },
    '40s': { height: 172.5, shoulderWidth: 397, waist: 87.0, hip: 97.5, whr: 0.89 },
    '50s': { height: 170.5, shoulderWidth: 392, waist: 88.0, hip: 96.0, whr: 0.92 },
  },
  female: {
    '20s': { height: 161.1, shoulderWidth: 357, waist: 68.0, hip: 91.0, whr: 0.75 },
    '30s': { height: 162.0, shoulderWidth: 362, waist: 72.0, hip: 93.5, whr: 0.77 },
    '40s': { height: 160.4, shoulderWidth: 362, waist: 76.0, hip: 94.5, whr: 0.80 },
    '50s': { height: 157.5, shoulderWidth: 357, waist: 79.0, hip: 95.0, whr: 0.83 },
  },
};

// 표준편차 (예시값 - 실제 Size Korea 데이터 참조 필요)
const KOREAN_STD_DEV = {
  male: { height: 5.8, shoulderWidth: 21, waist: 8.5, hip: 5.2 },
  female: { height: 5.2, shoulderWidth: 18, waist: 7.0, hip: 5.0 },
};

export function normalizeToKoreanStandard(
  value: number,
  measurement: 'height' | 'shoulderWidth' | 'waist' | 'hip',
  gender: 'male' | 'female',
  ageGroup: '20s' | '30s' | '40s' | '50s'
): { zScore: number; percentile: number } {
  const mean = KOREAN_STANDARDS[gender][ageGroup][measurement];
  const stdDev = KOREAN_STD_DEV[gender][measurement];
  
  const zScore = (value - mean) / stdDev;
  
  // 정규분포 CDF 근사 계산
  const percentile = (1 + Math.sign(zScore) * 
    Math.sqrt(1 - Math.exp(-2 * zScore * zScore / Math.PI))) / 2 * 100;
  
  return { zScore, percentile: Math.round(percentile) };
}
```

---

## 7. 구현 시 필수 체크리스트

### 기술 구현
- [ ] MediaPipe Pose 33개 랜드마크 인덱스 매핑 완료
- [ ] visibility/presence 임계값 0.5 이상 필터링 적용
- [ ] 정면/측면 촬영 분리 처리 로직 구현
- [ ] GPU 가속 활성화 (Delegate.GPU) 및 30+ FPS 성능 확인
- [ ] 픽셀-실제 치수 변환을 위한 참조 객체 캘리브레이션

### 체형 비율 측정
- [ ] WHR, WHtR, SHR 계산 함수 구현
- [ ] 허리 너비 추정 로직 (엉덩이 × 0.8) 적용
- [ ] 신장 기반 정규화 함수 구현
- [ ] 한국인 표준 데이터 기반 백분위 계산

### 자세 평가
- [ ] 3D 각도 계산 함수 (벡터 내적) 구현
- [ ] CVA(거북목), Cobb angle(측만), 골반 기울기 평가
- [ ] 0-100 자세 점수 및 A-F 등급 산출
- [ ] 실시간 피드백 메시지 생성

### 체형 분류 및 추천
- [ ] 과일형 체형 분류 알고리즘 (남/여 분리)
- [ ] 체형별 운동 추천 데이터베이스
- [ ] 체형별 스타일링 추천 데이터베이스
- [ ] Gemini AI 프롬프트 템플릿 작성

### 데이터 검증
- [ ] Size Korea 데이터 기반 정상 범위 설정
- [ ] 서양인 기준 vs 한국인 기준 분기 처리
- [ ] 연령대별/성별 표준 데이터 테이블 적용
- [ ] 측정 오차 허용 범위 (MAE 기준) 설정

---

## 결론

본 연구를 통해 MediaPipe Pose 기반 체형 분석 시스템 구현에 필요한 **학술적 근거와 실용적 알고리즘**을 종합했다. 핵심 발견은 다음과 같다:

**첫째**, MediaPipe의 33개 랜드마크 중 체형 분석 핵심은 어깨(11,12), 엉덩이(23,24), 무릎(25,26), 발목(27,28)이며, 허리는 직접 측정이 불가능하여 엉덩이 너비의 0.8배로 추정해야 한다.

**둘째**, 체형 비율 측정에서 WHtR < 0.5 기준은 성별/연령/민족에 관계없이 적용 가능하여 글로벌 앱에 적합하며, 자세 평가에서 CVA > 53°, Cobb angle < 10°가 정상 기준이다.

**셋째**, 모바일 앱에는 **과일형(Fruit Body Shape)** 분류 시스템이 가장 적합하며, 4개 측정값으로 자동 분류가 가능하고 학술적 검증이 완료된 알고리즘이 존재한다.

**넷째**, 한국인은 서양인 대비 **다리 비율이 짧고 몸통이 긴** 특성이 있어, 체형 분류 시 Size Korea 데이터 기반 한국인 정규화가 필수적이다. 20대 남성 평균 키 174.4cm, 여성 161.1cm, WHR은 각각 0.83, 0.75가 기준이다.

구현 시 정면+측면 2장 촬영, GPU 가속으로 30+ FPS 확보, visibility 0.5 이상 필터링을 권장하며, 제공된 TypeScript 코드를 기반으로 React Native + Gemini AI 파이프라인을 구축할 수 있다.