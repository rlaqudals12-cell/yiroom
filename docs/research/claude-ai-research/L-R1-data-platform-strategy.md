# L-R1: ë°ì´í„° í”Œë«í¼ ì „ëµ ë¦¬ì„œì¹˜

> **ì‘ì„±ì¼**: 2026-02-01
> **ëª©ì **: ì´ë£¸ ìì²´ ì»¤ë¨¸ìŠ¤ í”Œë«í¼ ì „í™˜ì„ ìœ„í•œ ë°ì´í„° ìì‚° êµ¬ì¶• ì „ëµ
> **P7 ë‹¨ê³„**: ë¦¬ì„œì¹˜ (Research)

---

## 1. ë°°ê²½ ë° ëª©í‘œ

### 1.1 í˜„ì¬ ìƒíƒœ

ì´ë£¸ì€ í˜„ì¬ **ì–´í•„ë¦¬ì—ì´íŠ¸ ëª¨ë¸**ë¡œ ìš´ì˜ ì¤‘:
- ì¿ íŒ¡, iHerb, ë¬´ì‹ ì‚¬ íŒŒíŠ¸ë„ˆì‚¬ ì œí’ˆ ì¶”ì²œ
- ë¶„ì„ ê²°ê³¼ ê¸°ë°˜ ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ (matching.ts)
- í´ë¦­ â†’ ì™¸ë¶€ ì‚¬ì´íŠ¸ ì´ë™ â†’ êµ¬ë§¤ ì‹œ ìˆ˜ìˆ˜ë£Œ

### 1.2 ì „í™˜ ëª©í‘œ

**ë°ì´í„° ê¸°ë°˜ ë·°í‹°/ì›°ë‹ˆìŠ¤ í”Œë«í¼**ìœ¼ë¡œ ì „í™˜:
- ë¬´ì‹ ì‚¬/ë£©í•€ì²˜ëŸ¼ ìì²´ ì‡¼í•‘ëª° + ë¸Œëœë“œ ì…ì  ëª¨ë¸
- ë¶„ì„ ê²°ê³¼ + í´ë¦­ ë°ì´í„° = **"í•µì‹¬ ë¬´ê¸°"**ë¡œ í™œìš©
- ë¸Œëœë“œ íŒŒíŠ¸ë„ˆì‹­ í˜‘ìƒë ¥ í™•ë³´

### 1.3 í•µì‹¬ ì§ˆë¬¸

1. ì–´ë–¤ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•´ì•¼ í•˜ëŠ”ê°€?
2. ì–´ë–»ê²Œ ë¶„ì„ ê²°ê³¼ì™€ í´ë¦­ì„ ì—°ê³„í•  ê²ƒì¸ê°€?
3. ë¸Œëœë“œì—ê²Œ ì–´ë–¤ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•  ìˆ˜ ìˆëŠ”ê°€?
4. ê°œì¸í™”ë¥¼ ì–´ë–»ê²Œ ê°œì„ í•  ê²ƒì¸ê°€?

---

## 2. ë°ì´í„° í”Œë«í¼ ì•„í‚¤í…ì²˜ íŒ¨í„´

### 2.1 3-Tier ë°ì´í„° í”Œë«í¼ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë°ì´í„° í”Œë«í¼ 3-Tier ì•„í‚¤í…ì²˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          Tier 1: Event Collection Layer              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ Analytics  â”‚  â”‚   Audit    â”‚  â”‚  Click     â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Events    â”‚  â”‚   Logs     â”‚  â”‚  Stream    â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚        â”‚               â”‚               â”‚             â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â”‚                        â–¼                             â”‚   â”‚
â”‚  â”‚              Event Queue (Batch 10/5s)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                 â”‚
â”‚                           â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          Tier 2: Processing & Enrichment Layer       â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Source       â”‚  â”‚ Product      â”‚  â”‚ User      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Attribution  â”‚  â”‚ Matching     â”‚  â”‚ Profiling â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  - ì–´ë–¤ ë¶„ì„ì—ì„œ ì¶”ì²œëëŠ”ì§€ (source_analysis_id)       â”‚   â”‚
â”‚  â”‚  - ë‚´ë¶€ ì œí’ˆ ID ë§¤í•‘ (product_master_id)              â”‚   â”‚
â”‚  â”‚  - ì‚¬ìš©ì ì„¸ê·¸ë¨¼íŠ¸ ë¶„ë¥˜                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                 â”‚
â”‚                           â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          Tier 3: Serving & Insight Layer             â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Personalized â”‚  â”‚ Brand        â”‚  â”‚ A/B Test  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Recommend    â”‚  â”‚ Dashboard    â”‚  â”‚ Analytics â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 í•µì‹¬ ë°ì´í„° íë¦„

1. **Event Collection**: ì‚¬ìš©ì í–‰ë™ ì‹¤ì‹œê°„ ìˆ˜ì§‘
2. **Processing**: ë¶„ì„-í´ë¦­ ì—°ê³„, ì œí’ˆ ID í†µí•©, ì‚¬ìš©ì í”„ë¡œíŒŒì¼ë§
3. **Serving**: ê°œì¸í™” ì¶”ì²œ, ë¸Œëœë“œ ì¸ì‚¬ì´íŠ¸, A/B í…ŒìŠ¤íŠ¸ ê²°ê³¼

---

## 3. ì œí’ˆ ë§ˆìŠ¤í„° ë°ì´í„°ë² ì´ìŠ¤ (Product Master)

### 3.1 í•„ìš”ì„±

í˜„ì¬ ë¬¸ì œ:
- ë™ì¼ ì œí’ˆì´ íŒŒíŠ¸ë„ˆë³„ë¡œ ë‹¤ë¥¸ ID ì‚¬ìš©
- ì¿ íŒ¡ "ABC123", iHerb "XYZ789" â†’ ê°™ì€ ì œí’ˆ
- êµì°¨ ë¶„ì„ ë¶ˆê°€ëŠ¥

í•´ê²°ì±…:
- **ë‚´ë¶€ SKU ì²´ê³„** ë„ì…
- ì™¸ë¶€ ID â†’ ë‚´ë¶€ ID ë§¤í•‘ í…Œì´ë¸”

### 3.2 ìŠ¤í‚¤ë§ˆ ì„¤ê³„

```sql
-- ì œí’ˆ ë§ˆìŠ¤í„° í…Œì´ë¸”
CREATE TABLE product_master (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  internal_sku TEXT UNIQUE NOT NULL,  -- ì´ë£¸ ë‚´ë¶€ SKU

  -- ê¸°ë³¸ ì •ë³´
  name TEXT NOT NULL,
  brand TEXT,
  category product_category NOT NULL,
  subcategory TEXT,

  -- ì™¸ë¶€ ID ë§¤í•‘
  external_ids JSONB NOT NULL DEFAULT '{}',
  -- { "coupang": "123", "iherb": "ABC", "musinsa": "456" }

  -- ì´ë£¸ ë¶„ì„ ì—°ê³„ ì†ì„±
  skin_types TEXT[],           -- ['dry', 'oily', 'combination']
  skin_concerns TEXT[],        -- ['acne', 'wrinkle', 'pigmentation']
  personal_colors TEXT[],      -- ['spring_warm', 'summer_cool']
  body_types TEXT[],           -- ['rectangle', 'hourglass']
  age_groups TEXT[],           -- ['20s', '30s', '40s']
  gender_targets TEXT[],       -- ['all', 'female', 'male']

  -- ë©”íƒ€ë°ì´í„°
  image_urls TEXT[],
  description TEXT,
  ingredients TEXT[],          -- ì„±ë¶„ ëª©ë¡ (í™”ì¥í’ˆ)

  -- ê°€ê²© íˆìŠ¤í† ë¦¬
  current_price JSONB,         -- { "coupang": 15900, "iherb": 12.99 }

  -- í†µê³„
  total_views INTEGER DEFAULT 0,
  total_clicks INTEGER DEFAULT 0,
  total_conversions INTEGER DEFAULT 0,
  avg_match_score DECIMAL,

  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_product_master_category ON product_master(category);
CREATE INDEX idx_product_master_skin_types ON product_master USING GIN(skin_types);
CREATE INDEX idx_product_master_personal_colors ON product_master USING GIN(personal_colors);
CREATE INDEX idx_product_master_external_ids ON product_master USING GIN(external_ids);
```

### 3.3 External ID ì¡°íšŒ íŒ¨í„´

```typescript
// ì¿ íŒ¡ ì œí’ˆ IDë¡œ ë‚´ë¶€ SKU ì¡°íšŒ
const { data } = await supabase
  .from('product_master')
  .select('internal_sku, name, skin_types, personal_colors')
  .contains('external_ids', { coupang: 'ABC123' })
  .single();

// ê²°ê³¼: { internal_sku: 'YR-SKIN-001', name: 'ë¼ìš´ë“œë© ìì‘ë‚˜ë¬´ ìˆ˜ë¶„í¬ë¦¼', ... }
```

---

## 4. í´ë¦­-ë¶„ì„ ì—°ê³„ (Click-Analysis Attribution)

### 4.1 í˜„ì¬ Analytics ì´ë²¤íŠ¸ í™•ì¥

ê¸°ì¡´ `analytics_events` í…Œì´ë¸”ì— ì»¬ëŸ¼ ì¶”ê°€:

```sql
ALTER TABLE analytics_events
  ADD COLUMN source_analysis_id UUID,        -- ì¶”ì²œ ì¶œì²˜ ë¶„ì„ ID
  ADD COLUMN source_analysis_type TEXT,      -- 'skin' | 'personal_color' | 'body'
  ADD COLUMN product_master_id UUID,         -- ë‚´ë¶€ ì œí’ˆ ID
  ADD COLUMN match_score INTEGER,            -- ë§¤ì¹­ ì ìˆ˜ (0-100)
  ADD COLUMN recommendation_position INTEGER, -- ì¶”ì²œ ëª©ë¡ ë‚´ ìœ„ì¹˜
  ADD COLUMN recommendation_context TEXT;    -- 'main_result' | 'related' | 'alternative'

-- ì™¸ë˜ í‚¤
ALTER TABLE analytics_events
  ADD CONSTRAINT fk_product_master
  FOREIGN KEY (product_master_id) REFERENCES product_master(id);
```

### 4.2 ì´ë²¤íŠ¸ ì¶”ì  ì‹œë‚˜ë¦¬ì˜¤

```typescript
// ì‚¬ìš©ì ì—¬ì • ì˜ˆì‹œ
// 1. í”¼ë¶€ ë¶„ì„ ì™„ë£Œ â†’ analysis_id: "skin_abc123"
// 2. ì¶”ì²œ ì œí’ˆ ëª©ë¡ ë…¸ì¶œ â†’ impression ì´ë²¤íŠ¸
// 3. ì œí’ˆ í´ë¦­ â†’ click ì´ë²¤íŠ¸ (source í¬í•¨)

trackEvent({
  event: 'product_click',
  properties: {
    product_master_id: 'YR-SKIN-001',
    source_analysis_id: 'skin_abc123',
    source_analysis_type: 'skin',
    match_score: 87,
    recommendation_position: 2,
    recommendation_context: 'main_result'
  }
});
```

### 4.3 Attribution ë¶„ì„ ì¿¼ë¦¬

```sql
-- ë¶„ì„ íƒ€ì…ë³„ ì „í™˜ìœ¨
SELECT
  source_analysis_type,
  COUNT(*) as clicks,
  COUNT(CASE WHEN event = 'purchase' THEN 1 END) as conversions,
  ROUND(COUNT(CASE WHEN event = 'purchase' THEN 1 END)::numeric / COUNT(*)::numeric * 100, 2) as conversion_rate
FROM analytics_events
WHERE source_analysis_id IS NOT NULL
GROUP BY source_analysis_type;

-- ê²°ê³¼ ì˜ˆì‹œ:
-- skin           | 2340 | 187 | 7.99%
-- personal_color | 1890 | 132 | 6.98%
-- body           | 890  | 45  | 5.06%
```

---

## 5. ì‚¬ìš©ì ì„ í˜¸ë„ í•™ìŠµ (Preference Learning)

### 5.1 í•™ìŠµ ë°ì´í„° ì†ŒìŠ¤

| ë°ì´í„° ì†ŒìŠ¤ | ì‹œê·¸ë„ | ê°€ì¤‘ì¹˜ |
|------------|--------|--------|
| í´ë¦­ | ê´€ì‹¬ë„ | 1x |
| ì¡°íšŒ ì‹œê°„ | ê´€ì‹¬ ê°•ë„ | 1.5x |
| êµ¬ë§¤ | ì‹¤ì œ ì„ í˜¸ | 5x |
| ì¬êµ¬ë§¤ | ê°•ë ¥ ì„ í˜¸ | 10x |
| ì°œ/ì €ì¥ | ê³ ë ¤ ì¤‘ | 2x |
| ë¦¬ë·° ì‘ì„± | ë§Œì¡±ë„ | 3x |

### 5.2 ì„ í˜¸ë„ ëª¨ë¸ ìŠ¤í‚¤ë§ˆ

```sql
CREATE TABLE user_preferences_learned (
  clerk_user_id TEXT PRIMARY KEY,

  -- ë¸Œëœë“œ ì¹œë°€ë„
  brand_affinity JSONB DEFAULT '{}',
  -- { "ë¼ìš´ë“œë©": 0.85, "ë‹¥í„°ìë¥´íŠ¸": 0.72 }

  -- ì¹´í…Œê³ ë¦¬ ì„ í˜¸ë„
  category_affinity JSONB DEFAULT '{}',
  -- { "skincare": 0.92, "makeup": 0.45, "supplements": 0.68 }

  -- ê°€ê²© ë¯¼ê°ë„ (0: ê°€ê²© ë¬´ê´€, 1: ë§¤ìš° ë¯¼ê°)
  price_sensitivity DECIMAL DEFAULT 0.5,

  -- ì„±ë¶„ ì„ í˜¸/íšŒí”¼
  ingredient_preferences JSONB DEFAULT '{}',
  -- { "preferred": ["íˆì•Œë£¨ë¡ ì‚°", "ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ"], "avoided": ["í–¥ë£Œ", "ì•Œì½”ì˜¬"] }

  -- ì‚¬ìš©ì ì„¸ê·¸ë¨¼íŠ¸
  user_segment TEXT,
  -- 'high_value', 'brand_loyalist', 'price_hunter', 'new_user', 'dormant'

  -- ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ íŒŒë¼ë¯¸í„°
  exploration_rate DECIMAL DEFAULT 0.2,  -- ìƒˆë¡œìš´ ì œí’ˆ ì¶”ì²œ ë¹„ìœ¨
  recency_weight DECIMAL DEFAULT 0.7,    -- ìµœê·¼ í–‰ë™ ê°€ì¤‘ì¹˜

  -- ì‹ ë¢°ë„ (ë°ì´í„° ì–‘ì— ë”°ë¼)
  confidence DECIMAL DEFAULT 0.0,

  -- íƒ€ì„ìŠ¤íƒ¬í”„
  first_interaction_at TIMESTAMPTZ,
  last_interaction_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ DEFAULT now()
);
```

### 5.3 ì„ í˜¸ë„ ì—…ë°ì´íŠ¸ ë¡œì§

```typescript
interface PreferenceUpdate {
  userId: string;
  eventType: 'click' | 'view' | 'purchase' | 'save' | 'review';
  productMasterId: string;
  context: {
    brand: string;
    category: string;
    price: number;
    matchScore: number;
  };
}

function updatePreferences(update: PreferenceUpdate): void {
  const weights = {
    click: 1,
    view: 0.5,
    purchase: 5,
    save: 2,
    review: 3
  };

  const weight = weights[update.eventType];

  // ë¸Œëœë“œ ì¹œë°€ë„ ì—…ë°ì´íŠ¸
  // ì§€ìˆ˜ ì´ë™ í‰ê·  (EMA) ì‚¬ìš©
  const alpha = 0.1;
  currentAffinity = alpha * weight + (1 - alpha) * currentAffinity;
}
```

---

## 6. ë¸Œëœë“œ ì¸ì‚¬ì´íŠ¸ ëŒ€ì‹œë³´ë“œ

### 6.1 ì œê³µ ê°€ëŠ¥ ë°ì´í„°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ì´ë£¸ ë¸Œëœë“œ ì¸ì‚¬ì´íŠ¸ íŒ¨í‚¤ì§€                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸ“Š 1. íƒ€ê²Ÿ ê³ ê° ë¶„ì„                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ "ë´„ ì›œí†¤ + ê±´ì„± í”¼ë¶€" ì‚¬ìš©ì                   â”‚    â”‚
â”‚     â”‚ - ë„ë‹¬ ê°€ëŠ¥ ì‚¬ìš©ì: 12,340ëª…                  â”‚    â”‚
â”‚     â”‚ - ì˜ˆìƒ CTR: 8.5% (í‰ê·  ëŒ€ë¹„ 2.3ë°°)            â”‚    â”‚
â”‚     â”‚ - ì£¼ìš” ê´€ì‹¬ì‚¬: ìˆ˜ë¶„, ì§„ì •, ë¯¸ë°±               â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  ğŸ“ˆ 2. ê²½ìŸ ë²¤ì¹˜ë§ˆí¬ (ìµëª…í™”)                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ ë™ì¼ ì¹´í…Œê³ ë¦¬ í‰ê·  ëŒ€ë¹„                       â”‚    â”‚
â”‚     â”‚ - CTR: +15% (ìƒìœ„ 25%)                       â”‚    â”‚
â”‚     â”‚ - ì „í™˜ìœ¨: +8% (ìƒìœ„ 40%)                     â”‚    â”‚
â”‚     â”‚ - ë§¤ì¹­ ì ìˆ˜: 82 (í‰ê·  75)                    â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  ğŸ¯ 3. ì¶”ì²œ ìµœì í™” ì œì•ˆ                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ - ê°€ê²©ëŒ€ ì¡°ì • ì‹œ ì˜ˆìƒ ì „í™˜ìœ¨ ë³€í™”             â”‚    â”‚
â”‚     â”‚ - íƒ€ê²Ÿ í™•ëŒ€ ì‹œ ë„ë‹¬ vs ì •í™•ë„ íŠ¸ë ˆì´ë“œì˜¤í”„    â”‚    â”‚
â”‚     â”‚ - ì‹œì¦Œë³„ ì¶”ì²œ íƒ€ì´ë° ì œì•ˆ                    â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  ğŸ’° â†’ ì…ì ë£Œ/ìˆ˜ìˆ˜ë£Œ í˜‘ìƒë ¥ì˜ ì›ì²œ                        â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ëŒ€ì‹œë³´ë“œ API ì—”ë“œí¬ì¸íŠ¸

```typescript
// /api/brands/[brandId]/insights

interface BrandInsights {
  // ê¸°ë³¸ í†µê³„
  summary: {
    totalImpressions: number;
    totalClicks: number;
    totalConversions: number;
    ctr: number;
    conversionRate: number;
  };

  // íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤ ë¶„ì„
  audience: {
    topSkinTypes: Array<{ type: string; percentage: number }>;
    topPersonalColors: Array<{ season: string; percentage: number }>;
    ageDistribution: Record<string, number>;
    genderDistribution: Record<string, number>;
  };

  // ì œí’ˆë³„ ì„±ê³¼
  productPerformance: Array<{
    productMasterId: string;
    name: string;
    avgMatchScore: number;
    clicks: number;
    conversions: number;
  }>;

  // ë²¤ì¹˜ë§ˆí¬ (ìµëª…í™”)
  benchmark: {
    categoryAvgCtr: number;
    categoryAvgConversion: number;
    percentileRank: number;
  };

  // íŠ¸ë Œë“œ
  trends: {
    weeklyClicks: Array<{ week: string; value: number }>;
    seasonalPattern: Record<string, number>;
  };
}
```

---

## 7. ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 7.1 ë°ì´í„° í’ˆì§ˆ

| ì›ì¹™ | êµ¬í˜„ |
|------|------|
| **Single Source of Truth** | product_master í…Œì´ë¸”ì´ ì œí’ˆì˜ ìœ ì¼í•œ ì§„ì‹¤ |
| **Immutable Events** | analytics_eventsëŠ” ìˆ˜ì • ë¶ˆê°€, ì¶”ê°€ë§Œ ê°€ëŠ¥ |
| **Schema Evolution** | JSONB ì»¬ëŸ¼ìœ¼ë¡œ ìœ ì—°í•œ í™•ì¥ |
| **Data Lineage** | ëª¨ë“  íŒŒìƒ ë°ì´í„°ì— source ê¸°ë¡ |

### 7.2 í”„ë¼ì´ë²„ì‹œ

| ìš”êµ¬ì‚¬í•­ | êµ¬í˜„ |
|----------|------|
| **ìµëª…í™”** | ë¸Œëœë“œ ì¸ì‚¬ì´íŠ¸ì— ê°œì¸ ì‹ë³„ ì •ë³´ ë¯¸í¬í•¨ |
| **ì§‘ê³„ ì„ê³„ê°’** | 10ëª… ë¯¸ë§Œ ê·¸ë£¹ì€ í‘œì‹œ ì•ˆ í•¨ |
| **ì˜µíŠ¸ì•„ì›ƒ** | ì‚¬ìš©ì ì„ íƒìœ¼ë¡œ ê°œì¸í™” ë¹„í™œì„±í™” ê°€ëŠ¥ |
| **ë°ì´í„° ë³´ì¡´** | ì›ë³¸ ì´ë²¤íŠ¸ 30ì¼ â†’ ì§‘ê³„ í›„ ì‚­ì œ |

### 7.3 í™•ì¥ì„±

```
ì´ë²¤íŠ¸ ì²˜ë¦¬ëŸ‰ ê³ ë ¤:
- í˜„ì¬: ~10,000 events/day (ì˜ˆìƒ)
- ëª©í‘œ: ~1,000,000 events/day

Supabase ì œì•½:
- Row ìˆ˜: ë¬´ì œí•œ (Pro í”Œëœ)
- ìŠ¤í† ë¦¬ì§€: 8GB (Pro í”Œëœ)
- ì—°ê²°: 500 ë™ì‹œ ì—°ê²°

ìŠ¤ì¼€ì¼ë§ ì „ëµ:
1. ì´ë²¤íŠ¸ ë°°ì¹˜ ì²˜ë¦¬ (í˜„ì¬ 10ê°œ/5ì´ˆ)
2. ì§‘ê³„ í…Œì´ë¸” (hourly/daily aggregates)
3. íŒŒí‹°ì…”ë‹ (ì‹œê°„ ê¸°ë°˜)
4. í•„ìš” ì‹œ BigQuery/Snowflake ì—°ë™
```

---

## 8. êµ­ë‚´ì™¸ ì‚¬ë¡€ ë¶„ì„ (L-R2 ì—°ê²°)

### 8.1 ë¬´ì‹ ì‚¬

- **í•µì‹¬ ìì‚°**: íŒ¨ì…˜ ì·¨í–¥ ë°ì´í„°, ì²´í˜•/ìŠ¤íƒ€ì¼ ë§¤ì¹­
- **ìˆ˜ìµ ëª¨ë¸**: ìì²´ ì»¤ë¨¸ìŠ¤ + ë¸Œëœë“œ ì…ì  ìˆ˜ìˆ˜ë£Œ
- **ë°ì´í„° í™œìš©**: ê°œì¸í™” ì¶”ì²œ, íŠ¸ë Œë“œ ë¦¬í¬íŠ¸

### 8.2 ë£©í•€

- **í•µì‹¬ ìì‚°**: ì°©ìš©ìƒ· ê¸°ë°˜ ìŠ¤íƒ€ì¼ ë°ì´í„°
- **ìˆ˜ìµ ëª¨ë¸**: ì‡¼í•‘ ì—°ë™ + ìŠ¤íƒ€ì¼ ì»¨ì„¤íŒ…
- **ë°ì´í„° í™œìš©**: ë¹„ìŠ·í•œ ì²´í˜•/ìŠ¤íƒ€ì¼ ì‚¬ìš©ì ì¶”ì²œ

### 8.3 ì´ë£¸ ì°¨ë³„ì 

| ê²½ìŸì‚¬ | ë°ì´í„° | ì´ë£¸ ê°•ì  |
|--------|--------|----------|
| ë¬´ì‹ ì‚¬ | êµ¬ë§¤ ì´ë ¥ | **AI ë¶„ì„ ê²°ê³¼** (í”¼ë¶€/í¼ìŠ¤ë„ì»¬ëŸ¬/ì²´í˜•) |
| ë£©í•€ | ìŠ¤íƒ€ì¼ ì„ í˜¸ | **ê³¼í•™ì  ê·¼ê±°** (ìƒ‰ì±„í•™, í”¼ë¶€ìƒë¦¬í•™) |
| ì˜¬ë¦¬ë¸Œì˜ | ë§¤ì¥ êµ¬ë§¤ | **ë¶„ì„-êµ¬ë§¤ ì—°ê³„** ë°ì´í„° |

---

## 9. ë‹¤ìŒ ë‹¨ê³„ (L-R2)

L-R2ì—ì„œ ìƒì„¸íˆ ë‹¤ë£° ë‚´ìš©:
1. ë¬´ì‹ ì‚¬ ë°ì´í„° í”Œë«í¼ ì•„í‚¤í…ì²˜ ì‹¬ì¸µ ë¶„ì„
2. ë£©í•€ ê°œì¸í™” ì—”ì§„ ë¶„ì„
3. ì¿ íŒ¡ ì–´í•„ë¦¬ì—ì´íŠ¸ â†’ ì§ë§¤ì… ì „í™˜ ì‚¬ë¡€
4. ì´ë£¸ ì ìš© ì‹œ êµ¬ì²´ì  êµ¬í˜„ ë°©ì•ˆ

---

## 10. ì°¸ê³  ìë£Œ

### 10.1 ë‚´ë¶€ ë¬¸ì„œ

- [apps/web/lib/analytics/tracker.ts](../../../apps/web/lib/analytics/tracker.ts) - í˜„ì¬ ì´ë²¤íŠ¸ ì¶”ì 
- [apps/web/lib/products/matching.ts](../../../apps/web/lib/products/matching.ts) - ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜
- [apps/web/types/product.ts](../../../apps/web/types/product.ts) - ì œí’ˆ íƒ€ì… ì •ì˜

### 10.2 ì™¸ë¶€ ìë£Œ

- Amplitude Data Platform Architecture (2024)
- Segment CDP Best Practices (2025)
- dbt Data Modeling Guidelines

---

**ë¬¸ì„œ ìƒíƒœ**: ì™„ë£Œ
**ë‹¤ìŒ ë‹¨ê³„**: L-R2 (ë¬´ì‹ ì‚¬/ë£©í•€ ì‚¬ë¡€ ë¶„ì„)
**ê²€ì¦ì**: -
