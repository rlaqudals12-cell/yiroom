# SYSTEMS.md - 핵심 시스템 설계

> 통합: 캡슐엔진 + 인벤토리 + 아바타 + 체형교정 + 컨설팅
> 버전: 1.0 | 업데이트: 2026-01-15

---

## 🔄 캡슐 루틴 엔진

> 핵심: "최소 구성 → 최대 활용, 어떤 상황에서도 대안 제공"

### 작동 원리
```
Input: 사용자 인벤토리 + 추천 요청
  ↓
1. 보유 아이템으로 가능한 조합 탐색
2. 부족한 아이템 식별
3. 대체 옵션 생성
  ↓
Output: 1순위 추천 + 대체 옵션 N개
```

### 전 영역 적용
| 영역 | 캡슐 적용 |
|------|----------|
| 운동 | 기구 없음 → 맨몸 운동 대체 |
| 영양 | 재료 없음 → 대체 재료 추천 |
| 패션 | 아이템 없음 → 대체 조합 |
| 스킨케어 | 제품 없음 → 성분 기반 대안 |

### 운동 예시
```
보유: 덤벨(5kg), 요가매트
목표: 가슴 운동

→ 1순위: 덤벨 플라이 (덤벨 활용)
→ 2순위: 푸시업 (맨몸)
→ 3순위: 딥스 (의자 활용)
```

### 영양 예시
```
보유 재료: 닭가슴살, 양파, 마늘
목표: 고단백 저녁

→ 1순위: 닭가슴살 스테이크 (보유 재료)
→ 대체: 브로콜리 없음 → 양배추로 대체
→ 추가 구매 추천: 브로콜리, 아스파라거스
```

---

## 📦 인벤토리 시스템

### 등록 방법 (4가지)
| 방법 | 활용 | 기술 |
|------|------|------|
| 바코드 스캔 | 화장품/영양제 | 바코드 DB |
| 카메라 AI | 패션 아이템 | Vision AI |
| 성분표 OCR | 성분 분석 | Google Vision |
| 직접 입력 | 정보 알 때 | 수동 폼 |

### 카테고리
| 카테고리 | 용도 |
|----------|------|
| 내 옷장 | 가상 드레이핑, 캡슐 코디 |
| 내 화장대 | 성분 분석, 피부 매칭 |
| 내 영양제함 | 상호작용 체크, 복용 스케줄 |
| 내 운동기구 | 루틴 생성, 캡슐 운동 |
| 내 주방 | 레시피 추천, 재료 매칭 |

### 운동 인벤토리 상세

**운동 보충제:**
```
크레아틴, 프로틴(WPC/WPI/카제인), BCAA/EAA, 
글루타민, 베타알라닌, 카페인, 프리워크아웃, 
관절 건강(글루코사민)
```

**홈트레이닝 기구:**
```
덤벨(무게별), 바벨, 케틀벨, 저항 밴드, 
폼롤러, 요가매트, 풀업바
```

**헬스장 기구 (플랜핏 참고):**
```
├── 유산소: 러닝머신, 사이클, 일립티컬, 스테어마스터
├── 가슴: 벤치프레스, 체스트프레스, 펙덱, 케이블 크로스오버
├── 등: 랫풀다운, 시티드로우, 케이블로우, 티바로우
├── 어깨: 숄더프레스, 레터럴레이즈 머신, 리어델트
├── 하체: 레그프레스, 레그컬, 레그익스텐션, 힙어덕션
├── 팔: 케이블, 프리처컬 머신
└── 프리웨이트: 덤벨, 바벨, EZ바, 스미스머신
```

→ 캡슐 루틴: 보유 기구 없으면 맨몸 운동 대체, "보편적 헬스장 기구"로 기본 추천

---

## 🧍 아바타 시스템

### 입력 흐름
```
필수: 키(cm) + 체중(kg) + 전신 사진
  ↓
MediaPipe 랜드마크 추출 (468포인트)
  ↓
AI 치수 예측 (어깨/가슴/허리/힙)
  ↓
프로필 저장 → 패션/운동 추천 활용
```

### 다각도 촬영
| 모듈 | 정면 | 측면 | 후면 |
|------|------|------|------|
| 얼굴/피부 | ✅ 필수 | ⚪ 선택 | - |
| 체형 | ✅ 필수 | ⚪ 선택 | ⚪ 선택 |

---

## 🦴 체형 교정 운동

### 문제별 교정
| 체형 문제 | 교정 운동 |
|----------|----------|
| 어깨 말림 | 페이스풀, 밴드 풀어파트, 흉추 스트레칭 |
| 거북목 | 친턱, 넥 스트레칭, 흉추 가동성 |
| 굽은 등 | 흉추 익스텐션, 캣카우, 프론 Y |
| 골반 전방 경사 | 힙 플렉서 스트레칭, 글루트 활성화, 데드버그 |
| 골반 후방 경사 | 힙 힌지, 햄스트링 강화, 코어 안정화 |

### 통합 추천 예시
```
분석: "어깨가 좁고 말려 있습니다"

[운동 추천]        [패션 추천]
• 사이드 레터럴    • 어깨 패드 자켓
• 페이스풀        • 보트넥 상의
• 숄더프레스      • 스퀘어넥

→ 장점 극대화 + 단점 극복 동시
```

---

## 🎨 이미지 컨설팅 방법론

### 4가지 역할
| 역할 | Input | Output |
|------|-------|--------|
| 이미지 컨설턴트 | 라이프스타일, TPO | 퍼스널 브랜딩 |
| 비주얼 디렉터 | 선호 이미지 | 톤앤매너, 컬러 팔레트 |
| 스타일리스트 | 옷장 사진 | 캡슐 옷장, 스타일링 |
| 퍼스널컬러 | 얼굴 사진 | 베스트/워스트 컬러 |

### 디지털 드레이핑 변수
| 변수 | 설명 |
|------|------|
| ITA° | 피부 밝기 (L*a*b* 색공간) |
| Undertone | 쿨톤/웜톤 판별 |
| Contrast | 눈-머리-피부 대비 |
| Saturation | 채도 적합성 |

### 얼굴형 분류 (6가지)
| 얼굴형 | 특징 | 스타일링 방향 |
|--------|------|--------------|
| 타원형 | 황금비율 | 대부분 어울림 |
| 둥근형 | 가로/세로 비슷 | 세로 강조 |
| 사각형 | 각진 턱선 | 부드러운 곡선 |
| 긴형 | 세로가 김 | 가로 강조 |
| 하트형 | 넓은 이마, 뾰족한 턱 | 하관 볼륨 |
| 다이아몬드 | 좁은 이마/턱, 넓은 광대 | 밸런스 조정 |

**기술 구현:** MediaPipe 468포인트 + ABCL 프레임워크 (한국 이미지 컨설팅 표준)

---

## 🔗 데이터 일관성

### 재사용 정책
| 데이터 | 변경 주기 | 정책 |
|--------|----------|------|
| 키 | 거의 안 바뀜 | 항상 재사용 확인 |
| 체중 | 주기적 | 최근 데이터 확인 |
| 퍼스널컬러 | 평생 고정 | 1회 분석 후 고정 |
| 피부 분석 | 계절/컨디션 | 재분석 옵션 |

### 구현 패턴
```typescript
async function getOrRequestMeasurement(userId: string) {
  const existing = await getMeasurement(userId);
  if (existing) {
    const reuse = await confirm(`기존 정보 사용: ${existing.height}cm?`);
    if (reuse) return existing;
  }
  return await requestNewMeasurement();
}
```
