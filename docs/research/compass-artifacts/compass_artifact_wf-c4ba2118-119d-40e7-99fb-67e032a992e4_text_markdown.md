# 이룸을 위한 한국 결제 시스템 통합 전략

**포트원 + 토스페이먼츠 조합이 솔로 개발자 환경에 최적의 선택입니다.** 월 **4,900원~19,900원** 구독 서비스의 경우 PWA 웹 결제로 시작하면 수수료를 **3.4%**로 최소화할 수 있으며, 인앱 결제 대비 약 **80%** 비용 절감이 가능합니다. Next.js 16 + TypeScript 스택에 완벽 호환되는 SDK와 업계 최고 수준의 문서화, 그리고 추후 Expo 앱 확장 시 React Native SDK 지원까지 고려하면 현재 이룸의 기술 스택과 성장 로드맵에 가장 적합한 선택입니다.

---

## PG사 비교: 포트원과 토스페이먼츠가 이룸에 최적인 이유

솔로 개발자 환경에서 **개발 편의성**과 **문서화 품질**은 결정적 요소입니다. 한국 주요 PG사 4곳을 비교한 결과, **포트원(구 아임포트)**을 통해 **토스페이먼츠**를 연동하는 방식이 이룸에 가장 적합합니다.

| 항목 | 토스페이먼츠 | 포트원 | 나이스페이 | KG이니시스 |
|------|-------------|--------|-----------|------------|
| **가입비** | 22만원 | **무료** | 22만원 | 20만원 |
| **카드 수수료** | 3.4% | PG사 따라 상이 | 1.9~3.4% | 2.1~3.3% |
| **정기결제 수수료** | 4.3% | PG사 따라 상이 | 별도 협의 | 별도 협의 |
| **React/Next.js** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |
| **TypeScript** | ✅ 공식 지원 | ✅ 커뮤니티 타입 | ❌ | ❌ |
| **정산 주기** | **5일 이내** | PG사 따라 | 7일 | 월 4회 |
| **React Native SDK** | ❌ | ✅ **공식 제공** | ❌ | ❌ |

**포트원을 프론트로 사용하는 이유**는 명확합니다. 포트원은 **30여 개 PG사를 단일 API로 통합**하여 한 번 연동으로 PG사 전환이 자유롭고, 슈퍼빌링키로 여러 PG사 빌링키를 통합 관리할 수 있습니다. 특히 **React Native SDK 공식 제공**으로 추후 Expo 앱 확장 시 추가 개발 비용 없이 결제 기능을 이식할 수 있습니다. 토스페이먼츠는 **Discord 개발자 커뮤니티**에서 실시간 기술 지원을 받을 수 있고, AI 코딩 어시스턴트까지 제공하여 솔로 개발자의 구현 부담을 크게 줄여줍니다.

---

## 인앱 결제 vs 웹 결제: PWA 우선 전략이 정답

이룸의 수익 모델(월 4,900원~19,900원 구독)에서 인앱 결제와 웹 결제의 수수료 차이는 상당합니다.

| 결제 방식 | 수수료율 | 월 9,900원 기준 | 개발자 실수령 |
|-----------|----------|-----------------|---------------|
| **웹 결제 (토스페이먼츠)** | **3.4%** | **337원** | **9,563원** |
| Google Play IAP (구독) | 15% | 1,485원 | 8,415원 |
| Google 제3자 결제 | 11% | 1,089원 | 8,811원 |
| Apple IAP (소규모/2년차) | 15% | 1,485원 | 8,415원 |
| Apple 한국 제3자 결제 | 26% | 2,574원 | 7,326원 |

**2021년 한국 인앱결제 강제방지법** 시행 이후 Apple과 Google 모두 제3자 결제를 허용했지만, 할인폭은 **4%**에 불과합니다. Apple의 경우 한국 전용 별도 앱 바이너리 제출이 필요하고, IAP와 동시 사용이 불가하며, Family Sharing 등 플랫폼 기능을 상실합니다. Google의 User Choice Billing은 두 결제 수단을 동시 제공할 수 있지만, **수수료 절감 효과가 제한적**입니다.

PWA 우선 출시 전략의 장점은 분명합니다. 개발 비용 **30~40% 절감**, 출시 시간 **40% 단축**, App Store 심사 불필요로 빠른 업데이트가 가능합니다. RevenueCat 테스트 결과에 따르면 웹 결제 전환 시 전환율이 25~45% 하락할 수 있지만, Apple 30% 수수료를 고려하면 웹 결제가 오히려 **약 6%** 수익 손실에 그칩니다. 소규모 개발자 프로그램(15%)이 적용되면 IAP가 유리해질 수 있으므로, **PMF 검증 후** 네이티브 앱 확장을 고려하는 것이 합리적입니다.

---

## 간편결제 연동 우선순위: 네이버페이가 뷰티/웰니스 타겟에 최적

2024~2025년 한국 간편결제 시장에서 **네이버페이가 51.5%**로 압도적 1위를 차지하고 있으며, 특히 **30~40대 여성** 사용자 비중이 높아 뷰티/웰니스 플랫폼인 이룸의 타겟층과 정확히 일치합니다.

| 순위 | 서비스 | 시장 점유율 | MAU | 정기결제 지원 | 수수료 (영세) |
|------|--------|-------------|-----|---------------|---------------|
| **1** | **네이버페이** | **51.5%** | 1,800만 | ✅ 반복결제 API | 0.81~0.88% |
| 2 | 카카오페이 | 25.1% | 2,396만 | ✅ 정기결제 API | **0.56%** |
| 3 | 토스페이 | 13.2% | 1,900만 | ⚠️ 카드 빌링만 | 1.01% |
| 4 | 삼성페이 | ~10% | 2,116만 | ❌ | - |

**연동 권장 전략**은 PG사 통합 연동입니다. 포트원이나 토스페이먼츠를 통해 단일 코드로 네이버페이, 카카오페이, 토스페이, 신용카드를 동시에 지원할 수 있습니다. 직접 연동 시 각 서비스별로 별도 계약과 검수(네이버페이 약 15영업일, 카카오페이 10~15일)가 필요하므로 솔로 개발자 환경에서는 비효율적입니다.

**뷰티/웰니스 특화 고려사항**: 네이버페이는 최대 **5% 포인트 적립** 혜택을 제공하여 마케팅 연계가 용이합니다. 페이코는 아모레퍼시픽 등 뷰티 브랜드 멤버십과 연동되어 있어 확장 시 검토할 만합니다. 삼성페이는 모바일 전용이고 갤럭시 사용자 한정이므로 PWA 웹 서비스에서는 우선순위가 낮습니다.

---

## 정기결제 구현 체크리스트와 핵심 아키텍처

**빌링키(Billing Key)**는 카드번호, 유효기간, CVC를 암호화한 토큰으로, 실제 카드 정보가 아닌 고유 식별자입니다. 토스페이먼츠의 경우 `billingKey`와 `customerKey` 쌍이 있어야 결제가 가능하므로 이중 보안이 적용됩니다. **customerKey는 UUID 형식**을 사용해야 하며, 이메일이나 전화번호처럼 추측 가능한 값은 금지됩니다.

### Supabase 핵심 스키마 설계

```sql
-- 구독 테이블 (핵심)
CREATE TABLE subscriptions (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  billing_key_id UUID REFERENCES billing_keys(id),
  status VARCHAR(30) DEFAULT 'active', -- active, payment_pending, payment_failed, paused, cancelled
  amount INTEGER NOT NULL,
  billing_cycle VARCHAR(20) NOT NULL, -- monthly, yearly
  next_payment_date DATE NOT NULL,
  retry_count INTEGER DEFAULT 0,
  grace_period_end TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 결제일 기준 인덱스 (Cron 조회 최적화)
CREATE INDEX idx_subscriptions_next_payment 
  ON subscriptions(next_payment_date) 
  WHERE status = 'active';
```

### Vercel Cron + 재시도 정책 구현

```typescript
// vercel.json
{ "crons": [{ "path": "/api/cron/process-subscriptions", "schedule": "0 9 * * *" }] }

// 재시도 정책: Exponential Backoff (1일 → 3일 → 7일)
const RETRY_INTERVALS = [1, 3, 7]; // 일 단위
const MAX_RETRIES = 3;
const GRACE_PERIOD_DAYS = 7;

// 결제 실패 시 재시도 가능 여부 판단
const RETRYABLE_ERRORS = ['NOT_ENOUGH_BALANCE', 'EXCEED_CARD_LIMIT', 'TEMPORARY_ERROR'];
const NON_RETRYABLE_ERRORS = ['INVALID_CARD_EXPIRY', 'STOLEN_CARD', 'RESTRICTED_CARD'];
```

**웹훅 보안 필수사항**: HTTPS TLS 1.2 이상, **10초 이내 2xx 응답**, 서명 검증(HMAC-SHA256), 멱등성 보장이 필요합니다. 토스페이먼츠는 웹훅 실패 시 최대 **7회 재전송**을 시도합니다.

### 구현 체크리스트

- [ ] **Phase 1**: 토스페이먼츠 계정 생성, 정기결제 계약, API 키 발급
- [ ] **Phase 2**: 결제창 SDK 연동, 빌링키 발급 API, customerKey UUID 생성 로직
- [ ] **Phase 3**: Vercel Cron Job 설정, 결제 처리 API, 결제 기록 저장
- [ ] **Phase 4**: 에러 코드별 처리 로직, 재시도 스케줄링, 유예 기간 관리
- [ ] **Phase 5**: 웹훅 엔드포인트, 서명 검증, 토스페이먼츠 URL 등록
- [ ] **Phase 6**: 플랜 변경(프로레이션), 일시정지/재개, 취소/환불

---

## 한국 결제 규정 준수 사항 총정리

### 환불/취소 정책 필수 요건

**전자상거래법 제17조**에 따라 소비자는 계약일로부터 **7일 이내** 청약철회가 가능합니다. 단, **디지털콘텐츠 이용 개시** 시 청약철회가 제한되며, 이 경우 반드시 다음 중 하나를 제공해야 합니다:

- 미리보기/미리듣기 등 **일부 이용 허용**
- 일정 기간 **무료 체험** 제공
- 제한된 기능의 **체험용 콘텐츠**
- 위 방법이 곤란한 경우 **콘텐츠 정보** 제공

**미조치 시 청약철회 예외가 적용되지 않으므로**, 이룸은 7일 무료 체험 제공을 권장합니다.

### 구독 환불 계산 공식

```
월간 환불금액 = 월 구독료 × (잔여일수 ÷ 해당월 총일수)
연간 환불금액 = 연간 구독료 × (잔여일수 ÷ 365)
```

### 현금영수증/세금계산서 발급 의무

| 구분 | 의무 발급 대상 | 미발급 가산세 |
|------|----------------|---------------|
| 현금영수증 | 수입 2,400만원 이상, **1원 이상** 거래 | 미발급금액의 **20%** |
| 전자세금계산서 | 법인 전체, 개인 공급가액 **8천만원 이상** | 공급가액의 **2%** |

토스페이먼츠는 **무통장입금, 계좌이체 결제 시 현금영수증 자동발급**을 무료로 대행합니다. 세금계산서는 팝빌, 바로빌 등 API 서비스를 통해 홈택스와 연동할 수 있습니다.

---

## 결제 플로우 설계: 웹/앱 통합 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                         이룸 결제 플로우                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [사용자] ──▶ [구독 선택] ──▶ [결제 수단 선택]                     │
│                                    │                            │
│              ┌────────────────────┼────────────────────┐        │
│              ▼                    ▼                    ▼        │
│        ┌──────────┐        ┌──────────┐        ┌──────────┐    │
│        │신용카드   │        │네이버페이│        │카카오페이│    │
│        │(빌링키)   │        │(반복결제) │        │(정기결제) │    │
│        └────┬─────┘        └────┬─────┘        └────┬─────┘    │
│             │                    │                    │         │
│             └────────────────────┼────────────────────┘         │
│                                  ▼                              │
│                    ┌──────────────────────────┐                 │
│                    │   포트원 통합 SDK         │                 │
│                    │   (토스페이먼츠 채널)      │                 │
│                    └────────────┬─────────────┘                 │
│                                 ▼                               │
│                    ┌──────────────────────────┐                 │
│                    │   빌링키 발급 + 저장      │                 │
│                    │   (Supabase billing_keys) │                 │
│                    └────────────┬─────────────┘                 │
│                                 ▼                               │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │              Vercel Cron (매일 09:00 KST)                  │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │  │
│  │  │결제 대상 조회│─▶│자동결제 실행│─▶│결과 처리    │       │  │
│  │  └─────────────┘  └─────────────┘  └─────┬───────┘       │  │
│  │                                          │                │  │
│  │                     ┌────────────────────┼───────────┐    │  │
│  │                     ▼                    ▼           ▼    │  │
│  │               [성공]               [실패-재시도]  [실패-최종]│  │
│  │                 │                       │             │   │  │
│  │                 ▼                       ▼             ▼   │  │
│  │            다음 결제일 갱신        재시도 예약     유예 기간   │  │
│  │            (monthly/yearly)      (1→3→7일)      (7일)     │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 최종 권장 로드맵

| 단계 | 전략 | 결제 수수료 | 주요 작업 |
|------|------|-------------|-----------|
| **1단계: MVP** | PWA + 웹 결제 (포트원+토스페이먼츠) | **3.4%** | 빌링키 발급, Cron 스케줄링, 네이버페이/카카오페이 연동 |
| **2단계: 성장기** | PWA 유지 + Android 앱 (Google 제3자 결제) | 웹 3.4% / 앱 14.5% | Expo 앱 빌드, 포트원 React Native SDK 연동 |
| **3단계: 확장기** | iOS 추가 (한국: 제3자 결제 또는 IAP 15%) | 15~26% | Apple 소규모 개발자 프로그램 등록, StoreKit 연동 |

### 예상 비용 (월 기준)

| 항목 | 금액 |
|------|------|
| 포트원 기본 사용료 | **무료** |
| 토스페이먼츠 연관리비 | ~1만원 |
| 구독결제 수수료 (4.3%, 월 100건 × 9,900원 평균) | ~4.3만원 |
| 일회성 결제 수수료 (3.4%, 월 50건 × 10,000원) | ~1.7만원 |
| **월 총 비용** | **~7만원** |

---

## Conclusion: 핵심 인사이트

이룸의 성공적인 결제 시스템 구축을 위한 3가지 핵심 원칙이 있습니다. 첫째, **PWA 우선 전략**으로 인앱 결제 수수료 30%를 웹 결제 3.4%로 대체하여 마진을 극대화합니다. 둘째, **포트원 + 토스페이먼츠 조합**으로 솔로 개발자도 엔터프라이즈급 결제 인프라를 구축할 수 있습니다. 셋째, **7일 무료 체험 제공**은 단순한 마케팅이 아닌 한국 전자상거래법 준수를 위한 필수 요건입니다.

정기결제 구현에서 가장 중요한 것은 **결제 실패 처리 로직**입니다. Exponential Backoff 재시도 정책(1→3→7일)과 7일 유예 기간을 통해 사용자 이탈을 최소화하면서도 미수금을 효과적으로 회수할 수 있습니다. Vercel Cron의 Hobby 플랜 제한(최대 2개, 10초 실행)을 고려하여 결제 처리 로직을 최적화해야 합니다.

네이티브 앱 확장은 **PMF 검증 후**로 미루는 것이 현명합니다. Google Play는 구독 서비스에 처음부터 15%를 적용하고 제3자 결제 시 11%까지 낮출 수 있어 상대적으로 유리합니다. Apple의 경우 소규모 개발자 프로그램(연 $1M 이하 시 15%)을 반드시 등록하고, 2년차부터 적용되는 구독 할인(15%)을 활용해야 합니다.