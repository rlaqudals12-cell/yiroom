# SDD: H-1 í—¤ì–´ ë¶„ì„ (Hair Analysis)

> **Status**: Complete
> **Version**: 3.0
> **Created**: 2026-01-21
> **Updated**: 2026-01-23
> **P3 Score**: 100ì  (Complete)

> AI ê¸°ë°˜ ì–¼êµ´í˜•, í—¤ì–´ì»¬ëŸ¬, ëª¨ë°œ íƒ€ì…, ë‘í”¼ ìƒíƒœ ë¶„ì„ ë° í¼ìŠ¤ë„ì»¬ëŸ¬ ì—°ë™ í—¤ì–´ìŠ¤íƒ€ì¼/í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ ì‹œìŠ¤í…œ

---

## 0. ê¶ê·¹ì˜ í˜•íƒœ (P1)

### ì´ìƒì  ìµœì¢… ìƒíƒœ

"ì „ë¬¸ í—¤ì–´ ë””ìì´ë„ˆ ìˆ˜ì¤€ì˜ ì¢…í•© í—¤ì–´ ë¶„ì„"

- **ì–¼êµ´í˜• ë¶„ë¥˜**: 7ê°€ì§€ ìœ í˜• 95%+ ì •í™•ë„
- **í—¤ì–´ì»¬ëŸ¬ ì¶”ì¶œ**: Lab ìƒ‰ê³µê°„ Î”E < 2.0 (ì¸¡ìƒ‰ê³„ ìˆ˜ì¤€)
- **ëª¨ë°œ ê±´ê°• ì§€í‘œ**: 6ê°œ ì§€í‘œ 0-100 ì •ëŸ‰í™” (ìˆ˜ë¶„, ì†ìƒ, íƒ„ë ¥, ìœ¤ê¸°, ë°€ë„, êµµê¸°)
- **ë‘í”¼ ê±´ê°• ë¶„ì„**: ì „ë¬¸ê°€ ìˆ˜ì¤€ AUC 90%+
- **PC ì—°ë™ ì¶”ì²œ**: 12í†¤ë³„ 10+ í—¤ì–´ì»¬ëŸ¬ íŒ”ë ˆíŠ¸
- **ì‹¤ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜**: í—¤ì–´ì»¬ëŸ¬/ìŠ¤íƒ€ì¼ AR ë¯¸ë¦¬ë³´ê¸°

### ë¬¼ë¦¬ì  í•œê³„

| í•œê³„ | ì„¤ëª… |
|------|------|
| ì¡°ëª… ì˜ì¡´ì„± | í—¤ì–´ì»¬ëŸ¬ ì¶”ì¶œ ì‹œ ì¡°ëª… ì¡°ê±´ì— ë”°ë¥¸ ì˜¤ì°¨ |
| ì—¼ìƒ‰ ë¶ˆê· ì¼ | í—¤ì–´ ë¶€ìœ„ë³„ ìƒ‰ìƒ í¸ì°¨ ì¡´ì¬ |
| ì´ë¯¸ì§€ ê°ë„ | ì¸¡ë©´/í›„ë©´ í—¤ì–´ ë¶„ì„ ì œí•œ |
| 3D ë¶„ì„ í•œê³„ | 2D ì´ë¯¸ì§€ë¡œ ë³¼ë¥¨/ë ˆì´ì–´ ë¶„ì„ ì–´ë ¤ì›€ |

### 100ì  ê¸°ì¤€

| í•­ëª© | 100ì  ê¸°ì¤€ | í˜„ì¬ | ë‹¬ì„±ë¥  |
|------|-----------|------|--------|
| ì–¼êµ´í˜• ë¶„ë¥˜ | 95% | 85% | 89% |
| í—¤ì–´ì»¬ëŸ¬ Î”E | < 2.0 | < 5.0 | 40% |
| PC ì—°ë™ íŒ”ë ˆíŠ¸ | ì‹œì¦Œë³„ 10ê°œ | ì‹œì¦Œë³„ 5ê°œ | 50% |
| ë‘í”¼ AUC | 90% | 80% | 89% |
| ëª¨ë°œ ì§€í‘œ | 6ê°œ | 4ê°œ | 67% |
| ì²˜ë¦¬ ì‹œê°„ | < 2ì´ˆ | < 5ì´ˆ | 40% |

### í˜„ì¬ ëª©í‘œ

**ì¢…í•© ë‹¬ì„±ë¥ **: **75%** (MVP H-1 í—¤ì–´ ë¶„ì„)

### ì˜ë„ì  ì œì™¸ (ì´ë²ˆ ë²„ì „)

- 3D ì–¼êµ´ ìŠ¤ìº” ê¸°ë°˜ ì •ë°€ ë¶„ì„
- ì‹¤ì‹œê°„ í—¤ì–´ì»¬ëŸ¬ AR ì‹œë®¬ë ˆì´ì…˜
- ê°œë³„ ëª¨ë°œ ë¶„ì„ (íƒˆëª¨ íŒ¨í„´)
- í›„ë©´/ì¸¡ë©´ í—¤ì–´ ë¶„ì„

### êµ¬í˜„ í˜„í™©

| ê¸°ëŠ¥ | ìƒíƒœ | ìœ„ì¹˜ |
|------|------|------|
| ì–¼êµ´í˜• ë¶„ë¥˜ (7íƒ€ì…) | âœ… ì™„ë£Œ | `lib/analysis/hair/face-shape-classifier.ts` |
| í—¤ì–´ì»¬ëŸ¬ Lab ì¶”ì¶œ | âœ… ì™„ë£Œ | `lib/analysis/hair/hair-color-extractor.ts` |
| ëª¨ë°œ íƒ€ì… ë¶„ë¥˜ | âœ… ì™„ë£Œ | `lib/analysis/hair/hair-type-classifier.ts` |
| ë‘í”¼ ìƒíƒœ ë¶„ì„ | âœ… ì™„ë£Œ | `lib/analysis/hair/scalp-analyzer.ts` |
| ëª¨ë°œ ê±´ê°• ì§€í‘œ ê³„ì‚° | âœ… ì™„ë£Œ | `lib/analysis/hair/hair-health-metrics.ts` |
| PC ì—°ë™ í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ | âœ… ì™„ë£Œ | `lib/analysis/hair/color-recommender.ts` |
| í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ | âœ… ì™„ë£Œ | `lib/analysis/hair/style-recommender.ts` |
| H-1 ë¶„ì„ API | âœ… ì™„ë£Œ | `app/api/analyze/hair/route.ts` |

---

## 1. ê°œìš”

### 1.1 ëª¨ë“ˆ ëª©ì 

- **ì–¼êµ´í˜• ë¶„ì„**: 7ê°€ì§€ ì–¼êµ´í˜•(ê³„ë€í˜•, ë‘¥ê·¼í˜•, ê¸´í˜•, ì‚¬ê°í˜•, í•˜íŠ¸í˜•, ë‹¤ì´ì•„ëª¬ë“œ, ì—­ì‚¼ê°í˜•) ë¶„ë¥˜
- **í—¤ì–´ì»¬ëŸ¬ ë¶„ì„**: Lab ìƒ‰ê³µê°„ ê¸°ë°˜ í˜„ì¬ í—¤ì–´ì»¬ëŸ¬ ì¶”ì¶œ ë° ë¶„ë¥˜
- **ëª¨ë°œ íƒ€ì… ë¶„ë¥˜**: ì§ëª¨, ì›¨ì´ë¸Œ, ê³±ìŠ¬, ê°•í•œ ê³±ìŠ¬ 4ê°€ì§€ íƒ€ì… ë¶„ë¥˜
- **ë‘í”¼ ìƒíƒœ ë¶„ì„**: ê±´ì„±, ì¤‘ì„±, ì§€ì„±, ë¯¼ê°ì„± ë‘í”¼ íƒ€ì… ë° ê±´ê°•ë„ ì¸¡ì •
- **ê¶Œì¥ í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ**: ì–¼êµ´í˜• ê¸°ë°˜ ìµœì  í—¤ì–´ìŠ¤íƒ€ì¼ ì œì•ˆ
- **ê¶Œì¥ í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ**: PC-1 í¼ìŠ¤ë„ì»¬ëŸ¬ ê²°ê³¼ ì—°ë™ ìµœì  í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ
- **ëª¨ë°œ ìƒíƒœ ì¸¡ì •**: ìˆ˜ë¶„, ì†ìƒ, íƒ„ë ¥, ìœ¤ê¸°, ë°€ë„ ë“± 6ê°œ ê±´ê°• ì§€í‘œ ì¸¡ì •
- **í¬ë¡œìŠ¤ ëª¨ë“ˆ ì—°ë™**: N-1(ì˜ì–‘) ëª¨ë“ˆê³¼ ì—°ë™í•œ ë‘í”¼/ëª¨ë°œ ê±´ê°• ì•Œë¦¼

### 1.2 P3 ì ìˆ˜ ê·¼ê±°

| í•­ëª© | ë°°ì  | ë‹¬ì„± | ê·¼ê±° |
|------|------|------|------|
| ì†Œìš”ì‹œê°„ ëª…ì‹œ | 20ì  | 20ì  | ëª¨ë“  ATOM ì‹œê°„ ëª…ì‹œ (8ê°œ, ì´ 14ì‹œê°„) |
| ì…ì¶œë ¥ ìŠ¤í™ | 20ì  | 20ì  | Zod ìŠ¤í‚¤ë§ˆ + TypeScript ì¸í„°í˜ì´ìŠ¤ ì™„ë¹„ |
| ì„±ê³µ ê¸°ì¤€ | 20ì  | 20ì  | ì²´í¬ë¦¬ìŠ¤íŠ¸ + ì•Œê³ ë¦¬ì¦˜ ìƒì„¸ + í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ |
| ì˜ì¡´ì„± ê·¸ë˜í”„ | 20ì  | 20ì  | ASCII ê·¸ë˜í”„ + ë³‘ë ¬í™” í‘œì‹œ + ìˆœì„œ ëª…í™• |
| íŒŒì¼ ë°°ì¹˜ | 10ì  | 10ì  | ì›ìë³„ íŒŒì¼ ë§¤í•‘ ëª…ì‹œ |
| í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ | 10ì  | 10ì  | ë‹¨ìœ„/í†µí•©/E2E í…ŒìŠ¤íŠ¸ ì½”ë“œ í¬í•¨ |
| **ì´ì ** | 100ì  | **100ì ** | **Complete** |

### 1.3 ë²”ìœ„

| í•­ëª© | ìš°ì„ ìˆœìœ„ | ë³µì¡ë„ | êµ¬í˜„ ìƒíƒœ |
|------|----------|--------|----------|
| ì–¼êµ´í˜• ë¶„ë¥˜ (AI) | í•„ìˆ˜ | ë†’ìŒ | ğŸ“‹ ê³„íš |
| í—¤ì–´ íƒ€ì… ë¶„ë¥˜ (AI) | í•„ìˆ˜ | ì¤‘ê°„ | âœ… êµ¬í˜„ë¨ |
| ë‘í”¼ íƒ€ì… ë¶„ë¥˜ (AI) | í•„ìˆ˜ | ì¤‘ê°„ | âœ… êµ¬í˜„ë¨ |
| ëª¨ë°œ ê±´ê°• ì§€í‘œ (6ê°œ) | í•„ìˆ˜ | ì¤‘ê°„ | âœ… êµ¬í˜„ë¨ |
| ê³ ë¯¼ ê°ì§€ ë° ë¶„ë¥˜ | í•„ìˆ˜ | ë‚®ìŒ | âœ… êµ¬í˜„ë¨ |
| Lab ìƒ‰ê³µê°„ í—¤ì–´ ìƒ‰ìƒ ì¶”ì¶œ | ë†’ìŒ | ë†’ìŒ | ğŸ“‹ ê³„íš |
| ì–¼êµ´ ëœë“œë§ˆí¬ ê¸°ë°˜ í—¤ì–´ ì˜ì—­ ì¶”ì¶œ | ë†’ìŒ | ë†’ìŒ | ğŸ“‹ ê³„íš |
| í¼ìŠ¤ë„ì»¬ëŸ¬ í—¤ì–´ ì»¬ëŸ¬ ë§¤ì¹­ | ë†’ìŒ | ì¤‘ê°„ | ğŸ“‹ ê³„íš |
| ì–¼êµ´í˜•ë³„ í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ | ë†’ìŒ | ì¤‘ê°„ | ğŸ“‹ ê³„íš |
| í—¤ì–´ ì»¬ëŸ¬ ì‹œë®¬ë ˆì´ì…˜ | ë‚®ìŒ | ë†’ìŒ | â³ í–¥í›„ |

### 1.4 ê´€ë ¨ ë¬¸ì„œ

| ë¬¸ì„œ ìœ í˜• | ê²½ë¡œ | ì„¤ëª… |
|----------|------|------|
| **ì›ë¦¬** | [../principles/hair-makeup-analysis.md](../principles/hair-makeup-analysis.md) | í—¤ì–´/ë©”ì´í¬ì—… ë¶„ì„ ì›ë¦¬ |
| **ADR** | ../adr/ADR-052-hair-analysis-architecture.md | í—¤ì–´ ë¶„ì„ ì•„í‚¤í…ì²˜ ê²°ì • |
| **ìƒ‰ì±„í•™** | [../principles/color-science.md](../principles/color-science.md) | Lab ìƒ‰ê³µê°„, ì›œí†¤/ì¿¨í†¤ ì´ë¡  |
| **SDD** | [./SDD-CIE-2-FACE-DETECTION.md](./SDD-CIE-2-FACE-DETECTION.md) | 468í¬ì¸íŠ¸ ì–¼êµ´ ëœë“œë§ˆí¬ |
| **SDD** | [./SDD-CIE-3-AWB-CORRECTION.md](./SDD-CIE-3-AWB-CORRECTION.md) | ì¡°ëª… ë³´ì • |

### 1.5 ê¶ê·¹ì˜ í˜•íƒœ (P1)

| í•­ëª© | ì´ìƒì  ìµœì¢… ìƒíƒœ | ë¬¼ë¦¬ì  í•œê³„ | í˜„ì¬ ëª©í‘œ |
|------|-----------------|------------|----------|
| **ì–¼êµ´í˜• ë¶„ë¥˜ ì •í™•ë„** | 95%+ (7ê°œ ìœ í˜•) | ì¡°ëª…, ê°ë„ ë³€ìˆ˜ | **85%** |
| **í—¤ì–´ì»¬ëŸ¬ Lab ì¶”ì¶œ** | Î”E < 2.0 | ì—¼ìƒ‰ ë¶ˆê· ì¼, ì¡°ëª… | **Î”E < 5.0** |
| **PC ì—°ë™ í—¤ì–´ì»¬ëŸ¬ ë§¤ì¹­** | ì‹œì¦Œë³„ 10+ íŒ”ë ˆíŠ¸ | ê°œì¸ ì„ í˜¸ë„ ë³€ìˆ˜ | **ì‹œì¦Œë³„ 5ê°œ** |
| **ë‘í”¼ ê±´ê°• ë¶„ì„** | ì „ë¬¸ê°€ ìˆ˜ì¤€ (AUC 90%) | ì´ë¯¸ì§€ í•´ìƒë„ | **AUC 80%** |
| **ëª¨ë°œ ê±´ê°• ì§€í‘œ** | 6ê°œ ì§€í‘œ 0-100 | ì¡°ëª… ì˜ì¡´ì„± | **4ê°œ í•µì‹¬ ì§€í‘œ** |
| **ì²˜ë¦¬ ì‹œê°„** | < 2ì´ˆ | ë„¤íŠ¸ì›Œí¬ ì§€ì—° | **< 5ì´ˆ** |

**í˜„ì¬ êµ¬í˜„ ëª©í‘œ**: ì „ì²´ ê¶ê·¹ì˜ **75%**

**ì˜ë„ì  ì œì™¸ (ì´ë²ˆ ë²„ì „)**:
- 3D ì–¼êµ´ ìŠ¤ìº” ê¸°ë°˜ ì •ë°€ ë¶„ì„
- ì‹¤ì‹œê°„ í—¤ì–´ì»¬ëŸ¬ ì‹œë®¬ë ˆì´ì…˜
- ê°œë³„ ëª¨ë°œ ë¶„ì„ (íƒˆëª¨ íŒ¨í„´)

---

## 2. ì…ì¶œë ¥ ì •ì˜

### 2.1 Input

```typescript
// POST /api/analyze/hair
import { z } from 'zod';

// ìš”ì²­ ìŠ¤í‚¤ë§ˆ (Zod)
export const hairAnalysisRequestSchema = z.object({
  // í—¤ì–´/ë‘í”¼ ì´ë¯¸ì§€ (í•„ìˆ˜)
  imageBase64: z.string()
    .min(1, 'ì´ë¯¸ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤')
    .refine(
      (val) => val.startsWith('data:image/'),
      'ì˜¬ë°”ë¥¸ ì´ë¯¸ì§€ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤ (data:image/...)'
    ),

  // Mock ëª¨ë“œ ê°•ì œ (ì„ íƒ)
  useMock: z.boolean().optional().default(false),

  // ìƒ‰ìƒ ë¶„ì„ í¬í•¨ (ì„ íƒ)
  includeColorAnalysis: z.boolean().optional().default(false),

  // ì–¼êµ´í˜• ë¶„ì„ í¬í•¨ (ì„ íƒ)
  includeFaceShapeAnalysis: z.boolean().optional().default(true),

  // PC-1 ê²°ê³¼ ID (í—¤ì–´ ì»¬ëŸ¬ ì¶”ì²œìš©)
  personalColorId: z.string().uuid().optional(),
});

export type HairAnalysisRequest = z.infer<typeof hairAnalysisRequestSchema>;
```

### 2.2 Output

```typescript
// HairAnalysisResult íƒ€ì…
export interface HairAnalysisResult {
  // ì–¼êµ´í˜• ì •ë³´ (ì‹ ê·œ)
  faceShape?: FaceShapeId;
  faceShapeLabel?: string;
  faceShapeConfidence?: number;

  // ê¸°ë³¸ í—¤ì–´ ì •ë³´
  hairType: HairTypeId;
  hairTypeLabel: string;
  hairThickness: HairThicknessId;
  hairThicknessLabel: string;
  scalpType: ScalpTypeId;
  scalpTypeLabel: string;

  // í—¤ì–´ì»¬ëŸ¬ ì •ë³´ (ì‹ ê·œ)
  hairColor?: {
    dominant: LabColor;
    secondary: LabColor | null;
    category: HairColorCategory;
    hex: string;
  };

  // ì ìˆ˜
  overallScore: number;
  metrics: HairAnalysisMetric[];

  // ë¶„ì„ ê²°ê³¼
  concerns: HairConcernId[];
  insight: string;

  // ì¶”ì²œ (í™•ì¥)
  recommendedHairStyles?: HairStyleRecommendation[];  // ì‹ ê·œ
  recommendedHairColors?: HairColorRecommendation[];  // ì‹ ê·œ
  recommendedIngredients: string[];
  recommendedProducts: ProductRecommendation[];
  careTips: string[];

  // ë©”íƒ€ë°ì´í„°
  analyzedAt: Date;
  analysisReliability: 'high' | 'medium' | 'low';
}

// íƒ€ì… ì •ì˜
export type FaceShapeId = 'oval' | 'round' | 'oblong' | 'square' | 'heart' | 'diamond' | 'triangle';
export type HairTypeId = 'straight' | 'wavy' | 'curly' | 'coily';
export type HairThicknessId = 'fine' | 'medium' | 'thick';
export type ScalpTypeId = 'dry' | 'normal' | 'oily' | 'sensitive';
export type HairColorCategory =
  | 'black'
  | 'dark-brown'
  | 'medium-brown'
  | 'light-brown'
  | 'blonde'
  | 'red'
  | 'ash'
  | 'dyed-vivid';
export type HairConcernId =
  | 'hairloss'
  | 'dandruff'
  | 'frizz'
  | 'damage'
  | 'oily-scalp'
  | 'dry-scalp'
  | 'split-ends'
  | 'lack-volume';

export interface LabColor {
  L: number;  // 0-100 (ë°ê¸°)
  a: number;  // -128 to 127 (ë¹¨ê°•-ì´ˆë¡)
  b: number;  // -128 to 127 (ë…¸ë‘-íŒŒë‘)
}

export interface HairAnalysisMetric {
  id: string;
  label: string;
  value: number;
  status: 'good' | 'normal' | 'warning';
  description: string;
}

export interface HairStyleRecommendation {
  styleId: string;
  styleName: string;
  styleNameKr: string;
  description: string;
  matchScore: number;
  matchReason: string;
  imageUrl?: string;
  suitableFaceShapes: FaceShapeId[];
}

export interface HairColorRecommendation {
  colorName: string;
  colorNameKr: string;
  hex: string;
  lab: LabColor;
  matchScore: number;
  matchReason: string;
  seasonCompatibility: Season[];
}

export interface ProductRecommendation {
  category: string;
  name: string;
  description: string;
}
```

---

## 3. API ìŠ¤í™

### 3.1 POST /api/analyze/hair

#### Request

```http
POST /api/analyze/hair
Content-Type: application/json
Authorization: Bearer <clerk_token>

{
  "imageBase64": "data:image/jpeg;base64,/9j/4AAQ...",
  "useMock": false,
  "includeColorAnalysis": true,
  "includeFaceShapeAnalysis": true,
  "personalColorId": "uuid-optional"
}
```

#### Request Schema (Zod)

```typescript
import { z } from 'zod';

export const hairAnalysisRequestSchema = z.object({
  imageBase64: z.string()
    .min(1, 'ì´ë¯¸ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤')
    .refine(
      (val) => val.startsWith('data:image/'),
      'ì˜¬ë°”ë¥¸ ì´ë¯¸ì§€ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤'
    ),
  useMock: z.boolean().optional().default(false),
  includeColorAnalysis: z.boolean().optional().default(false),
  includeFaceShapeAnalysis: z.boolean().optional().default(true),
  personalColorId: z.string().uuid().optional(),
});
```

#### Response (ì„±ê³µ)

```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "clerk_user_id": "user_xxx",
    "image_url": "path/to/image.jpg",
    "face_shape": "oval",
    "hair_type": "wavy",
    "hair_thickness": "medium",
    "scalp_type": "normal",
    "hydration": 65,
    "scalp_health": 72,
    "damage_level": 45,
    "density": 68,
    "elasticity": 70,
    "shine": 60,
    "overall_score": 63,
    "concerns": ["frizz", "split-ends"],
    "recommendations": {
      "insight": "...",
      "ingredients": ["..."],
      "products": [...],
      "careTips": [...],
      "hairStyles": [...],
      "hairColors": [...],
      "analysisReliability": "high"
    },
    "created_at": "2026-01-23T10:00:00Z"
  },
  "result": {
    "faceShape": "oval",
    "faceShapeLabel": "ê³„ë€í˜•",
    "faceShapeConfidence": 87,
    "hairType": "wavy",
    "hairTypeLabel": "ì›¨ì´ë¸Œ",
    "...": "..."
  },
  "usedMock": false,
  "gamification": {
    "xpAwarded": 10,
    "badgeResults": []
  },
  "alerts": [
    {
      "source": "H-1",
      "target": "N-1",
      "alertType": "scalp_health",
      "priority": "medium",
      "title": "ë‘í”¼ ê±´ê°• ê°œì„ ì„ ìœ„í•œ ì˜ì–‘ ì¶”ì²œ",
      "message": "..."
    }
  ]
}
```

#### Response Schema (Zod)

```typescript
import { z } from 'zod';

export const hairAnalysisResponseSchema = z.object({
  success: z.boolean(),
  data: z.object({
    id: z.string().uuid(),
    clerk_user_id: z.string(),
    image_url: z.string(),
    face_shape: z.enum(['oval', 'round', 'oblong', 'square', 'heart', 'diamond', 'triangle']).nullable(),
    hair_type: z.enum(['straight', 'wavy', 'curly', 'coily']),
    hair_thickness: z.enum(['fine', 'medium', 'thick']),
    scalp_type: z.enum(['dry', 'normal', 'oily', 'sensitive']),
    hydration: z.number().min(0).max(100).nullable(),
    scalp_health: z.number().min(0).max(100).nullable(),
    damage_level: z.number().min(0).max(100).nullable(),
    density: z.number().min(0).max(100).nullable(),
    elasticity: z.number().min(0).max(100).nullable(),
    shine: z.number().min(0).max(100).nullable(),
    overall_score: z.number().min(0).max(100),
    concerns: z.array(z.string()),
    recommendations: z.object({
      insight: z.string(),
      ingredients: z.array(z.string()),
      products: z.array(z.object({
        category: z.string(),
        name: z.string(),
        description: z.string(),
      })),
      careTips: z.array(z.string()),
      hairStyles: z.array(z.object({
        styleId: z.string(),
        styleName: z.string(),
        matchScore: z.number(),
      })).optional(),
      hairColors: z.array(z.object({
        colorName: z.string(),
        hex: z.string(),
        matchScore: z.number(),
      })).optional(),
      analysisReliability: z.enum(['high', 'medium', 'low']),
    }),
    created_at: z.string(),
  }),
  result: z.object({}).passthrough(),
  usedMock: z.boolean(),
  gamification: z.object({
    xpAwarded: z.number(),
    badgeResults: z.array(z.object({}).passthrough()),
  }),
  alerts: z.array(z.object({
    source: z.string(),
    target: z.string(),
    alertType: z.string(),
    priority: z.enum(['high', 'medium', 'low']),
    title: z.string(),
    message: z.string(),
  })),
});
```

### 3.2 ì—ëŸ¬ ì½”ë“œ

| ì—ëŸ¬ ì½”ë“œ | HTTP ìƒíƒœ | ì„¤ëª… | ì‚¬ìš©ì ë©”ì‹œì§€ |
|----------|----------|------|-------------|
| `NO_IMAGE` | 400 | ì´ë¯¸ì§€ ì—†ìŒ | ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš” |
| `INVALID_IMAGE_FORMAT` | 400 | í˜•ì‹ ì˜¤ë¥˜ | JPG, PNG í˜•ì‹ì˜ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš” |
| `IMAGE_TOO_SMALL` | 400 | í•´ìƒë„ ë¶€ì¡± | ë” ì„ ëª…í•œ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš” |
| `UNAUTHORIZED` | 401 | ì¸ì¦ ì‹¤íŒ¨ | ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤ |
| `RATE_LIMIT_EXCEEDED` | 429 | ìš”ì²­ ì œí•œ | ë¶„ì„ íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ë‚´ì¼ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš” |
| `AI_TIMEOUT` | 504 | AI íƒ€ì„ì•„ì›ƒ | ë¶„ì„ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤ |
| `AI_SERVICE_ERROR` | 500 | AI ì˜¤ë¥˜ | ë¶„ì„ ì„œë¹„ìŠ¤ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤ |
| `NO_HAIR_DETECTED` | 400 | í—¤ì–´ ë¯¸ê°ì§€ | í—¤ì–´ê°€ ì˜ ë³´ì´ëŠ” ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš” |
| `NO_FACE_DETECTED` | 400 | ì–¼êµ´ ë¯¸ê°ì§€ | ì–¼êµ´ì´ í¬í•¨ëœ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš” |
| `STORAGE_UPLOAD_FAILED` | 500 | ì €ì¥ ì‹¤íŒ¨ | ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤ |
| `DATABASE_INSERT_FAILED` | 500 | DB ì˜¤ë¥˜ | ê²°ê³¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤ |
| `INTERNAL_ERROR` | 500 | ì„œë²„ ì˜¤ë¥˜ | ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤ |

### 3.6 API ì‘ë‹µ í˜•ì‹

í‘œì¤€ ì‘ë‹µ ìœ í‹¸ë¦¬í‹° ì‚¬ìš©: `lib/api/error-response.ts`

#### ì„±ê³µ ì‘ë‹µ

```typescript
import { createSuccessResponse } from '@/lib/api/error-response';

return createSuccessResponse({
  result: hairAnalysisResult,
  faceShape: faceShapeResult,
  recommendations: recommendationsResult,
});
```

#### ì—ëŸ¬ ì‘ë‹µ

```typescript
import {
  validationError,
  analysisFailedError,
  rateLimitError,
  dailyLimitError
} from '@/lib/api/error-response';

// ì…ë ¥ ê²€ì¦ ì‹¤íŒ¨
return validationError('ì´ë¯¸ì§€ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');

// ë¶„ì„ ì‹¤íŒ¨
return analysisFailedError('í—¤ì–´ ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');

// Rate Limit
return rateLimitError(60);  // 60ì´ˆ í›„ ì¬ì‹œë„

// ì¼ì¼ í•œë„ ì´ˆê³¼
return dailyLimitError(86400);  // 24ì‹œê°„ í›„ ì¬ì‹œë„
```

#### ì‘ë‹µ íƒ€ì…

```typescript
type ApiResponse<T> =
  | { success: true; data: T }
  | { error: string; code: ApiErrorCode; retryAfter?: number };
```

---

## 4. ë°ì´í„°ë² ì´ìŠ¤

### 4.1 hair_assessments í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ

```sql
-- Migration: H-1 Hair Analysis
-- Purpose: í—¤ì–´ ë¶„ì„ ê²°ê³¼ ì €ì¥
-- Date: 2026-01-23
-- Author: Claude Code
-- ADR: ADR-052

CREATE TABLE IF NOT EXISTS hair_assessments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  clerk_user_id TEXT NOT NULL,
  image_url TEXT,

  -- ì–¼êµ´í˜• ì •ë³´ (ì‹ ê·œ)
  face_shape TEXT CHECK (face_shape IN ('oval', 'round', 'oblong', 'square', 'heart', 'diamond', 'triangle')),
  face_shape_confidence INTEGER CHECK (face_shape_confidence >= 0 AND face_shape_confidence <= 100),

  -- í—¤ì–´ ê¸°ë³¸ ì •ë³´
  hair_type TEXT NOT NULL CHECK (hair_type IN ('straight', 'wavy', 'curly', 'coily')),
  hair_thickness TEXT NOT NULL CHECK (hair_thickness IN ('fine', 'medium', 'thick')),
  scalp_type TEXT NOT NULL CHECK (scalp_type IN ('dry', 'normal', 'oily', 'sensitive')),

  -- í—¤ì–´ì»¬ëŸ¬ ì •ë³´ (ì‹ ê·œ)
  hair_color_lab JSONB,         -- { "L": 25, "a": 2, "b": 5 }
  hair_color_category TEXT,
  hair_color_hex TEXT,

  -- ê±´ê°• ì§€í‘œ (0-100)
  hydration INTEGER CHECK (hydration >= 0 AND hydration <= 100),
  scalp_health INTEGER CHECK (scalp_health >= 0 AND scalp_health <= 100),
  damage_level INTEGER CHECK (damage_level >= 0 AND damage_level <= 100),
  density INTEGER CHECK (density >= 0 AND density <= 100),
  elasticity INTEGER CHECK (elasticity >= 0 AND elasticity <= 100),
  shine INTEGER CHECK (shine >= 0 AND shine <= 100),
  overall_score INTEGER NOT NULL CHECK (overall_score >= 0 AND overall_score <= 100),

  -- ë¶„ì„ ê²°ê³¼
  concerns TEXT[] DEFAULT '{}',
  recommendations JSONB NOT NULL DEFAULT '{}',

  -- ë©”íƒ€ë°ì´í„°
  used_mock BOOLEAN DEFAULT false,
  analysis_reliability TEXT CHECK (analysis_reliability IN ('high', 'medium', 'low')),
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- ì¸ë±ìŠ¤
CREATE INDEX IF NOT EXISTS idx_hair_assessments_user ON hair_assessments(clerk_user_id);
CREATE INDEX IF NOT EXISTS idx_hair_assessments_created ON hair_assessments(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_hair_assessments_face_shape ON hair_assessments(face_shape);

-- ì½”ë©˜íŠ¸
COMMENT ON TABLE hair_assessments IS 'H-1 í—¤ì–´ ë¶„ì„ ê²°ê³¼ ì €ì¥';
COMMENT ON COLUMN hair_assessments.face_shape IS 'ì–¼êµ´í˜•: oval, round, oblong, square, heart, diamond, triangle';
COMMENT ON COLUMN hair_assessments.hair_color_lab IS 'Lab ìƒ‰ê³µê°„ í—¤ì–´ì»¬ëŸ¬: { L, a, b }';
COMMENT ON COLUMN hair_assessments.recommendations IS 'ì¶”ì²œ ì •ë³´ JSONB: insight, ingredients, products, careTips, hairStyles, hairColors';
```

### 4.2 RLS ì •ì±…

```sql
-- RLS í™œì„±í™”
ALTER TABLE hair_assessments ENABLE ROW LEVEL SECURITY;

-- ë³¸ì¸ ë°ì´í„° ì¡°íšŒ
CREATE POLICY "hair_assessments_select_own" ON hair_assessments
  FOR SELECT
  USING (clerk_user_id = auth.get_user_id());

-- ë³¸ì¸ ë°ì´í„° ìƒì„±
CREATE POLICY "hair_assessments_insert_own" ON hair_assessments
  FOR INSERT
  WITH CHECK (clerk_user_id = auth.get_user_id());

-- ë³¸ì¸ ë°ì´í„° ìˆ˜ì •
CREATE POLICY "hair_assessments_update_own" ON hair_assessments
  FOR UPDATE
  USING (clerk_user_id = auth.get_user_id());

-- ë³¸ì¸ ë°ì´í„° ì‚­ì œ
CREATE POLICY "hair_assessments_delete_own" ON hair_assessments
  FOR DELETE
  USING (clerk_user_id = auth.get_user_id());
```

---

## 5. AI í”„ë¡¬í”„íŠ¸ ê°€ì´ë“œ

### 5.1 Gemini ë¶„ì„ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿

```typescript
const HAIR_ANALYSIS_PROMPT = `
ë‹¹ì‹ ì€ ì „ë¬¸ íŠ¸ë¦¬ì½œë¡œì§€ìŠ¤íŠ¸(ëª¨ë°œ ì „ë¬¸ê°€)ì´ì í—¤ì–´ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤.
ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ë‹¤ìŒ ì •ë³´ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•˜ì„¸ìš”.

## ë¶„ì„ í•­ëª©

### 1. ì–¼êµ´í˜• ë¶„ì„ (faceShape)
ê°€ë¡œ:ì„¸ë¡œ ë¹„ìœ¨ê³¼ í„±ì„  í˜•íƒœë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¶„ë¥˜:
- "oval": ê³„ë€í˜• (ì´ìƒì  ë¹„ìœ¨, ê°€ë¡œ:ì„¸ë¡œ â‰ˆ 1:1.5)
- "round": ë‘¥ê·¼í˜• (ê°€ë¡œ:ì„¸ë¡œ â‰ˆ 1:1, ë„“ì€ ë³¼)
- "oblong": ê¸´í˜• (ê°€ë¡œ:ì„¸ë¡œ > 1:1.6)
- "square": ì‚¬ê°í˜• (ê°ì§„ í„±ì„ , ê°€ë¡œ:ì„¸ë¡œ â‰ˆ 1:1.2)
- "heart": í•˜íŠ¸í˜• (ë„“ì€ ì´ë§ˆ, ì¢ì€ í„±)
- "diamond": ë‹¤ì´ì•„ëª¬ë“œ (ë„“ì€ ê´‘ëŒ€, ì¢ì€ ì´ë§ˆ/í„±)

### 2. í—¤ì–´ íƒ€ì… (hairType)
- "straight": ì§ëª¨
- "wavy": ì›¨ì´ë¸Œ
- "curly": ê³±ìŠ¬
- "coily": ê°•í•œ ê³±ìŠ¬

### 3. ëª¨ë°œ êµµê¸° (hairThickness)
- "fine": ê°€ëŠ” ëª¨ë°œ
- "medium": ë³´í†µ
- "thick": êµµì€ ëª¨ë°œ

### 4. ë‘í”¼ íƒ€ì… (scalpType)
- "dry": ê±´ì„±
- "normal": ì¤‘ì„±
- "oily": ì§€ì„±
- "sensitive": ë¯¼ê°ì„±

### 5. ê±´ê°• ì§€í‘œ (metrics)
ê° ì§€í‘œë¥¼ 0-100 ì ìˆ˜ë¡œ í‰ê°€:
- hydration: ìˆ˜ë¶„ë„
- scalp: ë‘í”¼ ê±´ê°•
- damage: ì†ìƒë„ (100 = ì†ìƒ ì—†ìŒ, ê±´ê°•)
- density: ëª¨ë°œ ë°€ë„
- elasticity: íƒ„ë ¥
- shine: ìœ¤ê¸°

### 6. ê³ ë¯¼ ëª©ë¡ (concerns)
ê°ì§€ëœ ê³ ë¯¼ì„ ë°°ì—´ë¡œ ë°˜í™˜:
- "hairloss": íƒˆëª¨
- "dandruff": ë¹„ë“¬
- "frizz": í‘¸ì„í•¨
- "damage": ì†ìƒ
- "oily-scalp": ì§€ì„± ë‘í”¼
- "dry-scalp": ê±´ì¡° ë‘í”¼
- "split-ends": ëê°ˆë¼ì§
- "lack-volume": ë³¼ë¥¨ ë¶€ì¡±

### 7. í—¤ì–´ì»¬ëŸ¬ ì •ë³´ (hairColor)
- L: ëª…ë„ (0-100)
- a: ë¹¨ê°•-ì´ˆë¡ (-30 to 30)
- b: ë…¸ë‘-íŒŒë‘ (-30 to 30)
- category: ìƒ‰ìƒ ì¹´í…Œê³ ë¦¬

### 8. ì¶”ì²œ
- insight: 1-2ë¬¸ì¥ ì¢…í•© ì¸ì‚¬ì´íŠ¸ (í•œêµ­ì–´)
- recommendedIngredients: ì¶”ì²œ ì„±ë¶„ 4ê°œ
- careTips: ì¼€ì–´ íŒ 4ê°œ (í•œêµ­ì–´)
- recommendedHairStyles: ì–¼êµ´í˜•ì— ë§ëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ 3ê°œ

### 9. ì‹ ë¢°ë„ (analysisReliability)
- "high": ì„ ëª…í•œ ì´ë¯¸ì§€, ì •ë©´, ì¢‹ì€ ì¡°ëª…
- "medium": ë³´í†µ í’ˆì§ˆ
- "low": íë¦¿í•˜ê±°ë‚˜ ë¶€ë¶„ì ìœ¼ë¡œ ê°€ë ¤ì§

## ì‘ë‹µ í˜•ì‹ (JSONë§Œ)
{
  "faceShape": "oval",
  "faceShapeConfidence": 85,
  "hairType": "wavy",
  "hairTypeLabel": "ì›¨ì´ë¸Œ",
  "hairThickness": "medium",
  "hairThicknessLabel": "ë³´í†µ",
  "scalpType": "normal",
  "scalpTypeLabel": "ì¤‘ì„± ë‘í”¼",
  "overallScore": 72,
  "metrics": [
    { "id": "hydration", "label": "ìˆ˜ë¶„ë„", "value": 65, "status": "normal", "description": "..." },
    ...
  ],
  "hairColor": {
    "L": 25,
    "a": 2,
    "b": 5,
    "category": "black"
  },
  "concerns": ["frizz", "split-ends"],
  "insight": "ì›¨ì´ë¸Œ íƒ€ì…ì˜ ë³´í†µ êµµê¸° ëª¨ë°œì´ì‹œë„¤ìš”...",
  "recommendedIngredients": ["ì¼€ë¼í‹´", "ì•„ë¥´ê°„ ì˜¤ì¼", "íŒí…Œë†€", "ì‹¤í¬ ì•„ë¯¸ë…¸ì‚°"],
  "recommendedHairStyles": [
    {
      "styleId": "layered-bob",
      "styleName": "Layered Bob",
      "styleNameKr": "ë ˆì´ì–´ë“œ ë³´ë¸Œ",
      "description": "ê³„ë€í˜• ì–¼êµ´ì— ì˜ ì–´ìš¸ë¦¬ëŠ” ìŠ¤íƒ€ì¼",
      "matchScore": 92
    }
  ],
  "careTips": ["ë¯¸ì§€ê·¼í•œ ë¬¼ë¡œ ìƒ´í‘¸í•˜ì„¸ìš”", "ì£¼ 1íšŒ ë”¥ íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸", ...],
  "analysisReliability": "high"
}
`;
```

### 5.2 ì¶œë ¥ íŒŒì‹± ê·œì¹™

```typescript
/**
 * Gemini ì‘ë‹µ íŒŒì‹± ë° ê²€ì¦
 */
function parseGeminiHairResponse(responseText: string): HairAnalysisResult {
  // 1. JSON ì¶”ì¶œ
  const jsonMatch = responseText.match(/\{[\s\S]*\}/);
  if (!jsonMatch) {
    throw new Error('Failed to extract JSON from Gemini response');
  }

  const rawResult = JSON.parse(jsonMatch[0]);

  // 2. í•„ìˆ˜ í•„ë“œ ê²€ì¦
  const requiredFields = [
    'hairType',
    'hairThickness',
    'scalpType',
    'overallScore',
    'metrics',
    'concerns',
  ];

  for (const field of requiredFields) {
    if (!(field in rawResult)) {
      throw new Error(`Missing required field: ${field}`);
    }
  }

  // 3. ê°’ ë²”ìœ„ ê²€ì¦ ë° ì •ê·œí™”
  const overallScore = Math.max(0, Math.min(100, rawResult.overallScore));

  const metrics = rawResult.metrics.map((m: HairAnalysisMetric) => ({
    ...m,
    value: Math.max(0, Math.min(100, m.value)),
    status: getMetricStatus(m.value),
  }));

  // 4. íƒ€ì… ê²€ì¦
  const validHairTypes = ['straight', 'wavy', 'curly', 'coily'];
  const validScalpTypes = ['dry', 'normal', 'oily', 'sensitive'];
  const validFaceShapes = ['oval', 'round', 'oblong', 'square', 'heart', 'diamond', 'triangle'];

  if (!validHairTypes.includes(rawResult.hairType)) {
    rawResult.hairType = 'straight';  // ê¸°ë³¸ê°’
  }

  if (!validScalpTypes.includes(rawResult.scalpType)) {
    rawResult.scalpType = 'normal';  // ê¸°ë³¸ê°’
  }

  if (rawResult.faceShape && !validFaceShapes.includes(rawResult.faceShape)) {
    rawResult.faceShape = 'oval';  // ê¸°ë³¸ê°’
  }

  return {
    ...rawResult,
    overallScore,
    metrics,
    analyzedAt: new Date(),
  };
}

function getMetricStatus(value: number): 'good' | 'normal' | 'warning' {
  if (value >= 70) return 'good';
  if (value >= 40) return 'normal';
  return 'warning';
}
```

---

## 6. Mock ë°ì´í„°

> **ëª©ì **: AI ì„œë¹„ìŠ¤ ì¥ì•  ì‹œ Fallback, í…ŒìŠ¤íŠ¸ ë°ì´í„° ì œê³µ, ê°œë°œ í™˜ê²½ ì§€ì›

### 6.1 ì…ë ¥ Mock (Input Mock)

#### 6.1.1 í‘œì¤€ ì…ë ¥ Mock

```typescript
/**
 * í‘œì¤€ í—¤ì–´ ë¶„ì„ ì…ë ¥ Mock
 * ìœ„ì¹˜: tests/fixtures/hair-analysis-input.ts
 */
export const mockHairAnalysisInput: HairAnalysisRequest = {
  imageBase64: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBwgH...',
  useMock: false,
  includeColorAnalysis: true,
  includeFaceShapeAnalysis: true,
  personalColorId: 'f47ac10b-58cc-4372-a567-0e02b2c3d479',
};

export const mockHairAnalysisInputMinimal: HairAnalysisRequest = {
  imageBase64: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...',
  // ëª¨ë“  ì„ íƒ í•„ë“œ ìƒëµ - ê¸°ë³¸ê°’ ì‚¬ìš©
};
```

#### 6.1.2 ê²½ê³„ê°’ ì…ë ¥ Mock

```typescript
/**
 * ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸ìš© ì…ë ¥ Mock
 */
// ìµœì†Œ ìœ íš¨ ì´ë¯¸ì§€ (100x100)
export const mockHairInputBoundaryMinImage: HairAnalysisRequest = {
  imageBase64: 'data:image/jpeg;base64,/9j/4AAQ...',  // 100x100px ì´ë¯¸ì§€
  useMock: false,
};

// ìµœëŒ€ ì´ë¯¸ì§€ í¬ê¸° ê·¼ì ‘ (4096x4096)
export const mockHairInputBoundaryMaxImage: HairAnalysisRequest = {
  imageBase64: 'data:image/jpeg;base64,/9j/4AAQ...',  // 4096x4096px ì´ë¯¸ì§€
  useMock: false,
};

// PNG í˜•ì‹
export const mockHairInputPngFormat: HairAnalysisRequest = {
  imageBase64: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...',
  useMock: false,
};

// Mock ê°•ì œ ì‚¬ìš©
export const mockHairInputForceMock: HairAnalysisRequest = {
  imageBase64: 'data:image/jpeg;base64,/9j/4AAQ...',
  useMock: true,
};

// ëª¨ë“  ì˜µì…˜ í™œì„±í™”
export const mockHairInputAllOptions: HairAnalysisRequest = {
  imageBase64: 'data:image/jpeg;base64,/9j/4AAQ...',
  useMock: false,
  includeColorAnalysis: true,
  includeFaceShapeAnalysis: true,
  personalColorId: 'f47ac10b-58cc-4372-a567-0e02b2c3d479',
};
```

### 6.2 ì¶œë ¥ Mock (Output Mock)

#### 6.2.1 ì •ìƒ ì¶œë ¥ Mock

```typescript
/**
 * ì •ìƒ ë²”ìœ„ ì¶œë ¥ Mock
 * ìœ„ì¹˜: tests/fixtures/hair-analysis-output.ts
 */
export const mockHairResultNormal: HairAnalysisResult = {
  // ì–¼êµ´í˜• ì •ë³´
  faceShape: 'oval',
  faceShapeLabel: 'ê³„ë€í˜•',
  faceShapeConfidence: 87,

  // í—¤ì–´ ê¸°ë³¸ ì •ë³´
  hairType: 'wavy',
  hairTypeLabel: 'ì›¨ì´ë¸Œ',
  hairThickness: 'medium',
  hairThicknessLabel: 'ë³´í†µ',
  scalpType: 'normal',
  scalpTypeLabel: 'ì¤‘ì„± ë‘í”¼',

  // í—¤ì–´ì»¬ëŸ¬ ì •ë³´
  hairColor: {
    dominant: { L: 25, a: 2, b: 5 },
    secondary: { L: 30, a: 3, b: 7 },
    category: 'black',
    hex: '#1a1a1a',
  },

  // ì ìˆ˜
  overallScore: 72,
  metrics: [
    { id: 'hydration', label: 'ìˆ˜ë¶„ë„', value: 65, status: 'normal', description: 'ì ì • ìˆ˜ë¶„ ìƒíƒœ' },
    { id: 'scalp', label: 'ë‘í”¼ ê±´ê°•', value: 75, status: 'good', description: 'ê±´ê°•í•œ ë‘í”¼' },
    { id: 'damage', label: 'ì†ìƒë„', value: 70, status: 'good', description: 'ì•½ê°„ì˜ ì†ìƒ' },
    { id: 'density', label: 'ëª¨ë°œ ë°€ë„', value: 68, status: 'normal', description: 'ì •ìƒ ë°€ë„' },
    { id: 'elasticity', label: 'íƒ„ë ¥', value: 72, status: 'good', description: 'ì¢‹ì€ íƒ„ë ¥' },
    { id: 'shine', label: 'ìœ¤ê¸°', value: 60, status: 'normal', description: 'ë³´í†µ ìœ¤ê¸°' },
  ],

  // ë¶„ì„ ê²°ê³¼
  concerns: ['frizz', 'split-ends'],
  insight: 'ì›¨ì´ë¸Œ íƒ€ì…ì˜ ë³´í†µ êµµê¸° ëª¨ë°œì´ì‹œë„¤ìš”. ê³„ë€í˜• ì–¼êµ´ì— ì˜ ì–´ìš¸ë¦¬ëŠ” ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼ì„ ì‹œë„í•´ë³´ì„¸ìš”.',

  // ì¶”ì²œ
  recommendedHairStyles: [
    {
      styleId: 'layered-bob',
      styleName: 'Layered Bob',
      styleNameKr: 'ë ˆì´ì–´ë“œ ë³´ë¸Œ',
      description: 'ê³„ë€í˜• ì–¼êµ´ì— ì˜ ì–´ìš¸ë¦¬ëŠ” ìŠ¤íƒ€ì¼',
      matchScore: 92,
      matchReason: 'ì´ìƒì ì¸ ì–¼êµ´í˜•ì— ì˜ ë§ìŒ',
      imageUrl: '/styles/layered-bob.jpg',
      suitableFaceShapes: ['oval', 'heart'],
    },
    {
      styleId: 'long-wave',
      styleName: 'Long Wave',
      styleNameKr: 'ë¡± ì›¨ì´ë¸Œ',
      description: 'ìì—°ìŠ¤ëŸ¬ìš´ ì›¨ì´ë¸Œ ìŠ¤íƒ€ì¼',
      matchScore: 88,
      matchReason: 'ìì—°ìŠ¤ëŸ¬ìš´ ì›¨ì´ë¸Œ ì§ˆê°ê³¼ ì¡°í™”',
      suitableFaceShapes: ['oval', 'oblong'],
    },
  ],
  recommendedHairColors: [
    {
      colorName: 'Chocolate Brown',
      colorNameKr: 'ì´ˆì½œë¦¿ ë¸Œë¼ìš´',
      hex: '#3d2314',
      lab: { L: 35, a: 8, b: 15 },
      matchScore: 90,
      matchReason: 'ì›œí†¤ì— ì˜ ì–´ìš¸ë¦¬ëŠ” ìƒ‰ìƒ',
      seasonCompatibility: ['autumn', 'spring'],
    },
  ],
  recommendedIngredients: ['ì¼€ë¼í‹´', 'ì•„ë¥´ê°„ ì˜¤ì¼', 'íŒí…Œë†€', 'ë¹„ì˜¤í‹´'],
  recommendedProducts: [
    { category: 'ìƒ´í‘¸', name: 'ë³´ìŠµ ìƒ´í‘¸', description: 'ìˆ˜ë¶„ ê³µê¸‰ ì§‘ì¤‘ ì¼€ì–´' },
    { category: 'íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸', name: 'ë”¥ ì»¨ë””ì…”ë„ˆ', description: 'ì†ìƒ ëª¨ë°œ ë³µêµ¬' },
    { category: 'ì—ì„¼ìŠ¤', name: 'í—¤ì–´ ì„¸ëŸ¼', description: 'ìœ¤ê¸° ë¶€ì—¬ ë° ë³´í˜¸' },
  ],
  careTips: [
    'ë¯¸ì§€ê·¼í•œ ë¬¼ë¡œ ìƒ´í‘¸í•˜ì„¸ìš”',
    'ì£¼ 1-2íšŒ ë”¥ íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”',
    'ë“œë¼ì´ ì „ ì—´ ë³´í˜¸ì œë¥¼ ì‚¬ìš©í•˜ì„¸ìš”',
    'ë¹—ì§ˆì€ ëì—ì„œë¶€í„° ì‹œì‘í•˜ì„¸ìš”',
  ],

  // ë©”íƒ€ë°ì´í„°
  analyzedAt: new Date('2026-01-23T10:00:00Z'),
  analysisReliability: 'high',
};
```

#### 6.2.2 ìµœì†Œê°’ ì¶œë ¥ Mock

```typescript
/**
 * ìµœì†Œê°’ ê²½ê³„ ì¶œë ¥ Mock (ëª¨ë“  ì ìˆ˜ 0ì— ê°€ê¹Œì›€)
 */
export const mockHairResultMinimum: HairAnalysisResult = {
  faceShape: 'round',
  faceShapeLabel: 'ë‘¥ê·¼í˜•',
  faceShapeConfidence: 51,  // ìµœì†Œ ìœ íš¨ ì‹ ë¢°ë„

  hairType: 'straight',
  hairTypeLabel: 'ì§ëª¨',
  hairThickness: 'fine',
  hairThicknessLabel: 'ê°€ëŠ” ëª¨ë°œ',
  scalpType: 'dry',
  scalpTypeLabel: 'ê±´ì„± ë‘í”¼',

  hairColor: {
    dominant: { L: 15, a: 0, b: 1 },  // ë§¤ìš° ì–´ë‘ìš´ ê²€ì •
    secondary: null,
    category: 'black',
    hex: '#0a0a0a',
  },

  overallScore: 25,  // ë‚®ì€ ì ìˆ˜
  metrics: [
    { id: 'hydration', label: 'ìˆ˜ë¶„ë„', value: 15, status: 'warning', description: 'ì‹¬ê°í•œ ìˆ˜ë¶„ ë¶€ì¡±' },
    { id: 'scalp', label: 'ë‘í”¼ ê±´ê°•', value: 20, status: 'warning', description: 'ë‘í”¼ ê±´ê°• ì£¼ì˜' },
    { id: 'damage', label: 'ì†ìƒë„', value: 25, status: 'warning', description: 'ì‹¬í•œ ì†ìƒ' },
    { id: 'density', label: 'ëª¨ë°œ ë°€ë„', value: 30, status: 'warning', description: 'ë‚®ì€ ë°€ë„' },
    { id: 'elasticity', label: 'íƒ„ë ¥', value: 35, status: 'warning', description: 'íƒ„ë ¥ ë¶€ì¡±' },
    { id: 'shine', label: 'ìœ¤ê¸°', value: 25, status: 'warning', description: 'ìœ¤ê¸° ë¶€ì¡±' },
  ],

  concerns: ['hairloss', 'dandruff', 'dry-scalp', 'damage', 'frizz', 'split-ends', 'lack-volume'],
  insight: 'ëª¨ë°œê³¼ ë‘í”¼ ê±´ê°•ì— ì§‘ì¤‘ì ì¸ ì¼€ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì „ë¬¸ê°€ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.',

  recommendedHairStyles: [
    {
      styleId: 'volume-perm',
      styleName: 'Volume Perm',
      styleNameKr: 'ë³¼ë¥¨ íŒ',
      description: 'ë³¼ë¥¨ ë¶€ì¡±ì„ ë³´ì™„í•˜ëŠ” ìŠ¤íƒ€ì¼',
      matchScore: 75,
      matchReason: 'ê°€ëŠ” ëª¨ë°œì— ë³¼ë¥¨ ì¶”ê°€',
      suitableFaceShapes: ['round', 'oval'],
    },
  ],
  recommendedIngredients: ['ë¹„ì˜¤í‹´', 'ì² ë¶„', 'ì•„ì—°', 'ë‹¨ë°±ì§ˆ', 'ë¹„íƒ€ë¯¼ E'],
  recommendedProducts: [
    { category: 'ìƒ´í‘¸', name: 'íƒˆëª¨ ì¼€ì–´ ìƒ´í‘¸', description: 'ë‘í”¼ ê°•í™”' },
    { category: 'ì„¸ëŸ¼', name: 'ë‘í”¼ ì—ì„¼ìŠ¤', description: 'ë‘í”¼ ì˜ì–‘ ê³µê¸‰' },
  ],
  careTips: [
    'ë‘í”¼ ë§ˆì‚¬ì§€ë¥¼ ê·œì¹™ì ìœ¼ë¡œ í•˜ì„¸ìš”',
    'ì—´ê¸°êµ¬ ì‚¬ìš©ì„ ìµœì†Œí™”í•˜ì„¸ìš”',
    'ë‹¨ë°±ì§ˆì´ í’ë¶€í•œ ì‹ë‹¨ì„ ìœ ì§€í•˜ì„¸ìš”',
    'ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤',
  ],

  analyzedAt: new Date('2026-01-23T10:00:00Z'),
  analysisReliability: 'medium',
};
```

#### 6.2.3 ìµœëŒ€ê°’ ì¶œë ¥ Mock

```typescript
/**
 * ìµœëŒ€ê°’ ê²½ê³„ ì¶œë ¥ Mock (ëª¨ë“  ì ìˆ˜ 100ì— ê°€ê¹Œì›€)
 */
export const mockHairResultMaximum: HairAnalysisResult = {
  faceShape: 'oval',
  faceShapeLabel: 'ê³„ë€í˜•',
  faceShapeConfidence: 98,  // ìµœëŒ€ ì‹ ë¢°ë„

  hairType: 'wavy',
  hairTypeLabel: 'ì›¨ì´ë¸Œ',
  hairThickness: 'medium',
  hairThicknessLabel: 'ë³´í†µ',
  scalpType: 'normal',
  scalpTypeLabel: 'ì¤‘ì„± ë‘í”¼',

  hairColor: {
    dominant: { L: 45, a: 5, b: 12 },  // ë°ì€ ë¸Œë¼ìš´
    secondary: { L: 50, a: 3, b: 10 },
    category: 'medium-brown',
    hex: '#5a4033',
  },

  overallScore: 95,  // ìµœê³  ì ìˆ˜
  metrics: [
    { id: 'hydration', label: 'ìˆ˜ë¶„ë„', value: 95, status: 'good', description: 'ìµœì ì˜ ìˆ˜ë¶„ ìƒíƒœ' },
    { id: 'scalp', label: 'ë‘í”¼ ê±´ê°•', value: 98, status: 'good', description: 'ë§¤ìš° ê±´ê°•í•œ ë‘í”¼' },
    { id: 'damage', label: 'ì†ìƒë„', value: 97, status: 'good', description: 'ê±°ì˜ ì†ìƒ ì—†ìŒ' },
    { id: 'density', label: 'ëª¨ë°œ ë°€ë„', value: 92, status: 'good', description: 'í’ì„±í•œ ëª¨ë°œ' },
    { id: 'elasticity', label: 'íƒ„ë ¥', value: 94, status: 'good', description: 'ìš°ìˆ˜í•œ íƒ„ë ¥' },
    { id: 'shine', label: 'ìœ¤ê¸°', value: 96, status: 'good', description: 'ë¹›ë‚˜ëŠ” ìœ¤ê¸°' },
  ],

  concerns: [],  // ê³ ë¯¼ ì—†ìŒ
  insight: 'ë§¤ìš° ê±´ê°•í•œ ëª¨ë°œ ìƒíƒœì…ë‹ˆë‹¤! í˜„ì¬ ì¼€ì–´ ë£¨í‹´ì„ ìœ ì§€í•˜ì„¸ìš”.',

  recommendedHairStyles: [
    {
      styleId: 'any-style',
      styleName: 'Any Style',
      styleNameKr: 'ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼',
      description: 'ëŒ€ë¶€ë¶„ì˜ ìŠ¤íƒ€ì¼ì´ ì–´ìš¸ë¦½ë‹ˆë‹¤',
      matchScore: 98,
      matchReason: 'ì´ìƒì ì¸ ì–¼êµ´í˜•ê³¼ ê±´ê°•í•œ ëª¨ë°œ',
      suitableFaceShapes: ['oval'],
    },
  ],
  recommendedIngredients: ['ì¼€ë¼í‹´', 'ì‹¤í¬ ì•„ë¯¸ë…¸ì‚°'],
  recommendedProducts: [
    { category: 'ì—ì„¼ìŠ¤', name: 'ìœ¤ê¸° ë¶€ìŠ¤í„°', description: 'ê´‘íƒ ìœ ì§€' },
  ],
  careTips: [
    'í˜„ì¬ ë£¨í‹´ì„ ìœ ì§€í•˜ì„¸ìš”',
    'ìì™¸ì„  ì°¨ë‹¨ì„ ìŠì§€ ë§ˆì„¸ìš”',
  ],

  analyzedAt: new Date('2026-01-23T10:00:00Z'),
  analysisReliability: 'high',
};
```

#### 6.2.4 Fallback ì¶œë ¥ Mock

```typescript
/**
 * AI ì‹¤íŒ¨ ì‹œ Fallback Mock
 * analysisReliability: 'medium' í•„ìˆ˜
 */
export const mockHairResultFallback: HairAnalysisResult = {
  faceShape: 'oval',  // ê¸°ë³¸ê°’: ê°€ì¥ ì¼ë°˜ì ì¸ í˜•íƒœ
  faceShapeLabel: 'ê³„ë€í˜•',
  faceShapeConfidence: 70,  // ë‚®ì€ ì‹ ë¢°ë„

  hairType: 'straight',  // ê¸°ë³¸ê°’
  hairTypeLabel: 'ì§ëª¨',
  hairThickness: 'medium',
  hairThicknessLabel: 'ë³´í†µ',
  scalpType: 'normal',
  scalpTypeLabel: 'ì¤‘ì„± ë‘í”¼',

  overallScore: 65,  // ì¤‘ê°„ ì ìˆ˜
  metrics: [
    { id: 'hydration', label: 'ìˆ˜ë¶„ë„', value: 60, status: 'normal', description: 'ì¼ë°˜ì ì¸ ìˆ˜ë¶„ ìƒíƒœ' },
    { id: 'scalp', label: 'ë‘í”¼ ê±´ê°•', value: 65, status: 'normal', description: 'ì¼ë°˜ì ì¸ ë‘í”¼ ìƒíƒœ' },
    { id: 'damage', label: 'ì†ìƒë„', value: 60, status: 'normal', description: 'ì¼ë°˜ì ì¸ ì†ìƒ ìˆ˜ì¤€' },
    { id: 'density', label: 'ëª¨ë°œ ë°€ë„', value: 65, status: 'normal', description: 'ì¼ë°˜ì ì¸ ë°€ë„' },
    { id: 'elasticity', label: 'íƒ„ë ¥', value: 70, status: 'good', description: 'ì ì • íƒ„ë ¥' },
    { id: 'shine', label: 'ìœ¤ê¸°', value: 60, status: 'normal', description: 'ì¼ë°˜ì ì¸ ìœ¤ê¸°' },
  ],

  concerns: ['frizz'],  // ìµœì†Œ ê³ ë¯¼
  insight: 'ê¸°ë³¸ ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤. ë” ì •í™•í•œ ë¶„ì„ì„ ìœ„í•´ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',

  recommendedHairStyles: [
    {
      styleId: 'classic-cut',
      styleName: 'Classic Cut',
      styleNameKr: 'í´ë˜ì‹ ì»·',
      description: 'ëŒ€ë¶€ë¶„ì˜ ì‚¬ëŒì—ê²Œ ì–´ìš¸ë¦¬ëŠ” ìŠ¤íƒ€ì¼',
      matchScore: 80,
      matchReason: 'ë²”ìš©ì ì¸ ìŠ¤íƒ€ì¼',
      suitableFaceShapes: ['oval', 'round', 'oblong', 'square', 'heart', 'diamond', 'triangle'],
    },
  ],
  recommendedIngredients: ['ì¼€ë¼í‹´', 'íŒí…Œë†€', 'ì•„ë¥´ê°„ ì˜¤ì¼', 'ë¹„íƒ€ë¯¼ E'],
  recommendedProducts: [
    { category: 'ìƒ´í‘¸', name: 'ë°ì¼ë¦¬ ìƒ´í‘¸', description: 'ì¼ìƒ ì¼€ì–´ìš©' },
    { category: 'ì»¨ë””ì…”ë„ˆ', name: 'ë°ì¼ë¦¬ ì»¨ë””ì…”ë„ˆ', description: 'ë¶€ë“œëŸ¬ìš´ ë§ˆë¬´ë¦¬' },
  ],
  careTips: [
    'ê·œì¹™ì ì¸ ìƒ´í‘¸ ìŠµê´€ì„ ìœ ì§€í•˜ì„¸ìš”',
    'í—¤ì–´ ë“œë¼ì´ì–´ëŠ” ì¤‘ì˜¨ìœ¼ë¡œ ì‚¬ìš©í•˜ì„¸ìš”',
    'ì •ê¸°ì ì¸ ëª¨ë°œ íŠ¸ë¦¬ë°ì„ ê¶Œì¥í•©ë‹ˆë‹¤',
  ],

  analyzedAt: new Date(),
  analysisReliability: 'medium',  // Fallback í‘œì‹œ
};
```

### 6.3 Fallbackìš© Mock ìƒì„± í•¨ìˆ˜

```typescript
/**
 * AI ë¶„ì„ ì‹¤íŒ¨ ì‹œ Fallback Mock ê²°ê³¼ ìƒì„±
 *
 * ìœ„ì¹˜: lib/mock/hair-analysis.ts
 */
export function generateMockHairAnalysisResult(): HairAnalysisResult {
  const faceShapes: FaceShapeId[] = ['oval', 'round', 'oblong', 'square', 'heart', 'diamond', 'triangle'];
  const hairTypes: HairTypeId[] = ['straight', 'wavy', 'curly', 'coily'];
  const thicknesses: HairThicknessId[] = ['fine', 'medium', 'thick'];
  const scalpTypes: ScalpTypeId[] = ['dry', 'normal', 'oily', 'sensitive'];

  const randomFaceShape = faceShapes[Math.floor(Math.random() * faceShapes.length)];
  const randomHairType = hairTypes[Math.floor(Math.random() * hairTypes.length)];
  const randomThickness = thicknesses[Math.floor(Math.random() * thicknesses.length)];
  const randomScalpType = scalpTypes[Math.floor(Math.random() * scalpTypes.length)];

  const faceShapeLabels: Record<FaceShapeId, string> = {
    oval: 'ê³„ë€í˜•',
    round: 'ë‘¥ê·¼í˜•',
    oblong: 'ê¸´í˜•',
    square: 'ì‚¬ê°í˜•',
    heart: 'í•˜íŠ¸í˜•',
    diamond: 'ë‹¤ì´ì•„ëª¬ë“œ',
    triangle: 'ì‚¼ê°í˜•',
  };

  const hairTypeLabels: Record<HairTypeId, string> = {
    straight: 'ì§ëª¨',
    wavy: 'ì›¨ì´ë¸Œ',
    curly: 'ê³±ìŠ¬',
    coily: 'ê°•í•œ ê³±ìŠ¬',
  };

  const generateScore = (min: number, max: number) =>
    Math.floor(Math.random() * (max - min + 1)) + min;

  const metrics: HairAnalysisMetric[] = [
    { id: 'hydration', label: 'ìˆ˜ë¶„ë„', value: generateScore(30, 90), status: 'normal', description: 'ëª¨ë°œì˜ ìˆ˜ë¶„ í•¨ëŸ‰' },
    { id: 'scalp', label: 'ë‘í”¼ ê±´ê°•', value: generateScore(40, 85), status: 'normal', description: 'ë‘í”¼ ìƒíƒœ ì ìˆ˜' },
    { id: 'damage', label: 'ì†ìƒë„', value: generateScore(50, 95), status: 'normal', description: 'ëª¨ë°œ ì†ìƒ ì •ë„ (ë†’ì„ìˆ˜ë¡ ê±´ê°•)' },
    { id: 'density', label: 'ëª¨ë°œ ë°€ë„', value: generateScore(35, 85), status: 'normal', description: 'ëª¨ë°œì˜ ë°€ì§‘ë„' },
    { id: 'elasticity', label: 'íƒ„ë ¥', value: generateScore(40, 90), status: 'normal', description: 'ëª¨ë°œì˜ íƒ„ë ¥ì„±' },
    { id: 'shine', label: 'ìœ¤ê¸°', value: generateScore(30, 85), status: 'normal', description: 'ëª¨ë°œì˜ ê´‘íƒ' },
  ].map((m) => ({ ...m, status: getMetricStatus(m.value) }));

  const overallScore = Math.round(metrics.reduce((acc, m) => acc + m.value, 0) / metrics.length);

  // ì–¼êµ´í˜•ë³„ ì¶”ì²œ í—¤ì–´ìŠ¤íƒ€ì¼
  const stylesByFaceShape: Record<FaceShapeId, HairStyleRecommendation[]> = {
    oval: [
      { styleId: 'any', styleName: 'Any Style', styleNameKr: 'ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼', description: 'ëŒ€ë¶€ë¶„ì˜ ìŠ¤íƒ€ì¼ì´ ì–´ìš¸ë¦½ë‹ˆë‹¤', matchScore: 95, matchReason: 'ì´ìƒì ì¸ ì–¼êµ´í˜•', suitableFaceShapes: ['oval'] },
    ],
    round: [
      { styleId: 'layered-long', styleName: 'Layered Long', styleNameKr: 'ë ˆì´ì–´ë“œ ë¡±', description: 'ì„¸ë¡œ ë¼ì¸ ê°•ì¡°', matchScore: 90, matchReason: 'ì–¼êµ´ì´ ê¸¸ì–´ ë³´ì´ëŠ” íš¨ê³¼', suitableFaceShapes: ['round'] },
    ],
    oblong: [
      { styleId: 'side-volume', styleName: 'Side Volume', styleNameKr: 'ì‚¬ì´ë“œ ë³¼ë¥¨', description: 'ì˜†ìœ¼ë¡œ í¼ì§€ëŠ” ìŠ¤íƒ€ì¼', matchScore: 88, matchReason: 'ê°€ë¡œ ë³¼ë¥¨ìœ¼ë¡œ ê· í˜•', suitableFaceShapes: ['oblong'] },
    ],
    square: [
      { styleId: 'soft-waves', styleName: 'Soft Waves', styleNameKr: 'ì†Œí”„íŠ¸ ì›¨ì´ë¸Œ', description: 'ë¶€ë“œëŸ¬ìš´ ê³¡ì„ ', matchScore: 92, matchReason: 'ê°ì§„ ë¶€ë¶„ ì™„í™”', suitableFaceShapes: ['square'] },
    ],
    heart: [
      { styleId: 'chin-length-bob', styleName: 'Chin Length Bob', styleNameKr: 'í„±ì„  ë³´ë¸Œ', description: 'í„±ì„  ë³¼ë¥¨ ì¶”ê°€', matchScore: 89, matchReason: 'í•˜ë¶€ ê· í˜• ë§ì¶¤', suitableFaceShapes: ['heart'] },
    ],
    diamond: [
      { styleId: 'forehead-fringe', styleName: 'Forehead Fringe', styleNameKr: 'ì•ë¨¸ë¦¬ ìŠ¤íƒ€ì¼', description: 'ì´ë§ˆ ì»¤ë²„ ì•ë¨¸ë¦¬', matchScore: 87, matchReason: 'ìƒí•˜ë¶€ ê· í˜•', suitableFaceShapes: ['diamond'] },
    ],
    triangle: [
      { styleId: 'top-volume-layer', styleName: 'Top Volume Layer', styleNameKr: 'íƒ‘ ë³¼ë¥¨ ë ˆì´ì–´', description: 'ì •ìˆ˜ë¦¬ ë³¼ë¥¨ ê°•ì¡°', matchScore: 88, matchReason: 'ìƒë¶€ ë³¼ë¥¨ìœ¼ë¡œ ì¢ì€ ì´ë§ˆ ë³´ì™„', suitableFaceShapes: ['triangle'] },
    ],
  };

  return {
    faceShape: randomFaceShape,
    faceShapeLabel: faceShapeLabels[randomFaceShape],
    faceShapeConfidence: generateScore(70, 95),
    hairType: randomHairType,
    hairTypeLabel: hairTypeLabels[randomHairType],
    hairThickness: randomThickness,
    hairThicknessLabel: thicknesses[randomThickness === 'fine' ? 0 : randomThickness === 'medium' ? 1 : 2],
    scalpType: randomScalpType,
    scalpTypeLabel: scalpTypes[randomScalpType === 'dry' ? 0 : randomScalpType === 'normal' ? 1 : randomScalpType === 'oily' ? 2 : 3],
    overallScore,
    metrics,
    concerns: ['frizz', 'split-ends'] as HairConcernId[],
    insight: `${faceShapeLabels[randomFaceShape]} ì–¼êµ´í˜•ì— ${hairTypeLabels[randomHairType]} íƒ€ì…ì´ì‹œë„¤ìš”. ì–¼êµ´í˜•ì— ë§ëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.`,
    recommendedHairStyles: stylesByFaceShape[randomFaceShape],
    recommendedIngredients: ['ì¼€ë¼í‹´', 'ì•„ë¥´ê°„ ì˜¤ì¼', 'íŒí…Œë†€', 'ë¹„ì˜¤í‹´'],
    recommendedProducts: [
      { category: 'ìƒ´í‘¸', name: 'ëª¨ë°œ íƒ€ì…ë³„ ìƒ´í‘¸', description: 'ë‘í”¼ íƒ€ì…ì— ë§ëŠ” í´ë Œì§•' },
      { category: 'íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸', name: 'ì§‘ì¤‘ ì˜ì–‘ íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸', description: 'ì†ìƒ ëª¨ë°œ ì¼€ì–´' },
      { category: 'ì—ì„¼ìŠ¤', name: 'í—¤ì–´ ì—ì„¼ìŠ¤', description: 'ëª¨ë°œ ë³´í˜¸ ë° ìœ¤ê¸°' },
    ],
    careTips: [
      'ë¯¸ì§€ê·¼í•œ ë¬¼ë¡œ ìƒ´í‘¸í•˜ì„¸ìš”',
      'ë“œë¼ì´ê¸°ëŠ” 20cm ì´ìƒ ê±°ë¦¬ì—ì„œ ì‚¬ìš©í•˜ì„¸ìš”',
      'ìì™¸ì„  ë…¸ì¶œ ì‹œ ëª¨ë°œ ë³´í˜¸ ì œí’ˆì„ ì‚¬ìš©í•˜ì„¸ìš”',
      'ì¼ì£¼ì¼ì— 1-2íšŒ í—¤ì–´ ë§ˆìŠ¤í¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”',
    ],
    analyzedAt: new Date(),
    analysisReliability: 'medium',
  };
}
```

### 6.4 7ê°€ì§€ ì–¼êµ´í˜•ë³„ ìƒì„¸ Mock ë°ì´í„°

```typescript
/**
 * 7ê°€ì§€ ì–¼êµ´í˜•ë³„ ìƒì„¸ Mock ë°ì´í„°
 * ìœ„ì¹˜: tests/fixtures/hair-face-shapes.ts
 */

// ì–¼êµ´í˜•ë³„ ì¸¡ì •ê°’ ë° íŠ¹ì„± Mock
export const mockFaceShapeData: Record<FaceShapeId, FaceShapeDetailMock> = {
  oval: {
    faceShape: 'oval',
    faceShapeLabel: 'ê³„ë€í˜•',
    measurements: {
      faceLength: 210,
      faceWidth: 145,
      jawWidth: 105,
      cheekboneWidth: 140,
      foreheadWidth: 130,
      lengthToWidthRatio: 1.45,
      jawToCheekRatio: 0.75,
    },
    characteristics: ['ì´ìƒì ì¸ ë¹„ìœ¨', 'í„±ì„  ë¶€ë“œëŸ¬ì›€', 'ëŒ€ë¶€ë¶„ ìŠ¤íƒ€ì¼ ê°€ëŠ¥'],
    recommendedStyles: ['any-style', 'layered-bob', 'long-wave', 'pixie-cut'],
    avoidStyles: [],
    confidence: 92,
  },
  round: {
    faceShape: 'round',
    faceShapeLabel: 'ë‘¥ê·¼í˜•',
    measurements: {
      faceLength: 180,
      faceWidth: 165,
      jawWidth: 145,
      cheekboneWidth: 160,
      foreheadWidth: 155,
      lengthToWidthRatio: 1.09,
      jawToCheekRatio: 0.91,
    },
    characteristics: ['ì–¼êµ´ ê¸¸ì´ì™€ ë„ˆë¹„ ìœ ì‚¬', 'ë³¼ ë„“ìŒ', 'í„±ì„  ë¶€ë“œëŸ¬ì›€'],
    recommendedStyles: ['layered-long', 'side-part', 'high-ponytail'],
    avoidStyles: ['chin-length-bob', 'round-bangs'],
    confidence: 88,
  },
  oblong: {
    faceShape: 'oblong',
    faceShapeLabel: 'ê¸´í˜•',
    measurements: {
      faceLength: 230,
      faceWidth: 140,
      jawWidth: 100,
      cheekboneWidth: 135,
      foreheadWidth: 125,
      lengthToWidthRatio: 1.64,
      jawToCheekRatio: 0.74,
    },
    characteristics: ['ì„¸ë¡œë¡œ ê¸´ í˜•íƒœ', 'ì´ë§ˆ/í„± ë¹„ìŠ·í•œ í­', 'ê°€ë¡œ ë³¼ë¥¨ í•„ìš”'],
    recommendedStyles: ['side-volume', 'curtain-bangs', 'medium-wave'],
    avoidStyles: ['long-straight', 'high-bun'],
    confidence: 85,
  },
  square: {
    faceShape: 'square',
    faceShapeLabel: 'ì‚¬ê°í˜•',
    measurements: {
      faceLength: 190,
      faceWidth: 155,
      jawWidth: 150,
      cheekboneWidth: 155,
      foreheadWidth: 150,
      lengthToWidthRatio: 1.23,
      jawToCheekRatio: 0.97,
    },
    characteristics: ['ê°ì§„ í„±ì„ ', 'ì´ë§ˆ/í„±/ê´‘ëŒ€ í­ ìœ ì‚¬', 'ê°•ì¸í•œ ì¸ìƒ'],
    recommendedStyles: ['soft-waves', 'side-swept-bangs', 'textured-layers'],
    avoidStyles: ['blunt-cut', 'severe-part'],
    confidence: 90,
  },
  heart: {
    faceShape: 'heart',
    faceShapeLabel: 'í•˜íŠ¸í˜•',
    measurements: {
      faceLength: 200,
      faceWidth: 150,
      jawWidth: 95,
      cheekboneWidth: 140,
      foreheadWidth: 145,
      lengthToWidthRatio: 1.33,
      jawToCheekRatio: 0.68,
    },
    characteristics: ['ë„“ì€ ì´ë§ˆ', 'ì¢ì€ í„±', 'ê´‘ëŒ€ ê°•ì¡°'],
    recommendedStyles: ['chin-length-bob', 'side-part-long', 'textured-ends'],
    avoidStyles: ['slicked-back', 'top-volume-only'],
    confidence: 87,
  },
  diamond: {
    faceShape: 'diamond',
    faceShapeLabel: 'ë‹¤ì´ì•„ëª¬ë“œ',
    measurements: {
      faceLength: 205,
      faceWidth: 145,
      jawWidth: 100,
      cheekboneWidth: 150,
      foreheadWidth: 115,
      lengthToWidthRatio: 1.41,
      jawToCheekRatio: 0.67,
    },
    characteristics: ['ê´‘ëŒ€ ê°€ì¥ ë„“ìŒ', 'ì¢ì€ ì´ë§ˆ/í„±', 'ê°ì§„ ê´‘ëŒ€ë¼ˆ'],
    recommendedStyles: ['forehead-fringe', 'chin-length-styles', 'soft-layers'],
    avoidStyles: ['slicked-back', 'center-part-short'],
    confidence: 84,
  },
  triangle: {
    faceShape: 'triangle',
    faceShapeLabel: 'ì‚¼ê°í˜•',
    measurements: {
      faceLength: 195,
      faceWidth: 145,
      jawWidth: 155,
      cheekboneWidth: 140,
      foreheadWidth: 120,
      lengthToWidthRatio: 1.34,
      jawToCheekRatio: 1.11,
    },
    characteristics: ['í„±ì´ ê´‘ëŒ€ë³´ë‹¤ ë„“ìŒ', 'ì¢ì€ ì´ë§ˆ', 'ì—­ì‚¼ê°í˜• í¬í•¨'],
    recommendedStyles: ['top-volume-layer', 'side-swept-bangs', 'forehead-coverage'],
    avoidStyles: ['slicked-back', 'jaw-length-bob'],
    confidence: 83,
  },
};

interface FaceShapeDetailMock {
  faceShape: FaceShapeId;
  faceShapeLabel: string;
  measurements: FaceMeasurements;
  characteristics: string[];
  recommendedStyles: string[];
  avoidStyles: string[];
  confidence: number;
}
```

### 6.5 í—¤ì–´ ë ˆë²¨ 1-10 Mock ë°ì´í„°

```typescript
/**
 * í—¤ì–´ ë ˆë²¨ 1-10 ìƒì„¸ Mock ë°ì´í„°
 * ìœ„ì¹˜: tests/fixtures/hair-levels.ts
 */

export const mockHairLevelData: HairLevelMock[] = [
  {
    level: 1,
    name: 'Black',
    nameKr: 'ìˆœí‘ìƒ‰',
    labRange: { L: [0, 15], a: [-2, 2], b: [-2, 5] },
    typicalLab: { L: 10, a: 0, b: 2 },
    hex: '#0a0a0a',
    tone: 'neutral',
    description: 'ê°€ì¥ ì–´ë‘ìš´ ì²œì—° ëª¨ë°œ ìƒ‰ìƒ',
    commonIn: ['ë™ì•„ì‹œì•„', 'ì•„í”„ë¦¬ì¹´', 'ë‚¨ì•„ì‹œì•„'],
  },
  {
    level: 2,
    name: 'Off-Black',
    nameKr: 'ê±°ì˜ ê²€ì •',
    labRange: { L: [15, 22], a: [-2, 3], b: [2, 8] },
    typicalLab: { L: 18, a: 1, b: 5 },
    hex: '#1a1410',
    tone: 'warm',
    description: 'í–‡ë¹›ì—ì„œ ì•½ê°„ ê°ˆìƒ‰ ê¸°ìš´',
    commonIn: ['ë™ì•„ì‹œì•„', 'ë™ë‚¨ì•„ì‹œì•„'],
  },
  {
    level: 3,
    name: 'Darkest Brown',
    nameKr: 'ê°€ì¥ ì–´ë‘ìš´ ê°ˆìƒ‰',
    labRange: { L: [22, 28], a: [2, 6], b: [6, 12] },
    typicalLab: { L: 25, a: 4, b: 9 },
    hex: '#2a1a14',
    tone: 'warm',
    description: 'ê²€ì •ì— ê°€ê¹Œìš´ ë‹¤í¬ ë¸Œë¼ìš´',
    commonIn: ['ì§€ì¤‘í•´', 'ì¤‘ë™', 'ë‚¨ë¯¸'],
  },
  {
    level: 4,
    name: 'Dark Brown',
    nameKr: 'ì–´ë‘ìš´ ê°ˆìƒ‰',
    labRange: { L: [28, 35], a: [4, 10], b: [10, 18] },
    typicalLab: { L: 32, a: 7, b: 14 },
    hex: '#3a2820',
    tone: 'warm',
    description: 'í’ë¶€í•œ ë‹¤í¬ ë¸Œë¼ìš´',
    commonIn: ['ìœ ëŸ½', 'ì¤‘ë™', 'ë‚¨ë¯¸'],
  },
  {
    level: 5,
    name: 'Medium Brown',
    nameKr: 'ì¤‘ê°„ ê°ˆìƒ‰',
    labRange: { L: [35, 43], a: [5, 12], b: [12, 22] },
    typicalLab: { L: 39, a: 8, b: 17 },
    hex: '#4a3830',
    tone: 'warm',
    description: 'ìì—°ìŠ¤ëŸ¬ìš´ ë¸Œë¼ìš´',
    commonIn: ['ìœ ëŸ½', 'ë¶ë¯¸', 'í˜¸ì£¼'],
  },
  {
    level: 6,
    name: 'Light Brown',
    nameKr: 'ë°ì€ ê°ˆìƒ‰',
    labRange: { L: [43, 52], a: [6, 14], b: [15, 26] },
    typicalLab: { L: 48, a: 10, b: 21 },
    hex: '#6a4840',
    tone: 'warm',
    description: 'ë°ê³  ë”°ëœ»í•œ ë¸Œë¼ìš´',
    commonIn: ['ë¶ìœ ëŸ½', 'ë¶ë¯¸'],
  },
  {
    level: 7,
    name: 'Dark Blonde',
    nameKr: 'ì–´ë‘ìš´ ê¸ˆë°œ',
    labRange: { L: [52, 62], a: [4, 12], b: [18, 30] },
    typicalLab: { L: 57, a: 8, b: 24 },
    hex: '#8a6850',
    tone: 'warm',
    description: 'ì§„í•œ ê¿€ìƒ‰ ê¸ˆë°œ',
    commonIn: ['ë¶ìœ ëŸ½', 'ë™ìœ ëŸ½'],
  },
  {
    level: 8,
    name: 'Medium Blonde',
    nameKr: 'ì¤‘ê°„ ê¸ˆë°œ',
    labRange: { L: [62, 72], a: [2, 10], b: [20, 35] },
    typicalLab: { L: 67, a: 6, b: 28 },
    hex: '#b08860',
    tone: 'warm',
    description: 'í™©ê¸ˆë¹› ê¸ˆë°œ',
    commonIn: ['ìŠ¤ì¹¸ë””ë‚˜ë¹„ì•„', 'ë°œíŠ¸í•´ ì—°ì•ˆ'],
  },
  {
    level: 9,
    name: 'Light Blonde',
    nameKr: 'ë°ì€ ê¸ˆë°œ',
    labRange: { L: [72, 85], a: [0, 6], b: [22, 38] },
    typicalLab: { L: 78, a: 3, b: 30 },
    hex: '#d0a880',
    tone: 'warm',
    description: 'ë°ì€ ìì—° ê¸ˆë°œ',
    commonIn: ['ë¶ìœ ëŸ½ ì–´ë¦°ì´', 'ìŠ¤ì¹¸ë””ë‚˜ë¹„ì•„'],
  },
  {
    level: 10,
    name: 'Lightest Blonde',
    nameKr: 'ê°€ì¥ ë°ì€ ê¸ˆë°œ',
    labRange: { L: [85, 100], a: [-2, 4], b: [15, 30] },
    typicalLab: { L: 92, a: 1, b: 22 },
    hex: '#f0d8b0',
    tone: 'neutral',
    description: 'í”Œë˜í‹°ë„˜ì— ê°€ê¹Œìš´ ë°ì€ ê¸ˆë°œ',
    commonIn: ['ë¶ìœ ëŸ½ ì–´ë¦°ì´ (í¬ê·€)'],
  },
];

interface HairLevelMock {
  level: number;
  name: string;
  nameKr: string;
  labRange: { L: [number, number]; a: [number, number]; b: [number, number] };
  typicalLab: LabColor;
  hex: string;
  tone: 'warm' | 'cool' | 'neutral';
  description: string;
  commonIn: string[];
}
```

### 6.6 ì‹œì¦Œë³„ í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ Mock ë°ì´í„°

```typescript
/**
 * ì‹œì¦Œë³„ í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ Mock ë°ì´í„°
 * ìœ„ì¹˜: tests/fixtures/hair-color-recommendations.ts
 */

export const mockSeasonHairColors: Record<Season, SeasonHairColorMock> = {
  spring: {
    season: 'spring',
    seasonLabel: 'ë´„ ì›œí†¤',
    undertone: 'warm',
    recommendedColors: [
      { name: 'Honey Brown', nameKr: 'í—ˆë‹ˆ ë¸Œë¼ìš´', hex: '#8B6914', level: 6, lab: { L: 55, a: 8, b: 35 }, matchScore: 95 },
      { name: 'Golden Blonde', nameKr: 'ê³¨ë“  ë¸”ë¡ ë“œ', hex: '#DAA520', level: 8, lab: { L: 75, a: 2, b: 45 }, matchScore: 92 },
      { name: 'Warm Chestnut', nameKr: 'ì›œ ì²´ìŠ¤íŠ¸ë„›', hex: '#954535', level: 5, lab: { L: 45, a: 15, b: 25 }, matchScore: 90 },
      { name: 'Caramel', nameKr: 'ìº¬ë¼ë©œ', hex: '#D2691E', level: 6, lab: { L: 52, a: 12, b: 38 }, matchScore: 88 },
      { name: 'Copper', nameKr: 'ì½”í¼', hex: '#B87333', level: 5, lab: { L: 48, a: 18, b: 32 }, matchScore: 85 },
    ],
    avoidColors: ['Ash Blonde', 'Platinum', 'Jet Black', 'Blue-Black'],
    coloringTips: [
      'í™©ê¸ˆë¹› í•˜ì´ë¼ì´íŠ¸ ì¶”ê°€ ì¶”ì²œ',
      'ì°¨ê°€ìš´ ì• ì‰¬ ê³„ì—´ í”¼í•˜ê¸°',
      'ë”°ëœ»í•œ êµ¬ë¦¬ë¹› í¬ì¸íŠ¸ íš¨ê³¼ì ',
    ],
  },
  summer: {
    season: 'summer',
    seasonLabel: 'ì—¬ë¦„ ì¿¨í†¤',
    undertone: 'cool',
    recommendedColors: [
      { name: 'Ash Brown', nameKr: 'ì• ì‰¬ ë¸Œë¼ìš´', hex: '#6B5B5B', level: 5, lab: { L: 45, a: 3, b: -5 }, matchScore: 94 },
      { name: 'Soft Black', nameKr: 'ì†Œí”„íŠ¸ ë¸”ë™', hex: '#2C2C2C', level: 2, lab: { L: 22, a: 0, b: -2 }, matchScore: 91 },
      { name: 'Rose Brown', nameKr: 'ë¡œì¦ˆ ë¸Œë¼ìš´', hex: '#8B6969', level: 6, lab: { L: 50, a: 10, b: -2 }, matchScore: 89 },
      { name: 'Champagne', nameKr: 'ìƒ´í˜ì¸', hex: '#F7E7CE', level: 9, lab: { L: 85, a: 2, b: 12 }, matchScore: 86 },
      { name: 'Mauve Brown', nameKr: 'ëª¨ë¸Œ ë¸Œë¼ìš´', hex: '#7B5D5D', level: 5, lab: { L: 48, a: 8, b: -3 }, matchScore: 84 },
    ],
    avoidColors: ['Orange', 'Copper', 'Golden Blonde', 'Warm Red'],
    coloringTips: [
      'í‘¸ë¥¸ ê¸°ìš´ ìˆëŠ” ì• ì‰¬ ê³„ì—´ ì¶”ì²œ',
      'ì˜¤ë Œì§€/êµ¬ë¦¬ë¹› í”¼í•˜ê¸°',
      'ë¶€ë“œëŸ¬ìš´ í•‘í¬ ì–¸ë”í†¤ íš¨ê³¼ì ',
    ],
  },
  autumn: {
    season: 'autumn',
    seasonLabel: 'ê°€ì„ ì›œí†¤',
    undertone: 'warm',
    recommendedColors: [
      { name: 'Auburn', nameKr: 'ì˜¤ë²ˆ', hex: '#A52A2A', level: 4, lab: { L: 38, a: 25, b: 20 }, matchScore: 96 },
      { name: 'Copper Brown', nameKr: 'ì½”í¼ ë¸Œë¼ìš´', hex: '#8B4513', level: 5, lab: { L: 42, a: 18, b: 28 }, matchScore: 93 },
      { name: 'Chocolate', nameKr: 'ì´ˆì½œë¦¿', hex: '#3D2314', level: 3, lab: { L: 32, a: 10, b: 15 }, matchScore: 90 },
      { name: 'Cinnamon', nameKr: 'ì‹œë‚˜ëª¬', hex: '#D2691E', level: 5, lab: { L: 48, a: 20, b: 35 }, matchScore: 88 },
      { name: 'Deep Burgundy', nameKr: 'ë”¥ ë²„ê±´ë””', hex: '#722F37', level: 3, lab: { L: 30, a: 22, b: 8 }, matchScore: 85 },
    ],
    avoidColors: ['Ash Blonde', 'Platinum', 'Blue-Black', 'Cool Pink'],
    coloringTips: [
      'ë¶‰ì€ ê¸°ìš´ ìˆëŠ” ë”°ëœ»í•œ ìƒ‰ìƒ ì¶”ì²œ',
      'ì°¨ê°€ìš´ ì• ì‰¬/ë¸”ë£¨ ê³„ì—´ í”¼í•˜ê¸°',
      'ê¹Šê³  í’ë¶€í•œ í†¤ íš¨ê³¼ì ',
    ],
  },
  winter: {
    season: 'winter',
    seasonLabel: 'ê²¨ìš¸ ì¿¨í†¤',
    undertone: 'cool',
    recommendedColors: [
      { name: 'Espresso', nameKr: 'ì—ìŠ¤í”„ë ˆì†Œ', hex: '#3C280D', level: 2, lab: { L: 20, a: 5, b: 10 }, matchScore: 95 },
      { name: 'Blue-Black', nameKr: 'ë¸”ë£¨ ë¸”ë™', hex: '#1A1A2E', level: 1, lab: { L: 12, a: -2, b: -8 }, matchScore: 93 },
      { name: 'Cool Dark Brown', nameKr: 'ì¿¨ ë‹¤í¬ ë¸Œë¼ìš´', hex: '#4A3728', level: 3, lab: { L: 28, a: 4, b: 5 }, matchScore: 90 },
      { name: 'Platinum', nameKr: 'í”Œë˜í‹°ë„˜', hex: '#E5E4E2', level: 10, lab: { L: 92, a: 0, b: -2 }, matchScore: 88 },
      { name: 'Burgundy', nameKr: 'ë²„ê±´ë””', hex: '#800020', level: 3, lab: { L: 25, a: 30, b: 5 }, matchScore: 85 },
    ],
    avoidColors: ['Golden Blonde', 'Copper', 'Orange-Red', 'Warm Caramel'],
    coloringTips: [
      'ì„ ëª…í•œ ëŒ€ë¹„ íš¨ê³¼ì ',
      'ë”°ëœ»í•œ ì˜¤ë Œì§€/ê³¨ë“œ ê³„ì—´ í”¼í•˜ê¸°',
      'ìˆœìˆ˜í•œ ìƒ‰ìƒ (true colors) ì¶”ì²œ',
    ],
  },
};

interface SeasonHairColorMock {
  season: Season;
  seasonLabel: string;
  undertone: 'warm' | 'cool';
  recommendedColors: {
    name: string;
    nameKr: string;
    hex: string;
    level: number;
    lab: LabColor;
    matchScore: number;
  }[];
  avoidColors: string[];
  coloringTips: string[];
}
```

---

## 7. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 7.0 ìƒì„¸ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë° ì—ëŸ¬ í•¸ë“¤ë§

> **v2.3 ì¶”ê°€**: P3 ì›ì¹™ì— ë”°ë¥¸ ìƒì„¸ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì™€ ì—ëŸ¬ í•¸ë“¤ë§ ì‹œë‚˜ë¦¬ì˜¤

#### 7.0.1 Happy Path í…ŒìŠ¤íŠ¸ (Expected Values)

| TC-ID | í…ŒìŠ¤íŠ¸ëª… | ì…ë ¥ | Expected Value | í—ˆìš© ì˜¤ì°¨ | ê²€ì¦ ê³µì‹ |
|-------|----------|------|----------------|----------|----------|
| **H1-HP01** | ê³„ë€í˜• ì–¼êµ´ ë¹„ìœ¨ | `widthToHeight: 0.67` | `faceShape: 'oval'` | - | 0.60 â‰¤ w/h â‰¤ 0.75 |
| **H1-HP02** | ë‘¥ê·¼í˜• ì–¼êµ´ ë¹„ìœ¨ | `widthToHeight: 0.95` | `faceShape: 'round'` | - | w/h > 0.90 |
| **H1-HP03** | ê¸´í˜• ì–¼êµ´ ë¹„ìœ¨ | `widthToHeight: 0.50` | `faceShape: 'oblong'` | - | w/h < 0.55 |
| **H1-HP04** | ê²€ì • í—¤ì–´ Lab ë¶„ë¥˜ | `L: 20, a: 1, b: 2` | `category: 'black'` | L* Â±5 | L* < 25 |
| **H1-HP05** | ë¸Œë¼ìš´ í—¤ì–´ Lab ë¶„ë¥˜ | `L: 35, a: 8, b: 20` | `category: 'brown'` | Î”E â‰¤ 5 | a* 5-15, b* 15-30 |
| **H1-HP06** | ì• ì‰¬í†¤ Lab ë¶„ë¥˜ | `L: 45, a: 0, b: -2` | `category: 'ash'` | b* Â±3 | b* < 0 |
| **H1-HP07** | ë ˆë“œí†¤ Lab ë¶„ë¥˜ | `L: 40, a: 22, b: 20` | `category: 'red'` | a* Â±5 | a* > 20 |
| **H1-HP08** | ë¹„ë¹„ë“œ ì—¼ìƒ‰ Lab ë¶„ë¥˜ | `L: 50, a: 40, b: -20` | `category: 'dyed-vivid'` | - | ìì—° ë²”ìœ„ ì´ˆê³¼ |
| **H1-HP09** | ë‘í”¼ ê±´ê°• ì ìˆ˜ | `oilLevel: 40, hydration: 60` | `scalpScore: 70-80` | Â±5 | (100 - oilPenalty + hydration) / 2 |
| **H1-HP10** | ëª¨ë°œ êµµê¸° íŒì • | `diameter: 70Î¼m` | `thickness: 'medium'` | Â±5Î¼m | 60-80Î¼m = medium |
| **H1-HP11** | ì†ìƒë„ ì ìˆ˜ | `cuticleIntegrity: 80` | `damageLevel: 'low'` | - | 70-100 = low |
| **H1-HP12** | ì¢…í•© ì ìˆ˜ ê³„ì‚° | 6ê°œ ë©”íŠ¸ë¦­ í‰ê·  | `overallScore: 72` | Â±3 | Î£metrics / 6 |

#### 7.0.2 Edge Case í…ŒìŠ¤íŠ¸

| TC-ID | ì‹œë‚˜ë¦¬ì˜¤ | ì…ë ¥ | Expected Behavior | ë¹„ê³  |
|-------|----------|------|-------------------|------|
| **H1-E01** | null ì´ë¯¸ì§€ ì…ë ¥ | `imageBase64: null` | `ValidationError`, code: `NO_IMAGE` | HTTP 400 |
| **H1-E02** | ë¹ˆ ë¬¸ìì—´ ì´ë¯¸ì§€ | `imageBase64: ''` | `ValidationError`, code: `NO_IMAGE` | HTTP 400 |
| **H1-E03** | ì˜ëª»ëœ Base64 í˜•ì‹ | `imageBase64: 'invalid-base64'` | `ValidationError`, code: `INVALID_IMAGE_FORMAT` | HTTP 400 |
| **H1-E04** | ìµœì†Œ í•´ìƒë„ ë¯¸ë‹¬ | `50x50px` ì´ë¯¸ì§€ | `ValidationError`, code: `IMAGE_TOO_SMALL` | ìµœì†Œ 320x240 |
| **H1-E05** | ìµœëŒ€ í•´ìƒë„ ì´ˆê³¼ | `10000x10000px` ì´ë¯¸ì§€ | ë‹¤ìš´ìƒ˜í”Œë§ í›„ ì²˜ë¦¬ | ë‚´ë¶€ ë¦¬ì‚¬ì´ì¦ˆ |
| **H1-E06** | í˜¼í•©í˜• ì–¼êµ´ (ê¸´í˜•+ì‚¬ê°) | `w/h: 0.58, jawAngle: 145` | 1ìˆœìœ„: `oblong`, 2ìˆœìœ„: `square`, ì‹ ë¢°ë„ 70-75 | ë³µí•© íŒì • |
| **H1-E07** | í˜¼í•©í˜• ì–¼êµ´ (ê³„ë€+í•˜íŠ¸) | `w/h: 0.68, foreheadToJaw: 1.35` | 1ìˆœìœ„: `heart`, 2ìˆœìœ„: `oval`, ì‹ ë¢°ë„ 65-75 | ë³µí•© íŒì • |
| **H1-E08** | ë¨¸ë¦¬ì¹´ë½ìœ¼ë¡œ ìœ¤ê³½ ê°€ë¦¼ | ì´ë§ˆ/í„± ëœë“œë§ˆí¬ ë¯¸ê°ì§€ | `confidence: 50-60`, `warning: 'partial_occlusion'` | ë¶€ë¶„ ë¶„ì„ |
| **H1-E09** | ì¸¡ë©´ ì–¼êµ´ (>30ë„) | ì •ë©´ì´ ì•„ë‹Œ ì´ë¯¸ì§€ | `ValidationError`, code: `FACE_ANGLE_EXCEEDED` | ì •ë©´ ìš”êµ¬ |
| **H1-E10** | ë‹¤ì¤‘ ì–¼êµ´ ê°ì§€ | 2ëª… ì´ìƒ ì–¼êµ´ | ê°€ì¥ í° ì–¼êµ´ë§Œ ë¶„ì„, `warning: 'multiple_faces'` | ì²« ë²ˆì§¸ ì–¼êµ´ |
| **H1-E11** | ì–¼êµ´ ë¯¸ê°ì§€ | í’ê²½/ë¬¼ì²´ ì´ë¯¸ì§€ | `ValidationError`, code: `NO_FACE_DETECTED` | HTTP 400 |
| **H1-E12** | í—¤ì–´ ë¯¸ê°ì§€ | ëŒ€ë¨¸ë¦¬/ëª¨ì ì°©ìš© | `hairType: null`, `warning: 'no_hair_detected'` | ë¶€ë¶„ ê²°ê³¼ ë°˜í™˜ |
| **H1-E13** | ê·¹ë‹¨ Lab ê°’ | `L: 0, a: 0, b: 0` | `category: 'black'`, `confidence: 100` | ì™„ì „ ê²€ì • |
| **H1-E14** | ê·¹ë‹¨ Lab ê°’ | `L: 100, a: 0, b: 0` | `category: 'blonde'` ë˜ëŠ” `'dyed-vivid'` | ì™„ì „ ë°ìŒ |
| **H1-E15** | ë™ì‹œ ì˜µì…˜ ì¶©ëŒ | `useMock: true, forceAI: true` | `useMock` ìš°ì„ , AI í˜¸ì¶œ ìŠ¤í‚µ | ì˜µì…˜ ìš°ì„ ìˆœìœ„ |

#### 7.0.3 ì—ëŸ¬ í•¸ë“¤ë§ ì‹œë‚˜ë¦¬ì˜¤

##### ë¶€ë¶„ ì‹¤íŒ¨ ì²˜ë¦¬

| ì‹œë‚˜ë¦¬ì˜¤ | ê°ì§€ ì¡°ê±´ | ì²˜ë¦¬ ë°©ë²• | ì‚¬ìš©ì ì•ˆë‚´ |
|----------|----------|----------|------------|
| ì–¼êµ´í˜• ë¶„ì„ ì‹¤íŒ¨ | ëœë“œë§ˆí¬ < 300ê°œ ê°ì§€ | í—¤ì–´ì»¬ëŸ¬/ë‘í”¼ë§Œ ë¶„ì„ ë°˜í™˜ | "ì–¼êµ´í˜• ë¶„ì„ì„ ì™„ë£Œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì •ë©´ ì‚¬ì§„ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." |
| í—¤ì–´ì»¬ëŸ¬ ì¶”ì¶œ ì‹¤íŒ¨ | í—¤ì–´ ì˜ì—­ < 5% | Mock ì»¬ëŸ¬ ì‚¬ìš©, `usedFallback: true` | "í—¤ì–´ ìƒ‰ìƒì„ ì •í™•íˆ ì¶”ì¶œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." |
| ë‘í”¼ ë¶„ì„ ì‹¤íŒ¨ | ë‘í”¼ ì˜ì—­ ë¯¸ë…¸ì¶œ | ë‘í”¼ ì ìˆ˜ null, ë‚˜ë¨¸ì§€ ë°˜í™˜ | "ë‘í”¼ ìƒíƒœëŠ” ë¶„ì„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤." |
| PC-1 ì—°ë™ ì‹¤íŒ¨ | personalColorId ì¡°íšŒ ì‹¤íŒ¨ | ì‹œì¦Œ ì¡°í™” ì—†ì´ ë°˜í™˜ | "í¼ìŠ¤ë„ì»¬ëŸ¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." |
| N-1 ì•Œë¦¼ ìƒì„± ì‹¤íŒ¨ | DB insert ì‹¤íŒ¨ | ë¶„ì„ ê²°ê³¼ëŠ” ë°˜í™˜, ì•Œë¦¼ë§Œ ìŠ¤í‚µ | ë¡œê·¸ ê¸°ë¡, ì‚¬ìš©ì ë¯¸ë…¸ì¶œ |

##### Graceful Fallback ì „ëµ

| ì‹¤íŒ¨ ìœ í˜• | Fallback ë™ì‘ | ì‹ ë¢°ë„ ì¡°ì • | ì•Œë¦¼ |
|----------|--------------|------------|------|
| **AI íƒ€ì„ì•„ì›ƒ (3ì´ˆ)** | Mock ê²°ê³¼ ë°˜í™˜, `usedMock: true` | `analysisReliability: 'medium'` | "AI ë¶„ì„ì´ ì§€ì—°ë˜ì–´ ê¸°ë³¸ ê²°ê³¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤." |
| **AI ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨** | Mock ê²°ê³¼ ë°˜í™˜ | `analysisReliability: 'medium'` | "ë¶„ì„ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ì§€ ëª»í•´ ê¸°ë³¸ ê²°ê³¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤." |
| **Gemini API ì˜¤ë¥˜** | Mock ê²°ê³¼ ë°˜í™˜ | `analysisReliability: 'low'` | "ì¼ì‹œì ì¸ ë¬¸ì œë¡œ ê¸°ë³¸ ê²°ê³¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤." |
| **Rate Limit ì´ˆê³¼** | 429 ì—ëŸ¬ ë°˜í™˜, Fallback ì—†ìŒ | - | "ì¼ì¼ ë¶„ì„ í•œë„ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤." |
| **DB ì €ì¥ ì‹¤íŒ¨** | ê²°ê³¼ ë°˜í™˜, ì €ì¥ ì¬ì‹œë„ í | ë³€ë™ ì—†ìŒ | ë¡œê·¸ë§Œ ê¸°ë¡ |

##### ì‚¬ìš©ì ì„ íƒ í”Œë¡œìš°

| ìƒí™© | ì„ íƒì§€ A | ì„ íƒì§€ B | ê¸°ë³¸ê°’ |
|------|---------|---------|--------|
| ë¨¸ë¦¬ì¹´ë½ìœ¼ë¡œ ì–¼êµ´ ê°€ë¦¼ | "ê·¸ëŒ€ë¡œ ì§„í–‰" â†’ ë‚®ì€ ì‹ ë¢°ë„ | "ë‹¤ì‹œ ì´¬ì˜" â†’ ì¬ì‹œë„ | A (ì§„í–‰) |
| ì¸¡ë©´ ê°ë„ ê°ì§€ | "ê°•ì œ ë¶„ì„" â†’ ë‚®ì€ ì‹ ë¢°ë„ | "ì •ë©´ìœ¼ë¡œ ì¬ì´¬ì˜" | B (ì¬ì´¬ì˜) |
| ë‹¤ì¤‘ ì–¼êµ´ ê°ì§€ | "ì²« ë²ˆì§¸ ì–¼êµ´ ë¶„ì„" | "ì–¼êµ´ ì„ íƒ" â†’ í„°ì¹˜ë¡œ ì„ íƒ | A (ì²« ë²ˆì§¸) |
| Mock ê²°ê³¼ ìˆ˜ì‹  | "ê²°ê³¼ í™•ì¸" | "ì‹¤ì œ ë¶„ì„ ì¬ì‹œë„" | A (í™•ì¸) |

---

### 7.1 í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ìš”ì•½í‘œ

#### 7.1.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

| ID | í…ŒìŠ¤íŠ¸ëª… | ì…ë ¥ | ì˜ˆìƒ ì¶œë ¥ | ê²€ì¦ ì¡°ê±´ |
|----|----------|------|----------|----------|
| H1-U01 | ê³„ë€í˜• ì–¼êµ´ ë¶„ë¥˜ | `widthToHeight: 0.67` | `faceShape: 'oval'` | confidence > 80 |
| H1-U02 | ë‘¥ê·¼í˜• ì–¼êµ´ ë¶„ë¥˜ | `widthToHeight: 0.95` | `faceShape: 'round'` | ì •í™•í•œ íƒ€ì… ë°˜í™˜ |
| H1-U03 | ì‚¬ê°í˜• ì–¼êµ´ ë¶„ë¥˜ | `jawAngle: 145` | `faceShape: 'square'` | í„±ì„  ê°ë„ ê¸°ë°˜ |
| H1-U04 | í•˜íŠ¸í˜• ì–¼êµ´ ë¶„ë¥˜ | `foreheadToJaw: 1.4` | `faceShape: 'heart'` | ì´ë§ˆ:í„± ë¹„ìœ¨ |
| H1-U05 | ê²€ì • í—¤ì–´ ìƒ‰ìƒ ë¶„ë¥˜ | `L: 20, a: 1, b: 2` | `category: 'black'` | L* < 25 |
| H1-U06 | ì• ì‰¬í†¤ ìƒ‰ìƒ ë¶„ë¥˜ | `L: 45, a: 0, b: -2` | `category: 'ash'` | b* < 0 |
| H1-U07 | ë ˆë“œí†¤ ìƒ‰ìƒ ë¶„ë¥˜ | `L: 40, a: 22, b: 20` | `category: 'red'` | a* > 20 |
| H1-U08 | ë¹„ë¹„ë“œ ì—¼ìƒ‰ ë¶„ë¥˜ | `L: 50, a: 40, b: -20` | `category: 'dyed-vivid'` | ìì—° ë²”ìœ„ ì´ˆê³¼ |
| H1-U09 | ë‘¥ê·¼í˜• í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ | `faceShape: 'round'` | `styles.length > 0` | ì„¸ë¡œ ë¼ì¸ ìŠ¤íƒ€ì¼ |
| H1-U10 | ê³„ë€í˜• í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ | `faceShape: 'oval'` | `matchScore > 90` | ëŒ€ë¶€ë¶„ ìŠ¤íƒ€ì¼ ì í•© |
| H1-U11 | ì‚¬ê°í˜• ë¶€ë“œëŸ¬ìš´ ìŠ¤íƒ€ì¼ | `faceShape: 'square'` | ì›¨ì´ë¸Œ/ì†Œí”„íŠ¸ í¬í•¨ | ê°ì§„ ë¶€ë¶„ ì™„í™” |
| H1-U12 | ë´„ ì›œí†¤ í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ | `season: 'spring'` | ì›œ/ê³¨ë“œ/í—ˆë‹ˆ í†¤ | í¼ìŠ¤ë„ì»¬ëŸ¬ ì—°ë™ |
| H1-U13 | ì—¬ë¦„ ì¿¨í†¤ í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ | `season: 'summer'` | ì• ì‰¬í†¤ í¬í•¨ | ì¿¨í†¤ ìƒ‰ìƒ |
| H1-U14 | ê²¨ìš¸ ì¿¨í†¤ í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ | `season: 'winter'` | ì—ìŠ¤í”„ë ˆì†Œ ê³„ì—´ | ì‹œì¦Œ í˜¸í™˜ì„± |
| H1-U15 | Mock ê²°ê³¼ êµ¬ì¡° ê²€ì¦ | - | ìœ íš¨í•œ êµ¬ì¡° | ëª¨ë“  í•„ìˆ˜ í•„ë“œ |
| H1-U16 | Mock ë©”íŠ¸ë¦­ ìƒíƒœ ê²€ì¦ | - | `status âˆˆ {good,normal,warning}` | ê°’ ë²”ìœ„ 0-100 |

#### 7.1.2 í†µí•© í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

| ID | í…ŒìŠ¤íŠ¸ëª… | ì…ë ¥ | ì˜ˆìƒ ì¶œë ¥ | ê²€ì¦ ì¡°ê±´ |
|----|----------|------|----------|----------|
| H1-I01 | í—¤ì–´ ì´ë¯¸ì§€ ë¶„ì„ ì„±ê³µ | `imageBase64` + ì˜µì…˜ | `status: 200` | result í•„ë“œ ì¡´ì¬ |
| H1-I02 | AI ì‹¤íŒ¨ ì‹œ Mock Fallback | AI íƒ€ì„ì•„ì›ƒ | `usedMock: true` | reliability: 'medium' |
| H1-I03 | ì´ë¯¸ì§€ ì—†ìŒ ì—ëŸ¬ | `body: {}` | `status: 400` | NO_IMAGE ì—ëŸ¬ |
| H1-I04 | N-1 í¬ë¡œìŠ¤ ëª¨ë“ˆ ì•Œë¦¼ | ë‘í”¼ ì ìˆ˜ < 70 | `alerts.length > 0` | source: 'H-1', target: 'N-1' |
| H1-I05 | ë¶„ì„ XP ë¶€ì—¬ | ì„±ê³µì  ë¶„ì„ | `xpAwarded: 10` | gamification í•„ë“œ |
| H1-I06 | Rate Limit ì´ˆê³¼ | 50íšŒ ì´ˆê³¼ ìš”ì²­ | `status: 429` | ìš”ì²­ ì œí•œ |
| H1-I07 | ë¶„ì„ íˆìŠ¤í† ë¦¬ ì¡°íšŒ | GET ìš”ì²­ | `status: 200` | ë°°ì—´ ë°˜í™˜ |
| H1-I08 | ë¯¸ì¸ì¦ ìš”ì²­ ê±°ë¶€ | userId: null | `status: 401` | UNAUTHORIZED |

#### 7.1.3 ì—ëŸ¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

| ID | í…ŒìŠ¤íŠ¸ëª… | ì…ë ¥ ì¡°ê±´ | ì˜ˆìƒ ì—ëŸ¬ | HTTP ìƒíƒœ |
|----|----------|----------|----------|----------|
| H1-E01 | ì´ë¯¸ì§€ ì—†ìŒ | imageBase64 ëˆ„ë½ | NO_IMAGE | 400 |
| H1-E02 | ì˜ëª»ëœ ì´ë¯¸ì§€ í˜•ì‹ | `text/plain` í˜•ì‹ | INVALID_IMAGE_FORMAT | 400 |
| H1-E03 | ì´ë¯¸ì§€ í•´ìƒë„ ë¶€ì¡± | 50x50px ì´ë¯¸ì§€ | IMAGE_TOO_SMALL | 400 |
| H1-E04 | ì¸ì¦ ì‹¤íŒ¨ | í† í° ì—†ìŒ | UNAUTHORIZED | 401 |
| H1-E05 | Rate Limit ì´ˆê³¼ | ì¼ì¼ 50íšŒ ì´ˆê³¼ | RATE_LIMIT_EXCEEDED | 429 |
| H1-E06 | AI ì„œë¹„ìŠ¤ íƒ€ì„ì•„ì›ƒ | Gemini 10ì´ˆ ì´ˆê³¼ | AI_TIMEOUT | 504 |
| H1-E07 | í—¤ì–´ ë¯¸ê°ì§€ | í—¤ì–´ ì—†ëŠ” ì´ë¯¸ì§€ | NO_HAIR_DETECTED | 400 |
| H1-E08 | ì–¼êµ´ ë¯¸ê°ì§€ | ì–¼êµ´ ì—†ëŠ” ì´ë¯¸ì§€ | NO_FACE_DETECTED | 400 |
| H1-E09 | ì˜ëª»ëœ UUID | ìœ íš¨í•˜ì§€ ì•Šì€ personalColorId | VALIDATION_ERROR | 400 |

### 7.2 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œ

```typescript
// tests/lib/analysis/hair/hair-analysis.test.ts
import { describe, it, expect, vi } from 'vitest';
import {
  generateMockHairAnalysisResult,
  classifyFaceShape,
  classifyHairColor,
  recommendHairStyles,
  recommendHairColors,
} from '@/lib/analysis/hair';
import {
  mockHairAnalysisInput,
  mockHairResultNormal,
  mockHairResultMinimum,
  mockHairResultMaximum,
  mockHairResultFallback,
} from '@/tests/fixtures/hair-analysis';

describe('H-1 Hair Analysis', () => {
  describe('ì–¼êµ´í˜• ë¶„ë¥˜ (classifyFaceShape)', () => {
    it('H1-U01: should classify oval face correctly', () => {
      const ratios = { widthToHeight: 0.67, foreheadToJaw: 1.0, cheekToForehead: 1.0 };
      const result = classifyFaceShape(ratios);
      expect(result.faceShape).toBe('oval');
      expect(result.confidence).toBeGreaterThan(80);
    });

    it('H1-U02: should classify round face correctly', () => {
      const ratios = { widthToHeight: 0.95, foreheadToJaw: 1.0, cheekToForehead: 1.0 };
      const result = classifyFaceShape(ratios);
      expect(result.faceShape).toBe('round');
    });

    it('H1-U03: should classify square face correctly', () => {
      const ratios = { widthToHeight: 0.85, foreheadToJaw: 1.0, jawAngle: 145 };
      const result = classifyFaceShape(ratios);
      expect(result.faceShape).toBe('square');
    });

    it('H1-U04: should classify heart face correctly', () => {
      const ratios = { widthToHeight: 0.7, foreheadToJaw: 1.4, cheekToForehead: 0.9 };
      const result = classifyFaceShape(ratios);
      expect(result.faceShape).toBe('heart');
    });
  });

  describe('í—¤ì–´ì»¬ëŸ¬ ë¶„ë¥˜ (classifyHairColor)', () => {
    it('H1-U05: should classify black hair correctly', () => {
      const blackHairLab = { L: 20, a: 1, b: 2 };
      const result = classifyHairColor(blackHairLab);
      expect(result).toBe('black');
    });

    it('H1-U06: should classify ash tones by low b* value', () => {
      const ashLab = { L: 45, a: 0, b: -2 };
      const result = classifyHairColor(ashLab);
      expect(result).toBe('ash');
    });

    it('H1-U07: should classify red tones by high a* value', () => {
      const redLab = { L: 40, a: 22, b: 20 };
      const result = classifyHairColor(redLab);
      expect(result).toBe('red');
    });

    it('H1-U08: should classify vivid dyed hair when out of natural ranges', () => {
      const vividLab = { L: 50, a: 40, b: -20 };
      const result = classifyHairColor(vividLab);
      expect(result).toBe('dyed-vivid');
    });
  });

  describe('í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ (recommendHairStyles)', () => {
    it('H1-U09: should recommend layered styles for round face', () => {
      const recommendations = recommendHairStyles('round');
      expect(recommendations.length).toBeGreaterThan(0);
      expect(recommendations[0].suitableFaceShapes).toContain('round');
    });

    it('H1-U10: should recommend most styles for oval face', () => {
      const recommendations = recommendHairStyles('oval');
      expect(recommendations[0].matchScore).toBeGreaterThan(90);
    });

    it('H1-U11: should recommend soft waves for square face', () => {
      const recommendations = recommendHairStyles('square');
      const hasSoftStyle = recommendations.some(r =>
        r.styleName.toLowerCase().includes('wave') ||
        r.styleName.toLowerCase().includes('soft')
      );
      expect(hasSoftStyle).toBe(true);
    });
  });

  describe('í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ (recommendHairColors)', () => {
    it('H1-U12: should recommend warm tones for spring type', () => {
      const pcResult = { season: 'spring' as const, undertone: 'warm' as const };
      const currentHair = { dominant: { L: 25, a: 2, b: 3 }, category: 'black' as const };
      const recommendations = recommendHairColors(pcResult, currentHair);

      expect(recommendations[0].colorNameKr).toMatch(/ì›œ|ê³¨ë“œ|í—ˆë‹ˆ/);
    });

    it('H1-U13: should recommend ash tones for summer type', () => {
      const pcResult = { season: 'summer' as const, undertone: 'cool' as const };
      const currentHair = { dominant: { L: 25, a: 2, b: 3 }, category: 'black' as const };
      const recommendations = recommendHairColors(pcResult, currentHair);

      const hasAsh = recommendations.some(r => r.colorName.includes('Ash'));
      expect(hasAsh).toBe(true);
    });

    it('H1-U14: should recommend cool espresso for winter type', () => {
      const pcResult = { season: 'winter' as const, undertone: 'cool' as const };
      const currentHair = { dominant: { L: 25, a: 2, b: 3 }, category: 'black' as const };
      const recommendations = recommendHairColors(pcResult, currentHair);

      expect(recommendations.length).toBeGreaterThan(0);
      expect(recommendations[0].seasonCompatibility).toContain('winter');
    });
  });

  describe('Mock ê²°ê³¼ ê²€ì¦', () => {
    it('H1-U15: should return valid structure', () => {
      const result = generateMockHairAnalysisResult();

      expect(result.faceShape).toMatch(/oval|round|oblong|square|heart|diamond|triangle/);
      expect(result.hairType).toMatch(/straight|wavy|curly|coily/);
      expect(result.metrics.length).toBe(6);
      expect(result.overallScore).toBeGreaterThanOrEqual(0);
      expect(result.overallScore).toBeLessThanOrEqual(100);
      expect(result.recommendedHairStyles?.length).toBeGreaterThan(0);
    });

    it('H1-U16: should generate metrics with valid status', () => {
      const result = generateMockHairAnalysisResult();

      result.metrics.forEach(metric => {
        expect(metric.status).toMatch(/good|normal|warning/);
        expect(metric.value).toBeGreaterThanOrEqual(0);
        expect(metric.value).toBeLessThanOrEqual(100);
      });
    });

    it('should validate normal mock structure', () => {
      expect(mockHairResultNormal.overallScore).toBe(72);
      expect(mockHairResultNormal.analysisReliability).toBe('high');
    });

    it('should validate minimum mock boundaries', () => {
      expect(mockHairResultMinimum.overallScore).toBeLessThanOrEqual(30);
      expect(mockHairResultMinimum.concerns.length).toBeGreaterThan(3);
    });

    it('should validate maximum mock boundaries', () => {
      expect(mockHairResultMaximum.overallScore).toBeGreaterThanOrEqual(90);
      expect(mockHairResultMaximum.concerns.length).toBe(0);
    });

    it('should validate fallback mock reliability', () => {
      expect(mockHairResultFallback.analysisReliability).toBe('medium');
    });
  });
});
```

### 7.2 í†µí•© í…ŒìŠ¤íŠ¸

```typescript
// tests/api/analyze/hair.test.ts
import { describe, it, expect, beforeAll, afterAll, vi } from 'vitest';
import { POST, GET } from '@/app/api/analyze/hair/route';
import { createMockRequest } from '@/tests/utils/mock-request';

describe('H-1 API Integration', () => {
  const testUserId = 'user_test_123';
  const testImageBase64 = 'data:image/jpeg;base64,/9j/4AAQSkZJRg...';

  beforeAll(() => {
    vi.mock('@clerk/nextjs/server', () => ({
      auth: () => Promise.resolve({ userId: testUserId }),
    }));
  });

  afterAll(() => {
    vi.restoreAllMocks();
  });

  describe('POST /api/analyze/hair', () => {
    it('should analyze hair image successfully', async () => {
      const req = createMockRequest({
        method: 'POST',
        body: {
          imageBase64: testImageBase64,
          includeFaceShapeAnalysis: true,
        },
      });

      const response = await POST(req);
      const data = await response.json();

      expect(response.status).toBe(200);
      expect(data.success).toBe(true);
      expect(data.result.hairType).toBeDefined();
      expect(data.result.faceShape).toBeDefined();
      expect(data.result.metrics.length).toBe(6);
    });

    it('should fall back to mock when AI fails', async () => {
      vi.mock('@/lib/gemini', () => ({
        analyzeHair: () => Promise.reject(new Error('AI timeout')),
      }));

      const req = createMockRequest({
        method: 'POST',
        body: { imageBase64: testImageBase64 },
      });

      const response = await POST(req);
      const data = await response.json();

      expect(data.usedMock).toBe(true);
      expect(data.result).toBeDefined();
      expect(data.result.analysisReliability).toBe('medium');
    });

    it('should return error for missing image', async () => {
      const req = createMockRequest({
        method: 'POST',
        body: {},
      });

      const response = await POST(req);
      expect(response.status).toBe(400);
    });

    it('should generate cross-module alerts for N-1', async () => {
      const req = createMockRequest({
        method: 'POST',
        body: {
          imageBase64: testImageBase64,
          useMock: true,
        },
      });

      const response = await POST(req);
      const data = await response.json();

      // ë‘í”¼ ê±´ê°• ì ìˆ˜ê°€ ë‚®ìœ¼ë©´ ì•Œë¦¼ ìƒì„±
      expect(data.alerts).toBeDefined();
      if (data.result.metrics.find((m: any) => m.id === 'scalp')?.value < 70) {
        expect(data.alerts.length).toBeGreaterThan(0);
        expect(data.alerts[0].source).toBe('H-1');
        expect(data.alerts[0].target).toBe('N-1');
      }
    });

    it('should award XP on successful analysis', async () => {
      const req = createMockRequest({
        method: 'POST',
        body: {
          imageBase64: testImageBase64,
          useMock: true,
        },
      });

      const response = await POST(req);
      const data = await response.json();

      expect(data.gamification.xpAwarded).toBe(10);
    });

    it('should respect rate limits', async () => {
      // 50íšŒ ì´ìƒ ìš”ì²­ ì‹œ 429 ë°˜í™˜
      vi.mock('@/lib/security/rate-limit', () => ({
        applyRateLimit: () => ({
          success: false,
          response: new Response(JSON.stringify({ error: 'Rate limit exceeded' }), { status: 429 }),
        }),
      }));

      const req = createMockRequest({
        method: 'POST',
        body: { imageBase64: testImageBase64 },
      });

      const response = await POST(req);
      expect(response.status).toBe(429);
    });
  });

  describe('GET /api/analyze/hair', () => {
    it('should return user hair analysis history', async () => {
      const req = createMockRequest({ method: 'GET' });

      const response = await GET(req);
      const data = await response.json();

      expect(response.status).toBe(200);
      expect(data.success).toBe(true);
      expect(Array.isArray(data.data)).toBe(true);
    });

    it('should return unauthorized for unauthenticated requests', async () => {
      vi.mock('@clerk/nextjs/server', () => ({
        auth: () => Promise.resolve({ userId: null }),
      }));

      const req = createMockRequest({ method: 'GET' });
      const response = await GET(req);

      expect(response.status).toBe(401);
    });
  });
});
```

### 7.3 E2E í…ŒìŠ¤íŠ¸

```typescript
// e2e/hair-analysis.spec.ts
import { test, expect } from '@playwright/test';

test.describe('H-1 Hair Analysis Flow', () => {
  test.beforeEach(async ({ page }) => {
    // ë¡œê·¸ì¸
    await page.goto('/sign-in');
    await page.fill('[name="email"]', 'test@example.com');
    await page.fill('[name="password"]', 'password123');
    await page.click('button[type="submit"]');
    await page.waitForURL('/dashboard');
  });

  test('should complete hair analysis flow', async ({ page }) => {
    await page.goto('/analysis/hair');

    // ì´ë¯¸ì§€ ì—…ë¡œë“œ
    const fileInput = page.locator('input[type="file"]');
    await fileInput.setInputFiles('tests/fixtures/hair-sample.jpg');

    // ë¶„ì„ ì‹œì‘
    await page.click('button:has-text("ë¶„ì„ ì‹œì‘")');

    // ë¡œë”© ëŒ€ê¸°
    await page.waitForSelector('[data-testid="analysis-result"]', {
      timeout: 30000,
    });

    // ê²°ê³¼ í™•ì¸
    await expect(page.locator('[data-testid="face-shape"]')).toBeVisible();
    await expect(page.locator('[data-testid="hair-type"]')).toBeVisible();
    await expect(page.locator('[data-testid="scalp-type"]')).toBeVisible();
    await expect(page.locator('[data-testid="overall-score"]')).toBeVisible();

    // í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ í™•ì¸
    await expect(page.locator('[data-testid="hair-style-recommendations"]')).toBeVisible();
  });

  test('should show fallback message when using mock', async ({ page }) => {
    await page.goto('/analysis/hair?useMock=true');

    const fileInput = page.locator('input[type="file"]');
    await fileInput.setInputFiles('tests/fixtures/hair-sample.jpg');
    await page.click('button:has-text("ë¶„ì„ ì‹œì‘")');

    await page.waitForSelector('[data-testid="analysis-result"]');

    // Mock ì‚¬ìš© ì•Œë¦¼ í™•ì¸
    await expect(page.locator('[data-testid="mock-notice"]')).toBeVisible();
  });
});
```

---

## 8. P3 ì›ì ë¶„í•´

> ì°¸ì¡°: [00-first-principles.md](../../.claude/rules/00-first-principles.md) P3 ì›ì¹™

### 8.1 ì›ì ê°œìš”

| ID | ì›ìëª… | ì†Œìš”ì‹œê°„ | ì˜ì¡´ì„± | ë³‘ë ¬ ê°€ëŠ¥ |
|----|--------|----------|--------|----------|
| **H-1.1** | ì–¼êµ´í˜• ë¶„ì„ | 2h | CIE-2 | No (ì‹œì‘ì ) |
| **H-1.2** | í—¤ì–´ì»¬ëŸ¬ Lab ë¶„ë¥˜ | 2h | H-1.1 | No |
| **H-1.3** | ëª¨ë°œ íƒ€ì… ë¶„ë¥˜ | 1h | ì—†ìŒ | Yes (H-1.2ì™€) |
| **H-1.4** | ë‘í”¼ ìƒíƒœ ë¶„ì„ | 2h | ì—†ìŒ | Yes (H-1.2ì™€) |
| **H-1.5** | í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ | 2h | H-1.1, H-1.3 | No |
| **H-1.6** | Mock Fallback | 1h | ì—†ìŒ | Yes |
| **H-1.7** | API í†µí•© | 2h | H-1.1~H-1.6 | No (ìµœì¢…) |

---

### 8.2 ì›ì ìƒì„¸ ì •ì˜

#### H-1.1: ì–¼êµ´í˜• ë¶„ì„

**ì†Œìš”ì‹œê°„**: 2ì‹œê°„
**ì˜ì¡´ì„±**: CIE-2 (468í¬ì¸íŠ¸ ì–¼êµ´ ëœë“œë§ˆí¬)

**ì…ë ¥**:
```typescript
interface FaceShapeInput {
  imageData: ImageData;
  landmarks: FaceLandmark[]; // CIE-2ì—ì„œ ì œê³µ
}

interface FaceLandmark {
  x: number;
  y: number;
  z?: number;
}
```

**ì¶œë ¥**:
```typescript
interface FaceShapeResult {
  faceShape: FaceShapeId;       // 7ì¢…: oval, round, oblong, square, heart, diamond, triangle
  faceShapeLabel: string;       // í•œêµ­ì–´ ë¼ë²¨
  confidence: number;           // 0-100
  ratios: {
    widthToHeight: number;      // ê°€ë¡œ:ì„¸ë¡œ ë¹„ìœ¨
    foreheadToJaw: number;      // ì´ë§ˆ:í„± ë¹„ìœ¨
    cheekboneWidth: number;     // ê´‘ëŒ€ í­ (px)
  };
}
```

**ì„±ê³µ ê¸°ì¤€**:
- [ ] 468í¬ì¸íŠ¸ ëœë“œë§ˆí¬ì—ì„œ ì£¼ìš” í¬ì¸íŠ¸ ì¶”ì¶œ (ì´ë§ˆ, ê´‘ëŒ€, í„±)
- [ ] ê°€ë¡œ:ì„¸ë¡œ ë¹„ìœ¨ ê³„ì‚° ì •í™•ë„ 95% ì´ìƒ
- [ ] 7ì¢… ì–¼êµ´í˜• ë¶„ë¥˜ ì •í™•ë„ 85% ì´ìƒ
- [ ] í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 5ê°œ ì´ìƒ í†µê³¼
- [ ] typecheck í†µê³¼

**ì•Œê³ ë¦¬ì¦˜ ê°œìš” (MediaPipe Face Mesh 468 ëœë“œë§ˆí¬ ê¸°ë°˜)**:

> ì°¸ì¡°: MediaPipe Face MeshëŠ” 468ê°œì˜ 3D ëœë“œë§ˆí¬ë¥¼ ì œê³µí•˜ë©°, ì–¼êµ´í˜• ë¶„ë¥˜ì— í•„ìš”í•œ ì£¼ìš” í¬ì¸íŠ¸ë¥¼ í™œìš©í•œë‹¤.

**1. ì£¼ìš” ëœë“œë§ˆí¬ í¬ì¸íŠ¸**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          MediaPipe 468 ëœë“œë§ˆí¬ ì–¼êµ´í˜• ì¸¡ì • í¬ì¸íŠ¸          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚                        10 (ì´ë§ˆ ì¤‘ì•™)                        â”‚
â”‚                            â—                                 â”‚
â”‚                                                              â”‚
â”‚     234 â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì–¼êµ´ ë„ˆë¹„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â— 454             â”‚
â”‚     (ì¢Œì¸¡ ê´€ìë†€ì´)                    (ìš°ì¸¡ ê´€ìë†€ì´)       â”‚
â”‚                                                              â”‚
â”‚      93 â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê´‘ëŒ€ ë„ˆë¹„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â— 323             â”‚
â”‚     (ì¢Œì¸¡ ê´‘ëŒ€)                        (ìš°ì¸¡ ê´‘ëŒ€)           â”‚
â”‚                                                              â”‚
â”‚     172 â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í„± ë„ˆë¹„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â— 397             â”‚
â”‚     (ì¢Œì¸¡ í„±)                          (ìš°ì¸¡ í„±)             â”‚
â”‚                                                              â”‚
â”‚                            â—                                 â”‚
â”‚                        152 (í„± ë)                           â”‚
â”‚                                                              â”‚
â”‚       ì–¼êµ´ ê¸¸ì´: 10 â†’ 152 (ì´ë§ˆ ì¤‘ì•™ â†’ í„± ë)               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. ì¸¡ì •ê°’ ê³„ì‚° ê³µì‹**

```typescript
// ìœ í´ë¦¬ë“œ ê±°ë¦¬ ê³„ì‚°
function distance(p1: Point, p2: Point): number {
  return Math.sqrt((p2.x - p1.x) ** 2 + (p2.y - p1.y) ** 2);
}

// ì£¼ìš” ì¸¡ì •ê°’
const faceLength = distance(landmarks[10], landmarks[152]);   // ì´ë§ˆ â†’ í„±
const faceWidth = distance(landmarks[234], landmarks[454]);   // ê´€ìë†€ì´ í­
const jawWidth = distance(landmarks[172], landmarks[397]);    // í„± í­
const cheekboneWidth = distance(landmarks[93], landmarks[323]); // ê´‘ëŒ€ í­

// ë¹„ìœ¨ ê³„ì‚°
const lengthToWidthRatio = faceLength / faceWidth;  // ê¸¸ì´/ë„ˆë¹„
const jawToCheekRatio = jawWidth / cheekboneWidth;  // í„±/ê´‘ëŒ€
```

**3. ë¹„ìœ¨ ê¸°ë°˜ ì–¼êµ´í˜• ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜**

| ì–¼êµ´í˜• | í•œêµ­ì–´ | ê¸¸ì´/ë„ˆë¹„ ë¹„ìœ¨ | í„±/ê´‘ëŒ€ ë¹„ìœ¨ | íŠ¹ì§• |
|--------|--------|----------------|--------------|------|
| **oval** | ê³„ë€í˜• | 1.3 ~ 1.5 | 0.70 ~ 0.85 | ì´ìƒì  ë¹„ìœ¨, í„±ì„  ì™„ë§Œ |
| **round** | ë‘¥ê·¼í˜• | 1.0 ~ 1.2 | 0.85 ~ 1.0 | ë³¼ ë„“ìŒ, í„±ì„  ë¶€ë“œëŸ¬ì›€ |
| **oblong** | ê¸´í˜• | > 1.5 | 0.60 ~ 0.80 | ì„¸ë¡œë¡œ ê¸´ í˜•íƒœ |
| **square** | ì‚¬ê°í˜• | 1.1 ~ 1.4 | 0.90 ~ 1.0 | ê°ì§„ í„±ì„ , ì´ë§ˆ/í„± í­ ìœ ì‚¬ |
| **heart** | í•˜íŠ¸í˜• | 1.2 ~ 1.5 | 0.60 ~ 0.75 | ë„“ì€ ì´ë§ˆ, ì¢ì€ í„± |
| **diamond** | ë‹¤ì´ì•„ëª¬ë“œ | 1.2 ~ 1.5 | 0.65 ~ 0.80 | ê´‘ëŒ€ ê°€ì¥ ë„“ìŒ |
| **triangle** | ì‚¼ê°í˜•/ì—­ì‚¼ê°í˜• | 1.2 ~ 1.5 | 1.05 ~ 1.25 | í„±ì´ ê´‘ëŒ€ë³´ë‹¤ ë„“ìŒ, ì¢ì€ ì´ë§ˆ |

**4. ë¶„ë¥˜ ì˜ì‚¬ì½”ë“œ**

```typescript
function classifyFaceShape(landmarks: Point[]): FaceShapeId {
  const measurements = calculateMeasurements(landmarks);
  const { lengthToWidthRatio, jawToCheekRatio, foreheadWidth, cheekboneWidth, jawWidth } = measurements;

  // 1. ê¸¸ì´/ë„ˆë¹„ ë¹„ìœ¨ ì²´í¬
  if (lengthToWidthRatio > 1.5) {
    return 'oblong';  // ê¸´í˜•
  }

  if (lengthToWidthRatio < 1.2) {
    return 'round';   // ë‘¥ê·¼í˜•
  }

  // 2. í„±/ê´‘ëŒ€ ë¹„ìœ¨ë¡œ ì„¸ë¶„í™”
  if (jawToCheekRatio >= 0.9) {
    // í„±ì´ ê´‘ëŒ€ë³´ë‹¤ ë„“ìœ¼ë©´ ì‚¼ê°í˜• (ì—­ì‚¼ê°í˜• í¬í•¨)
    if (jawToCheekRatio > 1.05) {
      return 'triangle';  // ì‚¼ê°í˜•
    }
    return 'square';  // ì‚¬ê°í˜•
  }

  if (jawToCheekRatio < 0.75) {
    // ì´ë§ˆì™€ í„± ë¹„êµ
    if (foreheadWidth > jawWidth * 1.2) {
      return 'heart';   // í•˜íŠ¸í˜•
    }
    // ê´‘ëŒ€ê°€ ê°€ì¥ ë„“ì€ì§€ ì²´í¬
    if (cheekboneWidth > foreheadWidth && cheekboneWidth > jawWidth) {
      return 'diamond'; // ë‹¤ì´ì•„ëª¬ë“œ
    }
  }

  return 'oval';  // ê¸°ë³¸ê°’: ê³„ë€í˜•
}
```

**5. ì‹ ë¢°ë„ ê³„ì‚°**

```typescript
function calculateConfidence(
  measurements: FaceMeasurements,
  classifiedShape: FaceShapeId
): number {
  const idealRanges = FACE_SHAPE_IDEAL_RANGES[classifiedShape];

  // ê° ì¸¡ì •ê°’ì´ ì´ìƒì  ë²”ìœ„ ë‚´ì— ìˆëŠ” ì •ë„ ê³„ì‚°
  const ratioFit = calculateRangeFit(
    measurements.lengthToWidthRatio,
    idealRanges.lengthToWidth
  );
  const jawFit = calculateRangeFit(
    measurements.jawToCheekRatio,
    idealRanges.jawToCheek
  );

  // ê°€ì¤‘ í‰ê·  (ë¹„ìœ¨ 60%, í„± 40%)
  return Math.round(ratioFit * 0.6 + jawFit * 0.4);
}
```

**íŒŒì¼ ë°°ì¹˜**:
| íŒŒì¼ ê²½ë¡œ | ë³€ê²½ ìœ í˜• | ì„¤ëª… |
|-----------|----------|------|
| `apps/web/lib/analysis/hair/face-shape.ts` | ì‹ ê·œ | ì–¼êµ´í˜• ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜ |
| `apps/web/lib/analysis/hair/internal/landmarks.ts` | ì‹ ê·œ | ëœë“œë§ˆí¬ ì¸¡ì • ìœ í‹¸ë¦¬í‹° |
| `apps/web/tests/lib/analysis/hair/face-shape.test.ts` | ì‹ ê·œ | ì–¼êµ´í˜• ë¶„ë¥˜ í…ŒìŠ¤íŠ¸ |

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:

| TC ID | ì…ë ¥ | ì˜ˆìƒ ì¶œë ¥ | ì„¤ëª… |
|-------|------|----------|------|
| H1-1-TC1 | ratio=1.4, jaw/cheek=0.78 | oval | í‘œì¤€ ê³„ë€í˜• |
| H1-1-TC2 | ratio=1.1, jaw/cheek=0.92 | round | ë‘¥ê·¼í˜• |
| H1-1-TC3 | ratio=1.6, jaw/cheek=0.70 | oblong | ê¸´í˜• |
| H1-1-TC4 | ratio=1.25, jaw/cheek=0.95 | square | ì‚¬ê°í˜• |
| H1-1-TC5 | ratio=1.35, jaw/cheek=0.68, forehead>jaw | heart | í•˜íŠ¸í˜• |
| H1-1-TC6 | ratio=1.35, cheek>forehead, cheek>jaw | diamond | ë‹¤ì´ì•„ëª¬ë“œ |
| H1-1-TC7 | ratio=1.3, jaw/cheek=1.10, jaw>forehead | triangle | ì‚¼ê°í˜• (ì—­ì‚¼ê°í˜•) |

---

#### H-1.2: í—¤ì–´ì»¬ëŸ¬ Lab ë¶„ë¥˜

**ì†Œìš”ì‹œê°„**: 2ì‹œê°„
**ì˜ì¡´ì„±**: H-1.1 (ì–¼êµ´ ì˜ì—­ ì œì™¸ìš©)

**ì…ë ¥**:
```typescript
interface HairColorInput {
  imageData: ImageData;
  faceRegion: BoundingBox;      // ì–¼êµ´ ì˜ì—­ (ì œì™¸ìš©)
  landmarks?: FaceLandmark[];   // í—¤ì–´ë¼ì¸ ì¶”ì •ìš©
}
```

**ì¶œë ¥**:
```typescript
interface HairColorResult {
  dominant: LabColor;
  secondary: LabColor | null;
  category: HairColorCategory;  // 8ê°œ ì¹´í…Œê³ ë¦¬
  hex: string;
  confidence: number;
}

type HairColorCategory =
  | 'black' | 'dark-brown' | 'medium-brown' | 'light-brown'
  | 'blonde' | 'red' | 'ash' | 'dyed-vivid';
```

**ì„±ê³µ ê¸°ì¤€**:
- [ ] RGB â†’ Lab ë³€í™˜ ì •í™•ë„ (Î”E < 2)
- [ ] K-means í´ëŸ¬ìŠ¤í„°ë§ìœ¼ë¡œ ìƒìœ„ 2ê°œ ìƒ‰ìƒ ì¶”ì¶œ
- [ ] 8ê°œ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜ ë¡œì§ êµ¬í˜„
- [ ] í”¼ë¶€ìƒ‰/ë°°ê²½ í•„í„°ë§ ì •í™•ë„ 90% ì´ìƒ
- [ ] í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 5ê°œ ì´ìƒ í†µê³¼

**ì•Œê³ ë¦¬ì¦˜ ê°œìš” (Lab ìƒ‰ê³µê°„ í—¤ì–´ì»¬ëŸ¬ ë¶„ë¥˜)**:

> ì°¸ì¡°: Lab ìƒ‰ê³µê°„ì€ ì¸ê°„ ì‹œê°ê³¼ ê°€ì¥ ìœ ì‚¬í•œ ìƒ‰ì°¨ ê³„ì‚°ì´ ê°€ëŠ¥í•˜ë©°, í—¤ì–´ì»¬ëŸ¬ ë¶„ë¥˜ì— ìµœì í™”ë˜ì–´ ìˆë‹¤.

**1. í—¤ì–´ ì˜ì—­ ë¶„í•  (Hair Segmentation)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                í—¤ì–´ ì˜ì—­ ì¶”ì¶œ ì•Œê³ ë¦¬ì¦˜                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚       â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚ â† í—¤ì–´ ì˜ì—­ ìƒë‹¨  â”‚
â”‚       â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   (ì–¼êµ´ ìœ„ìª½)     â”‚
â”‚       â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   ì–¼êµ´ ì˜ì—­   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚ â† í—¤ì–´ ì˜ì—­ ì¸¡ë©´  â”‚
â”‚       â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  (ì œì™¸)      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   (ì–¼êµ´ ì–‘ì˜†)     â”‚
â”‚       â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚                   â”‚
â”‚       â”‚          â”‚  Face   â”‚             â”‚                   â”‚
â”‚       â”‚          â”‚ Region  â”‚             â”‚                   â”‚
â”‚       â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                   â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                              â”‚
â”‚   í—¤ì–´ ì˜ì—­ = ì´ë¯¸ì§€ ìƒë‹¨ 30% + ì–¼êµ´ ì¢Œìš° 20% ì˜ì—­            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
// í—¤ì–´ ì˜ì—­ ì¶”ì¶œ
function extractHairRegion(
  imageData: ImageData,
  faceRegion: BoundingBox,
  landmarks?: FaceLandmark[]
): HairRegion {
  const { width, height } = imageData;
  const { x: fx, y: fy, width: fw, height: fh } = faceRegion;

  // í—¤ì–´ë¼ì¸ ì¶”ì • (ëœë“œë§ˆí¬ 10, 103, 332)
  const hairlineY = landmarks
    ? Math.min(landmarks[10].y, landmarks[103].y, landmarks[332].y)
    : fy;

  return {
    // ìƒë‹¨ ì˜ì—­: ì´ë¯¸ì§€ ìƒë‹¨ë¶€í„° í—¤ì–´ë¼ì¸ê¹Œì§€
    top: { x: 0, y: 0, width, height: hairlineY },
    // ì¢Œì¸¡ ì˜ì—­: ì–¼êµ´ ì™¼ìª½
    left: { x: 0, y: fy, width: fx, height: fh },
    // ìš°ì¸¡ ì˜ì—­: ì–¼êµ´ ì˜¤ë¥¸ìª½
    right: { x: fx + fw, y: fy, width: width - (fx + fw), height: fh },
  };
}
```

**2. RGB â†’ Lab ìƒ‰ê³µê°„ ë³€í™˜**

```typescript
// RGB â†’ XYZ â†’ Lab ë³€í™˜ ê³µì‹
interface LabColor {
  L: number;  // ëª…ë„ (0-100)
  a: number;  // ì´ˆë¡-ë¹¨ê°• ì¶• (-128 ~ +127)
  b: number;  // íŒŒë‘-ë…¸ë‘ ì¶• (-128 ~ +127)
}

function rgbToLab(r: number, g: number, b: number): LabColor {
  // 1. RGB â†’ sRGB (0-1 ì •ê·œí™”)
  let sr = r / 255;
  let sg = g / 255;
  let sb = b / 255;

  // 2. sRGB â†’ Linear RGB (ê°ë§ˆ ë³´ì •)
  sr = sr > 0.04045 ? Math.pow((sr + 0.055) / 1.055, 2.4) : sr / 12.92;
  sg = sg > 0.04045 ? Math.pow((sg + 0.055) / 1.055, 2.4) : sg / 12.92;
  sb = sb > 0.04045 ? Math.pow((sb + 0.055) / 1.055, 2.4) : sb / 12.92;

  // 3. Linear RGB â†’ XYZ (D65 ê¸°ì¤€ ë°±ìƒ‰ì )
  const x = sr * 0.4124564 + sg * 0.3575761 + sb * 0.1804375;
  const y = sr * 0.2126729 + sg * 0.7151522 + sb * 0.0721750;
  const z = sr * 0.0193339 + sg * 0.1191920 + sb * 0.9503041;

  // D65 ê¸°ì¤€ ë°±ìƒ‰ì ìœ¼ë¡œ ì •ê·œí™”
  const xn = x / 0.95047;
  const yn = y / 1.00000;
  const zn = z / 1.08883;

  // 4. XYZ â†’ Lab
  const f = (t: number) => t > 0.008856
    ? Math.pow(t, 1/3)
    : (7.787 * t) + (16 / 116);

  const L = (116 * f(yn)) - 16;
  const a = 500 * (f(xn) - f(yn));
  const bVal = 200 * (f(yn) - f(zn));

  return { L, a, b: bVal };
}
```

**3. K-means í´ëŸ¬ìŠ¤í„°ë§ìœ¼ë¡œ ëŒ€í‘œ ìƒ‰ìƒ ì¶”ì¶œ**

```typescript
function extractDominantHairColor(
  pixels: RGBPixel[],
  k: number = 4
): LabColor[] {
  // Lab ë³€í™˜
  const labPixels = pixels.map(p => rgbToLab(p.r, p.g, p.b));

  // K-means í´ëŸ¬ìŠ¤í„°ë§
  const clusters = kMeans(labPixels, k, { maxIterations: 20 });

  // í”¼ë¶€ìƒ‰ í´ëŸ¬ìŠ¤í„° ì œì™¸ (a* > 10, b* > 20ì€ í”¼ë¶€ìƒ‰ ê°€ëŠ¥ì„±)
  const hairClusters = clusters.filter(c =>
    !(c.centroid.a > 10 && c.centroid.b > 20)
  );

  // í´ëŸ¬ìŠ¤í„° í¬ê¸°ìˆœ ì •ë ¬
  hairClusters.sort((a, b) => b.size - a.size);

  return hairClusters.slice(0, 2).map(c => c.centroid);
}
```

**4. í—¤ì–´ ë ˆë²¨ 1-10 ë¶„ë¥˜ (L* ê¸°ë°˜)**

| ë ˆë²¨ | ëª…ì¹­ | L* ë²”ìœ„ | ì„¤ëª… | RGB ì˜ˆì‹œ |
|------|------|---------|------|----------|
| 1 | Black | 0 ~ 15 | ìˆœí‘ìƒ‰ | #0a0a0a |
| 2 | Off-Black | 15 ~ 22 | ê±°ì˜ ê²€ì • | #1a1410 |
| 3 | Darkest Brown | 22 ~ 28 | ê°€ì¥ ì–´ë‘ìš´ ê°ˆìƒ‰ | #2a1a14 |
| 4 | Dark Brown | 28 ~ 35 | ì–´ë‘ìš´ ê°ˆìƒ‰ | #3a2820 |
| 5 | Medium Brown | 35 ~ 43 | ì¤‘ê°„ ê°ˆìƒ‰ | #4a3830 |
| 6 | Light Brown | 43 ~ 52 | ë°ì€ ê°ˆìƒ‰ | #6a4840 |
| 7 | Dark Blonde | 52 ~ 62 | ì–´ë‘ìš´ ê¸ˆë°œ | #8a6850 |
| 8 | Medium Blonde | 62 ~ 72 | ì¤‘ê°„ ê¸ˆë°œ | #b08860 |
| 9 | Light Blonde | 72 ~ 85 | ë°ì€ ê¸ˆë°œ | #d0a880 |
| 10 | Lightest Blonde | 85 ~ 100 | ê°€ì¥ ë°ì€ ê¸ˆë°œ | #f0d8b0 |

```typescript
function classifyHairLevel(L: number): number {
  const levels = [15, 22, 28, 35, 43, 52, 62, 72, 85, 100];
  for (let i = 0; i < levels.length; i++) {
    if (L < levels[i]) return i + 1;
  }
  return 10;
}
```

**5. ì›œí†¤/ì¿¨í†¤ ë¶„ë¥˜ (a*, b* ê¸°ë°˜)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Lab ìƒ‰ê³µê°„ ì›œí†¤/ì¿¨í†¤ ë¶„ë¥˜                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚                        +b* (Yellow)                         â”‚
â”‚                            â”‚                                 â”‚
â”‚             Warm           â”‚           Warm                  â”‚
â”‚            Orange          â”‚           Yellow                â”‚
â”‚                            â”‚                                 â”‚
â”‚     -a* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€+â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ +a*           â”‚
â”‚     (Green)                â”‚                  (Red)          â”‚
â”‚                            â”‚                                 â”‚
â”‚             Cool           â”‚           Neutral               â”‚
â”‚            Green           â”‚           Pink                  â”‚
â”‚                            â”‚                                 â”‚
â”‚                        -b* (Blue)                            â”‚
â”‚                                                              â”‚
â”‚   ì›œí†¤: b* > 5 (í™©ìƒ‰ ì–¸ë”í†¤)                                  â”‚
â”‚   ì¿¨í†¤: b* < -5 (ì²­ìƒ‰ ì–¸ë”í†¤)                                 â”‚
â”‚   ë‰´íŠ¸ëŸ´: -5 â‰¤ b* â‰¤ 5                                        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
type HairTone = 'warm' | 'cool' | 'neutral';

function classifyHairTone(lab: LabColor): HairTone {
  const { a, b } = lab;

  // b* ê°’ìœ¼ë¡œ 1ì°¨ íŒë‹¨
  if (b > 5) return 'warm';    // í™©ìƒ‰ ì–¸ë”í†¤ â†’ ì›œí†¤
  if (b < -5) return 'cool';   // ì²­ìƒ‰ ì–¸ë”í†¤ â†’ ì¿¨í†¤

  // a* ê°’ìœ¼ë¡œ 2ì°¨ íŒë‹¨
  if (a > 10) return 'warm';   // ì ìƒ‰ ì–¸ë”í†¤ â†’ ì›œí†¤
  if (a < -5) return 'cool';   // ë…¹ìƒ‰ ì–¸ë”í†¤ â†’ ì¿¨í†¤

  return 'neutral';
}
```

**6. ìµœì¢… í—¤ì–´ì»¬ëŸ¬ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜**

```typescript
function classifyHairColorCategory(lab: LabColor): HairColorCategory {
  const { L, a, b } = lab;
  const level = classifyHairLevel(L);
  const tone = classifyHairTone(lab);

  // ë¹„ìì—°ì  ìƒ‰ìƒ ê°ì§€ (ì—¼ìƒ‰)
  if (Math.abs(a) > 30 || Math.abs(b) > 40) {
    return 'dyed-vivid';
  }

  // ë ˆë“œ ê³„ì—´ (a* ë†’ìŒ)
  if (a > 20) return 'red';

  // ì• ì‰¬ ê³„ì—´ (b* ë‚®ìŒ)
  if (b < -10 && level >= 5) return 'ash';

  // ëª…ë„ ê¸°ë°˜ ë¶„ë¥˜
  if (level <= 2) return 'black';
  if (level <= 4) return 'dark-brown';
  if (level <= 6) return 'medium-brown';
  if (level <= 7) return 'light-brown';
  return 'blonde';
}
```

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:

| TC ID | ì…ë ¥ (Lab) | ì˜ˆìƒ ì¶œë ¥ | ì„¤ëª… |
|-------|-----------|----------|------|
| H1-2-TC1 | L=20, a=3, b=5 | black, level 2 | ìˆœí‘ìƒ‰ |
| H1-2-TC2 | L=35, a=8, b=15 | dark-brown, warm | ë”°ëœ»í•œ ê°ˆìƒ‰ |
| H1-2-TC3 | L=50, a=-2, b=-12 | ash, cool | ì• ì‰¬ ê·¸ë ˆì´ |
| H1-2-TC4 | L=65, a=25, b=20 | red, warm | ì ê°ˆìƒ‰ |
| H1-2-TC5 | L=75, a=2, b=18 | blonde, warm | í™©ê¸ˆë¹› ê¸ˆë°œ |
| H1-2-TC6 | L=40, a=50, b=-30 | dyed-vivid | ë¹„ìì—°ì  ì—¼ìƒ‰ |

**íŒŒì¼ ë°°ì¹˜**:
| íŒŒì¼ ê²½ë¡œ | ë³€ê²½ ìœ í˜• | ì„¤ëª… |
|-----------|----------|------|
| `apps/web/lib/analysis/hair/hair-color.ts` | ì‹ ê·œ | í—¤ì–´ì»¬ëŸ¬ ë¶„ë¥˜ ë©”ì¸ |
| `apps/web/lib/analysis/hair/internal/color-space.ts` | ì‹ ê·œ | RGBâ†”Lab ë³€í™˜ |
| `apps/web/lib/analysis/hair/internal/kmeans.ts` | ì‹ ê·œ | K-means í´ëŸ¬ìŠ¤í„°ë§ |
| `apps/web/lib/analysis/hair/internal/hair-region.ts` | ì‹ ê·œ | í—¤ì–´ ì˜ì—­ ë¶„í•  |
| `apps/web/tests/lib/analysis/hair/hair-color.test.ts` | ì‹ ê·œ | í—¤ì–´ì»¬ëŸ¬ í…ŒìŠ¤íŠ¸ |

---

#### H-1.3: ëª¨ë°œ íƒ€ì… ë¶„ë¥˜

**ì†Œìš”ì‹œê°„**: 1ì‹œê°„
**ì˜ì¡´ì„±**: ì—†ìŒ

**ì…ë ¥**:
```typescript
interface HairTypeInput {
  imageData: ImageData;
  hairRegion?: BoundingBox;
}
```

**ì¶œë ¥**:
```typescript
interface HairTypeResult {
  hairType: HairTypeId;         // straight, wavy, curly, coily
  hairTypeLabel: string;
  hairThickness: HairThicknessId; // fine, medium, thick
  hairThicknessLabel: string;
  confidence: number;
}
```

**ì„±ê³µ ê¸°ì¤€**:
- [ ] Gemini VLM í”„ë¡¬í”„íŠ¸ ì •ì˜
- [ ] 4ì¢… í—¤ì–´ íƒ€ì… ë¶„ë¥˜ ì •í™•ë„ 90% ì´ìƒ
- [ ] 3ì¢… êµµê¸° ë¶„ë¥˜ ì •í™•ë„ 85% ì´ìƒ
- [ ] í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 4ê°œ ì´ìƒ í†µê³¼

**ì•Œê³ ë¦¬ì¦˜ ê°œìš”**:
1. Geminiì— í—¤ì–´ ì´ë¯¸ì§€ ì „ì†¡
2. í”„ë¡¬í”„íŠ¸ë¡œ hairType, hairThickness ìš”ì²­
3. JSON ì‘ë‹µ íŒŒì‹± ë° ê²€ì¦

**íŒŒì¼ ë°°ì¹˜**:
| íŒŒì¼ ê²½ë¡œ | ë³€ê²½ ìœ í˜• |
|-----------|----------|
| `apps/web/lib/analysis/hair/hair-type.ts` | ì‹ ê·œ |
| `apps/web/tests/lib/analysis/hair/hair-type.test.ts` | ì‹ ê·œ |

---

#### H-1.4: ë‘í”¼ ìƒíƒœ ë¶„ì„

**ì†Œìš”ì‹œê°„**: 2ì‹œê°„
**ì˜ì¡´ì„±**: ì—†ìŒ

**ì…ë ¥**:
```typescript
interface ScalpAnalysisInput {
  imageData: ImageData;
}
```

**ì¶œë ¥**:
```typescript
interface ScalpAnalysisResult {
  scalpType: ScalpTypeId;       // dry, normal, oily, sensitive
  scalpTypeLabel: string;
  metrics: HairAnalysisMetric[]; // 6ê°œ ì§€í‘œ
  overallScore: number;
  concerns: HairConcernId[];
}
```

**ì„±ê³µ ê¸°ì¤€**:
- [ ] 4ì¢… ë‘í”¼ íƒ€ì… ë¶„ë¥˜ ì •í™•ë„ 85% ì´ìƒ
- [ ] 6ê°œ ê±´ê°• ì§€í‘œ ì ìˆ˜ ê³„ì‚° (0-100)
- [ ] 8ê°œ ê³ ë¯¼ ì¹´í…Œê³ ë¦¬ ê°ì§€
- [ ] í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 4ê°œ ì´ìƒ í†µê³¼

**ì•Œê³ ë¦¬ì¦˜ ê°œìš”**:
1. Geminiì— ë‘í”¼/í—¤ì–´ ì´ë¯¸ì§€ ì „ì†¡
2. í”„ë¡¬í”„íŠ¸ë¡œ ë‘í”¼ íƒ€ì…, ê±´ê°• ì§€í‘œ, ê³ ë¯¼ ìš”ì²­
3. JSON ì‘ë‹µ íŒŒì‹±
4. ì§€í‘œ ê°’ ì •ê·œí™” (0-100)
5. ì „ì²´ ì ìˆ˜ = 6ê°œ ì§€í‘œ ê°€ì¤‘ í‰ê· 

**íŒŒì¼ ë°°ì¹˜**:
| íŒŒì¼ ê²½ë¡œ | ë³€ê²½ ìœ í˜• |
|-----------|----------|
| `apps/web/lib/analysis/hair/scalp-type.ts` | ì‹ ê·œ |
| `apps/web/tests/lib/analysis/hair/scalp-type.test.ts` | ì‹ ê·œ |

---

#### H-1.5: í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ

**ì†Œìš”ì‹œê°„**: 2ì‹œê°„
**ì˜ì¡´ì„±**: H-1.1 (ì–¼êµ´í˜•), H-1.3 (í—¤ì–´ íƒ€ì…)

**ì…ë ¥**:
```typescript
interface StyleRecommendInput {
  faceShape: FaceShapeId;
  hairType: HairTypeId;
  hairThickness: HairThicknessId;
  personalColorSeason?: Season;  // PC-1 ì—°ë™ (ì„ íƒ)
}
```

**ì¶œë ¥**:
```typescript
interface StyleRecommendResult {
  recommendedHairStyles: HairStyleRecommendation[];
  recommendedHairColors?: HairColorRecommendation[];  // PC-1 ì—°ë™ ì‹œ
}
```

**ì„±ê³µ ê¸°ì¤€**:
- [ ] ì–¼êµ´í˜•ë³„ ìµœì†Œ 3ê°œ ìŠ¤íƒ€ì¼ ì¶”ì²œ
- [ ] í—¤ì–´ íƒ€ì…/êµµê¸° ê³ ë ¤í•œ í•„í„°ë§
- [ ] matchScore ê³„ì‚° ë¡œì§ (0-100)
- [ ] PC-1 ì—°ë™ ì‹œ ì‹œì¦Œë³„ í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ
- [ ] í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 6ê°œ ì´ìƒ í†µê³¼

**ì•Œê³ ë¦¬ì¦˜ ê°œìš”**:
1. STYLE_DATABASEì—ì„œ ì–¼êµ´í˜• í˜¸í™˜ ìŠ¤íƒ€ì¼ í•„í„°
2. í—¤ì–´ íƒ€ì… ì í•©ì„± ì ìˆ˜ ê³„ì‚°
3. êµµê¸° ì í•©ì„± ì ìˆ˜ ê³„ì‚°
4. ì¢…í•© matchScore = ì–¼êµ´í˜•(50%) + íƒ€ì…(30%) + êµµê¸°(20%)
5. ìƒìœ„ 3-5ê°œ ì¶”ì²œ

**íŒŒì¼ ë°°ì¹˜**:
| íŒŒì¼ ê²½ë¡œ | ë³€ê²½ ìœ í˜• |
|-----------|----------|
| `apps/web/lib/analysis/hair/style-recommend.ts` | ì‹ ê·œ |
| `apps/web/lib/analysis/hair/data/style-database.ts` | ì‹ ê·œ |
| `apps/web/tests/lib/analysis/hair/style-recommend.test.ts` | ì‹ ê·œ |

---

#### H-1.6: Mock Fallback

**ì†Œìš”ì‹œê°„**: 1ì‹œê°„
**ì˜ì¡´ì„±**: ì—†ìŒ

**ì…ë ¥**:
```typescript
interface MockInput {
  seed?: number;  // ì¬í˜„ ê°€ëŠ¥í•œ ê²°ê³¼ìš©
}
```

**ì¶œë ¥**:
```typescript
interface MockHairAnalysisResult extends HairAnalysisResult {
  // ëª¨ë“  í•„ë“œ ìœ íš¨í•œ Mock ê°’
}
```

**ì„±ê³µ ê¸°ì¤€**:
- [ ] ëª¨ë“  í•„ìˆ˜ í•„ë“œ ìœ íš¨í•œ ê°’ ë°˜í™˜
- [ ] ëœë¤ ê°’ì´ ì •ì˜ëœ ë²”ìœ„ ë‚´
- [ ] analysisReliability = 'medium' ì„¤ì •
- [ ] í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 2ê°œ ì´ìƒ í†µê³¼

**ì•Œê³ ë¦¬ì¦˜ ê°œìš”**:
1. ê° í•„ë“œë³„ ëœë¤ ê°’ ìƒì„± (ë²”ìœ„ ë‚´)
2. ì–¼êµ´í˜•ë³„ ì í•© ìŠ¤íƒ€ì¼ ë§¤í•‘
3. ë©”íƒ€ë°ì´í„° ì„¤ì • (usedFallback: true)

**íŒŒì¼ ë°°ì¹˜**:
| íŒŒì¼ ê²½ë¡œ | ë³€ê²½ ìœ í˜• |
|-----------|----------|
| `apps/web/lib/mock/hair-analysis.ts` | ìˆ˜ì • |
| `apps/web/tests/lib/mock/hair-analysis.test.ts` | ì‹ ê·œ |

---

#### H-1.7: API í†µí•©

**ì†Œìš”ì‹œê°„**: 2ì‹œê°„
**ì˜ì¡´ì„±**: H-1.1~H-1.6 (ëª¨ë‘)

**ì…ë ¥**:
```typescript
// HairAnalysisRequest (Section 2.1 ì°¸ì¡°)
```

**ì¶œë ¥**:
```typescript
// HairAnalysisResponse (Section 3 ì°¸ì¡°)
```

**ì„±ê³µ ê¸°ì¤€**:
- [ ] ì¸ì¦ í™•ì¸ (Clerk)
- [ ] Rate Limit ì ìš© (50 req/24h)
- [ ] ì…ë ¥ ê²€ì¦ (Zod ìŠ¤í‚¤ë§ˆ)
- [ ] Gemini ë¶„ì„ + 3ì´ˆ íƒ€ì„ì•„ì›ƒ + 2íšŒ ì¬ì‹œë„
- [ ] ì‹¤íŒ¨ ì‹œ Mock Fallback
- [ ] DB ì €ì¥ (RLS ì ìš©)
- [ ] ë±ƒì§€ ì—…ë°ì´íŠ¸ (H-1 ë¶„ì„ ì™„ë£Œ)
- [ ] N-1 ì•Œë¦¼ ìƒì„± (ë‘í”¼ ì ìˆ˜ ë‚®ì„ ì‹œ)
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ 5ê°œ ì´ìƒ í†µê³¼

**ì•Œê³ ë¦¬ì¦˜ ê°œìš”**:
1. ì¸ì¦ ë° Rate Limit í™•ì¸
2. ì…ë ¥ ê²€ì¦ (Zod)
3. CIE-2ë¡œ ì–¼êµ´ ëœë“œë§ˆí¬ ì¶”ì¶œ
4. H-1.1~H-1.5 ìˆœì°¨ ì‹¤í–‰ (with timeout)
5. ì‹¤íŒ¨ ì‹œ H-1.6 Mock ì‚¬ìš©
6. DB ì €ì¥ ë° gamification ì—…ë°ì´íŠ¸
7. ì‘ë‹µ ë°˜í™˜

**íŒŒì¼ ë°°ì¹˜**:
| íŒŒì¼ ê²½ë¡œ | ë³€ê²½ ìœ í˜• |
|-----------|----------|
| `apps/web/app/api/analyze/hair/route.ts` | ìˆ˜ì • |
| `apps/web/lib/analysis/hair/index.ts` | ì‹ ê·œ (Barrel) |
| `apps/web/tests/api/analyze/hair.test.ts` | ìˆ˜ì • |

---

#### H-1.8: í—¤ì–´ì»¬ëŸ¬ PC-1 ì—°ë™ ì¶”ì²œ

**ì†Œìš”ì‹œê°„**: 2ì‹œê°„
**ì˜ì¡´ì„±**: H-1.2 (í—¤ì–´ì»¬ëŸ¬ Lab ë¶„ë¥˜), PC-1 (í¼ìŠ¤ë„ì»¬ëŸ¬ ê²°ê³¼)

**ì…ë ¥**:
```typescript
interface HairColorRecommendInput {
  /** í˜„ì¬ í—¤ì–´ì»¬ëŸ¬ (H-1.2 ê²°ê³¼) */
  currentColor: HairColorResult;
  /** í¼ìŠ¤ë„ì»¬ëŸ¬ ì‹œì¦Œ */
  season: Season;
  /** ì–¸ë”í†¤ */
  undertone: 'warm' | 'cool' | 'neutral';
  /** í”¼ë¶€í†¤ Lab ê°’ (ì„ íƒ) */
  skinToneLab?: LabColor;
}
```

**ì¶œë ¥**:
```typescript
interface HairColorRecommendResult {
  /** ì¶”ì²œ í—¤ì–´ì»¬ëŸ¬ ëª©ë¡ (ìµœëŒ€ 5ê°œ) */
  recommendations: HairColorRecommendation[];
  /** í”¼í•´ì•¼ í•  ì»¬ëŸ¬ */
  avoidColors: {
    category: HairColorCategory;
    reason: string;
  }[];
  /** í˜„ì¬ ì»¬ëŸ¬ ì‹œì¦Œ ì¡°í™”ë„ (0-100) */
  currentColorHarmony: number;
  /** ì»¬ëŸ¬ë§ íŒ */
  coloringTips: string[];
}

interface HairColorRecommendation {
  /** ìƒ‰ìƒëª… (ì˜ë¬¸) */
  colorName: string;
  /** ìƒ‰ìƒëª… (í•œêµ­ì–´) */
  colorNameKr: string;
  /** Hex ìƒ‰ìƒ ì½”ë“œ */
  hex: string;
  /** Lab ìƒ‰ìƒê°’ */
  lab: LabColor;
  /** ë§¤ì¹­ ì ìˆ˜ (0-100) */
  matchScore: number;
  /** ë§¤ì¹­ ì´ìœ  */
  matchReason: string;
  /** ì í•©í•œ ì‹œì¦Œ */
  seasonCompatibility: Season[];
  /** í—¤ì–´ ë ˆë²¨ (1-10) */
  hairLevel: number;
}
```

**ì„±ê³µ ê¸°ì¤€**:
- [ ] ì‹œì¦Œë³„ ì¶”ì²œ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ ì •ì˜ (4ì‹œì¦Œ x 3ì„œë¸Œíƒ€ì…)
- [ ] í˜„ì¬ ì»¬ëŸ¬ vs ì‹œì¦Œ ê¸°ì¤€ìƒ‰ Î”E ê³„ì‚°
- [ ] Î”E < 10 â†’ ë†’ì€ ì¡°í™”ë„ (80+)
- [ ] Î”E > 25 â†’ ë‚®ì€ ì¡°í™”ë„ (í”¼í•´ì•¼ í•  ì»¬ëŸ¬)
- [ ] ì–¸ë”í†¤ ë§¤ì¹­ (ì›œí†¤â†”ì›œì»¬ëŸ¬, ì¿¨í†¤â†”ì¿¨ì»¬ëŸ¬)
- [ ] í”¼ë¶€í†¤ ëŒ€ë¹„ ì ì ˆí•œ ë ˆë²¨ ì¶”ì²œ
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ 8ê°œ ì´ìƒ í†µê³¼

**ì•Œê³ ë¦¬ì¦˜ ê°œìš”**:

```typescript
// ì‹œì¦Œë³„ ì¶”ì²œ í—¤ì–´ì»¬ëŸ¬ íŒ”ë ˆíŠ¸
const SEASON_HAIR_PALETTES: Record<Season, HairColorPalette> = {
  spring: {
    primary: [
      { name: 'honey-brown', lab: { L: 55, a: 8, b: 25 }, level: 6 },
      { name: 'golden-blonde', lab: { L: 75, a: 2, b: 30 }, level: 8 },
      { name: 'warm-chestnut', lab: { L: 45, a: 10, b: 20 }, level: 5 },
    ],
    secondary: ['copper', 'caramel', 'strawberry-blonde'],
    avoid: ['ash-blonde', 'platinum', 'jet-black'],
  },
  summer: {
    primary: [
      { name: 'ash-brown', lab: { L: 50, a: 3, b: 5 }, level: 5 },
      { name: 'soft-black', lab: { L: 25, a: 0, b: -3 }, level: 2 },
      { name: 'rose-brown', lab: { L: 55, a: 8, b: 0 }, level: 6 },
    ],
    secondary: ['mauve-brown', 'champagne', 'ash-blonde'],
    avoid: ['orange', 'copper', 'golden-blonde'],
  },
  autumn: {
    primary: [
      { name: 'auburn', lab: { L: 40, a: 18, b: 20 }, level: 4 },
      { name: 'copper-brown', lab: { L: 45, a: 15, b: 25 }, level: 5 },
      { name: 'chocolate', lab: { L: 35, a: 8, b: 12 }, level: 3 },
    ],
    secondary: ['burgundy', 'mahogany', 'warm-brown'],
    avoid: ['platinum', 'ash-gray', 'blue-black'],
  },
  winter: {
    primary: [
      { name: 'blue-black', lab: { L: 20, a: 0, b: -8 }, level: 1 },
      { name: 'espresso', lab: { L: 25, a: 2, b: 5 }, level: 2 },
      { name: 'burgundy', lab: { L: 35, a: 20, b: -5 }, level: 3 },
    ],
    secondary: ['jet-black', 'cool-brown', 'wine'],
    avoid: ['golden-blonde', 'orange', 'honey'],
  },
};

function recommendHairColors(input: HairColorRecommendInput): HairColorRecommendResult {
  const palette = SEASON_HAIR_PALETTES[input.season];

  // 1. í˜„ì¬ ì»¬ëŸ¬ ì¡°í™”ë„ ê³„ì‚°
  const currentHarmony = calculateSeasonHarmony(
    input.currentColor.dominant,
    input.season
  );

  // 2. ì¶”ì²œ ì»¬ëŸ¬ ì ìˆ˜ ê³„ì‚°
  const recommendations = palette.primary.map(color => {
    const deltaE = calculateDeltaE(input.currentColor.dominant, color.lab);
    const undertoneMatch = matchUndertone(color, input.undertone);
    const skinContrast = input.skinToneLab
      ? calculateSkinContrast(color.lab, input.skinToneLab)
      : 50;

    return {
      ...color,
      matchScore: calculateTotalScore(deltaE, undertoneMatch, skinContrast),
      matchReason: generateMatchReason(color, input),
      seasonCompatibility: [input.season],
    };
  }).sort((a, b) => b.matchScore - a.matchScore);

  // 3. í”¼í•´ì•¼ í•  ì»¬ëŸ¬
  const avoidColors = palette.avoid.map(category => ({
    category,
    reason: `${input.season} ì‹œì¦Œê³¼ ì¡°í™”ë˜ì§€ ì•ŠëŠ” ${category} ê³„ì—´ì…ë‹ˆë‹¤.`,
  }));

  // 4. ì»¬ëŸ¬ë§ íŒ
  const coloringTips = generateColoringTips(input, recommendations[0]);

  return {
    recommendations: recommendations.slice(0, 5),
    avoidColors,
    currentColorHarmony,
    coloringTips,
  };
}
```

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:

| TC ID | í…ŒìŠ¤íŠ¸ëª… | ì…ë ¥ | ì˜ˆìƒ ì¶œë ¥ | ìš°ì„ ìˆœìœ„ |
|-------|----------|------|----------|----------|
| H1-8-TC1 | ë´„ ì›œ ê³¨ë“  ì¶”ì²œ | season='spring', undertone='warm' | honey-brown, golden-blonde í¬í•¨ | P1 |
| H1-8-TC2 | ì—¬ë¦„ ì¿¨ ì• ì‰¬ ì¶”ì²œ | season='summer', undertone='cool' | ash-brown, soft-black í¬í•¨ | P1 |
| H1-8-TC3 | ê°€ì„ ì›œ ì½”í¼ ì¶”ì²œ | season='autumn', undertone='warm' | auburn, copper-brown í¬í•¨ | P1 |
| H1-8-TC4 | ê²¨ìš¸ ì¿¨ ë¸”ë™ ì¶”ì²œ | season='winter', undertone='cool' | blue-black, espresso í¬í•¨ | P1 |
| H1-8-TC5 | í˜„ì¬ ì»¬ëŸ¬ ë†’ì€ ì¡°í™”ë„ | currentColor â‰ˆ ì‹œì¦Œ ê¸°ì¤€ìƒ‰ | harmony > 80 | P2 |
| H1-8-TC6 | í˜„ì¬ ì»¬ëŸ¬ ë‚®ì€ ì¡°í™”ë„ | ë´„+í”Œë˜í‹°ë„˜ | harmony < 50, í”¼í•´ì•¼í•  ì»¬ëŸ¬ ì•ˆë‚´ | P2 |
| H1-8-TC7 | í”¼í•´ì•¼ í•  ì»¬ëŸ¬ ëª©ë¡ | season='spring' | ash, platinum í¬í•¨ | P2 |
| H1-8-TC8 | ì»¬ëŸ¬ë§ íŒ ìƒì„± | ìœ íš¨ ì…ë ¥ | tips ë°°ì—´ ê¸¸ì´ > 0 | P2 |

**íŒŒì¼ ë°°ì¹˜**:
| íŒŒì¼ ê²½ë¡œ | ë³€ê²½ ìœ í˜• |
|-----------|----------|
| `apps/web/lib/analysis/hair/color-recommend.ts` | ì‹ ê·œ |
| `apps/web/lib/analysis/hair/season-palettes.ts` | ì‹ ê·œ |
| `apps/web/tests/lib/analysis/hair/color-recommend.test.ts` | ì‹ ê·œ |

---

### 8.3 ì˜ì¡´ì„± ê·¸ë˜í”„

```mermaid
graph TD
    subgraph Phase1["Phase 1: ê¸°ë°˜"]
        CIE2[CIE-2: ì–¼êµ´ ëœë“œë§ˆí¬]
        H11["H-1.1: ì–¼êµ´í˜• ë¶„ì„<br/>[2h]"]
    end

    subgraph Phase2["Phase 2: ìƒ‰ìƒ ë¶„ì„"]
        H12["H-1.2: í—¤ì–´ì»¬ëŸ¬ Lab ë¶„ë¥˜<br/>[2h]"]
    end

    subgraph Phase3["Phase 3: ëª¨ë°œ/ë‘í”¼ (ë³‘ë ¬)"]
        H13["H-1.3: ëª¨ë°œ íƒ€ì…<br/>[1h]"]
        H14["H-1.4: ë‘í”¼ ìƒíƒœ<br/>[2h]"]
    end

    subgraph Phase4["Phase 4: ì¶”ì²œ"]
        H15["H-1.5: í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ<br/>[2h]"]
    end

    subgraph Phase5["Phase 5: Fallback (ë³‘ë ¬)"]
        H16["H-1.6: Mock Fallback<br/>[1h]"]
    end

    subgraph Phase6["Phase 6: í†µí•©"]
        H17["H-1.7: API í†µí•©<br/>[2h]"]
    end

    subgraph External["ì™¸ë¶€ ì—°ë™"]
        N1[N-1: ì˜ì–‘ ëª¨ë“ˆ ì•Œë¦¼]
    end

    CIE2 --> H11
    H11 --> H12
    H12 --> H13
    H12 --> H14
    H13 --> H15
    H14 --> H15
    H15 --> H17
    H16 -.-> H17
    H17 --> N1

    style Phase1 fill:#e1f5fe
    style Phase2 fill:#fff3e0
    style Phase3 fill:#e8f5e9
    style Phase4 fill:#fce4ec
    style Phase5 fill:#f3e5f5
    style Phase6 fill:#fff8e1
    style External fill:#e0e0e0
```

### 8.3.1 ë³‘ë ¬ ì‹¤í–‰ ê·¸ë£¹

| ê·¸ë£¹ | í¬í•¨ ì›ì | ë³‘ë ¬ ê°€ëŠ¥ | ì˜ˆìƒ ì‹œê°„ |
|------|----------|----------|----------|
| Group A | H-1.1 | No (ì‹œì‘ì ) | 2h |
| Group B | H-1.2 | No (A ì˜ì¡´) | 2h |
| Group C | H-1.3, H-1.4 | **Yes** | 2h (ë³‘ë ¬) |
| Group D | H-1.5 | No (C ì˜ì¡´) | 2h |
| Group E | H-1.6 | **Yes** (ë…ë¦½) | 1h |
| Group F | H-1.7 | No (D ì˜ì¡´) | 2h |
| **ì´í•©** | **7ê°œ** | | **~10h** (ë³‘ë ¬ ìµœì í™”) |

### 8.4 ì‘ì—… ì‹œê°„ ìš”ì•½

| Phase | ì›ì | ìˆœì°¨ ì‹œê°„ | ë³‘ë ¬ ì‹œ |
|-------|------|----------|---------|
| Phase 1 | H-1.1 | 2h | 2h |
| Phase 2 | H-1.2 | 2h | 2h |
| Phase 3 | H-1.3, H-1.4 | 3h | 2h (ë³‘ë ¬) |
| Phase 4 | H-1.5 | 2h | 2h |
| Phase 5 | H-1.6 | 1h | (Phase 3-4ì™€ ë³‘ë ¬ ê°€ëŠ¥) |
| Phase 6 | H-1.7 | 2h | 2h |
| **ì´í•©** | **7ê°œ** | **12h** | **~10h** (ë³‘ë ¬ ì‹œ) |

| êµ¬ë¶„ | ì‹œê°„ |
|------|------|
| í•µì‹¬ ì›ì (H-1.1~H-1.7) | 12ì‹œê°„ |
| í…ŒìŠ¤íŠ¸ ì‘ì„± | 3ì‹œê°„ |
| ë¬¸ì„œí™” ë° ë¦¬ë·° | 2ì‹œê°„ |
| **ì´í•©** | **17ì‹œê°„** |

---

## 9. íŒŒì¼ êµ¬ì¡°

```
lib/
â”œâ”€â”€ analysis/
â”‚   â””â”€â”€ hair/
â”‚       â”œâ”€â”€ index.ts              # H-1 ëª¨ë“ˆ export (Barrel)
â”‚       â”œâ”€â”€ types.ts              # í—¤ì–´ ë¶„ì„ íƒ€ì…
â”‚       â”œâ”€â”€ face-shape.ts         # ì–¼êµ´í˜• ë¶„ì„ (H-1.1)
â”‚       â”œâ”€â”€ hair-color.ts         # Lab ìƒ‰ìƒ ì¶”ì¶œ (H-1.2)
â”‚       â”œâ”€â”€ hair-type.ts          # ëª¨ë°œ íƒ€ì… ë¶„ë¥˜ (H-1.3)
â”‚       â”œâ”€â”€ scalp-type.ts         # ë‘í”¼ íƒ€ì… ë¶„ë¥˜ (H-1.4)
â”‚       â”œâ”€â”€ style-recommend.ts    # í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ (H-1.5)
â”‚       â”œâ”€â”€ color-recommend.ts    # í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ (PC-1 ì—°ë™)
â”‚       â””â”€â”€ cross-module.ts       # N-1 ì•Œë¦¼ (í¬ë¡œìŠ¤ ëª¨ë“ˆ)
â”œâ”€â”€ mock/
â”‚   â””â”€â”€ hair-analysis.ts          # Mock ë°ì´í„° (H-1.6)
â””â”€â”€ alerts/
    â””â”€â”€ index.ts                  # í¬ë¡œìŠ¤ ëª¨ë“ˆ ì•Œë¦¼

app/api/analyze/hair/
â””â”€â”€ route.ts                      # API ë¼ìš°íŠ¸ (H-1.7)

tests/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ analysis/
â”‚       â””â”€â”€ hair/
â”‚           â”œâ”€â”€ face-shape.test.ts
â”‚           â”œâ”€â”€ hair-color.test.ts
â”‚           â””â”€â”€ hair-analysis.test.ts
â””â”€â”€ api/
    â””â”€â”€ analyze/
        â””â”€â”€ hair.test.ts
```

---

## 10. í¬ë¡œìŠ¤ ëª¨ë“ˆ ì—°ë™

### 10.1 H-1 â†’ N-1 ì•Œë¦¼

```typescript
// lib/alerts/index.ts
interface CrossModuleAlertData {
  source: string;         // 'H-1'
  target: string;         // 'N-1'
  alertType: string;
  priority: 'high' | 'medium' | 'low';
  title: string;
  message: string;
  actionUrl?: string;
  data?: Record<string, unknown>;
}

// ë‘í”¼ ê±´ê°• ì ìˆ˜ ê¸°ë°˜ ì•Œë¦¼
export function createScalpHealthNutritionAlert(
  scalpScore: number,
  recommendedIngredients: string[]
): CrossModuleAlertData {
  return {
    source: 'H-1',
    target: 'N-1',
    alertType: 'scalp_health',
    priority: scalpScore < 50 ? 'high' : 'medium',
    title: 'ë‘í”¼ ê±´ê°• ê°œì„ ì„ ìœ„í•œ ì˜ì–‘ ì¶”ì²œ',
    message: `ë‘í”¼ ê±´ê°• ì ìˆ˜ê°€ ${scalpScore}ì ì…ë‹ˆë‹¤. ì˜ì–‘ ì„­ì·¨ë¡œ ê°œì„ í•´ë³´ì„¸ìš”.`,
    actionUrl: '/nutrition?focus=scalp',
    data: { scalpScore, recommendedIngredients },
  };
}

// íƒˆëª¨ ì˜ˆë°© ì•Œë¦¼
export function createHairLossPreventionAlert(
  densityScore: number,
  riskLevel: 'low' | 'medium' | 'high'
): CrossModuleAlertData {
  return {
    source: 'H-1',
    target: 'N-1',
    alertType: 'hair_loss_prevention',
    priority: riskLevel === 'high' ? 'high' : 'medium',
    title: 'ëª¨ë°œ ê±´ê°•ì„ ìœ„í•œ ì˜ì–‘ ê´€ë¦¬',
    message: `ëª¨ë°œ ë°€ë„ ì ìˆ˜: ${densityScore}ì . ë¹„ì˜¤í‹´, ì² ë¶„ ì„­ì·¨ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.`,
    actionUrl: '/nutrition?focus=hair',
    data: { densityScore, riskLevel },
  };
}

// ëª¨ë°œ ìœ¤ê¸° ì•Œë¦¼
export function createHairShineBoostAlert(
  damageLevel: number
): CrossModuleAlertData {
  return {
    source: 'H-1',
    target: 'N-1',
    alertType: 'hair_shine_boost',
    priority: 'medium',
    title: 'ëª¨ë°œ ìœ¤ê¸° ê°œì„ ì„ ìœ„í•œ ì˜ì–‘ ì¶”ì²œ',
    message: `ëª¨ë°œ ì†ìƒë„ê°€ ë†’ìŠµë‹ˆë‹¤. ë¹„íƒ€ë¯¼ E, ì˜¤ë©”ê°€-3 ì„­ì·¨ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.`,
    actionUrl: '/nutrition?focus=shine',
    data: { damageLevel },
  };
}
```

### 10.2 H-1 â†” PC-1 ì—°ë™

```typescript
// lib/analysis/hair/color-recommend.ts
import { createServiceRoleClient } from '@/lib/supabase/service-role';
import type { Season } from '@/types/personal-color';

interface PersonalColorResult {
  season: Season;
  subtype: string;
  undertone: 'warm' | 'cool' | 'neutral';
}

// í¼ìŠ¤ë„ì»¬ëŸ¬ ê²°ê³¼ ì¡°íšŒ
export async function getPersonalColorForHairRecommendation(
  userId: string
): Promise<PersonalColorResult | null> {
  const supabase = createServiceRoleClient();

  const { data } = await supabase
    .from('personal_color_assessments')
    .select('season, subtype, undertone, confidence')
    .eq('clerk_user_id', userId)
    .order('created_at', { ascending: false })
    .limit(1)
    .single();

  return data;
}

// ì‹œì¦Œë³„ ì¶”ì²œ í—¤ì–´ ì»¬ëŸ¬
export function recommendHairColorsBySeason(
  season: Season,
  currentHairColor: HairColorResult
): HairColorRecommendation[] {
  const palettes = SEASON_HAIR_PALETTES[season];

  return palettes.map(color => {
    const deltaE = calculateCIEDE2000(currentHairColor.dominant, color.lab);

    // ë³€í™”ëŸ‰ì— ë”°ë¥¸ ì ìˆ˜ ì¡°ì •
    let adjustedScore = color.matchScore;
    if (deltaE < 5) adjustedScore -= 10;  // ë„ˆë¬´ ë¹„ìŠ·í•¨
    if (deltaE > 40) adjustedScore -= 15; // ë„ˆë¬´ ë‹¤ë¦„

    return {
      ...color,
      matchScore: Math.max(0, Math.min(100, adjustedScore)),
    };
  }).sort((a, b) => b.matchScore - a.matchScore);
}
```

---

## 11. ë¦¬ìŠ¤í¬ ë° ì™„í™”

| ë¦¬ìŠ¤í¬ | í™•ë¥  | ì˜í–¥ | ì™„í™” ë°©ì•ˆ |
|--------|------|------|----------|
| AI ì–¼êµ´í˜• ë¶„ë¥˜ ë¶€ì •í™• | ì¤‘ê°„ | ë†’ìŒ | CIE-2 ëœë“œë§ˆí¬ ê¸°ë°˜ ìˆ˜í•™ì  ë¹„ìœ¨ ê²€ì¦ ë³‘í–‰ |
| ì¡°ëª…ì— ë”°ë¥¸ í—¤ì–´ì»¬ëŸ¬ ì˜¤ì°¨ | ë†’ìŒ | ë†’ìŒ | CIE-3 AWB ë³´ì • ì—°ê³„, ì¬ì´¬ì˜ ìœ ë„ |
| ì—¼ìƒ‰ ëª¨ë°œ ë¶„ë¥˜ ì–´ë ¤ì›€ | ì¤‘ê°„ | ë‚®ìŒ | 'dyed-vivid' ì¹´í…Œê³ ë¦¬ ë¶„ë¦¬, ì‚¬ìš©ì ì…ë ¥ ë³´ì™„ |
| ì§§ì€ í—¤ì–´ ì˜ì—­ ì¶”ì¶œ ì‹¤íŒ¨ | ë‚®ìŒ | ì¤‘ê°„ | ìµœì†Œ ì˜ì—­ ì„ê³„ê°’ ì„¤ì •, ì•ˆë‚´ ë©”ì‹œì§€ |
| PC-1 ë°ì´í„° ì—†ì„ ë•Œ | ë‚®ìŒ | ë‚®ìŒ | ê¸°ë³¸ ì¶”ì²œ ì œê³µ, PC-1 ë¶„ì„ ìœ ë„ |
| Gemini API íƒ€ì„ì•„ì›ƒ | ì¤‘ê°„ | ì¤‘ê°„ | 3ì´ˆ íƒ€ì„ì•„ì›ƒ, 2íšŒ ì¬ì‹œë„, Mock í´ë°± |

---

## 12. ê´€ë ¨ ë¬¸ì„œ

### ì›ë¦¬ ë¬¸ì„œ

- [ì›ë¦¬: í—¤ì–´/ë©”ì´í¬ì—… ë¶„ì„](../principles/hair-makeup-analysis.md) - ì–¼êµ´í˜•, í—¤ì–´ì»¬ëŸ¬ ì´ë¡ 
- [ì›ë¦¬: ìƒ‰ì±„í•™](../principles/color-science.md) - Lab ìƒ‰ê³µê°„, ì›œí†¤/ì¿¨í†¤ ì´ë¡ 

### ADR

- ADR-052: Hair Analysis Architecture (ì˜ˆì •)
- [ADR-001: Core Image Engine](../adr/ADR-001-core-image-engine.md) - ì´ë¯¸ì§€ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
- [ADR-007: Mock Fallback Strategy](../adr/ADR-007-mock-fallback-strategy.md) - í´ë°± ì „ëµ

### ê´€ë ¨ SDD

- [SDD-CIE-2: ì–¼êµ´ ê°ì§€](./SDD-CIE-2-FACE-DETECTION.md) - 468í¬ì¸íŠ¸ ëœë“œë§ˆí¬
- [SDD-CIE-3: AWB ë³´ì •](./SDD-CIE-3-AWB-CORRECTION.md) - ì¡°ëª… ë³´ì •
- [SDD-PERSONAL-COLOR-v2](./SDD-PERSONAL-COLOR-v2.md) - PC-1 í¼ìŠ¤ë„ì»¬ëŸ¬

### ê¸°ì¡´ êµ¬í˜„

- [API êµ¬í˜„](../../apps/web/app/api/analyze/hair/route.ts)
- [Mock ë°ì´í„°](../../apps/web/lib/mock/hair-analysis.ts)
- [ì•Œë¦¼ ìƒì„±](../../apps/web/lib/alerts/index.ts)

---

---

## 13. 7ê°œ ì›ì TypeScript ì¸í„°í˜ì´ìŠ¤ í†µí•©

> ëª¨ë“  ì›ì(H-1.1 ~ H-1.7)ì˜ ì…ì¶œë ¥ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•© ì •ì˜

```typescript
// apps/web/lib/analysis/hair/types.ts

import type { Season } from '@/types/personal-color';

// ============================================
// ê³µí†µ íƒ€ì… ì •ì˜
// ============================================

/** Lab ìƒ‰ê³µê°„ */
export interface LabColor {
  L: number;  // 0-100 (ë°ê¸°)
  a: number;  // -128 ~ +127 (ë¹¨ê°•-ì´ˆë¡)
  b: number;  // -128 ~ +127 (ë…¸ë‘-íŒŒë‘)
}

/** 2D í¬ì¸íŠ¸ (ëœë“œë§ˆí¬) */
export interface Point2D {
  x: number;
  y: number;
}

/** 3D í¬ì¸íŠ¸ (MediaPipe) */
export interface Point3D extends Point2D {
  z: number;
}

/** ë°”ìš´ë”© ë°•ìŠ¤ */
export interface BoundingBox {
  x: number;
  y: number;
  width: number;
  height: number;
}

/** ì–¼êµ´í˜• ID (7ì¢…) */
export type FaceShapeId = 'oval' | 'round' | 'oblong' | 'square' | 'heart' | 'diamond' | 'triangle';

/** í—¤ì–´ íƒ€ì… ID */
export type HairTypeId = 'straight' | 'wavy' | 'curly' | 'coily';

/** ëª¨ë°œ êµµê¸° ID */
export type HairThicknessId = 'fine' | 'medium' | 'thick';

/** ë‘í”¼ íƒ€ì… ID */
export type ScalpTypeId = 'dry' | 'normal' | 'oily' | 'sensitive';

/** í—¤ì–´ì»¬ëŸ¬ ì¹´í…Œê³ ë¦¬ */
export type HairColorCategory =
  | 'black'
  | 'dark-brown'
  | 'medium-brown'
  | 'light-brown'
  | 'blonde'
  | 'red'
  | 'ash'
  | 'dyed-vivid';

/** í—¤ì–´ ê³ ë¯¼ ID */
export type HairConcernId =
  | 'hairloss'
  | 'dandruff'
  | 'frizz'
  | 'damage'
  | 'oily-scalp'
  | 'dry-scalp'
  | 'split-ends'
  | 'lack-volume';

// ============================================
// H-1.1: ì–¼êµ´í˜• ë¶„ì„ ì¸í„°í˜ì´ìŠ¤
// ============================================

/** H-1.1 ì…ë ¥ */
export interface FaceShapeInput {
  /** ì´ë¯¸ì§€ ë°ì´í„° */
  imageData: ImageData;
  /** MediaPipe 468 ëœë“œë§ˆí¬ (CIE-2ì—ì„œ ì œê³µ) */
  landmarks: Point3D[];
}

/** ì–¼êµ´ ì¸¡ì •ê°’ */
export interface FaceMeasurements {
  /** ì–¼êµ´ ê¸¸ì´ (ì´ë§ˆ â†’ í„±) */
  faceLength: number;
  /** ì–¼êµ´ ë„ˆë¹„ (ê´€ìë†€ì´ í­) */
  faceWidth: number;
  /** í„± ë„ˆë¹„ */
  jawWidth: number;
  /** ê´‘ëŒ€ ë„ˆë¹„ */
  cheekboneWidth: number;
  /** ì´ë§ˆ ë„ˆë¹„ */
  foreheadWidth: number;
  /** ê¸¸ì´/ë„ˆë¹„ ë¹„ìœ¨ */
  lengthToWidthRatio: number;
  /** í„±/ê´‘ëŒ€ ë¹„ìœ¨ */
  jawToCheekRatio: number;
}

/** H-1.1 ì¶œë ¥ */
export interface FaceShapeResult {
  /** ì–¼êµ´í˜• ID */
  faceShape: FaceShapeId;
  /** í•œêµ­ì–´ ë¼ë²¨ */
  faceShapeLabel: string;
  /** ë¶„ë¥˜ ì‹ ë¢°ë„ (0-100) */
  confidence: number;
  /** ì¸¡ì •ê°’ ìƒì„¸ */
  measurements: FaceMeasurements;
}

// ============================================
// H-1.2: í—¤ì–´ì»¬ëŸ¬ Lab ë¶„ë¥˜ ì¸í„°í˜ì´ìŠ¤
// ============================================

/** H-1.2 ì…ë ¥ */
export interface HairColorInput {
  /** ì´ë¯¸ì§€ ë°ì´í„° */
  imageData: ImageData;
  /** ì–¼êµ´ ì˜ì—­ (ì œì™¸ìš©) */
  faceRegion: BoundingBox;
  /** í—¤ì–´ë¼ì¸ ì¶”ì •ìš© ëœë“œë§ˆí¬ */
  landmarks?: Point3D[];
}

/** H-1.2 ì¶œë ¥ */
export interface HairColorResult {
  /** ì£¼ìš” ìƒ‰ìƒ (Lab) */
  dominant: LabColor;
  /** ë³´ì¡° ìƒ‰ìƒ (Lab, ì—¼ìƒ‰ ë“±) */
  secondary: LabColor | null;
  /** ìƒ‰ìƒ ì¹´í…Œê³ ë¦¬ */
  category: HairColorCategory;
  /** Hex ìƒ‰ìƒ ì½”ë“œ */
  hex: string;
  /** ë¶„ë¥˜ ì‹ ë¢°ë„ (0-100) */
  confidence: number;
}

// ============================================
// H-1.3: ëª¨ë°œ íƒ€ì… ë¶„ë¥˜ ì¸í„°í˜ì´ìŠ¤
// ============================================

/** H-1.3 ì…ë ¥ */
export interface HairTypeInput {
  /** ì´ë¯¸ì§€ ë°ì´í„° */
  imageData: ImageData;
  /** í—¤ì–´ ì˜ì—­ (ì„ íƒ) */
  hairRegion?: BoundingBox;
}

/** H-1.3 ì¶œë ¥ */
export interface HairTypeResult {
  /** í—¤ì–´ íƒ€ì… ID */
  hairType: HairTypeId;
  /** í•œêµ­ì–´ ë¼ë²¨ */
  hairTypeLabel: string;
  /** ëª¨ë°œ êµµê¸° ID */
  hairThickness: HairThicknessId;
  /** êµµê¸° í•œêµ­ì–´ ë¼ë²¨ */
  hairThicknessLabel: string;
  /** ë¶„ë¥˜ ì‹ ë¢°ë„ (0-100) */
  confidence: number;
}

// ============================================
// H-1.4: ë‘í”¼ ìƒíƒœ ë¶„ì„ ì¸í„°í˜ì´ìŠ¤
// ============================================

/** H-1.4 ì…ë ¥ */
export interface ScalpAnalysisInput {
  /** ì´ë¯¸ì§€ ë°ì´í„° */
  imageData: ImageData;
}

/** ê±´ê°• ì§€í‘œ */
export interface HealthMetric {
  /** ì§€í‘œ ID */
  id: string;
  /** í•œêµ­ì–´ ë¼ë²¨ */
  label: string;
  /** ì ìˆ˜ (0-100) */
  value: number;
  /** ìƒíƒœ */
  status: 'good' | 'normal' | 'warning';
  /** ì„¤ëª… */
  description: string;
}

/** H-1.4 ì¶œë ¥ */
export interface ScalpAnalysisResult {
  /** ë‘í”¼ íƒ€ì… ID */
  scalpType: ScalpTypeId;
  /** í•œêµ­ì–´ ë¼ë²¨ */
  scalpTypeLabel: string;
  /** ê±´ê°• ì§€í‘œ (6ê°œ) */
  metrics: {
    hydration: HealthMetric;     // ìˆ˜ë¶„ë„
    scalpHealth: HealthMetric;   // ë‘í”¼ ê±´ê°•
    damageLevel: HealthMetric;   // ì†ìƒë„
    density: HealthMetric;       // ëª¨ë°œ ë°€ë„
    elasticity: HealthMetric;    // íƒ„ë ¥
    shine: HealthMetric;         // ìœ¤ê¸°
  };
  /** ì „ì²´ ì ìˆ˜ (0-100) */
  overallScore: number;
  /** ê°ì§€ëœ ê³ ë¯¼ ëª©ë¡ */
  concerns: HairConcernId[];
  /** ë¶„ì„ ì‹ ë¢°ë„ */
  analysisReliability: 'high' | 'medium' | 'low';
}

// ============================================
// H-1.5: í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ ì¸í„°í˜ì´ìŠ¤
// ============================================

/** H-1.5 ì…ë ¥ */
export interface HairStyleRecommendInput {
  /** ì–¼êµ´í˜• ê²°ê³¼ */
  faceShapeResult: FaceShapeResult;
  /** í—¤ì–´ íƒ€ì… ê²°ê³¼ */
  hairTypeResult: HairTypeResult;
  /** ì„±ë³„ (ì„ íƒ) */
  gender?: 'male' | 'female' | 'unspecified';
}

/** í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ í•­ëª© */
export interface HairStyleRecommendation {
  /** ìŠ¤íƒ€ì¼ ID */
  styleId: string;
  /** ì˜ë¬¸ ì´ë¦„ */
  styleName: string;
  /** í•œêµ­ì–´ ì´ë¦„ */
  styleNameKr: string;
  /** ìŠ¤íƒ€ì¼ ì„¤ëª… */
  description: string;
  /** ë§¤ì¹­ ì ìˆ˜ (0-100) */
  matchScore: number;
  /** ë§¤ì¹­ ì´ìœ  */
  matchReason: string;
  /** ì°¸ê³  ì´ë¯¸ì§€ URL */
  imageUrl?: string;
  /** ì í•©í•œ ì–¼êµ´í˜• ëª©ë¡ */
  suitableFaceShapes: FaceShapeId[];
}

/** H-1.5 ì¶œë ¥ */
export interface HairStyleRecommendResult {
  /** ì¶”ì²œ ìŠ¤íƒ€ì¼ ëª©ë¡ (ìµœëŒ€ 5ê°œ) */
  recommendations: HairStyleRecommendation[];
  /** í”¼í•´ì•¼ í•  ìŠ¤íƒ€ì¼ */
  avoidStyles?: string[];
  /** ìŠ¤íƒ€ì¼ë§ íŒ */
  stylingTips: string[];
}

// ============================================
// H-1.6: Mock Fallback ì¸í„°í˜ì´ìŠ¤
// ============================================

/** H-1.6 ì…ë ¥ */
export interface MockFallbackInput {
  /** ì…ë ¥ ì´ë¯¸ì§€ì˜ íŠ¹ì„± (ë¶„ì„ ì‹¤íŒ¨ ì‹œì—ë„ ê¸°ë³¸ê°’ ìƒì„±ìš©) */
  imageCharacteristics?: {
    brightness: number;
    hasHair: boolean;
    hasFace: boolean;
  };
  /** íƒ€ì„ì•„ì›ƒ ì—¬ë¶€ */
  isTimeout: boolean;
  /** ì—ëŸ¬ ë©”ì‹œì§€ */
  errorMessage?: string;
}

/** H-1.6 ì¶œë ¥ */
export interface MockFallbackResult {
  /** Mock ë°ì´í„° */
  result: HairAnalysisOutput;
  /** Mock ì‚¬ìš© ì—¬ë¶€ */
  usedMock: true;
  /** Mock ì‚¬ìš© ì´ìœ  */
  fallbackReason: 'timeout' | 'error' | 'low_confidence' | 'feature_disabled';
}

// ============================================
// H-1.7: API í†µí•© ì¸í„°í˜ì´ìŠ¤
// ============================================

/** H-1 í†µí•© ì…ë ¥ (API ìš”ì²­ ë³¸ë¬¸) */
export interface H1Input {
  /** Base64 ì¸ì½”ë”© ì´ë¯¸ì§€ */
  imageBase64: string;
  /** Mock ê°•ì œ ì‚¬ìš© */
  useMock?: boolean;
  /** ìƒ‰ìƒ ë¶„ì„ í¬í•¨ */
  includeColorAnalysis?: boolean;
  /** ì–¼êµ´í˜• ë¶„ì„ í¬í•¨ */
  includeFaceShapeAnalysis?: boolean;
  /** PC-1 ê²°ê³¼ ID (í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ ì—°ë™) */
  personalColorId?: string;
  /** ê¸°ì¡´ í¼ìŠ¤ë„ì»¬ëŸ¬ ê²°ê³¼ (ì§ì ‘ ì£¼ì…) */
  personalColorResult?: {
    season: Season;
    undertone: 'warm' | 'cool' | 'neutral';
  };
}

/** í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ í•­ëª© */
export interface HairColorRecommendation {
  /** ìƒ‰ìƒëª… (ì˜ë¬¸) */
  colorName: string;
  /** ìƒ‰ìƒëª… (í•œêµ­ì–´) */
  colorNameKr: string;
  /** Hex ìƒ‰ìƒ ì½”ë“œ */
  hex: string;
  /** Lab ìƒ‰ìƒê°’ */
  lab: LabColor;
  /** ë§¤ì¹­ ì ìˆ˜ (0-100) */
  matchScore: number;
  /** ë§¤ì¹­ ì´ìœ  */
  matchReason: string;
  /** ì í•©í•œ ì‹œì¦Œ */
  seasonCompatibility: Season[];
}

/** ì œí’ˆ ì¶”ì²œ í•­ëª© */
export interface ProductRecommendation {
  /** ì œí’ˆ ì¹´í…Œê³ ë¦¬ */
  category: string;
  /** ì œí’ˆëª…/ì„±ë¶„ëª… */
  name: string;
  /** ì¶”ì²œ ì„¤ëª… */
  description: string;
}

/** H-1 í†µí•© ì¶œë ¥ (API ì‘ë‹µ) */
export interface H1Output {
  // ì–¼êµ´í˜• ì •ë³´ (H-1.1)
  faceShape?: FaceShapeId;
  faceShapeLabel?: string;
  faceShapeConfidence?: number;
  faceMeasurements?: FaceMeasurements;

  // í—¤ì–´ì»¬ëŸ¬ ì •ë³´ (H-1.2)
  hairColor?: HairColorResult;

  // í—¤ì–´ íƒ€ì… ì •ë³´ (H-1.3)
  hairType: HairTypeId;
  hairTypeLabel: string;
  hairThickness: HairThicknessId;
  hairThicknessLabel: string;

  // ë‘í”¼ ìƒíƒœ ì •ë³´ (H-1.4)
  scalpType: ScalpTypeId;
  scalpTypeLabel: string;
  overallScore: number;
  metrics: HealthMetric[];
  concerns: HairConcernId[];

  // ì¶”ì²œ ì •ë³´ (H-1.5)
  recommendedHairStyles?: HairStyleRecommendation[];
  recommendedHairColors?: HairColorRecommendation[];
  recommendedIngredients: string[];
  recommendedProducts: ProductRecommendation[];
  careTips: string[];

  // ì¸ì‚¬ì´íŠ¸
  insight: string;

  // ë©”íƒ€ë°ì´í„°
  analyzedAt: Date;
  analysisReliability: 'high' | 'medium' | 'low';
  usedMock: boolean;
}

// ============================================
// ë¶„ì„ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜
// ============================================

/** ì–¼êµ´í˜• ë¶„ì„ í•¨ìˆ˜ */
export type AnalyzeFaceShape = (input: FaceShapeInput) => Promise<FaceShapeResult>;

/** í—¤ì–´ì»¬ëŸ¬ ë¶„ì„ í•¨ìˆ˜ */
export type AnalyzeHairColor = (input: HairColorInput) => Promise<HairColorResult>;

/** í—¤ì–´ íƒ€ì… ë¶„ì„ í•¨ìˆ˜ */
export type AnalyzeHairType = (input: HairTypeInput) => Promise<HairTypeResult>;

/** ë‘í”¼ ìƒíƒœ ë¶„ì„ í•¨ìˆ˜ */
export type AnalyzeScalp = (input: ScalpAnalysisInput) => Promise<ScalpAnalysisResult>;

/** í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ í•¨ìˆ˜ */
export type RecommendHairStyles = (input: HairStyleRecommendInput) => Promise<HairStyleRecommendResult>;

/** Mock ìƒì„± í•¨ìˆ˜ */
export type GenerateMockResult = (input: MockFallbackInput) => MockFallbackResult;

/** í†µí•© ë¶„ì„ í•¨ìˆ˜ */
export type AnalyzeHair = (input: H1Input) => Promise<H1Output>;
```

---

## 13. ì ‘ê·¼ì„± (Accessibility)

> WCAG 2.1 AA ì¤€ìˆ˜ ë° ìŠ¤í¬ë¦° ë¦¬ë” ì§€ì›

### 13.1 WCAG 2.1 AA ì¤€ìˆ˜ í•­ëª©

| ê¸°ì¤€ | í•­ëª© | ì ìš© |
|------|------|------|
| 1.1.1 | ë¹„í…ìŠ¤íŠ¸ ì½˜í…ì¸  | ì–¼êµ´í˜•/í—¤ì–´ ì´ë¯¸ì§€ alt í…ìŠ¤íŠ¸ |
| 1.3.1 | ì •ë³´ì™€ ê´€ê³„ | ë¶„ì„ ê²°ê³¼ ì‹œë§¨í‹± ë§ˆí¬ì—… |
| 1.4.3 | ëª…ì•” ëŒ€ë¹„ (ìµœì†Œ) | 4.5:1 í…ìŠ¤íŠ¸, 3:1 UI |
| 1.4.11 | ë¹„í…ìŠ¤íŠ¸ ëª…ì•” ëŒ€ë¹„ | í—¤ì–´ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ í…Œë‘ë¦¬ |
| 2.1.1 | í‚¤ë³´ë“œ | ìŠ¤íƒ€ì¼ ê°¤ëŸ¬ë¦¬ í‚¤ë³´ë“œ íƒìƒ‰ |
| 2.4.4 | ë§í¬ ëª©ì  | ì œí’ˆ/ìŠ¤íƒ€ì¼ ë§í¬ ëª…í™•í™” |
| 4.1.2 | ì´ë¦„, ì—­í• , ê°’ | ARIA ì†ì„± ì™„ë¹„ |

### 13.2 ì–¼êµ´í˜• ë¶„ì„ ê²°ê³¼ ì ‘ê·¼ì„±

```tsx
// components/analysis/hair/FaceShapeResult.tsx
interface FaceShapeResultProps {
  faceShape: FaceShapeType;
  confidence: number;
  measurements: FaceMeasurements;
}

export function FaceShapeResult({
  faceShape,
  confidence,
  measurements
}: FaceShapeResultProps) {
  const faceShapeLabels: Record<FaceShapeType, string> = {
    oval: 'ê³„ë€í˜•',
    round: 'ë‘¥ê·¼í˜•',
    oblong: 'ê¸´ ì–¼êµ´í˜•',
    square: 'ì‚¬ê°í˜•',
    heart: 'í•˜íŠ¸í˜•',
    diamond: 'ë‹¤ì´ì•„ëª¬ë“œí˜•',
    triangle: 'ì—­ì‚¼ê°í˜•',
  };

  return (
    <article
      role="region"
      aria-labelledby="face-shape-result-title"
      data-testid="face-shape-result"
    >
      <h2 id="face-shape-result-title">ì–¼êµ´í˜• ë¶„ì„ ê²°ê³¼</h2>

      {/* ë©”ì¸ ê²°ê³¼ */}
      <div
        role="status"
        aria-live="polite"
        aria-atomic="true"
      >
        <p>
          ë¶„ì„ ê²°ê³¼: <strong>{faceShapeLabels[faceShape]}</strong>
          <span className="sr-only">
            (ì‹ ë¢°ë„ {confidence}%)
          </span>
        </p>
      </div>

      {/* ì¸¡ì •ê°’ ìƒì„¸ */}
      <section aria-labelledby="measurements-title">
        <h3 id="measurements-title">ì–¼êµ´ ì¸¡ì •ê°’</h3>
        <dl>
          <div>
            <dt>ì–¼êµ´ ê¸¸ì´</dt>
            <dd aria-label={`ì–¼êµ´ ê¸¸ì´ ${measurements.faceLength.toFixed(1)} í”½ì…€`}>
              {measurements.faceLength.toFixed(1)}px
            </dd>
          </div>
          <div>
            <dt>ì–¼êµ´ ë„ˆë¹„</dt>
            <dd aria-label={`ì–¼êµ´ ë„ˆë¹„ ${measurements.faceWidth.toFixed(1)} í”½ì…€`}>
              {measurements.faceWidth.toFixed(1)}px
            </dd>
          </div>
          <div>
            <dt>ë¹„ìœ¨ (ê¸¸ì´:ë„ˆë¹„)</dt>
            <dd aria-label={`ê¸¸ì´ ëŒ€ ë„ˆë¹„ ë¹„ìœ¨ ${measurements.ratio.toFixed(2)}`}>
              {measurements.ratio.toFixed(2)}
            </dd>
          </div>
        </dl>
      </section>

      {/* ì–¼êµ´í˜• ì‹œê°í™” (ì‹œê° ì¥ì• ì¸ìš© ëŒ€ì²´ í…ìŠ¤íŠ¸) */}
      <figure aria-labelledby="face-shape-figure-caption">
        <div
          className="face-shape-diagram"
          role="img"
          aria-label={`${faceShapeLabels[faceShape]} ì–¼êµ´í˜• ë‹¤ì´ì–´ê·¸ë¨. ${getFaceShapeDescription(faceShape)}`}
        />
        <figcaption id="face-shape-figure-caption" className="sr-only">
          {faceShapeLabels[faceShape]} ì–¼êµ´í˜•: {getFaceShapeDescription(faceShape)}
        </figcaption>
      </figure>
    </article>
  );
}

function getFaceShapeDescription(shape: FaceShapeType): string {
  const descriptions: Record<FaceShapeType, string> = {
    oval: 'ì´ìƒì ì¸ ë¹„ìœ¨ì˜ ê³„ë€í˜•ìœ¼ë¡œ, ì´ë§ˆì™€ í„±ì´ ë¶€ë“œëŸ½ê²Œ ì¢ì•„ì§€ëŠ” í˜•íƒœì…ë‹ˆë‹¤.',
    round: 'ê¸¸ì´ì™€ ë„ˆë¹„ê°€ ë¹„ìŠ·í•˜ë©°, ë³¼ì´ ë‘¥ê¸€ê³  ë¶€ë“œëŸ¬ìš´ ì¸ìƒì…ë‹ˆë‹¤.',
    oblong: 'ê¸¸ì´ê°€ ë„ˆë¹„ë³´ë‹¤ ê¸¸ë©°, ì´ë§ˆ, ê´‘ëŒ€, í„±ì„ ì´ ë¹„ìŠ·í•œ ë„ˆë¹„ì…ë‹ˆë‹¤.',
    square: 'ì´ë§ˆ, ê´‘ëŒ€, í„±ì„  ë„ˆë¹„ê°€ ë¹„ìŠ·í•˜ê³  í„±ì„ ì´ ê°ì§„ í˜•íƒœì…ë‹ˆë‹¤.',
    heart: 'ì´ë§ˆê°€ ë„“ê³  í„±ì´ ì¢ì•„ì§€ë©° í•˜íŠ¸ ëª¨ì–‘ì„ ë‹®ì•˜ìŠµë‹ˆë‹¤.',
    diamond: 'ê´‘ëŒ€ê°€ ê°€ì¥ ë„“ê³  ì´ë§ˆì™€ í„±ì´ ì¢ì€ ë‹¤ì´ì•„ëª¬ë“œ í˜•íƒœì…ë‹ˆë‹¤.',
    triangle: 'í„±ì´ ë„“ê³  ì´ë§ˆê°€ ì¢ì€ ì—­ì‚¼ê°í˜• í˜•íƒœì…ë‹ˆë‹¤.',
  };
  return descriptions[shape];
}
```

### 13.3 í—¤ì–´ì»¬ëŸ¬ ë¶„ì„ ì ‘ê·¼ì„±

```tsx
// components/analysis/hair/HairColorResult.tsx
interface HairColorResultProps {
  currentColor: LabColor;
  colorName: string;
  tone: 'warm' | 'cool' | 'neutral';
  recommendedColors: HairColorRecommendation[];
}

export function HairColorResult({
  currentColor,
  colorName,
  tone,
  recommendedColors,
}: HairColorResultProps) {
  const toneLabels = {
    warm: 'ì›œí†¤',
    cool: 'ì¿¨í†¤',
    neutral: 'ë‰´íŠ¸ëŸ´',
  };

  return (
    <article
      role="region"
      aria-labelledby="hair-color-result-title"
      data-testid="hair-color-result"
    >
      <h2 id="hair-color-result-title">í—¤ì–´ì»¬ëŸ¬ ë¶„ì„ ê²°ê³¼</h2>

      {/* í˜„ì¬ í—¤ì–´ì»¬ëŸ¬ */}
      <section aria-labelledby="current-color-title">
        <h3 id="current-color-title">í˜„ì¬ í—¤ì–´ì»¬ëŸ¬</h3>
        <div className="color-display">
          <div
            className="color-swatch"
            style={{ backgroundColor: labToHex(currentColor) }}
            role="img"
            aria-label={`í˜„ì¬ í—¤ì–´ì»¬ëŸ¬: ${colorName}, ${toneLabels[tone]}`}
          />
          <div>
            <p><strong>{colorName}</strong></p>
            <p>í†¤: {toneLabels[tone]}</p>
            <p className="sr-only">
              Lab ìƒ‰ìƒê°’: L={currentColor.L.toFixed(1)},
              a={currentColor.a.toFixed(1)},
              b={currentColor.b.toFixed(1)}
            </p>
          </div>
        </div>
      </section>

      {/* ì¶”ì²œ í—¤ì–´ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ */}
      <section aria-labelledby="recommended-colors-title">
        <h3 id="recommended-colors-title">ì¶”ì²œ í—¤ì–´ì»¬ëŸ¬</h3>
        <ul
          role="list"
          aria-label="ì¶”ì²œ í—¤ì–´ì»¬ëŸ¬ ëª©ë¡"
          className="color-palette"
        >
          {recommendedColors.map((color, index) => (
            <li
              key={color.name}
              className="color-item"
            >
              <div
                className="color-swatch"
                style={{
                  backgroundColor: color.hexCode,
                  border: '2px solid currentColor', // 3:1 ëŒ€ë¹„
                }}
                role="img"
                aria-label={`${color.name}: ${color.hexCode}`}
              />
              <span>{color.name}</span>
              <span className="sr-only">
                ë§¤ì¹˜ìœ¨ {color.matchRate}%, {color.description}
              </span>
            </li>
          ))}
        </ul>
      </section>
    </article>
  );
}
```

### 13.4 ë‘í”¼ ê±´ê°• ì ìˆ˜ ì ‘ê·¼ì„±

```tsx
// components/analysis/hair/ScalpHealthGauge.tsx
interface ScalpHealthGaugeProps {
  healthScore: number;
  scalpType: ScalpType;
  concerns: string[];
}

export function ScalpHealthGauge({
  healthScore,
  scalpType,
  concerns,
}: ScalpHealthGaugeProps) {
  const getHealthLevel = (score: number): string => {
    if (score >= 80) return 'ë§¤ìš° ê±´ê°•';
    if (score >= 60) return 'ê±´ê°•';
    if (score >= 40) return 'ë³´í†µ';
    if (score >= 20) return 'ì£¼ì˜ í•„ìš”';
    return 'ê´€ë¦¬ í•„ìš”';
  };

  const scalpTypeLabels: Record<ScalpType, string> = {
    dry: 'ê±´ì„±',
    normal: 'ì¤‘ì„±',
    oily: 'ì§€ì„±',
    sensitive: 'ë¯¼ê°ì„±',
  };

  return (
    <section
      aria-labelledby="scalp-health-title"
      data-testid="scalp-health-gauge"
    >
      <h3 id="scalp-health-title">ë‘í”¼ ê±´ê°• ìƒíƒœ</h3>

      {/* ë‘í”¼ íƒ€ì… */}
      <p role="status" aria-live="polite">
        ë‘í”¼ íƒ€ì…: <strong>{scalpTypeLabels[scalpType]}</strong>
      </p>

      {/* ê±´ê°• ì ìˆ˜ ê²Œì´ì§€ */}
      <div
        role="meter"
        aria-valuenow={healthScore}
        aria-valuemin={0}
        aria-valuemax={100}
        aria-label={`ë‘í”¼ ê±´ê°• ì ìˆ˜ ${healthScore}ì , ${getHealthLevel(healthScore)}`}
        aria-describedby="scalp-health-description"
        className="health-gauge"
      >
        <div
          className="gauge-fill"
          style={{ width: `${healthScore}%` }}
        />
        <span className="gauge-label">{healthScore}ì </span>
      </div>
      <p id="scalp-health-description" className="sr-only">
        ë‘í”¼ ê±´ê°• ì ìˆ˜ëŠ” 0ì—ì„œ 100 ì‚¬ì´ì´ë©°,
        80ì  ì´ìƒì€ ë§¤ìš° ê±´ê°•, 60-79ì ì€ ê±´ê°•,
        40-59ì ì€ ë³´í†µ, 20-39ì ì€ ì£¼ì˜ í•„ìš”,
        20ì  ë¯¸ë§Œì€ ê´€ë¦¬ í•„ìš” ìƒíƒœì…ë‹ˆë‹¤.
      </p>

      {/* ë‘í”¼ ê³ ë¯¼ ëª©ë¡ */}
      {concerns.length > 0 && (
        <div aria-labelledby="scalp-concerns-title">
          <h4 id="scalp-concerns-title">ê°ì§€ëœ ë‘í”¼ ê³ ë¯¼</h4>
          <ul role="list" aria-label="ë‘í”¼ ê³ ë¯¼ ëª©ë¡">
            {concerns.map((concern, index) => (
              <li key={index}>{concern}</li>
            ))}
          </ul>
        </div>
      )}
    </section>
  );
}
```

### 13.5 í—¤ì–´ìŠ¤íƒ€ì¼ ê°¤ëŸ¬ë¦¬ í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜

```tsx
// components/analysis/hair/HairStyleGallery.tsx
interface HairStyleGalleryProps {
  styles: HairStyleRecommendation[];
  onSelect: (style: HairStyleRecommendation) => void;
}

export function HairStyleGallery({ styles, onSelect }: HairStyleGalleryProps) {
  const [selectedIndex, setSelectedIndex] = useState(0);
  const galleryRef = useRef<HTMLDivElement>(null);

  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {
    switch (e.key) {
      case 'ArrowLeft':
        e.preventDefault();
        setSelectedIndex(prev => Math.max(0, prev - 1));
        break;
      case 'ArrowRight':
        e.preventDefault();
        setSelectedIndex(prev => Math.min(styles.length - 1, prev + 1));
        break;
      case 'Home':
        e.preventDefault();
        setSelectedIndex(0);
        break;
      case 'End':
        e.preventDefault();
        setSelectedIndex(styles.length - 1);
        break;
      case 'Enter':
      case ' ':
        e.preventDefault();
        onSelect(styles[selectedIndex]);
        break;
    }
  }, [styles, selectedIndex, onSelect]);

  // ì„ íƒ ë³€ê²½ ì‹œ í¬ì»¤ìŠ¤ ì´ë™
  useEffect(() => {
    const gallery = galleryRef.current;
    if (gallery) {
      const selectedItem = gallery.querySelector(`[data-index="${selectedIndex}"]`);
      (selectedItem as HTMLElement)?.focus();
    }
  }, [selectedIndex]);

  return (
    <section aria-labelledby="hairstyle-gallery-title">
      <h3 id="hairstyle-gallery-title">ì¶”ì²œ í—¤ì–´ìŠ¤íƒ€ì¼</h3>

      <div
        ref={galleryRef}
        role="listbox"
        aria-label="ì¶”ì²œ í—¤ì–´ìŠ¤íƒ€ì¼ ê°¤ëŸ¬ë¦¬"
        aria-activedescendant={`style-${selectedIndex}`}
        onKeyDown={handleKeyDown}
        tabIndex={0}
        className="style-gallery"
      >
        {styles.map((style, index) => (
          <div
            key={style.name}
            id={`style-${index}`}
            data-index={index}
            role="option"
            aria-selected={index === selectedIndex}
            tabIndex={index === selectedIndex ? 0 : -1}
            onClick={() => {
              setSelectedIndex(index);
              onSelect(style);
            }}
            className={`style-item ${index === selectedIndex ? 'selected' : ''}`}
          >
            <img
              src={style.imageUrl}
              alt={`${style.name} í—¤ì–´ìŠ¤íƒ€ì¼. ${style.description}`}
              loading="lazy"
            />
            <div className="style-info">
              <p className="style-name">{style.name}</p>
              <p className="style-match">
                <span aria-label={`ë§¤ì¹˜ìœ¨ ${style.matchRate}í¼ì„¼íŠ¸`}>
                  {style.matchRate}%
                </span>
              </p>
            </div>
          </div>
        ))}
      </div>

      <p className="sr-only" aria-live="polite">
        {styles[selectedIndex]?.name} ì„ íƒë¨.
        ì¢Œìš° í™”ì‚´í‘œë¡œ íƒìƒ‰, Enterë¡œ ì„ íƒí•˜ì„¸ìš”.
      </p>

      {/* í‚¤ë³´ë“œ ì•ˆë‚´ (ì‹œê°ì ìœ¼ë¡œë„ í‘œì‹œ) */}
      <p className="keyboard-hint" aria-hidden="true">
        â† â†’ í‚¤ë¡œ íƒìƒ‰, Enterë¡œ ì„ íƒ
      </p>
    </section>
  );
}
```

### 13.6 ëª¨ë°œ ê±´ê°• ì§€í‘œ ì ‘ê·¼ì„±

```tsx
// components/analysis/hair/HairHealthMetrics.tsx
interface HairHealthMetricsProps {
  metrics: {
    moisture: number;    // ìˆ˜ë¶„
    damage: number;      // ì†ìƒë„ (ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)
    elasticity: number;  // íƒ„ë ¥
    shine: number;       // ìœ¤ê¸°
    density: number;     // ë°€ë„
    thickness: number;   // êµµê¸°
  };
}

export function HairHealthMetrics({ metrics }: HairHealthMetricsProps) {
  const metricLabels = {
    moisture: { label: 'ìˆ˜ë¶„', unit: '%', optimal: '60-80%' },
    damage: { label: 'ì†ìƒë„', unit: '%', optimal: '0-20% (ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)' },
    elasticity: { label: 'íƒ„ë ¥', unit: '%', optimal: '70-90%' },
    shine: { label: 'ìœ¤ê¸°', unit: '%', optimal: '60-80%' },
    density: { label: 'ë°€ë„', unit: '%', optimal: '70-100%' },
    thickness: { label: 'êµµê¸°', unit: 'Î¼m', optimal: '60-80Î¼m' },
  };

  return (
    <section
      aria-labelledby="hair-health-metrics-title"
      data-testid="hair-health-metrics"
    >
      <h3 id="hair-health-metrics-title">ëª¨ë°œ ê±´ê°• ì§€í‘œ</h3>

      <div className="metrics-grid" role="list" aria-label="ëª¨ë°œ ê±´ê°• ì§€í‘œ ëª©ë¡">
        {Object.entries(metrics).map(([key, value]) => {
          const metricKey = key as keyof typeof metricLabels;
          const { label, unit, optimal } = metricLabels[metricKey];

          return (
            <div
              key={key}
              role="listitem"
              className="metric-item"
            >
              <div
                role="meter"
                aria-valuenow={value}
                aria-valuemin={0}
                aria-valuemax={100}
                aria-label={`${label} ${value}${unit}`}
                aria-describedby={`${key}-description`}
              >
                <div className="meter-bar">
                  <div
                    className="meter-fill"
                    style={{ width: `${value}%` }}
                  />
                </div>
                <span className="meter-value">{value}{unit}</span>
              </div>
              <span className="metric-label">{label}</span>
              <span id={`${key}-description`} className="sr-only">
                ì ì • ë²”ìœ„: {optimal}
              </span>
            </div>
          );
        })}
      </div>
    </section>
  );
}
```

### 13.7 ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

```typescript
// tests/a11y/hair-analysis.a11y.test.tsx
import { render } from '@testing-library/react';
import { axe, toHaveNoViolations } from 'jest-axe';
import { FaceShapeResult } from '@/components/analysis/hair/FaceShapeResult';
import { HairColorResult } from '@/components/analysis/hair/HairColorResult';
import { ScalpHealthGauge } from '@/components/analysis/hair/ScalpHealthGauge';
import { HairStyleGallery } from '@/components/analysis/hair/HairStyleGallery';

expect.extend(toHaveNoViolations);

describe('H-1 Hair Analysis Accessibility', () => {
  describe('FaceShapeResult', () => {
    it('should have no accessibility violations', async () => {
      const { container } = render(
        <FaceShapeResult
          faceShape="oval"
          confidence={85}
          measurements={{
            faceLength: 200,
            faceWidth: 150,
            ratio: 1.33,
          }}
        />
      );
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    });

    it('should have proper ARIA labels for measurements', () => {
      const { getByLabelText } = render(
        <FaceShapeResult
          faceShape="heart"
          confidence={80}
          measurements={{
            faceLength: 210,
            faceWidth: 160,
            ratio: 1.31,
          }}
        />
      );

      expect(getByLabelText(/ì–¼êµ´ ê¸¸ì´ 210.0 í”½ì…€/)).toBeInTheDocument();
      expect(getByLabelText(/ì–¼êµ´ ë„ˆë¹„ 160.0 í”½ì…€/)).toBeInTheDocument();
    });
  });

  describe('HairColorResult', () => {
    it('should have no accessibility violations', async () => {
      const { container } = render(
        <HairColorResult
          currentColor={{ L: 30, a: 5, b: 10 }}
          colorName="ë‹¤í¬ ë¸Œë¼ìš´"
          tone="warm"
          recommendedColors={[
            { name: 'ì¹´ë¼ë©œ ë¸Œë¼ìš´', hexCode: '#8B4513', matchRate: 92, description: 'ë”°ëœ»í•œ ëŠë‚Œì˜ ê°ˆìƒ‰' },
          ]}
        />
      );
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    });

    it('should provide color information for screen readers', () => {
      const { getByLabelText, getByText } = render(
        <HairColorResult
          currentColor={{ L: 30, a: 5, b: 10 }}
          colorName="ë‹¤í¬ ë¸Œë¼ìš´"
          tone="warm"
          recommendedColors={[]}
        />
      );

      expect(getByLabelText(/í˜„ì¬ í—¤ì–´ì»¬ëŸ¬: ë‹¤í¬ ë¸Œë¼ìš´, ì›œí†¤/)).toBeInTheDocument();
    });
  });

  describe('ScalpHealthGauge', () => {
    it('should have proper meter role and values', () => {
      const { getByRole } = render(
        <ScalpHealthGauge
          healthScore={75}
          scalpType="normal"
          concerns={['ê°€ë²¼ìš´ ê°ì§ˆ']}
        />
      );

      const meter = getByRole('meter');
      expect(meter).toHaveAttribute('aria-valuenow', '75');
      expect(meter).toHaveAttribute('aria-valuemin', '0');
      expect(meter).toHaveAttribute('aria-valuemax', '100');
    });
  });

  describe('HairStyleGallery', () => {
    it('should support keyboard navigation', async () => {
      const onSelect = vi.fn();
      const styles = [
        { name: 'ë ˆì´ì–´ë“œ ì»·', imageUrl: '/img1.jpg', matchRate: 90, description: 'ë³¼ë¥¨ê° ìˆëŠ” ìŠ¤íƒ€ì¼' },
        { name: 'ë³´ë¸Œ ì»·', imageUrl: '/img2.jpg', matchRate: 85, description: 'ë‹¨ì •í•œ ìŠ¤íƒ€ì¼' },
      ];

      const { getByRole } = render(
        <HairStyleGallery styles={styles} onSelect={onSelect} />
      );

      const listbox = getByRole('listbox');
      listbox.focus();

      // ArrowRight í‚¤ í…ŒìŠ¤íŠ¸
      fireEvent.keyDown(listbox, { key: 'ArrowRight' });
      expect(getByRole('option', { name: /ë³´ë¸Œ ì»·/ })).toHaveAttribute('aria-selected', 'true');

      // Enter í‚¤ í…ŒìŠ¤íŠ¸
      fireEvent.keyDown(listbox, { key: 'Enter' });
      expect(onSelect).toHaveBeenCalledWith(styles[1]);
    });

    it('should announce selection changes', () => {
      const { getByText } = render(
        <HairStyleGallery
          styles={[
            { name: 'ë ˆì´ì–´ë“œ ì»·', imageUrl: '/img1.jpg', matchRate: 90, description: '' },
          ]}
          onSelect={() => {}}
        />
      );

      expect(getByText(/ë ˆì´ì–´ë“œ ì»· ì„ íƒë¨/)).toBeInTheDocument();
    });
  });
});
```

---

## 15. êµ¬í˜„ ì¼ì • (Implementation Schedule)

### 15.1 ì¼ì • ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì˜ˆìƒ ë¶„ê¸°** | 2026 Q3 |
| **ìš°ì„ ìˆœìœ„** | P1 (í¬ë¡œìŠ¤ ëª¨ë“ˆ ì—°ë™) |
| **ì˜ˆìƒ ê¸°ê°„** | 4-5ì£¼ |

### 15.2 ì„ í–‰ ì¡°ê±´ (Prerequisites)

| ì„ í–‰ ëª¨ë“ˆ | ìƒíƒœ | ì˜ì¡´ì„± ì„¤ëª… |
|----------|------|------------|
| **CIE-2** (ì–¼êµ´ ê°ì§€) | Complete | 468í¬ì¸íŠ¸ ëœë“œë§ˆí¬, ì–¼êµ´í˜• ë¶„ë¥˜ ê¸°ë°˜ |
| **CIE-3** (AWB ë³´ì •) | Complete | í—¤ì–´ì»¬ëŸ¬ Lab ì¶”ì¶œ ì •í™•ë„ |
| **PC-1** (í¼ìŠ¤ë„ì»¬ëŸ¬) | âœ… Stable | ì‹œì¦Œë³„ í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ ì—°ë™ |

### 15.3 ë§ˆì¼ìŠ¤í†¤

| Phase | ê¸°ê°„ | ì£¼ìš” ì‘ì—… | ì‚°ì¶œë¬¼ |
|-------|------|----------|--------|
| **Phase 1** | 1ì£¼ | ì–¼êµ´í˜• ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜ (7ê°œ ìœ í˜•) | `lib/hair/face-shape-classifier.ts` |
| **Phase 2** | 1ì£¼ | í—¤ì–´ì»¬ëŸ¬ Lab ì¶”ì¶œ | `lib/hair/hair-color-analyzer.ts` |
| **Phase 3** | 1ì£¼ | ë‘í”¼/ëª¨ë°œ ê±´ê°• ë¶„ì„ (AI) | `lib/hair/scalp-analyzer.ts` |
| **Phase 4** | 1ì£¼ | PC-1 ì—°ë™, ì¶”ì²œ ì—”ì§„ | `lib/hair/style-recommender.ts` |
| **Buffer** | 0.5ì£¼ | QA, í…ŒìŠ¤íŠ¸ | - |

### 15.4 í›„í–‰ ëª¨ë“ˆ (Downstream)

| ëª¨ë“ˆ | ì‚¬ìš© í•„ë“œ | ì˜í–¥ |
|------|----------|------|
| **M-1** (ë©”ì´í¬ì—…) | `faceShape` | ì»¨íˆ¬ì–´ë§ ê°€ì´ë“œ |
| **J-3** (í’€ ì•„ì›ƒí•) | `hairStyle` | ì „ì²´ ìŠ¤íƒ€ì¼ë§ ì¡°í™” |
| **ì œí’ˆ ì¶”ì²œ** | `hairConcerns` | í—¤ì–´ì¼€ì–´ ì œí’ˆ ë§¤ì¹­ |
| **N-1 ì—°ë™** | `scalpHealth` | ì˜ì–‘ì†Œ-ë‘í”¼ ê±´ê°• ìƒê´€ ë¶„ì„ |

### 15.5 ìœ„í—˜ ìš”ì†Œ

| ìœ„í—˜ | ì˜í–¥ë„ | ëŒ€ì‘ |
|------|--------|------|
| ì–¼êµ´í˜• ë¶„ë¥˜ ì •í™•ë„ | ì¤‘ê°„ | AI ë³´ì¡° ê²€ì¦, 85% ëª©í‘œ |
| í—¤ì–´ ì˜ì—­ ì¶”ì¶œ | ì¤‘ê°„ | ë°°ê²½ ì œê±° ì „ì²˜ë¦¬ |
| ë‹¤ì–‘í•œ í—¤ì–´ìŠ¤íƒ€ì¼ | ë‚®ìŒ | ê¸°ë³¸ ìŠ¤íƒ€ì¼ ìš°ì„ , ì ì§„ í™•ì¥ |

---

**Author**: Claude Code
**Reviewed by**: -
**Version History**:
- v3.1 (2026-01-24): **êµ¬í˜„ ì¼ì • ì„¹ì…˜ ì¶”ê°€ (15ì ˆ)** - 2026 Q3, P1 ìš°ì„ ìˆœìœ„, PC-1 ì—°ë™ ëª…ì‹œ
- v3.0 (2026-01-23): 7ê°œ ì–¼êµ´í˜•(triangle ì¶”ê°€), MediaPipe 468 ëœë“œë§ˆí¬ ì•Œê³ ë¦¬ì¦˜ ìƒì„¸í™”, Lab í—¤ì–´ì»¬ëŸ¬ ì¶”ì¶œ ì„¹ì…˜, P3 7ì›ì ì¬êµ¬ì„±(H-1.1~H-1.7), Mock ë°ì´í„° í™•ì¥, TypeScript ì¸í„°í˜ì´ìŠ¤ í†µí•©
- v2.2 (2026-01-23): ì–¼êµ´í˜• ë¶„ì„, Zod ìŠ¤í‚¤ë§ˆ, í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ê°•í™”
- v2.1 (2026-01-23): MediaPipe 468 ëœë“œë§ˆí¬ ê¸°ë°˜ ì–¼êµ´í˜• ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜ ìƒì„¸í™”, 7ê°œ ì›ì TypeScript ì¸í„°í˜ì´ìŠ¤ í†µí•© ì¶”ê°€
- v2.0 (2026-01-23): ì–¼êµ´í˜• ë¶„ì„, Zod ìŠ¤í‚¤ë§ˆ, í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ê°•í™”
- v1.1 (2026-01-21): Lab ìƒ‰ê³µê°„ í—¤ì–´ì»¬ëŸ¬ ë¶„ë¥˜ ì¶”ê°€
- v1.0 (2026-01-21): ì´ˆê¸° ë²„ì „
