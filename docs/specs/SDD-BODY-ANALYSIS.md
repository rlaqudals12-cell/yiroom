# SDD: ì²´í˜• ë¶„ì„ (Body Shape Analysis)

> **Status**: ğŸ“‹ Planned
> **Version**: 1.1
> **Created**: 2026-01-21
> **Updated**: 2026-01-28

> ì „ì‹  ì´ë¯¸ì§€ ê¸°ë°˜ ì²´í˜• ë¶„ë¥˜ ë° ìŠ¤íƒ€ì¼ ì¶”ì²œ ì‹œìŠ¤í…œ

---

## 0. ê¶ê·¹ì˜ í˜•íƒœ (P1)

### ì´ìƒì  ìµœì¢… ìƒíƒœ

"ì „ì‹  ì´ë¯¸ì§€ í•œ ì¥ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì²´í˜•ì„ ì •í™•íˆ ë¶„ë¥˜í•˜ê³ , ìµœì ì˜ ìŠ¤íƒ€ì¼ë§/ìš´ë™ ì¶”ì²œì„ ì œê³µí•˜ëŠ” AI ì²´í˜• ë¶„ì„ ì‹œìŠ¤í…œ"

- 5ê°€ì§€ ì²´í˜• ë¶„ë¥˜ ì •í™•ë„ 95%+
- ì–´ê¹¨/í—ˆë¦¬/í™ ë¹„ìœ¨ ì¸¡ì • ì˜¤ì°¨ Â±3% ì´ë‚´
- Size Korea í‘œì¤€ ê¸°ë°˜ í•œêµ­ì¸ íŠ¹í™” ì •ê·œí™”
- ì²´í˜•ë³„ ìŠ¤íƒ€ì¼ë§/ìš´ë™ ì¶”ì²œì´ ì‚¬ìš©ì ë§Œì¡±ë„ 90%+ ë‹¬ì„±

### ë¬¼ë¦¬ì  í•œê³„

| í•œê³„ | ì´ìœ  | ì™„í™” ì „ëµ |
|------|------|----------|
| ì¹´ë©”ë¼ ê°ë„ | ì •ë©´ ì•„ë‹Œ ì´¬ì˜ ì‹œ ì™œê³¡ | ì´¬ì˜ ê°€ì´ë“œ ì œê³µ |
| ì˜ë³µ ì˜í–¥ | íƒ€ì´íŠ¸í•˜ì§€ ì•Šì€ ì˜· ì°©ìš© ì‹œ | í”¼íŒ… ì˜ë¥˜ ê¶Œì¥ ì•ˆë‚´ |
| ì¡°ëª… ì¡°ê±´ | ê·¸ë¦¼ìë¡œ ì‹¤ë£¨ì—£ ì™œê³¡ | CIE-4 ì¡°ëª… ë¶„ì„ ì—°ë™ |
| 2D í•œê³„ | 3D ì²´í˜•ì„ 2Dë¡œ ì¶”ì • | ë³µìˆ˜ ê°ë„ ì´¬ì˜ ì˜µì…˜ |

### 100ì  ê¸°ì¤€

| í•­ëª© | 100ì  ê¸°ì¤€ | í˜„ì¬ |
|------|-----------|------|
| ì²´í˜• ë¶„ë¥˜ ì •í™•ë„ | 95% | ğŸ“‹ ê³„íš |
| ë¹„ìœ¨ ì¸¡ì • ì •í™•ë„ | Â±3% | ğŸ“‹ ê³„íš |
| ìŠ¤íƒ€ì¼ ì¶”ì²œ ë§Œì¡±ë„ | 90% | ğŸ“‹ ê³„íš |
| ìš´ë™ ì¶”ì²œ ì í•©ì„± | 85% | ğŸ“‹ ê³„íš |
| í•œêµ­ì¸ ì •ê·œí™” | Size Korea í†µí•© | ğŸ“‹ ê³„íš |

### í˜„ì¬ ëª©í‘œ: 0% (ê³„íš ë‹¨ê³„)

**ì¢…í•© ë‹¬ì„±ë¥ **: **0%** (ì„¤ê³„ ì™„ë£Œ, êµ¬í˜„ ëŒ€ê¸°)

| ê¸°ëŠ¥ | ë‹¬ì„±ë¥  | ìƒíƒœ |
|------|--------|------|
| ì „ì‹  ì‹¤ë£¨ì—£ ì¶”ì¶œ | 0% | ğŸ“‹ ê³„íš |
| ë¹„ìœ¨ ì¸¡ì • ì•Œê³ ë¦¬ì¦˜ | 0% | ğŸ“‹ ê³„íš |
| 5-Type ë¶„ë¥˜ | 0% | ğŸ“‹ ê³„íš |
| AI ì²´í˜• ë¶„ì„ | 0% | ğŸ“‹ ê³„íš |
| ìŠ¤íƒ€ì¼/ìš´ë™ ì¶”ì²œ | 0% | ğŸ“‹ ê³„íš |

### ì˜ë„ì  ì œì™¸

| ì œì™¸ í•­ëª© | ì´ìœ  | ì¬ê²€í†  ì‹œì  |
|----------|------|------------|
| 3D ì²´í˜• ìŠ¤ìº” | íŠ¹ìˆ˜ ì¥ë¹„ í•„ìš” | í–¥í›„ ê¸°ìˆ  ë°œì „ ì‹œ |
| ì²´ì¤‘/ì²´ì§€ë°© ì¶”ì • | ì •í™•ë„ ë³´ì¥ ì–´ë ¤ì›€ | ì›¨ì–´ëŸ¬ë¸” ì—°ë™ ì‹œ |
| ì‹¤ì‹œê°„ ì²´í˜• ë³€í™” ì¶”ì  | ë³µì¡ë„/ë¹„ìš© | Phase 3 |

---

## 1. ê°œìš”

### 1.1 ëª©ì 

- **ì²´í˜• ìë™ ë¶„ë¥˜**: ì „ì‹  ì´ë¯¸ì§€ì—ì„œ 5ê°€ì§€ ì²´í˜• ìœ í˜• ìë™ íŒë³„
- **ë¹„ìœ¨ ì¸¡ì •**: ì–´ê¹¨/í—ˆë¦¬/í™ ë¹„ìœ¨ ë° ìƒí•˜ì²´ ë¹„ìœ¨ ì •ëŸ‰í™”
- **ê°œì¸í™” ì¶”ì²œ**: ì²´í˜•ë³„ ë§ì¶¤ ìŠ¤íƒ€ì¼ë§ ë° ìš´ë™ ì¶”ì²œ ì œê³µ
- **í•œêµ­ì¸ íŠ¹í™”**: Size Korea í‘œì¤€ ê¸°ë°˜ ì •ê·œí™” ë° ë°±ë¶„ìœ„ ì‚°ì¶œ

### 1.2 ë²”ìœ„

| í•­ëª© | ìš°ì„ ìˆœìœ„ | ë³µì¡ë„ | êµ¬í˜„ ìƒíƒœ |
|------|----------|--------|----------|
| ì „ì‹  ì‹¤ë£¨ì—£ ì¶”ì¶œ | í•„ìˆ˜ | ì¤‘ê°„ | ğŸ“‹ ê³„íš |
| ì–´ê¹¨/í—ˆë¦¬/í™ ë¹„ìœ¨ ì¸¡ì • | í•„ìˆ˜ | ì¤‘ê°„ | ğŸ“‹ ê³„íš |
| 5ê°€ì§€ ì²´í˜• ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜ | í•„ìˆ˜ | ë†’ìŒ | ğŸ“‹ ê³„íš |
| AI ê¸°ë°˜ ì²´í˜• ë¶„ì„ (Gemini) | í•„ìˆ˜ | ë†’ìŒ | ğŸ“‹ ê³„íš |
| ì²´í˜•ë³„ ìŠ¤íƒ€ì¼ ì¶”ì²œ | ë†’ìŒ | ì¤‘ê°„ | ğŸ“‹ ê³„íš |
| ì²´í˜•ë³„ ìš´ë™ ì¶”ì²œ | ë†’ìŒ | ì¤‘ê°„ | ğŸ“‹ ê³„íš |
| í•œêµ­ì¸ í‘œì¤€ ì •ê·œí™” | ë†’ìŒ | ë‚®ìŒ | ğŸ“‹ ê³„íš |
| 3D ì²´í˜• ì‹œë®¬ë ˆì´ì…˜ | ë‚®ìŒ | ë†’ìŒ | â³ í–¥í›„ |

### 1.3 ê´€ë ¨ ë¬¸ì„œ

- [ì›ë¦¬: ì²´í˜• ì—­í•™](../principles/body-mechanics.md)
- [ì›ë¦¬: ì´ë¯¸ì§€ ì²˜ë¦¬](../principles/image-processing.md)
- [ADR-001: Core Image Engine](../adr/ADR-001-core-image-engine.md)
- [ADR-003: AI ëª¨ë¸ ì„ íƒ](../adr/ADR-003-ai-model-selection.md)
- *(ì´ ë¬¸ì„œê°€ C-1 ì²´í˜•ë¶„ì„ ìŠ¤í™ì…ë‹ˆë‹¤)*

---

## 2. ì²´í˜• ë¶„ì„ ì´ë¡ 

### 2.1 ì²´í˜• ë¶„ë¥˜ ì²´ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    5ê°€ì§€ ì²´í˜• ë¶„ë¥˜ ì²´ê³„                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â–¼           â—†           â–­           âŒ›           â—        â”‚
â”‚ ì‚¼ê°í˜•     ì—­ì‚¼ê°í˜•     ì§ì‚¬ê°í˜•    ëª¨ë˜ì‹œê³„í˜•     ì›í˜•        â”‚
â”‚ (Pear)   (Inverted   (Rectangle) (Hourglass)   (Apple)     â”‚
â”‚           Triangle)                                          â”‚
â”‚                                                              â”‚
â”‚  í™>ì–´ê¹¨    ì–´ê¹¨>í™    ì–´ê¹¨â‰ˆí—ˆë¦¬â‰ˆí™   ì–´ê¹¨â‰ˆí™     í—ˆë¦¬â‰¥ì–´ê¹¨    â”‚
â”‚                                   í—ˆë¦¬ ì˜ë¡    í—ˆë¦¬â‰¥í™       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ì²´í˜•ë³„ íŠ¹ì„±

| ì²´í˜• | í•œê¸€ëª… | ì–´ê¹¨:í—ˆë¦¬:í™ ë¹„ìœ¨ | íŠ¹ì§• |
|------|--------|------------------|------|
| **Pear** | ì‚¼ê°í˜•/ë°°í˜• | 1 : 0.7 : 1.2+ | í•˜ì²´ê°€ ìƒì²´ë³´ë‹¤ ë„“ìŒ |
| **Inverted Triangle** | ì—­ì‚¼ê°í˜• | 1.2+ : 0.9 : 1 | ì–´ê¹¨ê°€ í™ë³´ë‹¤ ë„“ìŒ |
| **Rectangle** | ì§ì‚¬ê°í˜• | 1 : 0.9+ : 1 | ì „ì²´ì ìœ¼ë¡œ ë¹„ìŠ·í•œ ë„ˆë¹„ |
| **Hourglass** | ëª¨ë˜ì‹œê³„í˜• | 1 : 0.7 : 1 | ì–´ê¹¨â‰ˆí™, í—ˆë¦¬ ì˜ë¡ |
| **Apple** | ì‚¬ê³¼í˜•/ì›í˜• | 1 : 1+ : 0.9 | í—ˆë¦¬ê°€ ê°€ì¥ ë„“ìŒ |

### 2.3 ì‹¤ë£¨ì—£ ë¶„ì„ ì§€ì 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì¸¡ì • ê¸°ì¤€ì  (Landmarks)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚                        â—‹ ë¨¸ë¦¬                                â”‚
â”‚                        â”‚                                     â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚               â”‚        â”‚        â”‚  â† ì–´ê¹¨ì„  (Shoulder)       â”‚
â”‚               â”‚        â”‚        â”‚    [11, 12] MediaPipe      â”‚
â”‚               â”‚        â”‚        â”‚                            â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                    â”Œâ”€â”€â”€â”¼â”€â”€â”€â”      â† í—ˆë¦¬ì„  (Waist)           â”‚
â”‚                    â”‚   â”‚   â”‚        ì–´ê¹¨-í™ ì¤‘ê°„ 60% ì§€ì      â”‚
â”‚                    â””â”€â”€â”€â”¼â”€â”€â”€â”˜                                 â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚               â”‚        â”‚        â”‚  â† í™ì„  (Hip)              â”‚
â”‚               â”‚        â”‚        â”‚    [23, 24] MediaPipe      â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                   â”‚         â”‚                                â”‚
â”‚                   â”‚         â”‚      â† ë‹¤ë¦¬ (Legs)             â”‚
â”‚                   â”‚         â”‚        [25-28] MediaPipe       â”‚
â”‚                   â–¼         â–¼                                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 ìƒ/í•˜ì²´ ë¹„ìœ¨ ì¸¡ì •

```
ìƒì²´ ê¸¸ì´ = ì–´ê¹¨ ì¤‘ì  â†’ í™ ì¤‘ì 
í•˜ì²´ ê¸¸ì´ = í™ ì¤‘ì  â†’ ë°œëª© ì¤‘ì 

ìƒí•˜ì²´ ë¹„ìœ¨ = í•˜ì²´ ê¸¸ì´ / ìƒì²´ ê¸¸ì´

í•œêµ­ì¸ í‰ê· :
- ë‚¨ì„±: 1.05 ~ 1.15
- ì—¬ì„±: 1.00 ~ 1.10

ì„œì–‘ì¸ í‰ê· :
- ë‚¨ì„±: 1.10 ~ 1.20
- ì—¬ì„±: 1.05 ~ 1.15
```

---

## 3. ì•Œê³ ë¦¬ì¦˜ ìƒì„¸

### 3.1 í•µì‹¬ ë¹„ìœ¨ ê³„ì‚°

```typescript
/**
 * ì²´í˜• ë¶„ì„ í•µì‹¬ ë¹„ìœ¨ ê³„ì‚°
 *
 * ì›ë¦¬: ì–´ê¹¨, í—ˆë¦¬, í™ ë„ˆë¹„ì˜ ìƒëŒ€ì  ë¹„ìœ¨ë¡œ ì²´í˜• ë¶„ë¥˜
 * MediaPipe Pose ëœë“œë§ˆí¬ ê¸°ë°˜
 */
interface BodyMeasurements {
  shoulderWidth: number;  // ì–´ê¹¨ ë„ˆë¹„ (11-12 ê±°ë¦¬)
  waistWidth: number;     // í—ˆë¦¬ ë„ˆë¹„ (ì¶”ì •ê°’)
  hipWidth: number;       // í™ ë„ˆë¹„ (23-24 ê±°ë¦¬)
  upperBodyLength: number; // ìƒì²´ ê¸¸ì´
  lowerBodyLength: number; // í•˜ì²´ ê¸¸ì´
  totalHeight: number;     // ì „ì²´ ë†’ì´
}

interface BodyRatios {
  shr: number;            // Shoulder-to-Hip Ratio
  whr: number;            // Waist-to-Hip Ratio
  whtr: number;           // Waist-to-Height Ratio
  upperLowerRatio: number; // ìƒí•˜ì²´ ë¹„ìœ¨
}

function calculateBodyMeasurements(
  landmarks: MediaPipeLandmark[]
): BodyMeasurements {
  // ì–´ê¹¨ ë„ˆë¹„: ì¢Œìš° ì–´ê¹¨ ëœë“œë§ˆí¬ ê±°ë¦¬
  const leftShoulder = landmarks[11];
  const rightShoulder = landmarks[12];
  const shoulderWidth = euclideanDistance(leftShoulder, rightShoulder);

  // í™ ë„ˆë¹„: ì¢Œìš° í™ ëœë“œë§ˆí¬ ê±°ë¦¬
  const leftHip = landmarks[23];
  const rightHip = landmarks[24];
  const hipWidth = euclideanDistance(leftHip, rightHip);

  // í—ˆë¦¬ ë„ˆë¹„: í™ ë„ˆë¹„ì˜ 80% ì¶”ì • (MediaPipeì— í—ˆë¦¬ ëœë“œë§ˆí¬ ì—†ìŒ)
  const waistWidth = hipWidth * 0.8;

  // ì–´ê¹¨ ì¤‘ì 
  const shoulderMidpoint = {
    x: (leftShoulder.x + rightShoulder.x) / 2,
    y: (leftShoulder.y + rightShoulder.y) / 2,
    z: (leftShoulder.z + rightShoulder.z) / 2,
  };

  // í™ ì¤‘ì 
  const hipMidpoint = {
    x: (leftHip.x + rightHip.x) / 2,
    y: (leftHip.y + rightHip.y) / 2,
    z: (leftHip.z + rightHip.z) / 2,
  };

  // ìƒì²´ ê¸¸ì´
  const upperBodyLength = euclideanDistance(shoulderMidpoint, hipMidpoint);

  // í•˜ì²´ ê¸¸ì´: í™ â†’ ë¬´ë¦ â†’ ë°œëª©
  const leftKnee = landmarks[25];
  const leftAnkle = landmarks[27];
  const hipToKnee = euclideanDistance(leftHip, leftKnee);
  const kneeToAnkle = euclideanDistance(leftKnee, leftAnkle);
  const lowerBodyLength = hipToKnee + kneeToAnkle;

  // ì „ì²´ ë†’ì´ (ì½”ì—ì„œ ë°œëª©ê¹Œì§€ + ë¨¸ë¦¬ ë³´ì •)
  const nose = landmarks[0];
  const totalHeight = euclideanDistance(nose, leftAnkle) * 1.1; // ë¨¸ë¦¬ 10% ë³´ì •

  return {
    shoulderWidth,
    waistWidth,
    hipWidth,
    upperBodyLength,
    lowerBodyLength,
    totalHeight,
  };
}

function calculateBodyRatios(measurements: BodyMeasurements): BodyRatios {
  return {
    shr: measurements.shoulderWidth / measurements.hipWidth,
    whr: measurements.waistWidth / measurements.hipWidth,
    whtr: measurements.waistWidth / measurements.totalHeight,
    upperLowerRatio: measurements.lowerBodyLength / measurements.upperBodyLength,
  };
}

function euclideanDistance(a: Point3D, b: Point3D): number {
  return Math.sqrt(
    Math.pow(a.x - b.x, 2) +
    Math.pow(a.y - b.y, 2) +
    Math.pow(a.z - b.z, 2)
  );
}
```

### 3.2 ì²´í˜• ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜

```typescript
/**
 * 5ê°€ì§€ ì²´í˜• ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜
 *
 * ê¸°ë°˜ ì—°êµ¬: ê³¼ì¼í˜• ì²´í˜• ë¶„ë¥˜ (Fruit-based Body Shape Classification)
 * í•œêµ­ì¸ íŠ¹í™”: Size Korea 8ì°¨ ì¡°ì‚¬ ë°ì´í„° ë°˜ì˜
 */
type BodyShapeType =
  | 'pear'             // ì‚¼ê°í˜•/ë°°í˜•
  | 'invertedTriangle' // ì—­ì‚¼ê°í˜•
  | 'rectangle'        // ì§ì‚¬ê°í˜•
  | 'hourglass'        // ëª¨ë˜ì‹œê³„í˜•
  | 'apple';           // ì‚¬ê³¼í˜•/ì›í˜•

interface BodyShapeResult {
  type: BodyShapeType;
  koreanName: string;
  confidence: number;    // 0-1
  ratios: BodyRatios;
  measurements: BodyMeasurements;
  alternativeTypes: Array<{ type: BodyShapeType; confidence: number }>;
}

function classifyBodyShape(
  ratios: BodyRatios,
  gender: 'male' | 'female'
): BodyShapeResult {
  const { shr, whr } = ratios;
  const scores: Record<BodyShapeType, number> = {
    pear: 0,
    invertedTriangle: 0,
    rectangle: 0,
    hourglass: 0,
    apple: 0,
  };

  if (gender === 'female') {
    // ì—¬ì„± ì²´í˜• ë¶„ë¥˜ ê¸°ì¤€
    scores.hourglass = calculateHourglassScore(shr, whr);
    scores.pear = calculatePearScore(shr, whr);
    scores.invertedTriangle = calculateInvertedTriangleScore(shr, whr);
    scores.apple = calculateAppleScore(shr, whr);
    scores.rectangle = calculateRectangleScore(shr, whr);
  } else {
    // ë‚¨ì„± ì²´í˜• ë¶„ë¥˜ ê¸°ì¤€
    scores.invertedTriangle = shr > 1.2 ? 90 : shr > 1.1 ? 70 : 40;
    scores.rectangle = Math.abs(shr - 1.0) < 0.1 ? 80 : 50;
    scores.pear = shr < 0.9 ? 85 : 30;
    scores.apple = whr > 0.9 ? 85 : 40;
    scores.hourglass = 20; // ë‚¨ì„±ì—ê²ŒëŠ” ë“œë¬¸ ì²´í˜•
  }

  // ìµœê³  ì ìˆ˜ ì²´í˜• ì„ íƒ
  const sortedTypes = Object.entries(scores)
    .sort(([, a], [, b]) => b - a)
    .map(([type, score]) => ({
      type: type as BodyShapeType,
      confidence: score / 100,
    }));

  const primary = sortedTypes[0];

  return {
    type: primary.type,
    koreanName: getKoreanBodyShapeName(primary.type),
    confidence: primary.confidence,
    ratios,
    measurements: {} as BodyMeasurements, // í˜¸ì¶œ ì‹œ ì±„ì›Œì§
    alternativeTypes: sortedTypes.slice(1, 3),
  };
}

function calculateHourglassScore(shr: number, whr: number): number {
  // ëª¨ë˜ì‹œê³„: ì–´ê¹¨â‰ˆí™ (shrâ‰ˆ1.0), í—ˆë¦¬ ì˜ë¡ (whr<0.75)
  const shrScore = shr >= 0.95 && shr <= 1.05 ? 40 : 20;
  const whrScore = whr <= 0.75 ? 50 : whr <= 0.8 ? 35 : 15;
  return shrScore + whrScore;
}

function calculatePearScore(shr: number, whr: number): number {
  // ë°°í˜•: í™>ì–´ê¹¨ (shr<0.9)
  if (shr < 0.85) return 90;
  if (shr < 0.9) return 75;
  if (shr < 0.95) return 50;
  return 20;
}

function calculateInvertedTriangleScore(shr: number, whr: number): number {
  // ì—­ì‚¼ê°í˜•: ì–´ê¹¨>í™ (shr>1.1)
  if (shr > 1.2) return 90;
  if (shr > 1.1) return 75;
  if (shr > 1.05) return 50;
  return 20;
}

function calculateAppleScore(shr: number, whr: number): number {
  // ì‚¬ê³¼í˜•: í—ˆë¦¬â‰¥ì–´ê¹¨ ë˜ëŠ” í—ˆë¦¬â‰¥í™ (whrâ‰¥0.9)
  if (whr >= 0.95) return 90;
  if (whr >= 0.9) return 75;
  if (whr >= 0.85) return 50;
  return 20;
}

function calculateRectangleScore(shr: number, whr: number): number {
  // ì§ì‚¬ê°í˜•: ì „ì²´ ë¹„ìŠ· (shrâ‰ˆ1.0, whr>0.8)
  const shrScore = Math.abs(shr - 1.0) < 0.1 ? 45 : 25;
  const whrScore = whr > 0.8 ? 45 : 25;
  return shrScore + whrScore;
}

function getKoreanBodyShapeName(type: BodyShapeType): string {
  const names: Record<BodyShapeType, string> = {
    pear: 'ì‚¼ê°í˜•(ë°°í˜•)',
    invertedTriangle: 'ì—­ì‚¼ê°í˜•',
    rectangle: 'ì§ì‚¬ê°í˜•',
    hourglass: 'ëª¨ë˜ì‹œê³„í˜•',
    apple: 'ì‚¬ê³¼í˜•(ì›í˜•)',
  };
  return names[type];
}
```

### 3.3 AI ê¸°ë°˜ ì²´í˜• ë¶„ì„ (Gemini ì—°ë™)

```typescript
/**
 * Gemini VLM ê¸°ë°˜ ì²´í˜• ë¶„ì„
 *
 * MediaPipe ê²°ê³¼ì™€ êµì°¨ ê²€ì¦í•˜ì—¬ ì‹ ë¢°ë„ í–¥ìƒ
 */
interface AIBodyAnalysisInput {
  imageBase64: string;
  mediaPipeResult: BodyShapeResult;
  gender: 'male' | 'female';
  ageGroup: '20s' | '30s' | '40s' | '50s';
}

interface AIBodyAnalysisOutput {
  bodyShape: BodyShapeType;
  confidence: number;
  silhouetteDescription: string;
  proportionAnalysis: {
    upperBody: string;
    lowerBody: string;
    waistline: string;
  };
  recommendations: {
    styling: string[];
    exercise: string[];
  };
}

async function analyzeBodyWithAI(
  input: AIBodyAnalysisInput
): Promise<AIBodyAnalysisOutput> {
  const prompt = `
ë‹¹ì‹ ì€ ì²´í˜• ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì²´í˜•ì„ ë¶„ë¥˜í•´ì£¼ì„¸ìš”.

## ë¶„ì„ ëŒ€ìƒ
- ì„±ë³„: ${input.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}
- ì—°ë ¹ëŒ€: ${input.ageGroup}

## ì²´í˜• ë¶„ë¥˜ ê¸°ì¤€
1. ì‚¼ê°í˜•(ë°°í˜•): í™ì´ ì–´ê¹¨ë³´ë‹¤ ë„“ìŒ
2. ì—­ì‚¼ê°í˜•: ì–´ê¹¨ê°€ í™ë³´ë‹¤ ë„“ìŒ
3. ì§ì‚¬ê°í˜•: ì–´ê¹¨, í—ˆë¦¬, í™ì´ ë¹„ìŠ·í•¨
4. ëª¨ë˜ì‹œê³„í˜•: ì–´ê¹¨ì™€ í™ì´ ë¹„ìŠ·í•˜ê³  í—ˆë¦¬ê°€ ì˜ë¡í•¨
5. ì‚¬ê³¼í˜•(ì›í˜•): í—ˆë¦¬ê°€ ê°€ì¥ ë„“ìŒ

## MediaPipe ë¶„ì„ ê²°ê³¼ (ì°¸ê³ )
- ì˜ˆì¸¡ ì²´í˜•: ${input.mediaPipeResult.koreanName}
- ì‹ ë¢°ë„: ${(input.mediaPipeResult.confidence * 100).toFixed(1)}%
- SHR (ì–´ê¹¨/í™): ${input.mediaPipeResult.ratios.shr.toFixed(2)}
- WHR (í—ˆë¦¬/í™): ${input.mediaPipeResult.ratios.whr.toFixed(2)}

## ì‘ë‹µ í˜•ì‹ (JSON)
{
  "bodyShape": "pear|invertedTriangle|rectangle|hourglass|apple",
  "confidence": 0.0-1.0,
  "silhouetteDescription": "ì „ì²´ ì‹¤ë£¨ì—£ ì„¤ëª…",
  "proportionAnalysis": {
    "upperBody": "ìƒì²´ ë¹„ìœ¨ ë¶„ì„",
    "lowerBody": "í•˜ì²´ ë¹„ìœ¨ ë¶„ì„",
    "waistline": "í—ˆë¦¬ë¼ì¸ ë¶„ì„"
  },
  "recommendations": {
    "styling": ["ìŠ¤íƒ€ì¼ ì¶”ì²œ 1", "ìŠ¤íƒ€ì¼ ì¶”ì²œ 2"],
    "exercise": ["ìš´ë™ ì¶”ì²œ 1", "ìš´ë™ ì¶”ì²œ 2"]
  }
}
`;

  const response = await generateWithGemini(prompt, input.imageBase64);
  return JSON.parse(response);
}
```

---

## 4. ì…ë ¥/ì¶œë ¥ ìŠ¤í™

### 4.1 ì…ë ¥ ì¸í„°í˜ì´ìŠ¤

```typescript
export interface BodyAnalysisInput {
  // í•„ìˆ˜
  imageBase64: string;              // Base64 ì¸ì½”ë”©ëœ ì „ì‹  ì´ë¯¸ì§€

  // ì„ íƒ
  gender?: 'male' | 'female';       // ì„±ë³„ (ìë™ ê°ì§€ ê°€ëŠ¥)
  ageGroup?: '20s' | '30s' | '40s' | '50s'; // ì—°ë ¹ëŒ€
  heightCm?: number;                // ì‹¤ì œ ì‹ ì¥ (ì •í™•ë„ í–¥ìƒ)
  weightKg?: number;                // ì‹¤ì œ ì²´ì¤‘ (BMI ê³„ì‚°)

  // ì˜µì…˜
  options?: {
    includeRecommendations?: boolean; // ì¶”ì²œ í¬í•¨ ì—¬ë¶€ (ê¸°ë³¸: true)
    useAIAnalysis?: boolean;          // AI ë¶„ì„ ì‚¬ìš© ì—¬ë¶€ (ê¸°ë³¸: true)
    normalizeToKorean?: boolean;      // í•œêµ­ì¸ í‘œì¤€ ì •ê·œí™” (ê¸°ë³¸: true)
  };
}
```

### 4.2 ì¶œë ¥ ì¸í„°í˜ì´ìŠ¤

```typescript
export interface BodyAnalysisOutput {
  success: boolean;

  // ì²´í˜• ë¶„ë¥˜ ê²°ê³¼
  bodyShape: {
    type: BodyShapeType;
    koreanName: string;
    confidence: number;             // 0-1
    description: string;            // ì²´í˜• ì„¤ëª…
    alternativeTypes: Array<{
      type: BodyShapeType;
      confidence: number;
    }>;
  };

  // ì¸¡ì • ê²°ê³¼
  measurements: {
    shoulderWidth: number;          // ì •ê·œí™”ëœ ì–´ê¹¨ ë„ˆë¹„
    waistWidth: number;             // ì •ê·œí™”ëœ í—ˆë¦¬ ë„ˆë¹„
    hipWidth: number;               // ì •ê·œí™”ëœ í™ ë„ˆë¹„
    upperBodyLength: number;
    lowerBodyLength: number;
  };

  // ë¹„ìœ¨ ê²°ê³¼
  ratios: {
    shr: number;                    // Shoulder-to-Hip Ratio
    whr: number;                    // Waist-to-Hip Ratio
    whtr: number;                   // Waist-to-Height Ratio
    upperLowerRatio: number;        // ìƒí•˜ì²´ ë¹„ìœ¨
  };

  // í•œêµ­ì¸ ê¸°ì¤€ ë°±ë¶„ìœ„ (ì˜µì…˜)
  koreanPercentile?: {
    shoulderWidth: number;          // 0-100
    waistWidth: number;
    hipWidth: number;
    overallBalance: number;
  };

  // ì¶”ì²œ (ì˜µì…˜)
  recommendations?: {
    styling: StylingRecommendation[];
    exercise: ExerciseRecommendation[];
  };

  // ë©”íƒ€ë°ì´í„°
  metadata: {
    analysisMethod: 'mediapipe' | 'ai' | 'hybrid';
    processingTime: number;         // ms
    landmarkConfidence: number;     // MediaPipe ëœë“œë§ˆí¬ ì‹ ë¢°ë„
  };
}

interface StylingRecommendation {
  category: 'top' | 'bottom' | 'dress' | 'accessory';
  recommendation: string;
  reason: string;
  avoidItems: string[];
}

interface ExerciseRecommendation {
  category: 'strength' | 'cardio' | 'flexibility';
  exercise: string;
  targetArea: string;
  reason: string;
}
```

---

## 5. ì²´í˜•ë³„ ìŠ¤íƒ€ì¼ ì¶”ì²œ

### 5.1 ì¶”ì²œ ë§¤í•‘ í…Œì´ë¸”

| ì²´í˜• | ê¶Œì¥ ìŠ¤íƒ€ì¼ | í”¼í•´ì•¼ í•  ìŠ¤íƒ€ì¼ | í•µì‹¬ í¬ì¸íŠ¸ |
|------|------------|-----------------|------------|
| **ì‚¼ê°í˜•** | ëŸ¬í”Œ/ì¥ì‹ ìƒì˜, ë°ì€ ìƒì˜, ë‹¤í¬ í•˜ì˜ | íƒ€ì´íŠ¸ ìŠ¤í‚¤ë‹ˆì§„, í™ ê°•ì¡° íŒ¨í„´ | ìƒì²´ ë³¼ë¥¨ ê°•ì¡° |
| **ì—­ì‚¼ê°í˜•** | Vë„¥, ì™€ì´ë“œíŒ¬ì¸ , ë°ì€ í•˜ì˜ | ì–´ê¹¨íŒ¨ë“œ, ë³´íŠ¸ë„¥, í¼í”„ì†Œë§¤ | í•˜ì²´ ë³¼ë¥¨ ê°•ì¡° |
| **ì§ì‚¬ê°í˜•** | í˜í”ŒëŸ¼, ë²¨íŠ¸ ë“œë ˆìŠ¤, ë ˆì´ì–´ë§ | ë°•ì‹œ ì›í”¼ìŠ¤, ì§ì„  ì‹¤ë£¨ì—£ | í—ˆë¦¬ë¼ì¸ ê°•ì¡° |
| **ëª¨ë˜ì‹œê³„** | ë°”ë””ì½˜, ë© ë“œë ˆìŠ¤, ë²¨íŠ¸ ê°•ì¡° | ë°•ì‹œ ì‹¤ë£¨ì—£, ì˜¤ë²„ì‚¬ì´ì¦ˆ | ê³¡ì„  ì‚´ë¦¬ê¸° |
| **ì‚¬ê³¼í˜•** | Vë„¥, í•˜ì´ì›¨ì´ìŠ¤íŠ¸, Aë¼ì¸ | íƒ€ì´íŠ¸ ìƒì˜, ë²¨íŠ¸ ê°•ì¡° | í—ˆë¦¬ ì»¤ë²„ |

### 5.2 ì¶”ì²œ ìƒì„± í•¨ìˆ˜

```typescript
function generateStylingRecommendations(
  bodyShape: BodyShapeType,
  gender: 'male' | 'female'
): StylingRecommendation[] {
  const STYLE_DB: Record<BodyShapeType, Record<'male' | 'female', StylingRecommendation[]>> = {
    pear: {
      female: [
        {
          category: 'top',
          recommendation: 'ëŸ¬í”Œ ë¸”ë¼ìš°ìŠ¤, ë³´íŠ¸ë„¥ ìƒì˜',
          reason: 'ìƒì²´ì— ë³¼ë¥¨ì„ ë”í•´ ê· í˜• ì¡íŒ ì‹¤ë£¨ì—£ ì—°ì¶œ',
          avoidItems: ['ë¯¼ì†Œë§¤', 'íƒ€ì´íŠ¸ ìƒì˜'],
        },
        {
          category: 'bottom',
          recommendation: 'ë‹¤í¬ ì»¬ëŸ¬ ì™€ì´ë“œíŒ¬ì¸ , Aë¼ì¸ ìŠ¤ì»¤íŠ¸',
          reason: 'í•˜ì²´ ë¼ì¸ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì»¤ë²„',
          avoidItems: ['ìŠ¤í‚¤ë‹ˆì§„', 'ë°ì€ ìƒ‰ í•˜ì˜', 'íŒ¨í„´ í•˜ì˜'],
        },
      ],
      male: [
        {
          category: 'top',
          recommendation: 'ìŠ¤íŠ¸ëŸ­ì²˜ë“œ ì¬í‚·, ì–´ê¹¨ ê°•ì¡° ì•„ìš°í„°',
          reason: 'ì–´ê¹¨ ë¼ì¸ì„ ê°•ì¡°í•˜ì—¬ ì—­ì‚¼ê°í˜• ì‹¤ë£¨ì—£ ì—°ì¶œ',
          avoidItems: ['ë“œë¡­ìˆ„ë”', 'ì˜¤ë²„í• ìƒì˜'],
        },
        {
          category: 'bottom',
          recommendation: 'ìŠ¤íŠ¸ë ˆì´íŠ¸ íŒ¬ì¸ , ë‹¤í¬ ë°ë‹˜',
          reason: 'í•˜ì²´ ë³¼ë¥¨ ì™„í™”',
          avoidItems: ['ì¹´ê³ íŒ¬ì¸ ', 'ì™€ì´ë“œíŒ¬ì¸ '],
        },
      ],
    },
    // ... ë‹¤ë¥¸ ì²´í˜•ì— ëŒ€í•œ ì¶”ì²œ
    invertedTriangle: { /* ... */ },
    rectangle: { /* ... */ },
    hourglass: { /* ... */ },
    apple: { /* ... */ },
  };

  return STYLE_DB[bodyShape][gender] || [];
}
```

---

## 6. ì—ëŸ¬ ì¼€ì´ìŠ¤ ë° ëŒ€ì‘

### 6.1 ì—ëŸ¬ ë¶„ë¥˜

| ì—ëŸ¬ ì½”ë“œ | ìƒí™© | ëŒ€ì‘ |
|----------|------|------|
| `BODY_INVALID_IMAGE` | ì´ë¯¸ì§€ í˜•ì‹ ì˜¤ë¥˜ | ì§€ì› í˜•ì‹ ì•ˆë‚´ |
| `BODY_NO_PERSON` | ì‚¬ëŒ ê°ì§€ ì‹¤íŒ¨ | ì „ì‹  ì´¬ì˜ ê°€ì´ë“œ ì œê³µ |
| `BODY_PARTIAL_BODY` | ì „ì‹  ë¯¸í¬í•¨ | ì „ì‹  í”„ë ˆì´ë° ìš”ì²­ |
| `BODY_LOW_LANDMARK_CONF` | ëœë“œë§ˆí¬ ì‹ ë¢°ë„ ë‚®ìŒ | ì¬ì´¬ì˜ ë˜ëŠ” Mock ê²°ê³¼ |
| `BODY_AI_TIMEOUT` | AI ë¶„ì„ íƒ€ì„ì•„ì›ƒ | MediaPipe ê²°ê³¼ë§Œ ë°˜í™˜ |
| `BODY_CLASSIFICATION_FAIL` | ì²´í˜• ë¶„ë¥˜ ì‹¤íŒ¨ | ì§ì‚¬ê°í˜•(ê¸°ë³¸ê°’) ë°˜í™˜ |

### 6.2 í´ë°± ì „ëµ

```typescript
/**
 * 3ë‹¨ê³„ í´ë°± ì „ëµ
 *
 * Level 1: AI + MediaPipe í•˜ì´ë¸Œë¦¬ë“œ (ìµœê³  ì •í™•ë„)
 * Level 2: MediaPipe ë‹¨ë… (AI ì‹¤íŒ¨ ì‹œ)
 * Level 3: Mock ë°ì´í„° (ì „ì²´ ì‹¤íŒ¨ ì‹œ)
 */
async function analyzeBodyWithFallback(
  input: BodyAnalysisInput
): Promise<BodyAnalysisOutput> {
  const startTime = Date.now();

  try {
    // Level 1: í•˜ì´ë¸Œë¦¬ë“œ ë¶„ì„
    const mediaPipeResult = await analyzeWithMediaPipe(input.imageBase64);

    if (mediaPipeResult.confidence < 0.5) {
      throw new Error('BODY_LOW_LANDMARK_CONF');
    }

    if (input.options?.useAIAnalysis !== false) {
      try {
        const aiResult = await analyzeBodyWithAI({
          imageBase64: input.imageBase64,
          mediaPipeResult,
          gender: input.gender || 'female',
          ageGroup: input.ageGroup || '30s',
        });

        return mergeResults(mediaPipeResult, aiResult, startTime);
      } catch (aiError) {
        console.warn('[BODY] AI ë¶„ì„ ì‹¤íŒ¨, MediaPipe ê²°ê³¼ ì‚¬ìš©:', aiError);
      }
    }

    // Level 2: MediaPipe ë‹¨ë…
    return formatMediaPipeResult(mediaPipeResult, startTime);

  } catch (error) {
    console.error('[BODY] ë¶„ì„ ì‹¤íŒ¨, Mock ë°ì´í„° ë°˜í™˜:', error);

    // Level 3: Mock ë°ì´í„°
    return generateMockBodyAnalysis(input.gender || 'female', startTime);
  }
}
```

### 6.3 ìœ íš¨ì„± ê²€ì¦

```typescript
function validateBodyImage(imageData: ImageData): {
  valid: boolean;
  issues: string[];
} {
  const issues: string[] = [];

  // 1. í•´ìƒë„ ê²€ì¦
  if (imageData.width < 480 || imageData.height < 640) {
    issues.push('ìµœì†Œ 480x640 í•´ìƒë„ í•„ìš”');
  }

  // 2. ì„¸ë¡œ ë°©í–¥ ê²€ì¦ (ì „ì‹  ì´¬ì˜ ê¶Œì¥)
  if (imageData.width > imageData.height) {
    issues.push('ì„¸ë¡œ ë°©í–¥ ì´¬ì˜ ê¶Œì¥');
  }

  // 3. ì‚¬ëŒ ê°ì§€ (MediaPipe ì„ í–‰ í™•ì¸)
  // ë³„ë„ í•¨ìˆ˜ì—ì„œ ì²˜ë¦¬

  return {
    valid: issues.length === 0,
    issues,
  };
}
```

---

## 7. P3 ì›ì ë¶„í•´

| ID | ì›ìëª… | ì†Œìš”ì‹œê°„ | ì…ë ¥ | ì¶œë ¥ | ì˜ì¡´ì„± |
|----|--------|----------|------|------|--------|
| **BODY-1** | ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ë° ê²€ì¦ | 2h | imageBase64 | ValidatedImage | - |
| **BODY-2** | MediaPipe Pose ëœë“œë§ˆí¬ ì¶”ì¶œ | 3h | ValidatedImage | Landmarks[] | BODY-1 |
| **BODY-3** | ì²´í˜• ì¸¡ì •ê°’ ê³„ì‚° | 2h | Landmarks[] | BodyMeasurements | BODY-2 |
| **BODY-4** | ì²´í˜• ë¹„ìœ¨ ê³„ì‚° | 1h | BodyMeasurements | BodyRatios | BODY-3 |
| **BODY-5** | ì²´í˜• ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜ | 3h | BodyRatios, gender | BodyShapeType | BODY-4 |
| **BODY-6** | AI ì²´í˜• ë¶„ì„ (Gemini) | 4h | imageBase64, MediaPipeResult | AIAnalysisResult | BODY-5 |
| **BODY-7** | í•œêµ­ì¸ í‘œì¤€ ì •ê·œí™” | 2h | Measurements, gender, age | KoreanPercentile | BODY-3 |
| **BODY-8** | ì²´í˜•ë³„ ì¶”ì²œ ìƒì„± | 2h | BodyShapeType, gender | Recommendations | BODY-5 |

### 7.1 ì˜ì¡´ì„± ê·¸ë˜í”„

```
BODY-1 (ì´ë¯¸ì§€ ê²€ì¦)
   â†“
BODY-2 (ëœë“œë§ˆí¬ ì¶”ì¶œ)
   â†“
BODY-3 (ì¸¡ì •ê°’ ê³„ì‚°) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ BODY-7 (í•œêµ­ì¸ ì •ê·œí™”)
   â†“
BODY-4 (ë¹„ìœ¨ ê³„ì‚°)
   â†“
BODY-5 (ì²´í˜• ë¶„ë¥˜) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ BODY-8 (ì¶”ì²œ ìƒì„±)
   â†“
BODY-6 (AI ë¶„ì„)
```

### 7.2 ê° ì›ì ìƒì„¸

#### BODY-1: ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ë° ê²€ì¦

```typescript
// ì…ë ¥
interface BODY1Input {
  imageBase64: string;
}

// ì¶œë ¥
interface BODY1Output {
  imageData: ImageData;
  isValid: boolean;
  issues: string[];
  dimensions: { width: number; height: number };
}

// ì„±ê³µ ê¸°ì¤€
// - ì´ë¯¸ì§€ ë””ì½”ë”© ì„±ê³µ
// - ìµœì†Œ í•´ìƒë„ ì¶©ì¡± (480x640)
// - ì„¸ë¡œ ë°©í–¥ ë˜ëŠ” ì •ì‚¬ê°í˜•
```

#### BODY-2: MediaPipe Pose ëœë“œë§ˆí¬ ì¶”ì¶œ

```typescript
// ì…ë ¥
interface BODY2Input {
  imageData: ImageData;
}

// ì¶œë ¥
interface BODY2Output {
  landmarks: MediaPipeLandmark[];
  confidence: number;
  poseDetected: boolean;
}

// ì„±ê³µ ê¸°ì¤€
// - 33ê°œ ëœë“œë§ˆí¬ ì¶”ì¶œ
// - í‰ê·  visibility > 0.5
// - ì–´ê¹¨/í™/ë¬´ë¦/ë°œëª© ëœë“œë§ˆí¬ ìœ íš¨
```

#### BODY-3: ì²´í˜• ì¸¡ì •ê°’ ê³„ì‚°

```typescript
// ì…ë ¥
interface BODY3Input {
  landmarks: MediaPipeLandmark[];
}

// ì¶œë ¥
interface BODY3Output {
  measurements: BodyMeasurements;
}

// ì„±ê³µ ê¸°ì¤€
// - ì–´ê¹¨ ë„ˆë¹„ > 0
// - í™ ë„ˆë¹„ > 0
// - ìƒí•˜ì²´ ê¸¸ì´ > 0
```

#### BODY-4: ì²´í˜• ë¹„ìœ¨ ê³„ì‚°

```typescript
// ì…ë ¥
interface BODY4Input {
  measurements: BodyMeasurements;
}

// ì¶œë ¥
interface BODY4Output {
  ratios: BodyRatios;
}

// ì„±ê³µ ê¸°ì¤€
// - SHR ë²”ìœ„: 0.7 ~ 1.5
// - WHR ë²”ìœ„: 0.6 ~ 1.1
// - ìƒí•˜ì²´ ë¹„ìœ¨: 0.8 ~ 1.4
```

#### BODY-5: ì²´í˜• ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜

```typescript
// ì…ë ¥
interface BODY5Input {
  ratios: BodyRatios;
  gender: 'male' | 'female';
}

// ì¶œë ¥
interface BODY5Output {
  bodyShape: BodyShapeType;
  confidence: number;
  alternativeTypes: Array<{ type: BodyShapeType; confidence: number }>;
}

// ì„±ê³µ ê¸°ì¤€
// - ì²´í˜• ë¶„ë¥˜ ì™„ë£Œ
// - confidence > 0.5
// - ëŒ€ì•ˆ ì²´í˜• 2ê°œ ì´ìƒ ì œê³µ
```

#### BODY-6: AI ì²´í˜• ë¶„ì„ (Gemini)

```typescript
// ì…ë ¥
interface BODY6Input {
  imageBase64: string;
  mediaPipeResult: BodyShapeResult;
  gender: 'male' | 'female';
  ageGroup: string;
}

// ì¶œë ¥
interface BODY6Output {
  aiBodyShape: BodyShapeType;
  aiConfidence: number;
  description: string;
  recommendations: { styling: string[]; exercise: string[] };
}

// ì„±ê³µ ê¸°ì¤€
// - 3ì´ˆ ì´ë‚´ ì‘ë‹µ
// - JSON íŒŒì‹± ì„±ê³µ
// - ìœ íš¨í•œ ì²´í˜• íƒ€ì… ë°˜í™˜
```

#### BODY-7: í•œêµ­ì¸ í‘œì¤€ ì •ê·œí™”

```typescript
// ì…ë ¥
interface BODY7Input {
  measurements: BodyMeasurements;
  gender: 'male' | 'female';
  ageGroup: '20s' | '30s' | '40s' | '50s';
}

// ì¶œë ¥
interface BODY7Output {
  zScores: Record<string, number>;
  percentiles: Record<string, number>;
}

// ì„±ê³µ ê¸°ì¤€
// - Size Korea ê¸°ì¤€ ì ìš©
// - ë°±ë¶„ìœ„ 0-100 ë²”ìœ„
```

#### BODY-8: ì²´í˜•ë³„ ì¶”ì²œ ìƒì„±

```typescript
// ì…ë ¥
interface BODY8Input {
  bodyShape: BodyShapeType;
  gender: 'male' | 'female';
}

// ì¶œë ¥
interface BODY8Output {
  stylingRecommendations: StylingRecommendation[];
  exerciseRecommendations: ExerciseRecommendation[];
}

// ì„±ê³µ ê¸°ì¤€
// - ìŠ¤íƒ€ì¼ ì¶”ì²œ 2ê°œ ì´ìƒ
// - ìš´ë™ ì¶”ì²œ 2ê°œ ì´ìƒ
// - í”¼í•´ì•¼ í•  í•­ëª© í¬í•¨
```

**ì´ ì˜ˆìƒ ì‹œê°„**: 19ì‹œê°„

---

## 8. íŒŒì¼ êµ¬ì¡°

```
lib/body-analysis/
â”œâ”€â”€ index.ts                    # í†µí•© export
â”œâ”€â”€ types.ts                    # ê³µí†µ íƒ€ì…
â”œâ”€â”€ body-analyzer.ts            # ë©”ì¸ ë¶„ì„ í•¨ìˆ˜
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ landmark-extractor.ts   # BODY-2: MediaPipe ì—°ë™
â”‚   â”œâ”€â”€ measurement-calculator.ts # BODY-3: ì¸¡ì •ê°’ ê³„ì‚°
â”‚   â”œâ”€â”€ ratio-calculator.ts     # BODY-4: ë¹„ìœ¨ ê³„ì‚°
â”‚   â”œâ”€â”€ shape-classifier.ts     # BODY-5: ì²´í˜• ë¶„ë¥˜
â”‚   â”œâ”€â”€ ai-analyzer.ts          # BODY-6: Gemini ì—°ë™
â”‚   â”œâ”€â”€ korean-normalizer.ts    # BODY-7: í•œêµ­ì¸ ì •ê·œí™”
â”‚   â””â”€â”€ recommendation-generator.ts # BODY-8: ì¶”ì²œ ìƒì„±
â””â”€â”€ data/
    â”œâ”€â”€ korean-standards.ts     # Size Korea í‘œì¤€ ë°ì´í„°
    â””â”€â”€ style-database.ts       # ì²´í˜•ë³„ ìŠ¤íƒ€ì¼ DB
```

---

## 9. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

### 9.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

```typescript
describe('Body Shape Analysis', () => {
  describe('Measurement Calculator', () => {
    it('should calculate shoulder width from landmarks', () => {
      const landmarks = createMockLandmarks({
        leftShoulder: { x: 0.3, y: 0.3, z: 0 },
        rightShoulder: { x: 0.7, y: 0.3, z: 0 },
      });

      const measurements = calculateBodyMeasurements(landmarks);
      expect(measurements.shoulderWidth).toBeCloseTo(0.4, 2);
    });

    it('should estimate waist as 80% of hip width', () => {
      const landmarks = createMockLandmarks({
        leftHip: { x: 0.35, y: 0.6, z: 0 },
        rightHip: { x: 0.65, y: 0.6, z: 0 },
      });

      const measurements = calculateBodyMeasurements(landmarks);
      expect(measurements.waistWidth).toBeCloseTo(measurements.hipWidth * 0.8, 2);
    });
  });

  describe('Shape Classifier', () => {
    it('should classify hourglass when SHRâ‰ˆ1 and WHR<0.75', () => {
      const ratios: BodyRatios = {
        shr: 1.0,
        whr: 0.7,
        whtr: 0.4,
        upperLowerRatio: 1.1,
      };

      const result = classifyBodyShape(ratios, 'female');
      expect(result.type).toBe('hourglass');
      expect(result.confidence).toBeGreaterThan(0.7);
    });

    it('should classify pear when SHR<0.9', () => {
      const ratios: BodyRatios = {
        shr: 0.85,
        whr: 0.75,
        whtr: 0.42,
        upperLowerRatio: 1.05,
      };

      const result = classifyBodyShape(ratios, 'female');
      expect(result.type).toBe('pear');
    });

    it('should classify inverted triangle when SHR>1.1', () => {
      const ratios: BodyRatios = {
        shr: 1.15,
        whr: 0.8,
        whtr: 0.45,
        upperLowerRatio: 1.1,
      };

      const result = classifyBodyShape(ratios, 'female');
      expect(result.type).toBe('invertedTriangle');
    });
  });

  describe('Korean Normalizer', () => {
    it('should calculate correct percentile for average Korean female', () => {
      const result = normalizeToKorean(68.0, 'waist', 'female', '20s');

      expect(result.zScore).toBeCloseTo(0, 1);
      expect(result.percentile).toBeCloseTo(50, 5);
    });
  });
});
```

### 9.2 í†µí•© í…ŒìŠ¤íŠ¸

```typescript
describe('Body Analysis Integration', () => {
  it('should complete full analysis pipeline', async () => {
    const input: BodyAnalysisInput = {
      imageBase64: loadTestImage('full-body-female.jpg'),
      gender: 'female',
      ageGroup: '30s',
    };

    const result = await analyzeBody(input);

    expect(result.success).toBe(true);
    expect(result.bodyShape.type).toBeDefined();
    expect(result.bodyShape.confidence).toBeGreaterThan(0.5);
    expect(result.measurements.shoulderWidth).toBeGreaterThan(0);
    expect(result.recommendations?.styling.length).toBeGreaterThan(0);
  });

  it('should fall back to MediaPipe when AI fails', async () => {
    vi.spyOn(geminiClient, 'generate').mockRejectedValue(new Error('Timeout'));

    const input: BodyAnalysisInput = {
      imageBase64: loadTestImage('full-body-male.jpg'),
      gender: 'male',
    };

    const result = await analyzeBody(input);

    expect(result.success).toBe(true);
    expect(result.metadata.analysisMethod).toBe('mediapipe');
  });
});
```

---

## 10. ê´€ë ¨ ë¬¸ì„œ ë§í¬

| ë¬¸ì„œ | ì„¤ëª… |
|------|------|
| [body-mechanics.md](../principles/body-mechanics.md) | ì²´í˜• ì—­í•™ ì›ë¦¬ |
| [image-processing.md](../principles/image-processing.md) | ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ì›ë¦¬ |
| [ADR-001](../adr/ADR-001-core-image-engine.md) | Core Image Engine ê²°ì • |
| [ADR-003](../adr/ADR-003-ai-model-selection.md) | AI ëª¨ë¸ ì„ íƒ ê²°ì • |
| [SDD-CIE-3](./SDD-CIE-3-AWB-CORRECTION.md) | í™”ì´íŠ¸ë°¸ëŸ°ìŠ¤ ë³´ì • |
| *(ë³¸ ë¬¸ì„œ)* | ì²´í˜•ë¶„ì„ ìŠ¤í™ (C-1 í†µí•©) |

---

## 11. ì˜ë£Œ ë©´ì±… ê³ ì§€

```
âš ï¸ ì¤‘ìš” ì˜ë£Œ ë©´ì±…

ì´ ë¬¸ì„œì˜ ì²´í˜• ë¶„ì„ì€ ì›°ë‹ˆìŠ¤ ë° í”¼íŠ¸ë‹ˆìŠ¤ ì°¸ê³  ëª©ì ì´ë©°,
ì˜ë£Œ ì§„ë‹¨ì´ë‚˜ ë¬¼ë¦¬ì¹˜ë£Œë¥¼ ëŒ€ì²´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ë‹¤ìŒ ì‚¬í•­ì€ ë°˜ë“œì‹œ ì „ë¬¸ê°€ ìƒë‹´ì´ í•„ìš”í•©ë‹ˆë‹¤:
- ì²´í˜• ì´ìƒìœ¼ë¡œ ì¸í•œ ë§Œì„± í†µì¦
- ì²™ì¶”ì¸¡ë§Œì¦, ê³¨ë°˜ ë¶ˆê· í˜• ë“± êµ¬ì¡°ì  ë¬¸ì œ
- BMI ê·¹ë‹¨ê°’ (18.5 ë¯¸ë§Œ ë˜ëŠ” 30 ì´ìƒ)
- ê¸‰ê²©í•œ ì²´ì¤‘ ë³€í™”

ì²´í˜• ë¶„ì„ ê²°ê³¼ ë° ìŠ¤íƒ€ì¼/ìš´ë™ ì¶”ì²œì€ ì°¸ê³ ìš©ì´ë©°,
ì „ë¬¸ì˜ ë˜ëŠ” í¼ìŠ¤ë„ íŠ¸ë ˆì´ë„ˆì™€ ìƒë‹´ í›„ ì‹¤í–‰í•˜ì„¸ìš”.
```

---

**Author**: Claude Code
**Reviewed by**: -
