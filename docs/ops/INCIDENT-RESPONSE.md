# 위기 대응 플레이북

> **Version**: 1.0 | **Updated**: 2026-01-21
> **Status**: `active`

---

## 1. 개요

이 문서는 이룸 서비스 운영 중 발생할 수 있는 장애 및 위기 상황에 대한 대응 절차를 정의합니다.

---

## 2. 심각도 분류

### 2.1 심각도 레벨

| 레벨 | 이름 | 정의 | 대응 시간 |
|------|------|------|----------|
| **P0** | Critical | 서비스 전체 중단 | 15분 이내 |
| **P1** | High | 핵심 기능 장애 (분석, 인증) | 1시간 이내 |
| **P2** | Medium | 부가 기능 장애 | 4시간 이내 |
| **P3** | Low | 경미한 버그/성능 저하 | 24시간 이내 |

### 2.2 예시

```
┌─────────────────────────────────────────────────────────────────┐
│                   심각도별 장애 예시                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   P0 (Critical)                                                  │
│   ├── 전체 서비스 접속 불가                                      │
│   ├── 데이터베이스 다운                                          │
│   ├── 보안 침해 (데이터 유출)                                    │
│   └── 결제 시스템 장애 (유료 서비스)                             │
│                                                                  │
│   P1 (High)                                                      │
│   ├── AI 분석 기능 전체 실패                                     │
│   ├── 로그인/회원가입 불가                                       │
│   ├── 이미지 업로드 실패                                         │
│   └── API 에러율 10% 초과                                        │
│                                                                  │
│   P2 (Medium)                                                    │
│   ├── 특정 분석 유형 실패                                        │
│   ├── 푸시 알림 미작동                                           │
│   ├── 일부 페이지 렌더링 오류                                    │
│   └── 성능 저하 (응답 5초 초과)                                  │
│                                                                  │
│   P3 (Low)                                                       │
│   ├── UI 깨짐 (특정 기기)                                        │
│   ├── 번역 오류                                                  │
│   ├── 간헐적 느린 응답                                           │
│   └── 문서/도움말 오류                                           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 대응 프로세스

### 3.1 장애 감지

```
┌─────────────────────────────────────────────────────────────────┐
│                   장애 감지 경로                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   자동 감지                                                      │
│   ├── Vercel 알림 (배포 실패, 에러 급증)                         │
│   ├── Sentry 알림 (에러 임계값 초과)                             │
│   ├── Uptime 모니터링 (서비스 다운)                              │
│   └── Supabase 알림 (DB 이상)                                    │
│                                                                  │
│   수동 감지                                                      │
│   ├── 사용자 문의/신고                                           │
│   ├── 내부 테스트 중 발견                                        │
│   └── SNS 모니터링                                               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 초기 대응 (15분 이내)

```markdown
## 1단계: 확인 (5분)

□ 장애 현상 확인
□ 영향 범위 파악
□ 심각도 판정
□ 담당자 호출

## 2단계: 공유 (5분)

□ Slack/카톡 장애 알림
□ 상태 페이지 업데이트 (해당 시)
□ 1차 원인 추정 공유

## 3단계: 착수 (5분)

□ 원인 조사 시작
□ 로그 확인
□ 롤백 필요 여부 판단
```

### 3.3 상세 대응

```typescript
// 장애 대응 프로세스
interface IncidentResponse {
  // P0/P1: 즉시 대응
  immediate: {
    rollback: boolean;           // 롤백 필요 여부
    hotfix: boolean;             // 핫픽스 가능 여부
    workaround: string | null;   // 임시 우회 방법
  };

  // 원인 분석
  rootCause: {
    category: 'code' | 'infra' | 'external' | 'unknown';
    description: string;
    timeline: string;            // 장애 발생 시점
  };

  // 복구
  recovery: {
    actions: string[];           // 복구 조치
    verification: string[];      // 복구 확인 방법
    estimatedTime: string;       // 예상 복구 시간
  };

  // 사후 조치
  postmortem: {
    preventionMeasures: string[];
    followUpTasks: string[];
  };
}
```

---

## 4. 유형별 대응 가이드

### 4.1 서비스 다운 (P0)

```markdown
## 원인: Vercel 배포 문제

### 확인
□ Vercel 대시보드 확인
□ 최근 배포 이력 확인
□ 빌드 로그 확인

### 대응
□ 이전 버전으로 롤백 (Vercel 대시보드 > Deployments > Rollback)
□ 롤백 후 서비스 정상화 확인
□ 문제 커밋 식별 및 수정

### 명령어
```bash
# Vercel CLI 롤백 (선택)
vercel rollback [deployment-url]
```
```

### 4.2 AI 분석 실패 (P1)

```markdown
## 원인: Gemini API 장애

### 확인
□ Gemini API 상태 확인 (status.cloud.google.com)
□ API 에러 로그 확인
□ Rate Limit 확인

### 대응
□ Mock Fallback 활성화 확인
□ 사용자에게 일시적 장애 안내
□ Gemini 복구 대기 또는 대체 모델 검토

### 확인 명령어
```bash
# API 상태 확인
curl -X POST "https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent" \
  -H "x-goog-api-key: $API_KEY" \
  -H "Content-Type: application/json"
```
```

### 4.3 데이터베이스 장애 (P0)

```markdown
## 원인: Supabase 다운

### 확인
□ Supabase 상태 확인 (status.supabase.com)
□ 프로젝트 대시보드 확인
□ 연결 테스트

### 대응
□ Supabase 복구 대기
□ 읽기 전용 모드 전환 (가능 시)
□ 사용자 안내 (서비스 일시 중단)

### 복구 후
□ 데이터 무결성 확인
□ 누락 데이터 복구 (백업에서)
```

### 4.4 보안 침해 (P0)

```markdown
## 의심 징후
- 비정상적 접근 패턴
- 대량 데이터 조회
- 인증 우회 시도

### 즉시 조치
□ 의심 계정/IP 차단
□ API 키 로테이션
□ 접근 로그 보존
□ 법률 자문 (유출 확인 시)

### 보고 의무
□ 개인정보 유출 시 72시간 내 신고 (PIPA)
□ 정보주체 통지
```

---

## 5. 커뮤니케이션

### 5.1 내부 커뮤니케이션

```markdown
## 장애 알림 템플릿 (Slack)

🚨 **[P{level}] 장애 발생**

**현상**: {현상 설명}
**영향**: {영향 범위}
**시작**: {시작 시간}
**담당**: @{담당자}

**상태**: 조사 중 / 복구 중 / 복구 완료
```

### 5.2 사용자 커뮤니케이션

```markdown
## 장애 공지 템플릿

**제목**: [안내] 서비스 일시 장애

안녕하세요, 이룸입니다.

현재 {기능명} 서비스에 일시적인 장애가 발생하여
복구 작업을 진행하고 있습니다.

- 발생 시간: {시간}
- 영향 범위: {범위}
- 예상 복구: {예상 시간}

불편을 드려 죄송합니다.
빠른 시간 내에 복구하겠습니다.

감사합니다.
이룸 팀 드림
```

---

## 6. 사후 분석 (Postmortem)

### 6.1 Postmortem 템플릿

```markdown
# 장애 보고서: {제목}

## 개요
- 날짜: YYYY-MM-DD
- 심각도: P{level}
- 지속 시간: X시간 Y분
- 영향: {영향받은 사용자 수}

## 타임라인
- HH:MM - 장애 감지
- HH:MM - 대응 시작
- HH:MM - 원인 파악
- HH:MM - 복구 완료

## 근본 원인
{근본 원인 상세 설명}

## 영향
- 사용자 영향: {설명}
- 비즈니스 영향: {설명}

## 대응 조치
1. {조치 1}
2. {조치 2}

## 재발 방지
1. {방지 조치 1}
2. {방지 조치 2}

## 후속 작업
- [ ] {작업 1} - 담당: @xxx - 기한: MM/DD
- [ ] {작업 2} - 담당: @xxx - 기한: MM/DD
```

### 6.2 Postmortem 회의

```markdown
## 참석자
- 장애 대응 담당자
- 관련 개발자
- PM (P0/P1)

## 논의 사항
□ 타임라인 검토
□ 대응 적절성 평가
□ 재발 방지 조치 확정
□ 후속 작업 할당
```

---

## 7. 비상 연락망

### 7.1 에스컬레이션 경로

```
Level 1 (5분)  → 담당 개발자
Level 2 (15분) → 시니어/리드
Level 3 (30분) → CEO/CTO
```

### 7.2 외부 연락처

| 서비스 | 지원 채널 | 우선순위 |
|--------|----------|----------|
| Vercel | support@vercel.com | 높음 |
| Supabase | support@supabase.io | 높음 |
| Clerk | support@clerk.dev | 높음 |
| Google Cloud | Cloud Console Support | 높음 |

---

## 관련 문서

- [docs/ops/LAUNCH-CHECKLIST.md](LAUNCH-CHECKLIST.md) - 출시 체크리스트
- [docs/ops/QA-PROCESS.md](QA-PROCESS.md) - QA 프로세스
- [.claude/rules/security-checklist.md](../../.claude/rules/security-checklist.md) - 보안 체크리스트

---

**Author**: Claude Code
